var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?s(n):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){t.call(this),this.resLoad=!1,this.themeLoad=!1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){var e=this,i=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",i),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/"),flashUtils.stage=this.stage,egret.TextField.default_fontFamily="SimHei",document.addEventListener("keydown",function(t){e.keyHandler(t)})},s.keyHandler=function(t){t.ctrlKey&&90==t.keyCode?LightUtils.ctrlZ():t.ctrlKey&&89==t.keyCode&&LightUtils.ctrlY()},s.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),ResourceUtils.getInstance().loadResource([],["preload","icons","config"],this.onResMainComplete,this.onResourceLoadProgress,this)},s.onResourceLoadProgress=function(t){},s.onResMainComplete=function(t){if(this.resLoad=!0,this.themeLoad&&this.resLoad){mouse.enable(this.stage);var e=new MainView(this.stage);this.addChild(e)}},s.onThemeLoadComplete=function(t){if(this.themeLoad=!0,this.themeLoad&&this.resLoad){mouse.enable(this.stage);var e=new MainView(this.stage);this.addChild(e)}},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,s){function n(t){e.call(s,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var BaseEuiView=function(t){function e(e){t.call(this),this._myParent=e,this._isInit=!1,this.percentHeight=100,this.percentWidth=100,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.createCompleteEvent=function(){this.initUI()},i(n,"myParent",function(){return this._myParent}),n.isInit=function(){return this._isInit},n.isShow=function(){return null!=this.stage&&this.visible},n.addToParent=function(){this._myParent.addChild(this)},n.removeFromParent=function(){null!=this._myParent&&this._myParent.removeChild(this)},n.initUI=function(){this._isInit=!0},n.initData=function(){},n.destroy=function(){this._myParent=null},n.setVisible=function(t){this.visible=t},e}(eui.Component);egret.registerClass(BaseEuiView,"BaseEuiView");var BasePhyView=function(t){function e(e,i){void 0===i&&(i=!0),t.call(this),this._homeElectric=null,this.isP2=!0,this.stageV=e,this.isP2=i,this.initUI()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initItemView=function(){},s.initUI=function(){this.isP2&&this.initWorld(),this.itemContainer=new egret.Sprite,this.itemContainer.graphics.beginFill(MainView.MainColor),this.itemContainer.graphics.drawRect(MainView.mainRect[0],MainView.mainRect[1],MainView.mainRect[2]-MainView.mainRect[0],MainView.mainRect[3]-MainView.mainRect[1]),this.itemContainer.graphics.endFill(),this.addChildAt(this.itemContainer,0),this.isP2&&this.addEventListener(egret.Event.ENTER_FRAME,this.loop,this),this.panelContainer=new egret.Sprite,this.addChildAt(this.panelContainer,1),this.maskC=new egret.Sprite,this.maskC.graphics.beginFill(65280),this.maskC.graphics.drawRect(MainView.mainRect[0],MainView.mainRect[1],MainView.mainRect[2]-MainView.mainRect[0],MainView.mainRect[3]-MainView.mainRect[1]),this.maskC.graphics.endFill(),this.addChild(this.maskC),this.itemContainer.mask=this.maskC},s.initWorld=function(){this.world=new p2.World({gravity:[0,0]}),this.debugDraw=new p2DebugDraw(this.world);var t=new egret.Sprite;this.addChild(t),this.debugDraw.setSprite(t)},s.loop=function(){this.world.step(.06),this.render()},s.render=function(){},s.dispose=function(){this.world&&this.world.clear()},e.hit=!1,e}(egret.DisplayObjectContainer);egret.registerClass(BasePhyView,"BasePhyView");var BaseClass=function(){function t(){}var e=(__define,t);e.prototype;return t.getInstance=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=this;if(!i._instance){var s=t.length;0==s?i._instance=new i:1==s?i._instance=new i(t[0]):2==s?i._instance=new i(t[0],t[1]):3==s?i._instance=new i(t[0],t[1],t[2]):4==s?i._instance=new i(t[0],t[1],t[2],t[3]):5==s&&(i._instance=new i(t[0],t[1],t[2],t[3],t[4]))}return i._instance},t}();egret.registerClass(BaseClass,"BaseClass");var ItemTop=function(t){function e(e){t.call(this),this.skinName="resource/skins/ItemTopSkin.exml",this.item=e,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){var e=this;this.rotaBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRotation,this),this.delBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDel,this),this.copyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCopy,this),this.border=new egret.Sprite,this.addChild(this.border),this.border.graphics.lineStyle(2,12500670),egret.callLater(function(){LightUtils.drawDotBorder(e.border,e.item.bitMap.x-20,e.item.bitMap.y-20,e.item.bitMap.x+e.item.bitMap.width+20,e.item.bitMap.y-20,e.item.bitMap.x+e.item.bitMap.width+20,e.item.bitMap.y+e.item.bitMap.height+20,e.item.bitMap.x-20,e.item.bitMap.y+e.item.bitMap.height+20),e.border.anchorOffsetX=e.border.width/2-20,e.border.anchorOffsetY=e.border.height/2-20,egret.callLater(function(){e.setPos(-e.width/2,-150)},e)},this)},s.setPos=function(t,e){this.border.x=-t,this.border.y=-e,this.topGroup.y=-this.border.height/2,this.box1.x=this.border.x-this.border.width/2,this.box1.y=this.border.y-this.border.height/2,this.box2.x=this.border.x+this.border.width/2,this.box2.y=this.border.y-this.border.height/2,this.box3.x=this.border.x-this.border.width/2,this.box3.y=this.border.y+this.border.height/2,this.box4.x=this.border.x+this.border.width/2,this.box4.y=this.border.y+this.border.height/2,this.item instanceof FishItem?(this.x=270,this.y=60):this.item instanceof KuaiziItem?(this.x=100,this.y=0,this.topGroup.x=230,this.topGroup.y=0,this.box1.x=105,this.box1.y=148,this.box2.x=575,this.box2.y=148,this.box3.x=105,this.box3.y=480,this.box4.x=575,this.box4.y=480):(this.x=t,this.y=e)},s.onRotation=function(t){var e=-this.item.rotation+90;this.item.setRotation(e),LightUtils.saveOpera()},s.onDel=function(t){this.item.dispose(),LightUtils.saveOpera()},s.onCopy=function(t){var e=this.item.getProObj();MessageCenter.getInstance().dispatch(ItemEventConst.COPY_ITEM,e),LightUtils.saveOpera()},e}(eui.Component);egret.registerClass(ItemTop,"ItemTop");var EItemTop=function(t){function e(e){t.call(this,e),this.skinName="resource/skins/EItemTopSkin.exml",this.item=e,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.delBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDel,this),this.copyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCopy,this),this.border=new egret.Sprite,this.addChild(this.border),this.border.graphics.lineStyle(2,12500670),LightUtils.drawDotBorder(this.border,this.item.bitMap.x-20,this.item.bitMap.y-20,this.item.bitMap.x+this.item.bitMap.width+20,this.item.bitMap.y-20,this.item.bitMap.x+this.item.bitMap.width+20,this.item.bitMap.y+this.item.bitMap.height+20,this.item.bitMap.x-20,this.item.bitMap.y+this.item.bitMap.height+20),this.border.anchorOffsetX=this.border.width/2-20,this.border.anchorOffsetY=this.border.height/2-20},s.setPos=function(e,i){t.prototype.setPos.call(this,e,i)},s.onRotation=function(t){},s.onDel=function(e){t.prototype.onDel.call(this,e)},s.onCopy=function(e){t.prototype.onCopy.call(this,e)},e}(ItemTop);egret.registerClass(EItemTop,"EItemTop");var EuiButton=function(t){function e(){t.call(this),this.touchEnabled=!0,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.currImg=this.getChildAt(0),this.currImgName=this.currImg._source,this.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),this.addEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this)},s.onMouseOver=function(t){for(var e=0;e<MainView.getInstance().btnArr.length;e++){var i=MainView.getInstance().btnArr[e].getChildAt(0),s=MainView.getInstance().btnNameArr[e];s!=this.currImgName&&(i.source=RES.getRes(s))}this.currImg.source=RES.getRes(this.currImgName.replace("up","over"))},s.onMouseOut=function(t){this.currImg.source=RES.getRes(this.currImgName)},e}(eui.Button);egret.registerClass(EuiButton,"EuiButton");var Item=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this),this.hasX=!1,this.openPro=!1,this.ro=!1,this.move=!1,this.world=e,this.touchEnabled=!0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddCom,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddCom=function(t){this.init()},s.init=function(){this.bitMap&&(this.roSpot=new egret.Bitmap,this.roSpot.texture=RES.getRes("rotation_png"),this.roSpot.visible=!1,this.roSpot.anchorOffsetX=this.roSpot.width/2,this.roSpot.anchorOffsetY=2.4*this.roSpot.height/4,this.roSpot.touchEnabled=!0,this.roSpot.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onSpotBegin,this),this.bitMap.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.bitMap.pixelHitTest=!0,this.itemTop=new ItemTop(this),this.addChild(this.itemTop),this.itemTop.visible=!1,this.roSpot.y=-this.bitMap.height/2-80,this.addChild(this.roSpot),this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.openProPanelBegin,this))},s.openProPanelBegin=function(t){this.openPro=!0},s.openProPanel=function(t){if(this.openPro){for(var e=this.parent.numChildren,i=0;e>i;i++){var s=this.parent.getChildAt(i);s!==this&&s.itemTop&&(s.itemTop.visible=!1,s.roSpot.visible=!1)}this.itemTop&&(this.itemTop.visible=!this.itemTop.visible,this.openPro=!1,this.roSpot.visible=this.itemTop.visible)}},s.onSpotBegin=function(t){t.stopPropagation(),this.ro=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this);var e=t.stageX-this.x,i=t.stageY-this.y;this.pressR=Math.atan2(i,e)},s.onStageMove=function(t){if(1==this.ro){var e=t.stageX-this.x,i=t.stageY-this.y,s=Math.atan2(i,e),n=s-this.pressR;this.pressR=s,this.rotation+=180*n/Math.PI}else this.stage&&(this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this));this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this)},s.onStagEnd=function(t){this.ro=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),LightUtils.saveOpera()},s.onBegin=function(t){this.startX=t.stageX,this.startY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.x,this.y,e);this.offX=this.startX-i.x,this.offY=this.startY-i.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.move=!1,BasePhyView.hit=!1},s.onMove=function(t){return this.ro?(this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),void this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)):(this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),void(BasePhyView.hit?(this.x=this.x,this.y=this.y):(this.x=t.stageX-this.offX,this.y=t.stageY-this.offY,this.move=!0)))},s.onEnd=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.move&&(LightUtils.saveOpera(),this.move=!1)},s.getProObj=function(){return null},s.dispose=function(){this.parent&&(this.parent.parent._currentInfoPanel&&(this.parent.parent._currentInfoPanel.visible=!1),this.parent.removeChild(this))},e}(eui.Component);egret.registerClass(Item,"Item",["InterPro"]);var TextInput2=function(t){function e(){t.call(this),this.maxNum=10,this.minNum=0,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.upBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onUp,this),this.downBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDown,this)},s.onUp=function(t){this.num++,this.num=Math.min(this.maxNum,this.num),this.setNum(this.num)},s.onDown=function(t){this.num--,this.num=Math.max(this.minNum,this.num),this.setNum(this.num)},s.setNum=function(t){this.numTxt.text=t+"",this.num=t,this.fun&&this.fun(this.num)},s.setFun=function(t){this.fun=t},e}(eui.Component);egret.registerClass(TextInput2,"TextInput2");var ItemEventConst=function(){function t(){}var e=(__define,t);e.prototype;return t.ADD_ITEM="ADD_ITEM",t.COPY_ITEM="COPY_ITEM",t.CANDLE_LIGHT="CANDLE_LIGHT",t.CLOSE_SCROLLER="CLOSE_SCROLLER",t.LINE_DRAW_START="LINE_DRAW_START",t.LINE_DRAW_STOP="LINE_DRAW_STOP",t.SHOW_SCROLLER="SHOW_SCROLLER",t.DIANLU_CONNECT_CHANGED="DIANLU_CONNECT_CHANGED",t.EXPORT_ITEM="EXPORT_ITEM",t.ADD_DIANLU_ITEM_DOWN="ADD_DIANLU_ITEM_DOWN",t.ADD_DIANLU_ITEM_MOVE="ADD_DIANLU_ITEM_MOVE",t.ADD_DIANLU_ITEM_END="ADD_DIANLU_ITEM_END",t.MODIFY_DIANLU_ITEM_DOWN="MODIFY_DIANLU_ITEM_DOWN",t.MODIFY_DIANLU_ITEM_MOVE="MODIFY_DIANLU_ITEM_MOVE",t.MODIFY_DIANLU_ITEM_END="MODIFY_DIANLU_ITEM_END",t.DRAW_DIANLU_LINE_DOWN="DRAW_DIANLU_LINE_DOWN",t.DRAW_DIANLU_LINE_MOVE="DRAW_DIANLU_LINE_MOVE",t.DRAW_DIANLU_LINE_END="DRAW_DIANLU_LINE_END",t}();egret.registerClass(ItemEventConst,"ItemEventConst");var MessageCenter=function(t){function e(e){void 0===e&&(e=1),t.call(this),this.dict={},this.eVec=new Array}__extends(e,t);var i=(__define,e),s=i.prototype;return s.clear=function(){this.dict={},this.eVec.splice(0)},s.addListener=function(t,e,i){var s=this.dict[t];null==s&&(s=new Array,this.dict[t]=s);var n=0,r=s.length;for(n;r>n;n++)if(s[n][0]==e&&s[n][1]==i)return;s.push([e,i])},s.removeListener=function(t,e,i){var s=this.dict[t];if(null!=s){var n=0,r=s.length;for(n;r>n;n++)if(s[n][0]==e&&s[n][1]==i){s.splice(n,1);break}0==s.length&&(this.dict[t]=null,delete this.dict[t])}},s.removeAll=function(t){for(var e=Object.keys(this.dict),i=0,s=e.length;s>i;i++){for(var n=e[i],r=this.dict[n],h=0;h<r.length;h++)r[h][1]==t&&(r.splice(h,1),h--);0==r.length&&(this.dict[n]=null,delete this.dict[n])}},s.dispatch=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(null!=this.dict[t]){var s=ObjectPool.pop("MessageVo");s.type=t,s.param=e,this.dealMsg(s)}},s.dealMsg=function(t){for(var e=this.dict[t.type],i=0,s=e.length,n=null;s>i;)n=e[i],n[0].apply(n[1],t.param),e.length!=s&&(s=e.length,i--),i++;t.dispose(),ObjectPool.push(t)},e}(BaseClass);egret.registerClass(MessageCenter,"MessageCenter");var MessageVo=function(){function t(){}var e=(__define,t),i=e.prototype;return i.dispose=function(){this.type=null,this.param=null},t}();egret.registerClass(MessageVo,"MessageVo");var LabType=function(){function t(){}var e=(__define,t);e.prototype;return t.LightLab=1001,t.ElectricsLab=1002,t.HomeElectric=1003,t.ElectricField=1004,t.ElectromagLab=1005,t}();egret.registerClass(LabType,"LabType");var ChargesAndFieldsConstants=function(){function t(){}var e=(__define,t);e.prototype;return t.WIDTH=16,t.HEIGHT=12,t.K_CONSTANT=9,t.MIN_DISTANCE_SCALE=1e-9,t.MAX_EFIELD_MAGNITUDE=1e6,t.ELECTRIC_POTENTIAL_SENSOR_SPACING=.1,t.GRID_MAJOR_SPACING=.5,t.ELECTRIC_FIELD_SENSOR_SPACING=.5,t.EFIELD_COLOR_SAT_MAGNITUDE=5,t.SCALE_METER=1920/t.WIDTH,t}();egret.registerClass(ChargesAndFieldsConstants,"ChargesAndFieldsConstants");var ElecFieldEventConst=function(){function t(){}var e=(__define,t);e.prototype;return t.ADD_PARITICLES="ADD_PARITICLES",t.REMOVE_PARITICLES="REMOVE_PARITICLES",t.ADD_SENSORS="ADD_SENSORS",t.ADD_LINES="ADD_LINES",t.REMOVE_LINES="REMOVE_LINES",t}();egret.registerClass(ElecFieldEventConst,"ElecFieldEventConst");var ElecFieldItem=function(t){function e(){t.call(this),this.touchEnabled=!0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddCom,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddCom=function(t){this.init()},s.init=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!0),this.bitMap=new egret.Bitmap,e&&(this.bitMap.texture=RES.getRes(t)),this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.bitMap.touchEnabled=!0,this.addChild(this.bitMap),this.bitMap.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this)},s.onBegin=function(t){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),flashUtils.startDrag(this)},s.onEnd=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),flashUtils.stopDrag(this)},s.Position=function(t){this.x=t[0],this.y=t[1]},s.getProObj=function(){return null},e}(eui.Component);egret.registerClass(ElecFieldItem,"ElecFieldItem",["InterPro"]);var PointUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.normalize=function(t){var e=this.magnitude(t);if(0===e)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t,e)},t.magnitude=function(t){return Math.sqrt(this.magnitudeSquared(t))},t.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},t.divideScalar=function(t,e){return this.setXY(t.x/e,t.y/e)},t.setXY=function(t,e){return egret.Point.create(t,e)},t.rotate=function(t,e){var i=this.angle(t)+e,s=this.magnitude(t);return this.setXY(s*Math.cos(i),s*Math.sin(i))},t.angle=function(t){return Math.atan2(t.y,t.x)},t.multiplyScalar=function(t,e){return this.setXY(t.x*e,t.y*e)},t.add=function(t,e){return this.setXY(t.x+e.x,t.y+e.y)},t.timesScalar=function(t,e){return new egret.Point(t.x*e,t.y*e)},t.plus=function(t,e){return new egret.Point(t.x+e.x,t.y+e.y)},t.minus=function(t,e){return new egret.Point(t.x-e.x,t.y-e.y)},t.clamp=function(t,e,i){return t>=e&&i>=t?t:e>t?e:t>i?i:void 0},t.angleBetween=function(t,e){var i=this.magnitude(t),s=this.magnitude(e);return Math.acos(this.clamp((t.x*e.x+t.y*e.y)/(i*s),-1,1))},t.distanceSquared=function(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},t.copy=function(t){return new egret.Point(t.x,t.y)},t.crossScalar=function(t,e){return t.x*e.y-t.y*e.x},t.modelToViewPosition=function(t){return new egret.Point(t.x*ChargesAndFieldsConstants.SCALE_METER,t.y*ChargesAndFieldsConstants.SCALE_METER)},t.viewToModelPosition=function(t){return egret.Point.create(t.x/ChargesAndFieldsConstants.SCALE_METER,t.y/ChargesAndFieldsConstants.SCALE_METER)},t}();egret.registerClass(PointUtils,"PointUtils");var Tandem=function(){function t(t,e){void 0===e&&(e=null),this.statics=!1,this.isDefaultTandem=!1,this.id=void 0!==t?t:""}var e=(__define,t),i=e.prototype;return t.createRootTandem=function(){return new t("chargesAndFields.chargesAndFieldsScreen")},i.createGroupTandem=function(t){return new GroupTandem(this.id+"."+t)},i.createTandem=function(e,i){void 0===i&&(i=null);var s=this.id.length>0?this.id+"."+e:e;return new t(s,i)},t}();egret.registerClass(Tandem,"Tandem");var GroupTandem=function(t){function e(e){t.call(this,e),this.groupElementIndex=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createSpecificTandem=function(t){return new Tandem(this.id+"_"+t)},s.createNextTandem=function(){return new Tandem(this.id+"_"+this.groupElementIndex++)},e}(Tandem);egret.registerClass(GroupTandem,"GroupTandem");var ModelElement=function(){function t(t,e){this._position=new egret.Point,this._isUserControlled=!1,this._isActive=!1,this.isInteractive=!0,this.isAnimated=!1,this.initialPosition=null}var e=(__define,t),i=e.prototype;return i.animate=function(){},t}();egret.registerClass(ModelElement,"ModelElement");var ChargedParticle=function(t){function e(e){t.call(this),this._oldPosition=new egret.Point,1===e||-1===e?this.charge=e:console.log("Charges should be +1 or -1"),this.uId=Date.now()}__extends(e,t);var i=__define,s=e,n=s.prototype;return i(n,"position",function(){return this._position},function(t){this._oldPosition.x=this._position.x,this._oldPosition.y=this._position.y,this._position.x=t.x,this._position.y=t.y,ChargesAndFieldsModel.getInstance().positionListener(this,this._position,this._oldPosition),ChargesAndFieldsScreenView.getInstance().electricFieldGridNode.chargeTracker.upDatePos(this,this._position,this._oldPosition),ChargesAndFieldsScreenView.getInstance().electricFieldGridNode.paintCanvas()}),e}(ModelElement);egret.registerClass(ChargedParticle,"ChargedParticle");var ChargesAndFieldsModel=function(){function t(){this.isElectricFieldVisible=!0,this.isElectricFieldDirectionOnly=!1,this.isElectricPotentialVisible=!1,this.areValuesVisible=!1,this.isGridVisible=!1,this.isPlayAreaCharged=!1,this.allowNewPositiveCharges=!0,this.allowNewNegativeCharges=!0,this.allowNewElectricFieldSensors=!0,this.hideTogglingElectricFieldVisibility=!1,this.hideTogglingElectricFieldDirectionOnly=!1,this.hideTogglingElectricPotentialVisibility=!1,this.hideTogglingValuesVisibility=!1,this.hideTogglingGridVisibility=!1,this.isResetting=!1,this.isResetting=!1,this.enlargedBounds=new egret.Rectangle(0,0,ChargesAndFieldsConstants.WIDTH,ChargesAndFieldsConstants.HEIGHT),this.activeChargedParticles=[],this.electricFieldSensors=[],this.electricPotentialLines=[],MessageCenter.getInstance().addListener(ElecFieldEventConst.ADD_PARITICLES,this.addParticlesAddedListener,this),MessageCenter.getInstance().addListener(ElecFieldEventConst.ADD_SENSORS,this.addSensorsAddedListener,this),t._instance=this}var e=(__define,t),i=e.prototype;return t.getInstance=function(){return t._instance},i.addParticlesAddedListener=function(t){this.activeChargedParticles.push(t)},i.positionListener=function(t,e,i){this.updateIsPlayAreaCharged(),this.updateAllSensors(),this.clearElectricPotentialLines()},i.addItemRemovedListener=function(t){t.isActive&&!this.isResetting&&(this.clearElectricPotentialLines(),this.updateAllSensors()),this.activeChargedParticles.remove(t),this.updateIsPlayAreaCharged()},i.clearElectricPotentialLines=function(){for(var t=0;t<this.electricPotentialLines.length;t++){var e=this.electricPotentialLines[t];e.clear()}this.electricPotentialLines=[]},i.updateIsPlayAreaCharged=function(){var t=0,e=0;this.activeChargedParticles.forEach(function(i){e++,t+=i.charge}),0!==t&&(this.isPlayAreaCharged=!0)},i.getElectricPotentialChange=function(t,e,i,s){var n=egret.Point.distance(e,t),r=egret.Point.distance(i,t);return s*ChargesAndFieldsConstants.K_CONSTANT*(1/n-1/r)},i.getElectricPotential=function(t){var e=0;return this.isPlayAreaCharged?(this.activeChargedParticles.forEach(function(i){var s=egret.Point.distance(i.position,t);e+=i.charge/s}),e*=ChargesAndFieldsConstants.K_CONSTANT):e},i.addSensorsAddedListener=function(t){this.electricFieldSensors.push(t)},i.getElectricField=function(t){this.updateIsPlayAreaCharged();var e=new egret.Point(0,0);return this.isPlayAreaCharged?(this.activeChargedParticles.forEach(function(i){var s=(i.position.x-t.x)*(i.position.x-t.x)+(i.position.y-t.y)*(i.position.y-t.y);if(s<ChargesAndFieldsConstants.MIN_DISTANCE_SCALE)return e.x=10*ChargesAndFieldsConstants.MAX_EFIELD_MAGNITUDE,void(e.y=0);var n=Math.pow(s,1.5),r={x:(t.x-i.position.x)*i.charge/n,y:(t.y-i.position.y)*i.charge/n};e.x=e.x+r.x,e.y=e.y+r.y}),e.x=e.x*ChargesAndFieldsConstants.K_CONSTANT,e.y=e.y*ChargesAndFieldsConstants.K_CONSTANT,e):e},i.addElectricPotentialLine=function(t){if(this.isPlayAreaCharged){for(var e=!1,i=0;i<this.activeChargedParticles.length;i++){var s=this.activeChargedParticles[i];Math.sqrt(PointUtils.distanceSquared(s.position,t))<.03&&(e=!0)}if(!e){var n=new ElectricPotentialLine(t,this.enlargedBounds,this.activeChargedParticles,this.getElectricPotential.bind(this),this.getElectricField.bind(this),this.isPlayAreaCharged);this.electricPotentialLines.push(n),MessageCenter.getInstance().dispatch(ElecFieldEventConst.ADD_LINES,n)}}},i.updateAllSensors=function(){for(var t=0;t<this.electricFieldSensors.length;t++){var e=this.electricFieldSensors[t];e.electricFieldChange(e.electricFieldSensor.electricField)}},t._instance=null,t}();egret.registerClass(ChargesAndFieldsModel,"ChargesAndFieldsModel");var ElectricFieldSensor=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return i(n,"position",function(){return this._position},function(t){this._position.x=t.x,this._position.y=t.y}),i(n,"electricField",function(){return ChargesAndFieldsModel.getInstance().getElectricField(this.position)}),n.dispose=function(){this.disposeElectricFieldSensor()},n.disposeElectricFieldSensor=function(){},e}(ModelElement);egret.registerClass(ElectricFieldSensor,"ElectricFieldSensor");var ElectricPotentialLine=function(t){function e(e,i,s,n,r,h){t.call(this),this.MAX_STEPS=5e3,this.MIN_STEPS=1e3,this.MAX_EPSILON_DISTANCE=.05,this.MIN_EPSILON_DISTANCE=.01,this.getElectricPotential=n,this.getElectricField=r,this.chargedParticles=s,this.bounds=i,this.isPlayAreaChargedProperty=h,this.position=e,this.electricPotential=n(e),this.isLineClosed=!1,this.isEquipotentialLineTerminatingInsideBounds=!0,this.positionArray=[],this.positionArray=this.getEquipotentialPositionArray(e),this.shape=new egret.Shape,this.shape.graphics.lineStyle(2,16711680);var o=this.getPrunedPositionArray(this.positionArray);this.positionArrayToStraightLine(this.shape,o,{isClosedLineSegments:this.isLineClosed}),this.addChild(this.shape)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.update=function(){this.positionArray=this.getEquipotentialPositionArray(this.position);var t=this.getPrunedPositionArray(this.positionArray);this.positionArrayToStraightLine(this.shape,t,{isClosedLineSegments:this.isLineClosed})},s.getEquipotentialPositionArray=function(t){for(var e,i,s=0,n=t,r=t,h=[],o=[],a=this.MIN_EPSILON_DISTANCE,l=-a;s<this.MAX_STEPS&&!this.isLineClosed&&(this.isEquipotentialLineTerminatingInsideBounds||s<this.MIN_STEPS);){if(e=this.getNextPositionAlongEquipotentialWithElectricPotential(n,this.electricPotential,a),i=this.getNextPositionAlongEquipotentialWithElectricPotential(r,this.electricPotential,l),h.push(e),o.push(i),n=e,r=i,s++,s>3){if(a=this.getAdaptativeEpsilonDistance(a,h,!0),l=this.getAdaptativeEpsilonDistance(l,o,!1),0>=a||null==a)throw Error("计算Line错误");if(l>=0||null==a)throw Error("计算Line错误");var c=egret.Point.distance(n,r);c<a+Math.abs(l)&&(a=c/3,l=-a,c<2*this.MIN_EPSILON_DISTANCE&&(this.isLineClosed=!0))}this.isEquipotentialLineTerminatingInsideBounds=this.bounds.containsPoint(n)||this.bounds.containsPoint(r)}if(!this.isLineClosed&&this.isEquipotentialLineTerminatingInsideBounds){var d=new egret.Point(31415e-8,27178e-8);return this.getEquipotentialPositionArray(PointUtils.plus(t,d))}var u=h.reverse();return u.concat(t,o)},s.getNextPositionAlongEquipotentialWithElectricPotential=function(t,e,i){var s=this.getElectricField(t),n=PointUtils.normalize(s),r=PointUtils.rotate(n,Math.PI/2),h=PointUtils.add(PointUtils.multiplyScalar(r,i),t),o=this.getElectricField(h),a=this.getElectricPotential(h),l=a-e,c=PointUtils.multiplyScalar(o,l/PointUtils.magnitudeSquared(o)),d=Math.sqrt(c.x*c.x+c.y*c.y);if(0==d)throw Error("the second order correction is larger than the first");return d>Math.abs(i)?this.getNextPositionAlongEquipotentialWithRK4(t,i):PointUtils.add(h,c)},s.getNextPositionAlongEquipotentialWithRK4=function(t,e){var i=this.getElectricField(t),s=PointUtils.magnitude(i);if(0==s)throw Error("the magnitude of the electric field is zero: initial Electric Field");var n=PointUtils.rotate(PointUtils.normalize(this.getElectricField(t)),Math.PI/2),r=PointUtils.plus(t,PointUtils.timesScalar(n,e/2)),h=this.getElectricField(r),o=PointUtils.rotate(PointUtils.normalize(h),Math.PI/2),a=PointUtils.plus(t,PointUtils.timesScalar(o,e/2)),l=this.getElectricField(a),c=PointUtils.rotate(PointUtils.normalize(l),Math.PI/2),d=PointUtils.plus(t,PointUtils.timesScalar(c,e)),u=this.getElectricField(d),p=PointUtils.rotate(PointUtils.normalize(u),Math.PI/2),g={x:e*(n.x+2*o.x+2*c.x+p.x)/6,y:e*(n.y+2*o.y+2*c.y+p.y)/6};return PointUtils.plus(t,g)},s.getAdaptativeEpsilonDistance=function(t,e,i){var s=this.getRotationAngle(e);return 0===s?t=this.MAX_EPSILON_DISTANCE:t*=2*Math.PI/360/s,t=PointUtils.clamp(Math.abs(t),this.MIN_EPSILON_DISTANCE,this.MAX_EPSILON_DISTANCE),t=i?t:-t,null==t&&console.log(" nulll l ll"),t},s.getRotationAngle=function(t){if(t.length<=2)throw Error("the positionArray must contain at least three elements");var e=t.length,i=PointUtils.minus(t[e-1],t[e-2]),s=PointUtils.minus(t[e-2],t[e-3]);return isNaN(PointUtils.angleBetween(i,s))&&console.log("rotation null"),PointUtils.angleBetween(i,s)},s.positionArrayToStraightLine=function(t,e,i){t.graphics.clear(),t.graphics.lineStyle(2,16711680);var s=i.isClosedLineSegments?e.length:e.length-1;t.graphics.moveTo(e[0].x*ChargesAndFieldsConstants.SCALE_METER,e[0].y*ChargesAndFieldsConstants.SCALE_METER);for(var n=1;s+1>n;n++)t.graphics.lineTo(e[n%e.length].x*ChargesAndFieldsConstants.SCALE_METER,e[n%e.length].y*ChargesAndFieldsConstants.SCALE_METER)},s.getPrunedPositionArray=function(t){var e=t.length,i=[];i.push(t[0]);for(var s=.001,n=0,r=1;e-1>r;r++)for(var h=i[i.length-1],o=n;r+1>o;o++){var a=this.getDistanceFromLine(h,t[o+1],t[r+1]);if(a>s){i.push(t[r]),n=r;break}}return i.push(t[e-1]),i},s.getDistanceFromLine=function(t,e,i){var s=PointUtils.minus(e,t),n=PointUtils.minus(i,t);return n=PointUtils.normalize(n),Math.abs(PointUtils.crossScalar(s,n))},s.clear=function(){this.shape.graphics.clear(),this.parent&&this.parent.removeChild(this)},e}(egret.Sprite);egret.registerClass(ElectricPotentialLine,"ElectricPotentialLine");var ElectricPotentialSensor=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(ElectricPotentialSensor,"ElectricPotentialSensor");var MeasuringTape=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(MeasuringTape,"MeasuringTape");var ChargeTracker=function(){function t(t){this.chargedParticles=t,this.queue=[],this.rebuild(),MessageCenter.getInstance().addListener(ElecFieldEventConst.ADD_PARITICLES,this.addParticlesAddedListener,this),MessageCenter.getInstance().addListener(ElecFieldEventConst.REMOVE_PARITICLES,this.removeParticlesAddedListener,this)}var e=(__define,t),i=e.prototype;return i.addParticlesAddedListener=function(t){this.addParticle(t)},i.removeParticlesAddedListener=function(t){for(var e=!1,i=0;i<this.queue.length;i++){var s=this.queue[i];if(s.newPosition&&s.newPosition.equals(t.position)&&s.charge===t.charge){s.newPosition=null,null===s.oldPosition&&null===s.newPosition&&this.queue.splice(i,1),e=!0;break}}e||this.queue.push({charge:t.charge,oldPosition:PointUtils.copy(t.position),newPosition:null})},i.rebuild=function(){this.clear();
for(var t=0;t<this.chargedParticles.length;t++)this.addParticle(this.chargedParticles[t])},i.clear=function(){this.queue.length=0},i.addParticle=function(t){this.queue.push({charge:t.charge,oldPosition:null,newPosition:PointUtils.copy(t.position),uId:t.uId})},i.onParticleMoved=function(t,e,i){},i.upDatePos=function(t,e,i){for(var s=0;s<this.queue.length;s++){var n=this.queue[s];if(n.uId==t.uId){n.newPosition=e,n.oldPosition=i;break}}},i.dispose=function(){MessageCenter.getInstance().removeListener(ElecFieldEventConst.ADD_PARITICLES,this.addParticlesAddedListener,this),MessageCenter.getInstance().removeListener(ElecFieldEventConst.REMOVE_PARITICLES,this.removeParticlesAddedListener,this)},t}();egret.registerClass(ChargeTracker,"ChargeTracker");var ChargedParticleNode=function(t){function e(){t.call(this),this.chargedParticle=new ChargedParticle(1)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"chargeP_png"),this.dragFun=this.onMove},s.onBegin=function(e){t.prototype.onBegin.call(this,e),this.chargedParticle.isUserControlled=!0,this.chargedParticle.position=PointUtils.viewToModelPosition(egret.Point.create(this.x,this.y))},s.onMove=function(t,e,i,s){this.chargedParticle.position=PointUtils.viewToModelPosition(egret.Point.create(t,e))},s.onEnd=function(e){t.prototype.onEnd.call(this,e),this.chargedParticle.isUserControlled=!1},s.Position=function(e){t.prototype.Position.call(this,e),this.chargedParticle.position=PointUtils.viewToModelPosition(egret.Point.create(e[0],e[1]))},e}(ElecFieldItem);egret.registerClass(ChargedParticleNode,"ChargedParticleNode");var ChargedParticleNode2=function(t){function e(){t.call(this),this.chargedParticle=new ChargedParticle(-1)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"chargeN_png"),this.dragFun=this.onMove},s.onBegin=function(e){t.prototype.onBegin.call(this,e),this.chargedParticle.isUserControlled=!0,this.chargedParticle.position=PointUtils.viewToModelPosition(egret.Point.create(this.x,this.y))},s.onMove=function(t,e,i,s){this.chargedParticle.position=PointUtils.viewToModelPosition(egret.Point.create(t,e))},s.onEnd=function(e){t.prototype.onEnd.call(this,e),this.chargedParticle.isUserControlled=!1},s.Position=function(e){t.prototype.Position.call(this,e),this.chargedParticle.position=PointUtils.viewToModelPosition(egret.Point.create(e[0],e[1]))},e}(ElecFieldItem);egret.registerClass(ChargedParticleNode2,"ChargedParticleNode2");var ChargesAndFieldsScreenView=function(t){function e(i){t.call(this),this.graphics.beginFill(MainView.MainColor),this.graphics.drawRect(MainView.mainRect[0],MainView.mainRect[1],MainView.mainRect[2]-MainView.mainRect[0],MainView.mainRect[3]-MainView.mainRect[1]),this.graphics.endFill(),this.initUI(),e._instance=this}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){return e._instance},s.initUI=function(){this.model=new ChargesAndFieldsModel,MessageCenter.getInstance().addListener(ItemEventConst.ADD_ITEM,this.addItem,this),this.gridNode=new GridNodeEF(this.model.enlargedBounds,this.model.isGridVisible,this.model.areValuesVisible),this.electricFieldGridNode=new ElectricFieldCanvasNode(this.model.activeChargedParticles,this.model.enlargedBounds,this.model.isElectricFieldDirectionOnly,this.model.isElectricFieldVisible),this.electricPotentialLinesNode=new ElectricPotentialLinesNode(this.model.electricPotentialLines,this.model.areValuesVisible),this.itemContainer=new egret.Sprite,this.panelContainer=new egret.Sprite,this.addChild(this.gridNode),this.addChild(this.electricFieldGridNode),this.addChild(this.electricPotentialLinesNode),this.addChild(this.itemContainer),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAddLine,this)},s.onAddLine=function(t){var e=PointUtils.viewToModelPosition(egret.Point.create(t.stageX,t.stageY));this.model.addElectricPotentialLine(e)},s.addItem=function(t,e){if(LightUtils.isInRect(e)){var i=egret.getDefinitionByName(t.cls),s=new i;s.typeid=t.type,s.infoCls=t.infoCls,this.itemContainer.addChild(s);var n=LightUtils.getLightConfig(t.type);s.config=n,4001==s.typeid||4002==s.typeid?MessageCenter.getInstance().dispatch(ElecFieldEventConst.ADD_PARITICLES,s.chargedParticle):4003==s.typeid&&MessageCenter.getInstance().dispatch(ElecFieldEventConst.ADD_SENSORS,s),s.Position(e)}},s.removeEvents=function(){MessageCenter.getInstance().removeListener(ItemEventConst.ADD_ITEM,this.addItem,this)},s.dispose=function(){for(;this.itemContainer.numChildren>0;)this.itemContainer.removeChildAt(0);for(;this.panelContainer.numChildren>0;)this.panelContainer.removeChildAt(0)},e._instance=null,e}(egret.Sprite);egret.registerClass(ChargesAndFieldsScreenView,"ChargesAndFieldsScreenView");var ElectricFieldArrowCanvas=function(t){function e(){t.call(this),this.img=new egret.Bitmap,this.img.texture=RES.getRes("elecArrow_png"),this.img.anchorOffsetX=this.img.width/2,this.img.anchorOffsetY=this.img.height/2,this.addChild(this.img)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.Sprite);egret.registerClass(ElectricFieldArrowCanvas,"ElectricFieldArrowCanvas");var ElectricFieldCanvasNode=function(t){function e(e,i,s,n){t.call(this),this.scratchVector=new egret.Point,this.MIN_VISIBLE_ELECTRIC_FIELD_MAG=1e-9,this.chargeTracker=new ChargeTracker(e),this.isElectricFieldDirectionOnly=s,this.isVisible=n,MessageCenter.getInstance().addListener(ElecFieldEventConst.ADD_PARITICLES,this.addParticlesAddedListener,this),MessageCenter.getInstance().addListener(ElecFieldEventConst.REMOVE_PARITICLES,this.removeParticlesAddedListener,this),this.modelPositions=[];for(var r=i.width,h=i.height,o=Math.ceil(r/ChargesAndFieldsConstants.ELECTRIC_FIELD_SENSOR_SPACING),a=Math.ceil(h/ChargesAndFieldsConstants.ELECTRIC_FIELD_SENSOR_SPACING),l=0;a>l;l++)for(var c=i.topLeft.y+(l+.5)*h/a,d=0;o>d;d++){var u=i.topLeft.x+(d+.5)*r/o;this.modelPositions.push(new egret.Point(u,c))}this.viewPositions=this.modelPositions.map(function(t){return PointUtils.modelToViewPosition(t)}),this.electricField=this.modelPositions.map(function(){return new egret.Point}),this.arrList=[],this.paintInitCanvas()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.updateElectricPotentials=function(){for(var t=ChargesAndFieldsConstants.K_CONSTANT,e=this.chargeTracker.queue.length,i=0;e>i;i++)for(var s=this.chargeTracker.queue[i],n=(s.oldPosition,s.newPosition),r=s.charge,h=0;h<this.modelPositions.length;h++){var o=this.modelPositions[h],a=this.electricField[h];if(n){var l=PointUtils.distanceSquared(o,n);if(0!==l){var c=this.scratchVector.setTo(o.x,o.y).subtract(n),d=PointUtils.multiplyScalar(c,t*r/Math.pow(l,1.5));a.x=a.x+d.x,a.y=a.y+d.y}}}},s.paintCanvas=function(){this.updateElectricPotentials();for(var t=this.isElectricFieldDirectionOnly,e=ChargesAndFieldsConstants.EFIELD_COLOR_SAT_MAGNITUDE,i=0;i<this.viewPositions.length;i++){var s=this.viewPositions[i],n=this.electricField[i],r=this.arrList[i];r.alpha=PointUtils.clamp(PointUtils.magnitude(n)/e,0,1),t&&PointUtils.magnitude(n)>this.MIN_VISIBLE_ELECTRIC_FIELD_MAG&&(r.alpha=1),r.x=s.x,r.y=s.y,r.rotation=180*PointUtils.angle(n)/Math.PI,n.x=0,n.y=0}},s.paintInitCanvas=function(){for(var t=(this.isElectricFieldDirectionOnly,ChargesAndFieldsConstants.EFIELD_COLOR_SAT_MAGNITUDE,0);t<this.viewPositions.length;t++){var e=this.viewPositions[t],i=this.electricField[t],s=ObjectPool.pop("ElectricFieldArrowCanvas");s.alpha=1,s.x=e.x,s.y=e.y,this.addChild(s),this.arrList.push(s),console.log(i+"   du ")}},s.addParticlesAddedListener=function(t){this.paintCanvas()},s.removeParticlesAddedListener=function(t){},e}(egret.Sprite);egret.registerClass(ElectricFieldCanvasNode,"ElectricFieldCanvasNode");var ElectricFieldSensorNode=function(t){function e(){t.call(this),this.MIN_ARROW_LENGTH=1e-9}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"thumb_png"),this.dragFun=this.onMove,this.electricFieldSensor=new ElectricFieldSensor,this.arrowNode=new egret.Sprite,this.addChild(this.arrowNode),this.fieldStrengthLabel=new eui.Label,this.addChild(this.fieldStrengthLabel),this.fieldStrengthLabel.x=10,this.fieldStrengthLabel.y=10,this.directionLabel=new eui.Label,this.addChild(this.directionLabel),this.directionLabel.x=10,this.directionLabel.y=60},s.onBegin=function(e){t.prototype.onBegin.call(this,e)},s.onMove=function(t,e,i,s){this.electricFieldSensor.position=PointUtils.viewToModelPosition(egret.Point.create(t,e)),this.electricFieldChange(this.electricFieldSensor.electricField)},s.onEnd=function(e){e.stopPropagation(),t.prototype.onEnd.call(this,e)},s.Position=function(e){t.prototype.Position.call(this,e),this.electricFieldSensor.position=PointUtils.viewToModelPosition(egret.Point.create(e[0],e[1])),this.electricFieldChange(this.electricFieldSensor.electricField)},s.electricFieldChange=function(t){var e=PointUtils.magnitude(t),i=PointUtils.angle(t);if(this.arrowNode.graphics.clear(),e<ChargesAndFieldsConstants.MAX_EFIELD_MAGNITUDE){var s=15*e;s>this.MIN_ARROW_LENGTH&&(this.arrowNode.graphics.lineStyle(5,65280),this.arrowNode.graphics.moveTo(0,0),this.arrowNode.graphics.lineTo(Math.min(s*Math.cos(i),1920),Math.min(s*Math.sin(i),1440)),this.arrowNode.visible=!0);var n=this.decimalAdjust(e,{maxDecimalPlaces:2});this.fieldStrengthLabel.text=n,this.directionLabel.text=(180*i/Math.PI).toFixed(2)+""}else this.arrowNode.visible=!1,this.fieldStrengthLabel.text="-",this.directionLabel.text="-"},s.decimalAdjust=function(t,e){var i,s=Math.floor(Math.log(Math.abs(t))/Math.log(10));i=s>=e.maxDecimalPlaces?0:s>0?e.maxDecimalPlaces-s:e.maxDecimalPlaces;var n=Math.pow(10,i),r=this.roundSymmetric(t*n)/n;return r.toFixed(i)},s.roundSymmetric=function(t){return(0>t?-1:1)*Math.round(Math.abs(t))},e}(ElecFieldItem);egret.registerClass(ElectricFieldSensorNode,"ElectricFieldSensorNode");var ElectricPotentialCanvasNode=function(t){function e(e,i,s){t.call(this),this.initView(i),this.isVisibleProperty=s,this.chargeTracker=new ChargeTracker(e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initView=function(t){this.modelPositions=[];for(var e=t.width,i=t.height,s=Math.ceil(e/ChargesAndFieldsConstants.ELECTRIC_POTENTIAL_SENSOR_SPACING),n=Math.ceil(i/ChargesAndFieldsConstants.ELECTRIC_POTENTIAL_SENSOR_SPACING),r=0;n>r;r++)for(var h=t.topLeft.y+(r+.5)*i/n,o=0;s>o;o++){var a=t.topLeft.x+(o+.5)*e/s;this.modelPositions.push(new egret.Point(a,h))}this.electricPotentials=new Float64Array(this.modelPositions.length)},s.addParticlesAddedListener=function(t){this.forceRepaint()},s.removeParticlesAddedListener=function(t){this.forceRepaint()},s.forceRepaint=function(){},e}(egret.Sprite);egret.registerClass(ElectricPotentialCanvasNode,"ElectricPotentialCanvasNode");var ElectricPotentialLinesNode=function(t){function e(e,i){t.call(this),this.areValuesVisible=i,this.initView(),MessageCenter.getInstance().addListener(ElecFieldEventConst.ADD_LINES,this.addItemAddedListener,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initView=function(){this.pathsNode=new egret.Sprite,this.addChild(this.pathsNode),this.labelsNode=new egret.Sprite,this.addChild(this.labelsNode)},s.addItemAddedListener=function(t){this.pathsNode.addChild(t)},e}(egret.Sprite);egret.registerClass(ElectricPotentialLinesNode,"ElectricPotentialLinesNode");var GridNodeEF=function(t){function e(e,i,s){t.call(this),this.MINOR_GRIDLINES_PER_MAJOR_GRIDLINE=5,this.MAJOR_GRIDLINE_LINEWIDTH=2,this.MINOR_GRIDLINE_LINEWIDTH=1,this.initView(e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initView=function(t){var e=new egret.Sprite;this.addChild(e);var i,s,n,r=ChargesAndFieldsConstants.GRID_MAJOR_SPACING,h=r,o=r/this.MINOR_GRIDLINES_PER_MAJOR_GRIDLINE,a=h/this.MINOR_GRIDLINES_PER_MAJOR_GRIDLINE,l=Math.ceil(t.topLeft.x/o),c=Math.floor(t.bottomRight.x/o),d=Math.ceil(t.topLeft.y/a),u=Math.floor(t.bottomRight.y/a),p=new egret.Shape,g=new egret.Shape;for(p.graphics.lineStyle(this.MAJOR_GRIDLINE_LINEWIDTH,3289650),g.graphics.lineStyle(this.MINOR_GRIDLINE_LINEWIDTH,3289650),e.addChild(p),e.addChild(g),i=l;c>=i;i++)n=i%this.MINOR_GRIDLINES_PER_MAJOR_GRIDLINE===0,n?(p.graphics.moveTo(i*o*ChargesAndFieldsConstants.SCALE_METER,d*a*ChargesAndFieldsConstants.SCALE_METER),p.graphics.lineTo(i*o*ChargesAndFieldsConstants.SCALE_METER,u*a*ChargesAndFieldsConstants.SCALE_METER)):(g.graphics.moveTo(i*o*ChargesAndFieldsConstants.SCALE_METER,d*a*ChargesAndFieldsConstants.SCALE_METER),g.graphics.lineTo(i*o*ChargesAndFieldsConstants.SCALE_METER,u*a*ChargesAndFieldsConstants.SCALE_METER));for(s=d;u>=s;s++)n=s%this.MINOR_GRIDLINES_PER_MAJOR_GRIDLINE===0,n?(p.graphics.moveTo(l*o*ChargesAndFieldsConstants.SCALE_METER,s*a*ChargesAndFieldsConstants.SCALE_METER),p.graphics.lineTo(c*o*ChargesAndFieldsConstants.SCALE_METER,s*a*ChargesAndFieldsConstants.SCALE_METER)):(g.graphics.moveTo(l*o*ChargesAndFieldsConstants.SCALE_METER,s*a*ChargesAndFieldsConstants.SCALE_METER),g.graphics.lineTo(c*o*ChargesAndFieldsConstants.SCALE_METER,s*a*ChargesAndFieldsConstants.SCALE_METER))},s.isGridVisible=function(t){this.visible=t},e}(egret.Sprite);egret.registerClass(GridNodeEF,"GridNodeEF");var EETest=function(t){function e(){t.call(this),this.equipmentContainer=new egret.Sprite;var e=this;experimentalApparatus.Electricity.ElecUtil.init_elect_Update(this),e.addChild(this.equipmentContainer),this.equipmentContainer.name="elec_equipmentContainer";for(var i=0;4>i;i++){var s=new experimentalApparatus.Electricity.ElecLamp;this.equipmentContainer.addChild(s),s.x=300,s.y=100*(i+1);var n=new experimentalApparatus.Electricity.ElecPower;this.equipmentContainer.addChild(n),n.x=500,n.y=100*(i+1)}for(var i=0;4>i;i++){var r=new experimentalApparatus.Electricity.ElecWire;r.x=100,r.y=100*(i+1),this.equipmentContainer.addChild(r)}this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downHandle,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.downHandle=function(t){var e=this.getElecComp(t.target);e&&(this.downElec=e,this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),this.stage.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandle,this))},s.getElecComp=function(t){for(var e=!1,i=t;i;){if(experimentalApparatus.Electricity.ElecUtil.checkIsElec(i)){e=!0;break}i=i.parent}return e?i:null},s.enterFrameHandle=function(t){this.downElec.dragIng()},s.stage_upHandle=function(t){this.stage.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandle,this)},e}(egret.Sprite);egret.registerClass(EETest,"EETest");var EgretMain=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){flashUtils.stage=this.stage,egret.DisplayObject.defaultTouchEnabled=!0,this.touchEnabled=!0,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName},s.createGameScene=function(){this.startApplication()},s.preLoadComplete=function(t){this.startApplication()},s.startApplication=function(){this.addChild(new EETest)},e}(egret.DisplayObjectContainer);egret.registerClass(EgretMain,"EgretMain");var embedLoadingList=[],HashMap=function(t){function e(e){void 0===e&&(e=500),t.call(this),this._initSize=0,this._maxSize=0,this._size=0,this._initSize=this._maxSize=Math.max(10,e),this._keyMap=new flashUtils.Dictionary(!0),this._dupMap=new flashUtils.Dictionary(!0),this._size=0;var i=new PairNode;this._head=this._tail=i;for(var s=this._initSize+1,n=0;s>n;n++)i.next=new PairNode,i=i.next;this._tail=i}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.insert=function(t,e){if(null==t)return!1;if(null==e)return!1;if(this._keyMap.getItem(t))return!1;if(this._size++==this._maxSize)for(var i=(this._maxSize+=this._initSize)+1,s=0;i>s;s++)this._tail.next=new PairNode,this._tail=this._tail.next;var n=this._head;this._head=this._head.next,n.key=t,n.obj=e,n.next=this._pair,this._pair&&(this._pair.prev=n),this._pair=n,this._keyMap.setItem(t,n);var r=this._dupMap.getItem(e);return r?(r++,this._dupMap.setItem(e,r)):this._dupMap.setItem(e,1),!0},n.find=function(t){var e=this._keyMap.getItem(t);return e?e.obj:null},n.remove=function(t){var e=this._keyMap.getItem(t);if(e){var i=e.obj;this._keyMap.delItem(t),e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e==this._pair&&(this._pair=e.next),e.prev=null,e.next=null,this._tail.next=e,this._tail=e;var s=this._dupMap.getItem(i);if(--s<=0&&this._dupMap.delItem(i),--this._size<=this._maxSize-this._initSize)for(var n=(this._maxSize-=this._initSize)+1,r=0;n>r;r++)this._head=this._head.next;return i}return null},n.containsKey=function(t){return void 0!=this._keyMap.getItem(t)},n.getKeySet=function(){var t=new Array(this._size),e=0;for(var i in this._keyMap.map){var s=this._keyMap.map[i][1];t[e++]=s.key}return t},n.contains=function(t){return this._dupMap.getItem(t)>0},n.clear=function(){this._keyMap=new flashUtils.Dictionary(!0),this._dupMap=new flashUtils.Dictionary(!0);for(var t,e=this._pair;e;)t=e.next,e.next=e.prev=null,e.key=null,e.obj=null,this._tail.next=e,this._tail=this._tail.next,e=t;this._pair=null,this._size=0},n.getIterator=function(){return new HashMapIterator(this._pair)},i(n,"size",function(){return this._size}),n.isEmpty=function(){return 0==this._size},n.toArray=function(){var t=new Array(this._size),e=0;for(var i in this._keyMap.map){var s=this._keyMap.map[i][1];t[e++]=s.obj}return t},n.toString=function(){return"[HashMap, size="+this.size+"]"},n.dump=function(){var t="HashMap:\n";for(var e in this._keyMap.map){var i=this._keyMap.map[e][1];t+="[key: "+i.key+", val:"+i.obj+"]\n"}return t},n.get_keyValyeArray=function(){var t=[];for(var e in this._keyMap.map){var i=this._keyMap.map[e][1];t.push({key:i,value:this.find(i)})}return t},n.get_ValyeArray=function(){var t=[];for(var e in this._keyMap.map){var i=this._keyMap.map[e][1];t.push(i.obj)}return t},n.containsValue=function(t){for(var e in this._dupMap.map){var i=this._dupMap.map[e][1];if(i===t)return!0}return!1},n.put=function(t,e){this.insert(t,e)},n.clone=function(){var t=new e;for(var i in this._keyMap.map){var s=this._keyMap.map[i][1];t._keyMap.getItem("push")(s),t.insert(s,this._dupMap.getItem(s))}return t},e}(egret.HashObject);egret.registerClass(HashMap,"HashMap",["de.polygonal.ds.Collection"]);var PairNode=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.HashObject);egret.registerClass(PairNode,"PairNode");var HashMapIterator=function(t){function e(e){t.call(this),this._pair=this._walker=e}__extends(e,t);var i=__define,s=e,n=s.prototype;return i(n,"data",function(){return this._walker.obj},function(t){this._walker.obj=t}),n.start=function(){this._walker=this._pair},n.hasNext=function(){return null!=this._walker},n.next=function(){var t=this._walker.obj;return this._walker=this._walker.next,t},e}(egret.HashObject);egret.registerClass(HashMapIterator,"HashMapIterator",["de.polygonal.ds.Iterator"]);var flashUtils;!function(t){function e(t,e){if(null==t)return null;null==t.__EgretBid__&&(t.__EgretBid__=h,h++);var i=t.__EgretBid__;if(null==e.__EgretBO__&&(e.__EgretBO__={}),!e.__EgretBO__[i]){var s=function(){return s["function"].apply(s.owner,arguments)};s["function"]=t,s.owner=e,e.__EgretBO__[i]=s}return e.__EgretBO__[i]}function i(e){c||(t.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n,null),t.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,r,null));for(var i=0;i<d.length;i++)if(d[i][0]==e)return;d.push([e,e.x,e.y])}function s(t){for(var e=0;e<d.length;e++)if(d[e][0]==t){d.splice(e,1);break}}function n(t){for(var e=0;e<d.length;e++)d[e][1]=d[e][0].x,d[e][2]=d[e][0].y;a=t.$stageX,l=t.$stageY}function r(t){for(var e=t.stageX-a,i=t.stageY-l,s=0;s<d.length;s++)u=d[s][0].x,p=d[s][0].y,d[s][0].x=d[s][1]+e,d[s][0].y=d[s][2]+i,null!=d[s][0].dragFun&&d[s][0].dragFun.call(d[s][0],d[s][0].x,d[s][0].y,u,p)}var h=0;t.bind=e,t.sortOn=function(t,e,i){for(var s,n=0;n<t.length-1;n++)t[n][e]>t[n+1][e]&&(s=t[n+1],t[n+1]=t[n],t[n]=s,n=-1);return t};var o=function(){function t(t){this.map=new Array}var e=(__define,t),i=e.prototype;return i.getItem=function(t){for(var e=0;e<this.map.length;e++)if(this.map[e][0]==t)return this.map[e][1]},i.setItem=function(t,e){for(var i=0;i<this.map.length;i++)if(this.map[i][0]==t)return void(this.map[i][1]=e);return this.map.push([t,e]),e},i.delItem=function(t){for(var e=0;e<this.map.length;e++)if(this.map[e][0]==t){this.map.splice(e,1);break}},i.hasOwnProperty=function(t){if(void 0==this.map||void 0==this.map.length)return!1;for(var e=0;e<this.map.length;e++)if(this.map[e][0]==t)return!0;return!1},t}();t.Dictionary=o,egret.registerClass(o,"flashUtils.Dictionary");var a,l,c=!1,d=[];t.startDrag=i,t.stopDrag=s,t.onDragBegin=n;var u,p;t.onDragMove=r}(flashUtils||(flashUtils={}));var com;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var s=(__define,i);s.prototype;return i.arrayContainsValue=function(t,e){return-1!=t.indexOf(e)},i.arrayContainsArray=function(e,i){var s=!0,n=0,r=i.length;for(n=0;r>n;n++){var h=i[n];if(!t.adobe.utils.ArrayUtil.arrayContainsValue(e,h)){s=!1;break}}return s},i.removeValueFromArray=function(t,e){var i=t.length,s=0;for(s=i;s>-1;s--)if(t[s]===e)return t.splice(s,1),!0;return!1},i.addSingleArr=function(e,i){return t.adobe.utils.ArrayUtil.arrayContainsValue(e,i)?!1:(e.push(i),!0)},i.removeValueFromIndex=function(t,e){var i,s=t.length;return e>=0&&s>e&&(i=t[e],t.splice(e,1)),i},i.removeArrayFromArray=function(e,i){var s=i.length,n=0;for(n=0;s>n;n++){var r=i[n];t.adobe.utils.ArrayUtil.removeValueFromArray(e,r)}},i.createUniqueCopy=function(e){var i,s=new Array,n=e.length,r=0;for(r=0;n>r;++r)i=e[r],t.adobe.utils.ArrayUtil.arrayContainsValue(s,i)||s.push(i);return s},i.copyArray=function(t){return t?t.slice(0,t.length):null},i.arraysAreEqual=function(t,e){if(t.length!=e.length)return!1;var i=t.length,s=0;for(s=0;i>s;s++)if(t[s]!==e[s])return!1;return!0},i.clear=function(t){t&&0!=t.length&&t.splice(0)},i.print=function(t){for(var e in t)console.log(e+":"+t[e])},i.getIndexFromValue=function(t,e){var i=-1,s=0,n=t.length;for(s=0;n>s;s++)if(e==t[s]){i=s;break}return i},i.swapObj=function(t,e){var i=t;t=e,e=i},i.swapArrObj=function(e,i,s){var n=t.adobe.utils.ArrayUtil.getIndexFromValue(e,i),r=t.adobe.utils.ArrayUtil.getIndexFromValue(e,s);n>-1&&r>-1&&(e[n]=s,e[r]=i)},i.swapArrInd=function(t,e,i){e=e,i=i;var s=t[e],n=t[i];e>-1&&i>-1&&(t[e]=n,t[i]=s)},i.swapChaArrInd=function(e,i,s){i=i,s=s;var n,r,h=[],o=0,a=0,l=e.length;if(0>i||i>=l)return e;if(s>=0&&l>s){n=e[i],r=e[s],t.adobe.utils.ArrayUtil.removeValueFromIndex(e,i);var c=t.adobe.utils.ArrayUtil.getIndexFromValue(e,r);for(o=0;c>o;o++)h[o]=e[o];for(h[c]=n,a=c+1;l+1>a;a++)h[a]=e[a-1]}else s>=l?(n=e[i],t.adobe.utils.ArrayUtil.removeValueFromIndex(e,i),e.push(n),h=t.adobe.utils.ArrayUtil.copyArray(e)):0>s&&(n=e[i],t.adobe.utils.ArrayUtil.removeValueFromIndex(e,i),e.unshift(n),h=t.adobe.utils.ArrayUtil.copyArray(e));return h},i}(egret.HashObject);e.ArrayUtil=i,egret.registerClass(i,"com.adobe.utils.ArrayUtil")}(i=e.utils||(e.utils={}))}(e=t.adobe||(t.adobe={}))}(com||(com={}));var DisplayUtil=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e);i.prototype;return e.getParenFromNameDis=function(t,e){for(var i=!1,s=t;s;){if(s.name&&s.name==e){i=!0;break}s=s.parent}return i?s:null},e.drawRect=function(t,e,i,s,n){void 0===s&&(s=1),void 0===n&&(n=16711680),t.clear(),t.beginFill(n,s),t.drawRect(0,0,e,i),t.endFill()},e}(egret.HashObject);egret.registerClass(DisplayUtil,"DisplayUtil");var com;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var s=(__define,i),n=s.prototype;return i.sq=function(t){return Math.pow(Math.abs(t),2)},i.max=function(t){return Math.max.apply(null,t)},i.ping=function(t){for(var e=0,i=0;i<t.length;i++){var s=t[i];e+=s}return e/t.length},i.getUnique=function(){return ascb.util.NumberUtilities.getUnique()},i.getUniqueID=function(){return ascb.util.NumberUtilities.getUniqueID()},i.getCenP=function(t,e){return new egret.Point((t.x+e.x)/2,(t.y+e.y)/2)},i.getPointLen=function(t,e){return egret.Point.distance(t,e)},i.getFuhao=function(t){return t>=0?1:-1},i.getXYLen=function(t,e,i,s){return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s))},i.getXianDianByDis=function(e,i,s,n){var r=0;if(s.x==n.x&&s.y==n.y)return s.clone();if(n.x==s.x){if(i&&s.y>n.y||!i&&s.y<n.y)return new egret.Point(s.x,s.y-e);if(!i&&s.y>n.y||i&&s.y<n.y)return new egret.Point(s.x,s.y+e)}r=(n.y-s.y)/(n.x-s.x);var h,o=Math.sqrt(e*e/(1+r*r))+s.x,a=-Math.sqrt(e*e/(1+r*r))+s.x,l=r*(o-s.x)+s.y,c=r*(a-s.x)+s.y,d=t.adobe.utils.M.sq(o-n.x)+t.adobe.utils.M.sq(l-n.y),u=t.adobe.utils.M.sq(a-n.x)+t.adobe.utils.M.sq(c-n.y);return h=i?d>u?new egret.Point(a,c):new egret.Point(o,l):d>u?new egret.Point(o,l):new egret.Point(a,c)},i.getRandColor=function(){return 16777215*Math.random()+4278190080},i.getDecimalNum=function(e){var i=""+e;return t.adobe.utils.StringUtil.contains(i,".")?(i=i.substring(i.indexOf(".")+1),i.length):0},i.getAngleP=function(t,e){void 0===e&&(e=null),e||(e=new egret.Point(0,0));var i=t.x-e.x,s=t.y-e.y,n=Math.atan2(s,i)*(180/Math.PI);return n},i.getAngleP1=function(t,e){void 0===e&&(e=null);var i=Math.atan2(t.y,t.x)*(180/Math.PI);if(!e)return i;var s=Math.atan2(e.y,e.x)*(180/Math.PI);return i-s},i.getAreaByPoints=function(t,e,i){var s=t.x-e.x,n=t.y-e.y,r=Math.sqrt(s*s+n*n);s=e.x-i.x,n=e.y-i.y;var h=Math.sqrt(s*s+n*n);s=i.x-t.x,n=i.y-t.y;var o=Math.sqrt(s*s+n*n),a=(r+h+o)/2;return Math.sqrt(a*(a-r)*(a-h)*(a-o))},i.checkPointIn=function(e,i,s,n){var r=t.adobe.utils.M.getAreaByPoints(i,s,n),h=0;return h+=t.adobe.utils.M.getAreaByPoints(e,i,s),h+=t.adobe.utils.M.getAreaByPoints(e,s,n),h+=t.adobe.utils.M.getAreaByPoints(e,n,i),h==r||Math.abs(h-r)<1e-4},i.getAngleByP=function(e,i,s){var n=t.adobe.utils.M.getPointLen(i,s),r=t.adobe.utils.M.getPointLen(e,s),h=t.adobe.utils.M.getPointLen(e,i),o=2*r*h;0==o&&(o=1e-9);var a=(r*r+h*h-n*n)/o;return 180*Math.acos(a)/Math.PI},i.getPoint_NeiXin=function(e,i,s){var n=t.adobe.utils.M.getPointLen(e,i),r=t.adobe.utils.M.getPointLen(i,s),h=t.adobe.utils.M.getPointLen(e,s),o=new egret.Point;return o.x=(n*e.x+r*i.x+h*s.x)/(n+r+h),o.y=(n*e.y+r*i.y+h*s.y)/(n+r+h),o},i.getSPPoint=function(t){return new egret.Point(t.x,t.y)},i.setSPPoint=function(t,e){t&&e&&(t.x=e.x,t.y=e.y)},i.setSPPointXY=function(t,e,i){t&&(t.x=e,t.y=i)},i.rotaPointFromP=function(e,i,s){i.y==e.y&&(i.y=e.y+t.adobe.utils.M.MIN);var n=new egret.Point(e.x-i.x,e.y-i.y),r=t.adobe.utils.M.rotaPoint(n,s);return r.x+=i.x,r.y+=i.y,r},i.atan=function(e,i){return t.adobe.utils.M.getAngleP(e,i)},i.getPFrom2DianAndAngle=function(e,i,s,n){var r=(e.clone(),i.clone(),180+t.adobe.utils.M.atan(i,e)-n),h=t.adobe.utils.M.toHu(r);e=t.adobe.utils.M.rotaPoint(e,-h),i=t.adobe.utils.M.rotaPoint(i,-h);var o=Math.sqrt(t.adobe.utils.M.sq(i.x-e.x)+t.adobe.utils.M.sq(i.y-e.y)),a=o*Math.sin(t.adobe.utils.M.toHu(s))/Math.sin(t.adobe.utils.M.toHu(180-s-n)),l=a+i.x,c=i.y,d=new egret.Point(l,c);return d=t.adobe.utils.M.rotaPoint(d,h)},i.toHu=function(t){return t/180*Math.PI},i.toAngle=function(t){return t/Math.PI*180},i.getNumStr=function(t){var e=/(-?\d+)(\.\d+)?/,i=e.exec(t)[0];return i},n.checkPointArr=function(t){var e=0;if(t.length>0)for(var i=0;i<t.length;i++)e+=(t[i].x-t[i+1].x)*(t[i].y+t[i+1].y)},i.checkOnLineAB=function(t,e,i,s){return void 0===s&&(s=.5),Math.abs((t.y-e.y)*(t.x-i.x)-(t.y-i.y)*(t.x-e.x))<s},i.checkInLineAB=function(e,i,s,n){void 0===n&&(n=.1);var r=!1;return e?t.adobe.utils.M.getPointLen(e,i)+t.adobe.utils.M.getPointLen(e,s)-t.adobe.utils.M.getPointLen(i,s)<n&&(r=!0):r=!1,r},i.isPingxing=function(t,e,i,s){var n=!1,r=t.x,h=t.y,o=e.x,a=e.y,l=i.x,c=i.y,d=s.x,u=s.y;return(a-h)*(d-l)==(o-r)*(u-c)&&(n=!0),n},i.getJiaoP=function(t,e,i,s){var n=new egret.Point,r=t.x,h=t.y,o=e.x,a=e.y,l=i.x,c=i.y,d=s.x,u=s.y,p=1e-7,g=0;g=o==r?(a-h)/(o-r+p):(a-h)/(o-r);var _=0;return _=d==l?(u-c)/(d-l+p):(u-c)/(d-l),g==_?n.x=(g*r-_*l+c-h)/(g-_+p):n.x=(g*r-_*l+c-h)/(g-_),n.y=g*n.x-g*r+h,n},i.checkJPIsInAB=function(e,i,s,n){var r=!1,h=t.adobe.utils.M.getJiaoP(e,i,s,n);return r=t.adobe.utils.M.checkInLineAB(h,e,i)},i.checkJPIsInABCD=function(e,i,s,n){var r=!1,h=t.adobe.utils.M.getJiaoP(e,i,s,n);return r=t.adobe.utils.M.checkInLineAB(h,e,i)&&t.adobe.utils.M.checkInLineAB(h,s,n)||t.adobe.utils.M.checkInLineAB(e,s,n)||t.adobe.utils.M.checkInLineAB(i,s,n)||t.adobe.utils.M.checkInLineAB(s,e,i)||t.adobe.utils.M.checkInLineAB(n,e,i)},i.hasPoint=function(t,e){for(var i=!1,s=0;s<t.length;s++){var n=t[s];if(n.x==e.x&&n.y==e.y){i=!0;break}}return i},i.rotaPoint=function(t,e){var i=new egret.Point;return i.x=Math.cos(e)*t.x-Math.sin(e)*t.y,i.y=Math.cos(e)*t.y+Math.sin(e)*t.x,i},i.getPArrRect=function(t){for(var e,i,s=0;s<t.length;s++){var n=t[s];e?(e.x=Math.min(e.x,n.x),e.y=Math.min(e.y,n.y)):e=new egret.Point(n.x,n.y),i?(i.x=Math.max(i.x,n.x),i.y=Math.max(i.y,n.y)):i=new egret.Point(e.x,e.y)}return new egret.Rectangle(e.x,e.y,i.x-e.x,i.y-e.y)},i.getRectCen=function(t){var e=new egret.Point;return e.x=(t.left+t.right)/2,e.y=(t.top+t.bottom)/2,e},i.getRectFromDuiP=function(t,e){var i=Math.min(t.x,e.x),s=Math.min(t.y,e.y),n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return new egret.Rectangle(i,s,n,r)},i.getZoomPoint=function(t,e,i,s){var n=t.x,r=t.y,h=e.x,o=e.y,a=i.x,l=i.y,c=s.x,d=s.y,u=(a-n)/(h-n),p=(l-r)/(o-r),g=u*(c-n)+n,_=p*(d-r)+r;return new egret.Point(g,_)},i.getZoomPointA=function(e,i,s,n,r){var h=e.x,o=e.y,a=i.x,l=i.y,c=s.x,d=s.y,u=n.x,p=n.y,g=new egret.Point(c-h,d-o),_=new egret.Point(a-h,l-o),f=new egret.Point(u-h,p-o),v=g.x/_.x,m=g.y/_.y,E=new egret.Point(v*f.x,m*f.y),b=E.x+h,y=E.y+o,C=new egret.Point(b-u,y-p);C=t.adobe.utils.M.getRoZoomP(C,r);var T=C.x+u,x=C.y+p;return new egret.Point(T,x)},i.isPointNi=function(t,e,i){var s=e.x,n=e.y,r=i.x,h=i.y,o=t.x,a=t.y;return(a-n)*(r-s)>(o-s)*(h-n)},i.getRoZoomP=function(e,i){var s=new egret.Point;return s.x=e.x*Math.cos(t.adobe.utils.M.toHu(-i))+e.y*Math.sin(t.adobe.utils.M.toHu(-i)),s.y=e.y*Math.cos(t.adobe.utils.M.toHu(-i))-e.x*Math.sin(t.adobe.utils.M.toHu(-i)),s},i.getOvalPoint=function(t,e,i){void 0===i&&(i=null);var s=[],n=t/2,r=e/2,h=0,o=0,a=0;for(i||(i=new egret.Point(0,0));h<2*Math.PI;)o=i.x+n*Math.sin(h),a=i.y+r*Math.cos(h),s.push(new egret.Point(o,a)),h+=2/180*Math.PI;return s},i.getRegPolygon=function(t,e,i){var s=[];if(1==t)return[e];for(var n=0;t>n;n++){var r=new egret.Point;r.x=e.x+i*Math.cos(2*Math.PI/t*n),r.y=e.y+i*Math.sin(2*Math.PI/t*n),Math.abs(r.x)<1e-5&&(r.x=0),Math.abs(r.y)<1e-5&&(r.y=0),s.push(r)}return s},i.getLianPObj=function(t,e){return{p1:t,p2:e}},i.getRegPolygonRay=function(e,i,s){var n=t.adobe.utils.M.getRegPolygon(e,i,s),r=[];
if(2==e)r.push(t.adobe.utils.M.getLianPObj(n[0],n[1]));else if(e>2){for(var h=0;h<n.length-1;h++)r.push({p1:n[h],p2:n[h+1]});r.push({p1:n[n.length-1],p2:n[0]})}return{pArr:n,lianArr:r}},i.getThreeRay=function(e,i,s){var n=[],r=[],h=0;n.push(i),h++;for(var o=Math.ceil((e-1)/3),a=0;o>a;a++)for(var l=0;3>l&&h!=e;l++){var c;c=1==n.length?n[0]:n[n.length-3];var d=new egret.Point(c.x,c.y-s);if(n.push(d),h++,h==e)break;var u=t.adobe.utils.M.rotaPointFromP(d,i,2*-Math.PI/3);if(n.push(u),h++,h==e)break;var p=t.adobe.utils.M.rotaPointFromP(d,i,2*Math.PI/3);if(n.push(p),h++,h==e)break}if(2==e)r.push(t.adobe.utils.M.getLianPObj(n[0],n[1]));else if(3==e)r.push(t.adobe.utils.M.getLianPObj(n[0],n[1])),r.push(t.adobe.utils.M.getLianPObj(n[0],n[2]));else if(e>3){r.push(t.adobe.utils.M.getLianPObj(n[0],n[1])),r.push(t.adobe.utils.M.getLianPObj(n[0],n[2]));for(var g=0;g<=n.length-4;g++)r.push(t.adobe.utils.M.getLianPObj(n[g],n[g+3]))}return{pArr:n,lianArr:r}},i.getCrossRay=function(e,i,s){var n=[],r=[],h=0;n.push(i),h++;for(var o=Math.ceil((e-1)/3),a=0;o>a;a++)for(var l=0;4>l&&h!=e;l++){var c;c=1==n.length?n[0]:n[n.length-4];var d=new egret.Point(c.x,c.y-s);if(n.push(d),h++,h==e)break;var u=t.adobe.utils.M.rotaPointFromP(d,i,-Math.PI/2);if(n.push(u),h++,h==e)break;var p=t.adobe.utils.M.rotaPointFromP(d,i,-Math.PI);if(n.push(p),h++,h==e)break;var g=t.adobe.utils.M.rotaPointFromP(d,i,Math.PI/2);if(n.push(g),h++,h==e)break}if(2==e)r.push(t.adobe.utils.M.getLianPObj(n[0],n[1]));else if(3==e)r.push(t.adobe.utils.M.getLianPObj(n[0],n[1])),r.push(t.adobe.utils.M.getLianPObj(n[0],n[2]));else if(4==e)r.push(t.adobe.utils.M.getLianPObj(n[0],n[1])),r.push(t.adobe.utils.M.getLianPObj(n[0],n[2])),r.push(t.adobe.utils.M.getLianPObj(n[0],n[3]));else if(e>4){r.push(t.adobe.utils.M.getLianPObj(n[0],n[1])),r.push(t.adobe.utils.M.getLianPObj(n[0],n[2])),r.push(t.adobe.utils.M.getLianPObj(n[0],n[3]));for(var _=0;_<=n.length-5;_++)r.push(t.adobe.utils.M.getLianPObj(n[_],n[_+4]))}return{pArr:n,lianArr:r}},i.getHorizontalRay=function(e,i,s){var n=[],r=[],h=0;n.push(i),h++;for(var o=Math.ceil((e-1)/3),a=0;o>a;a++)for(var l=0;3>l&&h!=e;l++){var c;c=1==n.length?n[0]:n[n.length-2];var d=new egret.Point(c.x-s,c.y);if(n.push(d),h++,h==e)break;var u=t.adobe.utils.M.rotaPointFromP(d,i,Math.PI);if(n.push(u),h++,h==e)break}if(2==e)r.push(t.adobe.utils.M.getLianPObj(n[0],n[1]));else if(e>2){r.push(t.adobe.utils.M.getLianPObj(n[0],n[1]));for(var p=0;p<=n.length-3;p++)r.push(t.adobe.utils.M.getLianPObj(n[p],n[p+2]))}return{pArr:n,lianArr:r}},i.getVerticalRay=function(e,i,s){var n=[],r=[],h=0;n.push(i),h++;for(var o=Math.ceil((e-1)/3),a=0;o>a;a++)for(var l=0;3>l&&h!=e;l++){var c;c=1==n.length?n[0]:n[n.length-2];var d=new egret.Point(c.x,c.y-s);if(n.push(d),h++,h==e)break;var u=t.adobe.utils.M.rotaPointFromP(d,i,Math.PI);if(n.push(u),h++,h==e)break}if(2==e)r.push(t.adobe.utils.M.getLianPObj(n[0],n[1]));else if(e>2){r.push(t.adobe.utils.M.getLianPObj(n[0],n[1]));for(var p=0;p<=n.length-3;p++)r.push(t.adobe.utils.M.getLianPObj(n[p],n[p+2]))}return{pArr:n,lianArr:r}},i.getDuiDianP=function(e,i,s){var n=new egret.Point,r=t.adobe.utils.M.getGaoDianFrom3Dian(e,i,s);return n.x=2*r.x-e.x,n.y=2*r.y-e.y,n},i.getDuiDianDian=function(t,e){return new egret.Point(2*e.x-t.x,2*e.y-t.y)},i.getNumJie=function(t,e){void 0===e&&(e=0);var i=Math.pow(10,e);return Math.round(t*i)/i},i.getGaoDianFrom3Dian=function(t,e,i){var s=t.x,n=t.y,r=e.x,h=e.y,o=i.x,a=i.y,l=1*((a-h)*(a-h)*r+(o-r)*(o-r)*s+(n-h)*(o-r)*(a-h))/((a-h)*(a-h)+(o-r)*(o-r)),c=((s-r)*(o-r)*(a-h)+(n-h)*(a-h)*(a-h))/((a-h)*(a-h)+(o-r)*(o-r))+h;return new egret.Point(l,c)},i.getXianDuanGaoXianDian=function(e,i,s,n){void 0===n&&(n=!0);var r,h=t.adobe.utils.M.getXianDianByDis(s,!0,e,i);return r=n?t.adobe.utils.M.rotaPointFromP(h,e,-Math.PI/2):t.adobe.utils.M.rotaPointFromP(h,e,Math.PI/2)},i.retrieveRGBComponent=function(t){t=t;var e=t>>16,i=t>>8&255,s=255&t;return[e,i,s]},i.generateFromRGBComponent=function(t){return null==t||3!=t.length||t[0]<0||t[0]>255||t[1]<0||t[1]>255||t[2]<0||t[2]>255?16777215:t[0]<<16|t[1]<<8|t[2]},i.generateTransitionalColor=function(e,i,s){if(e=e,i=i,s=s,1==s)return[e];if(2==s)return[e,i];var n=t.adobe.utils.M.retrieveRGBComponent(e),r=t.adobe.utils.M.retrieveRGBComponent(i),h=[];h.push(e),s-=2;for(var o=r[0]-n[0],a=r[1]-n[1],l=r[2]-n[2],c=1;s-1>c;c++){var d=[n[0]+o*c/s,n[1]+a*c/s,n[2]+l*c/s];h.push(t.adobe.utils.M.generateFromRGBComponent(d))}return h.push(i),h},i.DrawSector=function(t,e,i,s,n,r,h,o,a,l,c,d){if(void 0===e&&(e=200),void 0===i&&(i=200),void 0===s&&(s=100),void 0===n&&(n=27),void 0===r&&(r=270),void 0===h&&(h=16711680),void 0===o&&(o=1),void 0===a&&(a=0),void 0===l&&(l=0),void 0===c&&(c=1),void 0===d&&(d=!0),0==n)return void t.graphics.clear();t.graphics.beginFill(h,o),t.graphics.moveTo(e,i),n=Math.abs(n)>360?360:n;var u=Math.ceil(Math.abs(n)/45),p=n/u;p=p*Math.PI/180,r=r*Math.PI/180,0==a?t.graphics.lineTo(e+s*Math.cos(r),i+s*Math.sin(r)):d?(t.graphics.lineStyle(a,l,c),t.graphics.lineTo(e+s*Math.cos(r),i+s*Math.sin(r))):(t.graphics.lineStyle(a,l,c),t.graphics.lineTo(e+s*Math.cos(r),i+s*Math.sin(r)));for(var g=1;u>=g;g++){r+=p;var _=r-p/2,f=e+s/Math.cos(p/2)*Math.cos(_),v=i+s/Math.cos(p/2)*Math.sin(_),m=e+s*Math.cos(r),E=i+s*Math.sin(r);t.graphics.curveTo(f,v,m,E)}(0==a||d)&&t.graphics.lineStyle(null,0,0),360!=n&&t.graphics.lineTo(e,i),t.graphics.endFill()},i.clonePointArr=function(t){if(!t)return null;for(var e=[],i=0;i<t.length;i++){var s=t[i];e.push(s.clone())}return e},i.checkArrEqual=function(e,i,s){void 0===s&&(s=5),e=t.adobe.utils.M.clonePointArr(e),i=t.adobe.utils.M.clonePointArr(i);var n=t.adobe.utils.M.getRectCen(t.adobe.utils.M.getPArrRect(e)),r=t.adobe.utils.M.getRectCen(t.adobe.utils.M.getPArrRect(i)),h=r.x-n.x,o=r.y-n.y,a=0,l=0;for(a=0;a<e.length;a++){var c=e[a];c.x+=h,c.y+=o}for(a=0;a<e.length;a++){var d=e[a],u=!1;for(l=0;l<i.length;l++){var p=i[l];if(t.adobe.utils.M.getPointLen(d,p)<=s){u=!0;break}}if(!u)return!1}return{chaX:h,chaY:o}},i.checkPointEqual=function(e,i,s){return void 0===s&&(s=.1),t.adobe.utils.M.getPointLen(e,i)<s?!0:!1},i.checkPolygonPointArr2=function(t,e){for(var i=!1,s=0,n=0,r=e.length,h=0,o=r-1;r>h;o=h++){var a=(t.x-e[o].x)*(e[h].y-e[o].y)-(t.y-e[o].y)*(e[h].x-e[o].x);a>0?++s:0>a&&++n}return(0==s||0==n)&&(i=!0),i},i.containtsP=function(e,i,s){void 0===s&&(s=.1);for(var n=!1,r=0;r<e.length;r++){var h=e[r];if(t.adobe.utils.M.getPointLen(h,i)<s){n=!0;break}}return n},i.getNearP=function(e,i){for(var s,n=1e5,r=0;r<e.length;r++){var h=e[r],o=t.adobe.utils.M.getPointLen(i,h);n>o&&(n=o,s=h)}return s},i.checkPolygonPointArr3=function(t,e){if(null==e)return!1;var i,s,n=e.length,r=0,h=0,o=0;for(i=e[0],r=1;n>=r;r++)s=e[r%n],t.y>Math.min(i.y,s.y)&&t.y<=Math.max(i.y,s.y)&&t.x<=Math.max(i.x,s.x)&&i.y!=s.y&&(o=(t.y-i.y)*(s.x-i.x)/(s.y-i.y)+i.x,(i.x==s.x||t.x<=o)&&h++),i=s;return h%2!=0},i.centerRotate=function(t,e){var i=t.rotation;t.rotation=0;var s=t.width,n=t.height;t.rotation=i;var r=t.localToGlobal(new egret.Point(s/2,n/2));t.rotation=e;var h=t.localToGlobal(new egret.Point(s/2,n/2)),o=r.subtract(h),a=t.transform.matrix;a.translate(o.x,o.y),t.transform.matrix=a},i.getAllChildren=function(t){if(!t)return null;for(var e=[],i=0;i<t.numChildren;i++)e.push(t.getChildAt(i));return e},i}(egret.HashObject);e.M=i,egret.registerClass(i,"com.adobe.utils.M")}(i=e.utils||(e.utils={}))}(e=t.adobe||(t.adobe={}))}(com||(com={})),com.adobe.utils.M.MIN=1e-6;var com;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(t,i){void 0===t&&(t=1),void 0===i&&(i=1),e.call(this),this._isError=!1,this._det=0/0,this._rows=0,this._columns=0,this._m=new Array,this._rows=t,this._columns=i;for(var s=t*i,n=0;s>n;n++)this._m.push(0);this._isError=!1,this._errorMes=""}__extends(i,e);var s=__define,n=i,r=n.prototype;return r.identity=function(){if(this._isError=!1,this._errorMes="",this._rows!=this._columns)return this._isError=!0,void(this._errorMes="Number of rows doesn't match number of columns");for(var t=0;t<this._rows;t++)for(var e=0;e<this._columns;e++)t==e?this._m[e+t*this._columns]=1:this._m[e+t*this._columns]=0},r.multiply=function(e){if(this._isError=!1,this._errorMes="",this._columns!=e.rows)return this._isError=!0,void(this._errorMes="Number of columns of the first matrix doesn't match with number of rows of the second matrix");for(var i=e.columns,s=new t.adobe.utils.MatrixMath(this._rows,i),n=0;n<this._rows;n++)for(var r=0;i>r;r++)for(var h=0;h<this._columns;h++)s._m[r+n*i]+=this._m[h+n*this._columns]*e._m[r+h*i];this._columns=i,this._m=s._m},r.scalar=function(t){for(var e=this._rows*this._columns,i=0;e>i;i++)this._m[i]*=t},r.add=function(t){if(this._isError=!1,this._errorMes="",this._rows!=t.rows||this._columns!=t.columns)return this._isError=!0,void(this._errorMes="Number of columns and rows of the first matrix doesn't match with number of columns and rows of the second matrix");for(var e=this._rows*this._columns,i=0;e>i;i++)this._m[i]+=t._m[i]},r.substract=function(t){if(this._isError=!1,this._errorMes="",this._rows!=t.rows||this._columns!=t.columns)return this._isError=!0,void(this._errorMes="Number of columns and rows of the first matrix doesn't match with number of columns and rows of the second matrix");for(var e=this._rows*this._columns,i=0;e>i;i++)this._m[i]-=t._m[i]},r.transpose=function(){for(var e=new t.adobe.utils.MatrixMath(this._columns,this._rows),i=0;i<this._rows;i++)for(var s=0;s<this._columns;s++)e._m[i+s*this._rows]=this._m[s+i*this._columns];return e},r.gaussElimination=function(){this._isError=!1,this._errorMes="";var t=0,e=0;if(this._det=1,this._rows>this._columns-1)return this._isError=!0,void(this._errorMes="This matrix doesn't represent any system of equations");for(var i=0;i<this._rows-1;i++){t=i;for(var s=i+1;s<this._rows;s++)Math.abs(this._m[i+s*this._columns])>Math.abs(this._m[i+t*this._columns])&&(t=s);for(this.swapRows(i,t),s=i+1;s<this._rows;s++){if(0==this._m[i*(1+this._columns)])return this._isError=!0,void(this._errorMes="This system of equations doesn't have any solution");e=this._m[i+s*this._columns]/this._m[i*(1+this._columns)];for(var n=i;n<this._columns;n++)this._m[n+s*this._columns]-=this._m[n+i*this._columns]*e}}return 0==this._m[(this._rows-1)*(1+this._columns)]?(this._isError=!0,void(this._errorMes="This system of equations doesn't have any solution")):void 0},i.GaussSolution=function(e,i){var s=e.rows,n=0,r=new t.adobe.utils.MatrixMath(s,1);if(e.rows!=e.columns||e.rows!=i.rows||i.columns>1||0==i.columns)return r.resize(0,0),r.isError=!0,r.errorMes="Can't solve this system of equations",r;var h=e.merge(i),o=h.columns;if(h.gaussElimination(),h.isError)return r.resize(0,0),r.isError=!0,r.errorMes=h.errorMes,r;for(var a=s-1;a>=0;a--){n=0;for(var l=a+1;s>l;l++)n+=h._m[l+a*o]*r._m[l];r._m[a]=(h._m[s+a*o]-n)/h._m[a*(1+o)]}return r},r.inverse=function(){this._isError=!1,this._errorMes="";var e=this.rows,i=new t.adobe.utils.MatrixMath(e,e);if(this._rows!=this._columns)return i.resize(0,0),i.isError=!0,i.errorMes="Number of rows doesn't match number of columns",i;for(var s=0,n=this.merge(i),r=n.columns,h=0;e>h;h++)n._m[h+e+h*r]=1;if(n.gaussElimination(),n.isError)return i.resize(0,0),i.isError=!0,i.errorMes=n.errorMes,i;for(var o=0;e>o;o++)for(h=e-1;h>=0;h--){s=0;for(var a=h+1;e>a;a++)s+=n._m[a+h*r]*i._m[o+a*e];i._m[o+h*e]=(n._m[o+e+h*r]-s)/n._m[h*(1+r)]}return i},r.gaussDeterminant=function(){if(this._isError=!1,this._errorMes="",this.rows!=this.columns)return this._isError=!0,this._errorMes="Number of rows doesn't match number of columns",0/0;var e=this.rows,i=this.merge(new t.adobe.utils.MatrixMath(e,1));if(i.gaussElimination(),i.isError)return this._isError=!0,this._errorMes="Some unexpected error",0;this._det=i.detMultiplier;for(var s=i.columns,n=0;e>n;n++)this._det*=i._m[n*(1+s)];return this._det},r.recursiveDeterminant=function(){if(this._isError=!1,this._errorMes="",this.rows!=this.columns)return this._isError=!0,this._errorMes="Number of rows doesn't match number of columns",0/0;var t,e,i,s=this.rows,n=0,r=0,h=0;if(s>1)for(var o=0;s>o;o++)h=this._m[o],0!=h&&(r=o%2==0?1:-1,0==o?i=this.fragment(1,1,s-1,this.columns-1):o==s-1?i=this.fragment(1,0,s-1,this.columns-2):(t=this.fragment(1,0,s-1,o-1),e=this.fragment(1,o+1,s-1,this.columns-1),i=t.merge(e)),n+=r*h*i.recursiveDeterminant());else n=this._m[0];return n},i.LUPDecomposition=function(t,e){if(t.rows==t.columns){var i=t.rows;e.resize(i,1);for(var s=0;i>s;s++)e._m[s]=s;for(var n=0;i>n;n++){var r=0,h=0;for(s=n;i>s;s++)Math.abs(t._m[n+s*i])>r&&(r=Math.abs(t._m[n+s*i]),h=s);if(0==r)return t.isError=!0,void(t.errorMes="Can't solve this system of equations");for(e.swapRows(n,h),t.swapRows(n,h),s=n+1;i>s;s++){t._m[n+s*i]/=t._m[n*(1+i)];for(var o=n+1;i>o;o++)t._m[o+s*i]-=t._m[n+s*i]*t._m[o+n*i]}}}},i.LUPSolution=function(e,i,s){var n=e.rows,r=0,h=0,o=0,a=new t.adobe.utils.MatrixMath(n,1);if(e.isError||n!=e.columns||n!=i.rows||1!=i.columns||n!=s.rows||1!=s.columns)return a.resize(0,0),a.isError=!0,a.errorMes="Can't solve this system of equations",a;for(h=0;n>h;h++){for(r=0,o=0;h>o;o++)r+=e._m[o+h*n]*a._m[o];a._m[h]=s._m[i._m[h]]-r}for(h=n-1;h>=0;h--){for(r=0,o=h+1;n>o;o++)r+=e._m[o+h*n]*a._m[o];a._m[h]=(a._m[h]-r)/e._m[h*(1+n)]}return a},i.CramerSolution=function(e,i){var s,n=e.rows,r=new t.adobe.utils.MatrixMath(n,1);if(e.rows!=e.columns||e.rows!=i.rows||1!=i.columns)return r.resize(0,0),r.isError=!0,r.errorMes="Can't solve this system of equations",r;var h=e.recursiveDeterminant();if(0==h)return r.resize(0,0),r.isError=!0,r.errorMes="The A matrix is not invertible. So I can't solve this system of equations",r;for(var o=0;n>o;o++)s=e.clone(),s.insert(i,0,o),r._m[o]=s.recursiveDeterminant()/h;return r},r.insert=function(t,e,i,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=!1);var n=this.rows,r=this.columns;if(!(e>=n||i>=r)){var h=e+t.rows,o=i+t.columns;h=h>n?h:n,o=o>r?o:r,s&&this.resize(h,o),h=e+t.rows,o=i+t.columns;for(var a=h<=this.rows?h:this.rows,l=o<=this.columns?o:this.columns,c=e;a>c;c++)for(var d=i;l>d;d++)this._m[d+c*this._columns]=t._m[d-i+(c-e)*t.columns]}},r.resize=function(e,i){e=e,i=i;var s=this.rows,n=this.columns,r=new t.adobe.utils.MatrixMath(e,i),h=0,o=0;for(h=0;e>h;h++)if(s>h)for(o=0;i>o;o++)n>o&&(r._m[o+h*i]=this._m[o+h*n]);this._rows=e,this._columns=i,this._m=r._m},r.fragment=function(e,i,s,n){e=e,i=i,s=s,n=n,e>this._rows&&(e=this._rows),i>this._columns&&(i=this._columns),s>this._rows&&(s=this._rows),n>this._columns&&(n=this._columns);var r;e>s&&(r=e,e=s,s=r),i>n&&(r=i,i=n,n=r);for(var h=n-i+1,o=new t.adobe.utils.MatrixMath(s-e+1,h),a=e;s>=a;a++)for(var l=i;n>=l;l++)o._m[l-i+(a-e)*h]=this._m[l+a*this._columns];return o},r.merge=function(e){for(var i=e.rows,s=e.columns,n=this._rows,r=this._columns,h=r+s,o=new t.adobe.utils.MatrixMath(Math.max(n,i),h),a=0;n>a;a++)for(var l=0;r>l;l++)o._m[l+a*h]=this._m[l+a*r];for(a=0;i>a;a++)for(l=0;s>l;l++)o._m[l+r+a*h]=e._m[l+a*s];return o},r.swapRows=function(t,e){if(t=t,e=e,!(t>this._rows||e>this._rows)&&t!=e){this._det=-this._det;for(var i=0,s=0;s<this._columns;s++)i=this._m[s+t*this._columns],this._m[s+t*this._columns]=this._m[s+e*this._columns],this._m[s+e*this._columns]=i}},r.random=function(t,e){for(var i=this._rows*this._columns,s=0;i>s;s++)this._m[s]=Math.round(Math.random()*(Math.max(t,e)-Math.min(t,e)))+Math.min(t,e)},r.clone=function(){for(var e=this._rows*this._columns,i=new t.adobe.utils.MatrixMath(this._rows,this._columns),s=0;e>s;s++)i._m[s]=this._m[s];return i},s(r,"isError",function(){return this._isError},function(t){this._isError=t}),s(r,"errorMes",function(){return this._errorMes},function(t){this._errorMes=t}),s(r,"detMultiplier",function(){return this._det}),s(r,"rows",function(){return this._rows}),s(r,"columns",function(){return this._columns}),r.setElement=function(t,e,i){t=t,e=e,t>=this._rows||e>=this._columns||(this._m[e+t*this._columns]=i)},r.getElement=function(t,e){return t=t,e=e,t>=this._rows||e>=this._columns?0/0:this._m[e+t*this._columns]},r.setMatrixFromRows=function(t){for(var e=t.length,i=t[0].length,s=0;e>s;s++)if(t[s].length!=i)return;for(this._m.length=e*i,s=0;e>s;s++)for(var n=0;i>n;n++)this._m[n+s*i]=t[s][n];this._rows=e,this._columns=i},r.setMatrixFromVector=function(t,e,i){e=e,i=i;var s=e*i;if(s==t.length){for(var n=0;s>n;n++)this._m[n]=t[n];this._rows=e,this._columns=i}},s(r,"m",function(){return this._m}),r.traceMatrix=function(){for(var t,e=0;e<this._rows;e++){t="";for(var i=0;i<this._columns;i++)t+=this._m[i+e*this._columns],i<this._columns-1&&(t+="	");console.log(t)}},i}(egret.HashObject);e.MatrixMath=i,egret.registerClass(i,"com.adobe.utils.MatrixMath")}(i=e.utils||(e.utils={}))}(e=t.adobe||(t.adobe={}))}(com||(com={}));var ascb;!function(t){var e;!function(e){var i=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var s=(__define,i);s.prototype;return i.round=function(t,e){return void 0===e&&(e=1),Math.round(t/e)*e},i.floor=function(t,e){return void 0===e&&(e=1),Math.floor(t/e)*e},i.ceil=function(t,e){return void 0===e&&(e=1),Math.ceil(t/e)*e},i.random=function(e,i,s){if(void 0===i&&(i=0),void 0===s&&(s=1),e>i){var n=e;e=i,i=n}var r=i-e+1*s,h=Math.random()*r;return h+=e,t.util.NumberUtilities.floor(h,s)},i.getUniqueID=function(){return t.util.NumberUtilities.getUnique()+""},i.getUnique=function(){null==t.util.NumberUtilities._aUniqueIDs&&(t.util.NumberUtilities._aUniqueIDs=new Array);for(var e=new Date,i=e.getTime();!t.util.NumberUtilities.isUnique(i);)i+=t.util.NumberUtilities.random(e.getTime(),2*e.getTime());return t.util.NumberUtilities._aUniqueIDs.push(i),i},i.isUnique=function(e){for(var i=0;i<t.util.NumberUtilities._aUniqueIDs.length;i++)if(t.util.NumberUtilities._aUniqueIDs[i]==e)return!1;return!0},i}(egret.HashObject);e.NumberUtilities=i,egret.registerClass(i,"ascb.util.NumberUtilities")}(e=t.util||(t.util={}))}(ascb||(ascb={}));var com;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var s=(__define,i);s.prototype;return i.stringsAreEqual=function(t,e,i){return i?t==e:t.toUpperCase()==e.toUpperCase()},i.trim=function(e){return e&&0!=e.length?t.adobe.utils.StringUtil.ltrim(t.adobe.utils.StringUtil.rtrim(e)):e},i.ltrim=function(t){for(var e=t.length,i=0;e>i;i++)if(t.charCodeAt(i)>32)return t.substring(i);return""},i.rtrim=function(t){for(var e=t.length,i=e;i>0;i--)if(t.charCodeAt(i-1)>32)return t.substring(0,i);return""},i.beginsWith=function(t,e){return e==t.substring(0,e.length)},i.endsWith=function(t,e){return e==t.substring(t.length-e.length)},i.remove=function(e,i){return t.adobe.utils.StringUtil.replace(e,i,"")},i.replace=function(t,e,i){return t.split(e).join(i)},i.stringHasValue=function(t){return null!=t&&t.length>0},i.contains=function(t,e){return t.indexOf(e)>-1},i.addString=function(t,e,i){void 0===i&&(i="0");for(var s=t;s.length<e;)s+=i;return s},i}(egret.HashObject);e.StringUtil=i,egret.registerClass(i,"com.adobe.utils.StringUtil")}(i=e.utils||(e.utils={}))}(e=t.adobe||(t.adobe={}))}(com||(com={}));var com;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var s=(__define,i);s.prototype;return i.arrayContainsValue=function(t,e){return-1!=t.indexOf(e)},i.removeValueFromArray=function(t,e){for(var i=t.length,s=i;s>-1;s--)t[s]===e&&t.splice(s,1)},i.removeValueFromIndex=function(t,e){var i,s=t.length;return e>=0&&s>e&&(i=t[e],t.splice(e,1)),i},i.copyArray=function(t){return t.slice()},i.arraysAreEqual=function(t,e){if(t.length!=e.length)return!1;for(var i=t.length,s=0;i>s;s++)if(t[s]!==e[s])return!1;return!0},i.clear=function(t){t&&0!=t.length&&t.splice(0,t.length)},i.print=function(t){for(var e in t)console.log(e+":"+t[e])},i.getIndexFromValue=function(t,e){for(var i=-1,s=0;s<t.length;s++)if(e==t[s]){i=s;break}return i},i.swapObj=function(t,e){var i=t;t=e,e=i},i.swapArrObj=function(e,i,s){var n=t.adobe.utils.VectorUtil.getIndexFromValue(e,i),r=t.adobe.utils.VectorUtil.getIndexFromValue(e,s);n>-1&&r>-1&&(e[n]=s,e[r]=i)},i.swapArrInd=function(t,e,i){e=e,i=i;var s=t[e],n=t[i];e>-1&&i>-1&&(t[e]=n,t[i]=s)},i.swapChaArrInd=function(e,i,s){i=i,s=s;var n,r,h=[];if(0>i||i>=e.length)return e;if(s>=0&&s<e.length){n=e[i],r=e[s],t.adobe.utils.VectorUtil.removeValueFromIndex(e,i);for(var o=t.adobe.utils.VectorUtil.getIndexFromValue(e,r),a=0;o>a;a++)h[a]=e[a];h[o]=n;for(var l=o+1;l<e.length+1;l++)h[l]=e[l-1]}else s>=e.length?(n=e[i],t.adobe.utils.VectorUtil.removeValueFromIndex(e,i),e.push(n),h=t.adobe.utils.VectorUtil.copyArray(e)):0>s&&(n=e[i],t.adobe.utils.VectorUtil.removeValueFromIndex(e,i),e.unshift(n),h=t.adobe.utils.VectorUtil.copyArray(e));return h},i}(egret.HashObject);e.VectorUtil=i,egret.registerClass(i,"com.adobe.utils.VectorUtil")}(i=e.utils||(e.utils={}))}(e=t.adobe||(t.adobe={}))}(com||(com={}));var core;!function(t){var e=function(t){function e(){t.call(this),this.isDebug=!0,this.isDebugSmall=!0,this.nodeNum=0,this.branchNum=0,this.elecRowsVector=new Array,this.allNotes=new Array}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setHead=function(t){t=t,(this.isDebug||this.isDebugSmall)&&(console.log(),console.log("**************开始进行电路计算*********************")),this.branchNum=t},s.appendRow=function(t,e,i,s,n,r){this.elecRowsVector.push([t,e,i,s,n,r])},s.clear=function(){this.nodeNum=0,this.branchNum=0,com.adobe.utils.VectorUtil.clear(this.elecRowsVector)},s.calcCircuit=function(){if(this.branchNum<=0)return null;if(this.fresh_allNotes(),this.nodeNum=this.allNotes.length,this.isDebug||this.isDebugSmall){console.log("******************** 节点数:"+this.nodeNum+"   支路数:"+this.branchNum+" *******************");for(var t=0;t<this.elecRowsVector.length;t++){var e=this.elecRowsVector[t];console.log("appendRow: ("+e[0]+","+e[1]+","+e[2]+","+e[3]+","+e[4]+","+e[5]+")")}}var i=this.get_A();this.isDebug&&(console.log("*****节点电流的关联矩阵 A*****"),i.traceMatrix());var s=this.get_G();this.isDebug&&(console.log("*****支路电导矩阵 G*****"),s.traceMatrix());var n=this.get_Us();this.isDebug&&(console.log("*****独立电压源矩阵 Us*****"),n.traceMatrix());var r=this.get_Is();this.isDebug&&(console.log("*****独立电流源矩阵 Is*****"),r.traceMatrix());var h=i.clone();h.multiply(s),h.multiply(n),this.isDebug&&(console.log("*****AGUs*****"),h.traceMatrix());var o=i.clone();o.multiply(r),this.isDebug&&(console.log("*****AIs*****"),o.traceMatrix());var a=h.clone();a.substract(o),this.isDebug&&(console.log("*****节点电流源向量 In*****"),a.traceMatrix());var l=(a.m,i.transpose()),c=i.clone();c.multiply(i),c.multiply(s),c.multiply(l),this.isDebug&&(console.log("*****节点电导矩阵 Gn*****"),c.traceMatrix());var d=c.inverse(),u=d.clone();u.multiply(a);var p=u.clone().m;this.isDebug&&(console.log("*****节点电压 Un*****"),u.traceMatrix());var g=l.clone();this.isDebug&&(console.log("*****A 的转职*****"),g.traceMatrix()),g.multiply(u),this.isDebug&&(console.log("*****支路电压 Ub*****"),g.traceMatrix());var _=s.clone();_.multiply(n);var f=s.clone();f.multiply(g);var v=f.clone();v.add(r),v.substract(_),(this.isDebug||this.isDebugSmall)&&(console.log("*****支路电流 Ib*****"),v.traceMatrix()),p.push(0);var m={Un:p,Ub:g.m,Ib:v.m};return m},s.fresh_allNotes=function(){for(var t=new HashMap,e=0;e<this.elecRowsVector.length;e++){var i=this.elecRowsVector[e];t.put(i[1],i[1]),t.put(i[2],i[2])}var s=t.get_ValyeArray();s.sort(function(t,e){return e>t?-1:t>e?1:0}),this.allNotes=s},s.get_A=function(){for(var t=new com.adobe.utils.MatrixMath(this.nodeNum-1,this.branchNum),e=0;e<t.rows;e++)for(var i=this.allNotes[e],s=0;s<t.columns;s++){var n=this.elecRowsVector[s],r=0;r=i==n[1]?1:i==n[2]?-1:0,t.setElement(e,s,r)}return t},s.get_G=function(){for(var t=new com.adobe.utils.MatrixMath(this.branchNum,this.branchNum),e=0;e<this.branchNum;e++){var i=this.elecRowsVector[e];t.setElement(e,e,1/i[3])}return t},s.get_Us=function(){for(var t=new com.adobe.utils.MatrixMath(this.branchNum,1),e=0;e<this.branchNum;e++){var i=this.elecRowsVector[e];t.setElement(e,0,i[4])}return t},s.get_Is=function(){for(var t=new com.adobe.utils.MatrixMath(this.branchNum,1),e=0;e<this.branchNum;e++){var i=this.elecRowsVector[e];t.setElement(e,0,i[5])}return t},e}(egret.HashObject);t.ElecCore=e,egret.registerClass(e,"core.ElecCore")}(core||(core={}));var core;!function(t){var e=function(e){function i(i){e.call(this),this._timeInd=0,this.elecWireArr=[],this.eleCore=new t.ElecCore,this.hasZuhe=!1,this.allCompArr=[],this.staCompArr=[],this.zuheCompArr=new HashMap,this.huiArr=[],this.node_branch_arr=[],this.delCompArr=[],this.delWireArr=[],this.CapacitanceArr=[],this.ElecPowerStudentArr=[],this.suojian_delBindingerArr=[],this.elecAndArr=new HashMap,this.isFir_cacu=!1,this.oneHuiArr=new HashMap,this.allCompArrW_=[],this.allCompArrT=[],this.bodyView=i}__extends(i,e);var s=__define,n=i,r=n.prototype;return r.checkAllChanged=function(){this.cacu_AllElecComp()},s(r,"timeInd",function(){return this._timeInd}),r.step_enterFrame=function(){this._timeInd++;var t=!1,e=0,i=this.staCompArr.length;for(e=0;i>e;e++){var s=this.staCompArr[e];s.loop&&(t=!0),s.loopHandle()}t&&this.cacu_AllElecComp()},r.checkIsWire=function(t){return experimentalApparatus.Electricity.ElecUtil.checkIsWire(t)},r.update_power=function(t,e){void 0===e&&(e=!1),this.temp_x_com=t;var i,s,n=0,r=0,h=this.node_branch_arr.length,o=s.length;for(n=0;h>n;n++){var a=this.node_branch_arr[n];s=a.branchArr;var l=!1;for(r=0;o>r;r++){var c=s[r];c.elecComp==t&&(i=a.nodeArr,c.voltageSource=t.Power,l=!0),"SimpleCoilSkin"==c.elecComp.classname&&(e?(c.elecComp.hasSetCoilPower=!0,c.voltageSource=c.elecComp.Power,c.resistance=c.elecComp.minResistance):(c.elecComp.hasSetCoilPower=!1,c.voltageSource=0,c.resistance=c.elecComp.maxResistance))}if(l)break}i&&i.length>0&&s&&s.length>0&&this.cacu_node_branch(i,s);var d=this.zuheCompArr.getKeySet(),u=d.length;for(n=0;u>n;n++){var p=d[n];p.caculateOver&&p.caculateOver()}},r.getCFromNum=function(t){t=t;var e,i,s,n=null,r=this.elecWireArr.length;for(e=0;r>e;e++){var h=this.elecWireArr[e],o=h.owenBindingers;for(s=o.length,i=0;s>i;i++){var a=o[i];if(a.tmpNumber==t){n=a;break}}}return n},r.cacu_AllElecComp=function(){var t,e,i=0,s=0,n=0,r=0;for(this.elecAndArr.clear(),com.adobe.utils.ArrayUtil.clear(this.allCompArr),com.adobe.utils.ArrayUtil.clear(this.huiArr),this.getAll_comp(),i=this.allCompArr.length,n=0;i>n;n++)for(e=this.allCompArr[n],t=this.get_bindingers(e),s=t.length,r=0;r<t.length;r++){var h=t[r];h.Un&&(h.Un=0)}this.isFir_cacu=!0,this.cacu(),this.caculate_huiArr()},r.getAll_comp=function(){var t,e,i,s=0;this.hasZuhe=!1,com.adobe.utils.ArrayUtil.clear(this.allCompArr),com.adobe.utils.ArrayUtil.clear(this.staCompArr);var n=this.bodyView.itemContainer,r=com.adobe.utils.M.getAllChildren(n);for(s=r.length-1;s>=0;s--){var t=r[s];if(null!=t){if(t.isLock&&t.isLock)break;(t.h1_mc&&t.h2_mc||t.bposter0&&t.bposter1||t.slidPoster0&&t.slidPoster1||t.lightPoster0&&t.lightPoster1)&&t.owenBindingers&&(this.staCompArr.push(t),t.isZuHe&&t.isZuHe?(this.zuheCompArr.insert(t,t),t.isZuHe&&(this.allCompArr=this.allCompArr.concat(t.zuheCompArr)),this.hasZuhe=!0):this.allCompArr.push(t))}}for(i=this.staCompArr.length,s=0;i>s;s++){var e=this.staCompArr[s];e.allCompArrT=this.allCompArr,e.staCompArrT=this.staCompArr}},r.caculate_huiArr=function(){var t=0,e=0,i=0,s=0,n=this.zuheCompArr.getKeySet();for(com.adobe.utils.ArrayUtil.clear(this.node_branch_arr),i=this.huiArr.length,t=0;i>t;t++){var r=this.huiArr[t],h=new HashMap,o=new HashMap;for(s=r.length,e=0;s>e;e++){var a=r[e];this.checkIsWire(a)||a instanceof experimentalApparatus.Electricity.BaseElecWire?h.insert(a,a):o.insert(a,a)}var l=this.createNode(o.getKeySet(),h.getKeySet(),r),c=this.createBranch(r,l);this.node_branch_arr.push({nodeArr:l,branchArr:c}),this.cacu_node_branch(l,c)}for(i=this.allCompArrT.length,t=0;i>t;t++){var d=this.allCompArrT[t];d.caculateOver&&d.caculateOver()}for(i=n.length,t=0;i>t;t++){var u=n[t];u.caculateOver&&u.caculateOver()}if(this.isFir_cacu){for(this.isFir_cacu=!1,i=this.node_branch_arr.length,t=0;i>t;t++){var p=this.node_branch_arr[t];for(c=p.branchArr,s=c.length,e=0;s>e;e++){var g=c[e];"Capacitance"==g.classname&&(g.resistance=.1)}}for(i=this.CapacitanceArr.length,t=0;i>t;t++){var _=this.CapacitanceArr[t];_.startCharge()}if(this.elecAndArr.size>0)return com.adobe.utils.ArrayUtil.clear(this.allCompArr),com.adobe.utils.ArrayUtil.clear(this.huiArr),this.getAll_comp(),this.cacu(),void this.caculate_huiArr()}},r.fresh_isDianCiZhenDang=function(t){var e,i=[],s=[],n=t.length,r=[];for(e=0;n>e;e++){var h=t[e],o=h.elecComp;"Capacitance"==o.classname?i.push(h):"SimpleCoilSkin"==o.classname?s.push(h):0!=o.Power&&r.push(h)}0==r.length&&1==i.length&&1==s.length&&(i[0].elecComp.isDianCiZhenDang=!0,s[0].elecComp.isDianCiZhenDang=!0,s[0].resistance=3,s[0].elecComp.Resistance=1)},r.cacu_node_branch=function(t,e){var i=0,s=0;this.eleCore.clear(),this.eleCore.setHead(e.length),s=e.length;var n,r=[],h=[];for(i=0;s>i;i++){var o=e[i],a=o.elecComp;!this.checkIsWire(a)||a instanceof experimentalApparatus.Electricity.BaseElecWire||h.push(a),this.checkIsWire(a)||a instanceof experimentalApparatus.Electricity.BaseElecWire||(a instanceof experimentalApparatus.Electricity.BaseElecResistance?a.zuheBox&&(n=a.zuheBox,-1==r.indexOf(n)&&r.push(n)):r.push(a));var l=o.branchFlag,c=o.startNodeFlag,d=o.endNodeFlag,u=o.resistance,p=o.voltageSource,g=o.currentSource;this.eleCore.appendRow(l,c,d,u,p,g)}var _=CacuManager.cacu_comp_huilu(r,h);MessageCenter.getInstance().dispatch(ItemEventConst.DIANLU_CONNECT_CHANGED,_);var f=this.eleCore.calcCircuit();if(f){var v=f.Ub,m=f.Ib,E=f.Un;for(s=E.length,i=0;s>i;i++)t[i].bindinger.Un&&(t[i].bindinger.Un=E[i]);var b=!1;for(s=e.length,i=0;s>i;i++){var y=e[i].elecComp,C=m[i];"ElecTwo"==y.classname&&(y.Resistance<1&&0>C?(y.Resistance=y.resMax,b=!0):y.Resistance>1&&C>0&&(y.Resistance=y.resMin,b=!0))}if(b)return void this.caculate_huiArr();var T=!1,x=[];for(s=e.length,i=0;s>i;i++){var y=e[i].elecComp,I=v[i];"SimpleCoilSkin"!=y.classname||y.isDianCiZhenDang||y.hasSetCoilPower||(y.power12=I,y.hasSetCoilPower=!0,T=!0,x.push(y))}if(T)return void(1==x.length?(this.temp_x_com=x[0],this.update_power(this.temp_x_com,!0)):this.cac_huilu());var w=!1;for(s=e.length,i=0;s>i;i++){var L=e[i],P=L.elecComp;if("Capacitance"==P.classname){w=!0;break}}for(s=e.length,i=0;s>i;i++){var P=e[i].elecComp,I=v[i],A=m[i];w&&this.isFir_cacu?"Capacitance"!=P.classname||P.has_set_Vu||(P.Vu=I,P.has_set_Vu=!0):(P.setWorkPower&&P.setWorkPower(I),P.setWorkElec&&P.setWorkElec(A),"UniversalMetre"==P.classname&&2==P.mode&&(A=A||1e-6,P.setWorkRes(Math.abs(I/A-.001))))}}},r.cacu=function(){var t=0,e=0,i=0,s=0;for(i=this.allCompArr.length,t=0;i>t;t++){var n=this.allCompArr[t];n.isZuHe&&"ElecPowerStudent"==n.zuheBox.classname&&"bposter0"==n.bposter0.name&&1==n.zuheBox.power_mode&&n.zuheBox.stop_jp(),"Capacitance"==n.classname&&(n.stopCharge(),n.Vu=0,n.has_set_Vu=!1),n.valid&&(n.valid=!1)}for(com.adobe.utils.ArrayUtil.clear(this.delCompArr),com.adobe.utils.ArrayUtil.clear(this.delWireArr),com.adobe.utils.ArrayUtil.clear(this.CapacitanceArr),com.adobe.utils.ArrayUtil.clear(this.ElecPowerStudentArr),com.adobe.utils.ArrayUtil.clear(this.suojian_delBindingerArr),this.suojian(),this.effectiveAllElecs=com.adobe.utils.ArrayUtil.copyArray(this.allCompArr),i=this.delWireArr.length,t=0;i>t;t++){var n=this.delWireArr[t];n.setWorkPower&&n.setWorkPower(0),n.setWorkElec&&n.setWorkElec(0),n.caculateOver&&n.caculateOver(),n.huiUID="0"}for(i=this.delCompArr.length,t=0;i>t;t++){var n=this.delCompArr[t];if("SimpleCoilSkin"==n.classname&&(n.power12=0,n.hasSetCoilPower=!1,n.Resistance=n.maxResistance),n.setWorkPower&&n.setWorkPower(0),n.setWorkElec&&n.setWorkElec(0),n.isDianCiZhenDang&&n.isDianCiZhenDang&&(n.isDianCiZhenDang=!1,"SimpleCoilSkin"==n.classname&&(n.Resistance=n.maxResistance)),n.isZuHe&&n.isZuHe){if(n.zuheCompArr){var r=n.zuheCompArr;for(s=r.length,e=0;s>e;e++){var h=r[e];h.setWorkPower&&h.setWorkPower(0),h.setWorkElec&&h.setWorkElec(0),h.caculateOver&&h.caculateOver()}}n.caculateOver&&n.caculateOver()}}if(this.allCompArr.length<4){var o=this.zuheCompArr.getKeySet();
for(i=o.length,t=0;i>t;t++){var h=o[t];h.caculateOver&&h.caculateOver()}}else{for(i=this.allCompArr.length,t=0;i>t;t++){var n=this.allCompArr[t];n.valid&&(n.valid=!0),n.isZuHe&&"ElecPowerStudent"==n.zuheBox.classname&&"bposter0"==n.bposter0.name&&1==n.zuheBox.power_mode&&n.zuheBox.start_jp(),"Capacitance"==n.classname&&(n.Resistance=1e6,this.CapacitanceArr.push(n)),n.isZuHe&&"ElecPowerStudent"==n.zuheBox.classname&&"bposter0"==n.bposter0.name&&this.ElecPowerStudentArr.push(n.zuheBox)}this.cac_huilu()}},r.suo_duanlu=function(t){var e,i,s=0,n=0,r=0,h=0,o=[];for(r=this.allCompArr.length,s=0;r>s;s++){var a=this.allCompArr[s];if(!this.checkIsWire(a)){var l=a.bposter0.bindinger.friendPostersArr;for(h=l.length,n=0;h>n;n++){var c=l[n];if(this.checkIsWire(c.body)){e=c.body;break}}var d=a.bposter1.bindinger.friendPostersArr;for(h=l.length,n=0;h>n;n++){var u=d[n];if(this.checkIsWire(u.body)){i=u.body;break}}for(h=t.length,n=0;h>n;n++){var p=t[n];if(com.adobe.utils.ArrayUtil.arrayContainsValue(p,e)&&com.adobe.utils.ArrayUtil.arrayContainsValue(p,i)){o.push(a);break}}}}this.delCompArr=this.delCompArr.concat(o),com.adobe.utils.ArrayUtil.removeArrayFromArray(this.allCompArr,o)},r.suojian=function(){var t=0,e=0,i=0,s=0,n=0,r=0;for(s=this.allCompArr.length,t=0;s>t;t++){var h=this.allCompArr[t],o=!1;if(h.isBreak&&h.isBreak)o=!0;else if(this.checkIsWire(h))if(!h.h1_mc||!h.h2_mc||!h.h1_mc.bindinger||!h.h2_mc.bindinger||h.h1_mc&&!this.checkValueBindinger(h.h1_mc.bindinger)||h.h2_mc&&!this.checkValueBindinger(h.h2_mc.bindinger))o=!0;else{var a=h.h1_mc.bindinger.friendPostersArr,l=h.h2_mc.bindinger.friendPostersArr;if(a.length>0&&l.length>0){var c,d;for(n=a.length,e=0;n>e;e++){var u=a[e];if(!(this.checkIsWire(u.body)||u.body instanceof experimentalApparatus.Electricity.BaseElecWire)){c=u;break}}for(n=l.length,e=0;n>e;e++){var u=l[e];if(!(this.checkIsWire(u.body)||u.body instanceof experimentalApparatus.Electricity.BaseElecWire)){d=u;break}}c==d&&(o=!0)}}else if(h instanceof experimentalApparatus.Electricity.BaseElecWire)(h.bposter0&&!this.checkValueBindinger(h.bposter0.bindinger)||h.bposter1&&!this.checkValueBindinger(h.bposter1.bindinger))&&(o=!0);else if("ElecSinglePloeDoubleThrowSwitch"==h.classname){var p=[];if(0==h.type?o=!0:1==h.type?com.adobe.utils.ArrayUtil.arrayContainsValue(this.suojian_delBindingerArr,h.bposter2.bindinger)||p.push(h.bposter2.bindinger):2==h.type&&(com.adobe.utils.ArrayUtil.arrayContainsValue(this.suojian_delBindingerArr,h.bposter0.bindinger)||p.push(h.bposter0.bindinger)),p.length>0){var g=!1;for(n=p.length,e=0;n>e;e++){var _,f=p[e],v=f.friendPostersArr,m=0;for(r=v.length,i=0;n>i;i++){var E=v[i];this.checkIsWire(E.body)&&com.adobe.utils.ArrayUtil.arrayContainsValue(this.allCompArr,E.body)&&(_=E.body,m++)}1==m&&(com.adobe.utils.ArrayUtil.removeValueFromArray(this.allCompArr,_),this.delCompArr.push(_),g=!0)}if(g)return this.suojian_delBindingerArr=this.suojian_delBindingerArr.concat(p),void this.suojian()}}else if("ElecAnd"==h.classname){var b=this.get_bindinger_ValidWireNums(h.bposter0.bindinger,this.allCompArr),y=this.get_bindinger_ValidWireNums(h.bposter1.bindinger,this.allCompArr),C=this.get_bindinger_ValidWireNums(h.bposter2.bindinger,this.allCompArr),T=[b,y,C],x=0;for(n=T.length,e=0;n>e;e++)0==T[e]&&x++;if(this.isFir_cacu&&x>=1||0==C)o=!0;else if(this.isFir_cacu){h.resistance0=1e-6,h.resistance1=1e-6,h.resistance2=1e-6;var I=[];b>0&&I.push(h.bposter0.bindinger),y>0&&I.push(h.bposter1.bindinger),C>0&&I.push(h.bposter2.bindinger),h.bposter3.bindinger.friendPostersArr=I,this.elecAndArr.insert(h,{elecComp:h,type:0})}else{var w=null;if(h.bposter0.bindinger.Un>h.bposter1.bindinger.Un?w=h.bposter0.bindinger:h.bposter0.bindinger.Un<h.bposter1.bindinger.Un&&(w=h.bposter1.bindinger),com.adobe.utils.ArrayUtil.removeValueFromArray(h.bposter3.bindinger.friendPostersArr,w),w){var L=this.get_bindinger_ValidWire(w,this.allCompArr);if(1==L.length)return com.adobe.utils.ArrayUtil.removeValueFromArray(this.allCompArr,L[0]),this.delCompArr.push(L[0]),void this.suojian()}}}else if("ElecOr"==h.classname){var b=this.get_bindinger_ValidWireNums(h.bposter0.bindinger,this.allCompArr),y=this.get_bindinger_ValidWireNums(h.bposter1.bindinger,this.allCompArr),C=this.get_bindinger_ValidWireNums(h.bposter2.bindinger,this.allCompArr),T=[b,y,C],x=0;for(n=T.length,e=0;n>e;e++)0==T[e]&&x++;if(this.isFir_cacu&&x>=2||0==C)o=!0;else if(this.isFir_cacu){h.resistance0=1e-6,h.resistance1=1e-6,h.resistance2=1e-6;var I=[];b>0&&I.push(h.bposter0.bindinger),y>0&&I.push(h.bposter1.bindinger),C>0&&I.push(h.bposter2.bindinger),h.bposter3.bindinger.friendPostersArr=I,this.elecAndArr.insert(h,{elecComp:h,type:0})}else if(b>0&&y>0){var w=null;if(h.bposter0.bindinger.Un>h.bposter1.bindinger.Un?w=h.bposter0.bindinger:h.bposter0.bindinger.Un<h.bposter1.bindinger.Un&&(w=h.bposter1.bindinger),com.adobe.utils.ArrayUtil.removeValueFromArray(h.bposter3.bindinger.friendPostersArr,w),w){var L=this.get_bindinger_ValidWire(w,this.allCompArr);if(1==L.length)return com.adobe.utils.ArrayUtil.removeValueFromArray(this.allCompArr,L[0]),this.delCompArr.push(L[0]),void this.suojian()}}}else(h.bposter0&&h.bposter0&&!this.checkValueBindinger(h.bposter0.bindinger)||h.bposter1&&h.bposter1&&!this.checkValueBindinger(h.bposter1.bindinger))&&(o=!0);if(o)return com.adobe.utils.ArrayUtil.removeValueFromArray(this.allCompArr,h),this.checkIsWire(h)||h instanceof experimentalApparatus.Electricity.BaseElecWire?this.delWireArr.push(h):this.delCompArr.push(h),void this.suojian()}},r.get_bindinger_ValidWireNums=function(t,e){var i=this.get_bindinger_ValidWire(t,e);return i.length},r.get_bindinger_ValidWire=function(t,e){var i,s=0,n=t.friendPostersArr,r=[];for(i=n.length,s=0;i>s;s++){var h=n[s];(this.checkIsWire(h.body)||h.body instanceof experimentalApparatus.Electricity.BaseElecWire)&&com.adobe.utils.ArrayUtil.arrayContainsValue(e,h.body)&&r.push(h.body)}return r},r.checkValueBindinger=function(t){var e,i=0,s=!1;if(!t)return!1;var n=t.friendPostersArr;if(n)for(e=n.length,i=0;e>i;i++){var r=n[i];if(com.adobe.utils.ArrayUtil.arrayContainsValue(this.allCompArr,r.body)){s=!0;break}}return s},r.cac_huilu=function(){var t,e=0;this.oneHuiArr.clear(),this.allCompArrT=com.adobe.utils.ArrayUtil.copyArray(this.allCompArr);var i=[];for(i.push(this.allCompArr.pop());i.length>0;){var s=i.shift();this.oneHuiArr.insert(s,s);var n=this.get_OtherItems(s,this.allCompArrT);for(t=n.length,e=0;t>e;e++){var r=n[e];this.oneHuiArr.containsKey(r)||com.adobe.utils.ArrayUtil.arrayContainsValue(i,r)||(com.adobe.utils.ArrayUtil.removeValueFromArray(this.allCompArr,r),i.push(r))}}var h=this.oneHuiArr.getKeySet();if(h.length>=4){this.huiArr.push(h);var o=com.adobe.utils.M.getUniqueID();for(t=h.length,e=0;t>e;e++){var s=h[e];s.huiUID=o}}this.allCompArr.length>0&&this.cac_huilu()},r.get_OtherItems=function(t,e){var i=0,s=0,n=0,r=0,h=new HashMap,o=this.get_bindingers(t);for("ElecSinglePloeDoubleThrowSwitch"==t.classname&&(1==t.type?o.pop():2==t.type&&o.shift()),n=o.length,i=0;n>i;i++){var a=o[i],l=a.friendPostersArr;for(r=l.length,s=0;r>s;s++){var c=l[s];com.adobe.utils.ArrayUtil.arrayContainsValue(e,c.body)&&h.insert(c.body,c.body)}}return h.getKeySet()},r.getAllGroupLinkWire=function(){var t,e=0;if(this.allCompArrW_=com.adobe.utils.ArrayUtil.copyArray(this.effectiveAllElecs),!this.allCompArrW_)return[];var i=[];for(t=this.allCompArrW_.length,e=0;t>e;e++){var s=this.allCompArrW_[e];this.checkIsWire(s)&&i.push(s)}for(var n=[];i.length>0;){var r=this.getLinkWire(i);n.push(r),com.adobe.utils.ArrayUtil.removeArrayFromArray(i,r)}return n},r.getLinkWire=function(t){var e,i=0,s=new HashMap,n=[];for(n.push(t.pop());n.length>0;){var r=n.shift();s.insert(r,r);var h=this.get_OtherWires(r,t);for(e=h.length,i=0;e>i;i++){var o=h[i];s.containsKey(o)||com.adobe.utils.ArrayUtil.arrayContainsValue(n,o)||(com.adobe.utils.ArrayUtil.removeValueFromArray(t,o),n.push(o))}}return s.getKeySet()},r.get_OtherWires=function(t,e){var i=0,s=0,n=0,r=0,h=new HashMap,o=this.get_bindingers(t);for(n=o.length,i=0;n>i;i++){var a=o[i],l=a.friendPostersArr;for(r=l.length,s=0;r>s;s++){var c=l[s];com.adobe.utils.ArrayUtil.arrayContainsValue(e,c.body)&&this.checkIsWire(c.body)&&h.insert(c.body,c.body)}}return h.getKeySet()},r.get_bindingers=function(t){var e=[];this.checkIsWire(t)?t.h1_mc&&t.h2_mc&&(e.push(t.h1_mc.bindinger),e.push(t.h2_mc.bindinger)):t instanceof experimentalApparatus.Electricity.BaseElecWire?t.bposter0&&t.bposter1&&(e.push(t.bposter0.bindinger),e.push(t.bposter1.bindinger)):"ElecSinglePloeDoubleThrowSwitch"==t.classname?t.bposter0&&t.bposter1&&t.bposter2&&(e.push(t.bposter0.bindinger),e.push(t.bposter1.bindinger),e.push(t.bposter2.bindinger)):"ElecSlideRheostat"==t.classname?t.slidPoster0&&t.slidPoster1&&t.slidPoster2&&t.slidPoster3&&(e.push(t.slidPoster0.bindinger),e.push(t.slidPoster1.bindinger),e.push(t.slidPoster2.bindinger),e.push(t.slidPoster3.bindinger)):"ElecAnd"==t.classname||"ElecOr"==t.classname?t.bposter0&&t.bposter1&&t.bposter2&&(e.push(t.bposter0.bindinger),e.push(t.bposter1.bindinger),e.push(t.bposter2.bindinger)):t.bposter0&&t.bposter0&&t.bposter1&&t.bposter1&&(t.bposter0&&t.bposter0&&t.bposter0.bindinger&&e.push(t.bposter0.bindinger),t.bposter1&&t.bposter1&&t.bposter1.bindinger&&e.push(t.bposter1.bindinger),t.bposter2&&t.bposter2&&t.bposter2.bindinger&&e.push(t.bposter2.bindinger));var i=0,s=e.length,n=[];for(i=0;s>i;i++){var r=e[i];r&&n.push(r)}return n},r.createBranch=function(t,e){var i=0,s=0,n=0,r=0,h=[],o=0;for(n=t.length,i=0;n>i;i++){var a=t[i],l=o,c=[],d=0,u=0,p=!1;if(this.checkIsWire(a))c.push(a.h1_mc.bindinger),c.push(a.h2_mc.bindinger),u=1e-6,p=!0;else if(a instanceof experimentalApparatus.Electricity.BaseElecWire)c.push(a.bposter0.bindinger),c.push(a.bposter1.bindinger),u=1e-6,p=!0;else if(experimentalApparatus.Electricity.ElecUtil.checkIsVoltmeter(a))c.push(a.bposter0.bindinger),c.push(a.bposter1.bindinger),u=1e6;else if("ElecSinglePloeSingleThrowSwitch"==a.classname)c.push(a.bposter0.bindinger),c.push(a.bposter1.bindinger),u=1e-6;else if("ElecSinglePloeDoubleThrowSwitch"==a.classname)1==a.type?(c.push(a.bposter0.bindinger),c.push(a.bposter1.bindinger)):2==a.type&&(c.push(a.bposter1.bindinger),c.push(a.bposter2.bindinger)),u=1e-6;else if("ElecAnd"==a.classname||"ElecOr"==a.classname){var g=a.bposter3.bindinger.friendPostersArr;for(r=g.length,s=0;r>s;s++){var _=g[s],f=_,v=a.bposter3.bindinger,m=this.getFNum(f,e,!1),E=this.getFNum(v,e,!1),b=0;switch(_.name){case"bposter0":b=a.resistance0;break;case"bposter1":b=a.resistance1;break;case"bposter2":b=a.resistance2}l=o,h.push({branchFlag:l,startNodeFlag:m,endNodeFlag:E,resistance:b,voltageSource:0,currentSource:0,elecComp:a}),o++}}else if("UniversalMetre"==a.classname){var y=a.mode;switch(y){case 0:u=1e10;break;case 1:u=1e-6;break;case 2:u=.001,d=.001}c.push(a.bposter0.bindinger),c.push(a.bposter1.bindinger)}else c.push(a.bposter0.bindinger),c.push(a.bposter1.bindinger),u=a.Resistance,d=a.Power;if(2==c.length){var m=this.getFNum(c[0],e,p),E=this.getFNum(c[1],e,p);l=o,h.push({branchFlag:l,startNodeFlag:m,endNodeFlag:E,resistance:u,voltageSource:d,currentSource:0,elecComp:a}),o++}}return h},r.getFNum=function(t,e,i){var s=0,n=0,r=0,h=0,o=0;if(i){var a=!1,l=[];for(r=e.length,s=0;r>s;s++){var c=e[s];c.isWire&&l.push(c)}for(r=e.length,s=0;r>s;s++){var c=e[s],d=[c.bindinger].concat(c.bindinger.friendPostersArr);for(h=l.length,n=0;h>n;n++){var u=l[n];if(com.adobe.utils.ArrayUtil.arrayContainsValue(d,u)){o=u.number,a=!0;break}}if(a)break}if(!a){var p=t.friendPostersArr;for(r=p.length,s=0;r>s;s++){var g=p[s];if(!(this.checkIsWire(g.body)||g.body instanceof experimentalApparatus.Electricity.BaseElecWire)){for(h=e.length,n=0;h>n;n++){var _=e[n];if(_.bindinger==g){o=_.number;break}}break}}}}else for(r=e.length,s=0;r>s;s++){var c=e[s];if(c.bindinger==t){o=c.number;break}}return o},r.createNode=function(t,e,i){var s=0,n=0,r=0,h=0,o=[],a=0;for(r=t.length,s=0;r>s;s++){var l=t[s],c=this.get_bindingers(l),d=[];if("ElecSinglePloeDoubleThrowSwitch"==l.classname)1==l.type?d.push(c.pop()):2==l.type&&d.push(c.shift());else if("ElecAnd"==l.classname||"ElecOr"==l.classname){com.adobe.utils.ArrayUtil.clear(c);var u=l.bposter3.bindinger.friendPostersArr;for(h=u.length,n=0;h>n;n++){var p=u[n],g=this.get_bindinger_ValidWireNums(p,t);0!=g&&u.push(p)}for(u=u.concat(l.bposter3.bindinger),h=u.length,n=0;h>n;n++){var p=u[n],_={};_.bindinger=p,_.number=a,_.isWire=!1,o.push(_),a++}}for(h=c.length,n=0;h>n;n++){var f=c[n],_={};_.bindinger=f,_.number=a,_.isWire=!1,o.push(_),a++}if(d.length>0)for(h=d.length,n=0;h>n;n++){var f=d[n],v=this.check_b_in_wireArr(f,e);if(v){var m=this.check_has_node(o,v);if(!m){var _={};_.bindinger=f,_.number=a,_.isWire=!0,o.push(_),a++}}}}for(r=this.delCompArr.length,s=0;r>s;s++){var E=this.delCompArr[s],c=this.get_bindingers(E);for(h=c.length,n=0;h>n;n++){var f=c[n],v=this.check_b_in_wireArr(f,e);if(v){var _={};_.bindinger=f,_.number=a,_.isWire=!0,o.push(_),a++}}}return o},r.check_has_node=function(t,e){var i=0,s=0,n=e.friendPostersArr,r=!1;for(n=n.concat(e),s=t.length,i=0;s>i;i++){var h=t[i];com.adobe.utils.ArrayUtil.arrayContainsValue(n,h.bindinger)&&(r=!0)}return r},r.check_b_in_wireArr=function(t,e){var i=0,s=0,n=t.friendPostersArr;for(s=n.length,i=0;s>i;i++){var r=n[i];if(com.adobe.utils.ArrayUtil.arrayContainsValue(e,r.body))return r}return null},r.getElecWire_FriendWire=function(t){var e=0,i=0,s=[],n=t.friendPostersArr;for(i=n.length,e=0;i>e;e++){var r=n[e];(this.checkIsWire(r.body)||r.body instanceof experimentalApparatus.Electricity.BaseElecWire)&&s.push(r.body)}return s},i}(egret.HashObject);t.Elect_Update=e,egret.registerClass(e,"core.Elect_Update")}(core||(core={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.cateid=1,this.iElecInter=0,this.Resistance=t.Electricity.ElecUtil.MIN_RESISTANCE,this.Power=0,this.huiUID="0",this.UID="0",this.allCompArrT=[],this.staCompArrT=[],this.owenBindingers={},this.bPsArr=[],this.bpsGroupArr=[],this.isLock=!1,this.isZuHe=!1,this.zuheBox=null,this.zuheCompArr=[],this.isBreak=!1,this.realV=0,this.realA=0,this.UID=com.adobe.utils.M.getUniqueID()}__extends(i,e);var s=(__define,i),n=s.prototype;return n.kds_remove=function(){this.break_wai(),this.remove(),this.diyChanged()},n.break_wai=function(){var t=0,e=this.bPsArr.length;for(t=0;e>t;t++){var i=this.bPsArr[t];i.clear_friend()}},n.break_nei=function(){},n.addBinPoster=function(e,i,s){void 0===s&&(s=null),s||(s=this);var n=new t.Electricity.BindingPoster(s,e,i);return this.bPsArr.push(n),null!=e&&(this.owenBindingers[e.name]=n),n},n.addBinWirePoster=function(e,i){var s=new t.Electricity.BindingPoster(this,e,i);return this.bPsArr.push(s),this.owenBindingers[e.name]=s,s},n.dragIng=function(){var e,i=t.Electricity.ElecUtil.checkIsWire(this);if(!i)for(e=0;e<this.bPsArr.length;e++)this.bPsArr[e].bindingFllowIng()},n.diyChanged=function(){t.Electricity.ElecUtil.diyChanged()},n.update_power=function(e,i){void 0===e&&(e=null),void 0===i&&(i=!1),t.Electricity.ElecUtil.update_power(e,i)},n.addDrag=function(){},n.this_downHandle=function(t){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),flashUtils.startDrag(this)},n.stage_upHandle=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),flashUtils.stopDrag(this)},n.getValidLinkWires=function(t){for(var e,i=[],s=t.bindinger.friendPostersArr.length,n=0;s>n;n++){e=t.bindinger.friendPostersArr[n];var r=e.body;r&&r.valid&&i.push(r)}return i},n.bindWire=function(t,e){},n.remove=function(){},n.setWorkElec=function(t){},n.setWorkPower=function(t){},n.caculateOver=function(){},i}(Item);e.BASEElectricity=i,egret.registerClass(i,"experimentalApparatus.Electricity.BASEElectricity")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(e){function i(i,s){void 0===i&&(i=3),void 0===s&&(s="ElecLamp"),e.call(this),this.curPower=0,this.curElec=0;var n=this;this.iElecInter=i,this.classname=s,this.bposter0=new t.Electricity.BindMC("bposter0",this),this.bposter1=new t.Electricity.BindMC("bposter1",this),n.addChild(this.bposter0),n.addChild(this.bposter1)}__extends(i,e);var s=(__define,i),n=s.prototype;return n.set_bposterXY=function(t,e){this.bposter0.x=t.x,com.adobe.utils.M.setSPPoint(this.bposter0,t),com.adobe.utils.M.setSPPoint(this.bposter1,e)},n.set_bposter=function(t,e,i){this.bposter0=t,this.bposter1=e,this.Resistance=i,t.bindinger.set_myroad(e.bindinger,this.Resistance)},n.setWorkPower=function(t){this.curPower=t},n.setWorkElec=function(t){this.curElec=t},i}(t.Electricity.BASEElectricity);e.BaseElecComp=i,egret.registerClass(i,"experimentalApparatus.Electricity.BaseElecComp")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.tempPower=0,this.tempElec=0,this.zuheBox=e}__extends(e,t);var i=(__define,e),s=i.prototype;return s.set_bposter=function(t,e,i){this.bposter0=t,this.bposter1=e,this.Resistance=i,t.bindinger.set_myroad(e.bindinger,this.Resistance)},s.setWorkPower=function(t){this.tempPower=t,null!=this.setWorkPowerFunc&&this.setWorkPowerFunc(this,t)},s.setWorkElec=function(t){this.tempElec=t,null!=this.setWorkElecFunc&&this.setWorkElecFunc(this,t)},e}(t.Electricity.BASEElectricity);e.BaseElecResistance=i,egret.registerClass(i,"experimentalApparatus.Electricity.BaseElecResistance")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.bposter0=new t.utils.DynamicSprite,this.bposter1=new t.utils.DynamicSprite,this.Resistance=1e-6,this.bposter0.bindinger=new _BindingPoster(this,this.bposter0,"bposter0"),this.bposter1.bindinger=new _BindingPoster(this,this.bposter1,"bposter1")}__extends(i,e);var s=(__define,i),n=s.prototype;return n.set_bindingers=function(t,e){this.bposter0.bindinger.friendPostersArr.push(t.bindinger),t.bindinger.friendPostersArr.push(this.bposter0.bindinger),this.bposter1.bindinger.friendPostersArr.push(e.bindinger),e.bindinger.friendPostersArr.push(this.bposter1.bindinger)},n.breakBind=function(){var t=com.adobe.utils.ArrayUtil.copyArray(this.bposter0.bindinger.friendPostersArr);for(var e in t){var i=t[e];com.adobe.utils.ArrayUtil.removeValueFromArray(this.bposter0.bindinger.friendPostersArr,i),com.adobe.utils.ArrayUtil.removeValueFromArray(i.friendPostersArr,this.bposter0.bindinger)}var s=com.adobe.utils.ArrayUtil.copyArray(this.bposter1.bindinger.friendPostersArr);for(var e in s){var i=s[e];com.adobe.utils.ArrayUtil.removeValueFromArray(this.bposter1.bindinger.friendPostersArr,i),com.adobe.utils.ArrayUtil.removeValueFromArray(i.friendPostersArr,this.bposter1.bindinger)}},n.set_friendPostersArr=function(t,e){for(var i in e.bindinger.friendPostersArr){var s=e.bindinger.friendPostersArr[i];com.adobe.utils.ArrayUtil.arrayContainsValue(t.bindinger.friendPostersArr,s)||t.bindinger.friendPostersArr.push(s)}com.adobe.utils.ArrayUtil.arrayContainsValue(t.bindinger.friendPostersArr,e.bindinger)||t.bindinger.friendPostersArr.push(e.bindinger)},i}(t.Electricity.BASEElectricity);e.BaseElecWire=i,egret.registerClass(i,"experimentalApparatus.Electricity.BaseElecWire")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(e){function i(i,s,n){void 0===n&&(n=16711680),e.call(this),this.isWireBind=!1,this.downFunc=null,this.upHandleFunc=null;var r=this;r.touchEnabled=!0,this.name=i,t.Electricity.ElecUtil.checkIsWire(s)?this.bindinger=s.addBinWirePoster(this,i):this.bindinger=s.addBinPoster(this,i);var h=new egret.Sprite;r.addChild(h),DisplayUtil.drawRect(h.graphics,40,40,.6,n),h.x=-h.width/2,h.y=-h.height/2}__extends(i,e);var s=(__define,i),n=s.prototype;return n.initMC=function(){},n.addDrag=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.this_downHandle,this)},n.removeDrag=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.this_downHandle,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this)},n.this_downHandle=function(t){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),flashUtils.startDrag(this),null!=this.downFunc&&this.downFunc(this)},n.stage_upHandle=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),flashUtils.stopDrag(this),null!=this.upHandleFunc&&this.upHandleFunc(this)},i}(egret.Sprite);e.BindMC=i,egret.registerClass(i,"experimentalApparatus.Electricity.BindMC")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(e){function i(t,i,s){e.call(this),this.body=null,this.binPoster=null,this.name="",this.myroad_arr=[],this.Un=0,this.connectMinDistanceNumber=100,this.body=t,this.binPoster=i,this.name=s,this.friendPostersArr=[]}__extends(i,e);var s=(__define,i),n=s.prototype;return n.set_myroad=function(t,e){void 0===e&&(e=1e-6);var i=0,s=this.myroad_arr.length,n=!1;for(i=0;s>i;i++){var r=this.myroad_arr[i];if(r.to==t){n=!0;break}}if(!n){var h={to:t,zu:e};this.myroad_arr.push(h);var o={to:this,zu:e};t.myroad_arr.push(o)}},n.clear_myroad=function(){var t=0,e=0,i=0,s=0;for(i=this.myroad_arr.length,t=0;i>t;t++){var n=this.myroad_arr[t],r=0;for(s=n.to.myroad_arr.length,e=0;s>e;e++){var h=n.to.myroad_arr[e];if(h.to==this){n.to.myroad_arr.splice(r,1);break}r++}}com.adobe.utils.ArrayUtil.clear(this.myroad_arr)},n.nearToBinding=function(){var e;e=this.binPoster.parent.localToGlobal(this.binPoster.x,this.binPoster.y,e);var i,s,n=0,r=[],h=DisplayUtil.getParenFromNameDis(this.body,"elec_equipmentContainer"),o=com.adobe.utils.M.getAllChildren(h);for(n=0;n<o.length;n++)for(i=o[n],s=0;s<i.bPsArr.length;s++){var a=i.bPsArr[s],l=a.binPoster,c=new egret.Point(l.x,l.y);if(0!=c.length){c=l.parent.localToGlobal(l.x,l.y,c);var d=egret.Point.distance(e,c);if(i instanceof HomeElectric&&t.Electricity.ElecUtil.checkIsPower(i))r.push({distance:d,component:i,bPsIt:a});else if(void 0!=d&&d<=this.connectMinDistanceNumber){if(t.Electricity.ElecUtil.checkIsWire(i))continue;r.push({distance:d,component:i,bPsIt:a})}}}var u=!1;return r.length&&(flashUtils.sortOn(r,"distance"),u=this.nearToBinding__0(r[0].component,r[0].bPsIt)),u},n.nearToBinding__0=function(t,e){var i,s=t.owenBindingers[e.name],n=s.friendPostersArr.concat(this,s);for(i=0;i<n.length;i++)n[i].bindingMultiPosters(n);s.binPoster.alpha=0,this.binPoster.alpha=0;var r=new egret.Point(s.binPoster.x,s.binPoster.y);return r=s.binPoster.parent.localToGlobal(s.binPoster.x,s.binPoster.y,r),r=this.binPoster.parent.globalToLocal(r.x,r.y,r),this.binPoster.x=r.x,this.binPoster.y=r.y,this.body.followLinkObj(),t.bindWire(e,this.binPoster),!0},n.breakBinding=function(){var t,e,i=this.friendPostersArr;for(e=0;e<this.friendPostersArr.length;e++)t=this.friendPostersArr[e],t.bindingMultiPosters(i);this.friendPostersArr=[],this.binPoster.alpha=1},n.clear_friend=function(){var e=0,i=0,s=0,n=0;for(s=this.friendPostersArr.length,e=0;s>e;e++){var r=this.friendPostersArr[e],h=0;for(n=r.friendPostersArr.length,i=0;n>i;i++){var o=r.friendPostersArr[i];if(o==this){t.Electricity.ElecUtil.checkIsWire(r.body)&&(r.binPoster.alpha=1),r.friendPostersArr.splice(h,1);break}h++}}this.friendPostersArr=[]},n.bindingFllowIng=function(){if(null!=this.binPoster){var t,e=new egret.Point(this.binPoster.x,this.binPoster.y);if(null!=this.binPoster.parent){e=this.binPoster.parent.localToGlobal(this.binPoster.x,this.binPoster.y,e);var i,s;for(s=0;s<this.friendPostersArr.length;s++)i=this.friendPostersArr[s],t=i.binPoster.parent.globalToLocal(e.x,e.y,e),i.binPoster.x=t.x,i.binPoster.y=t.y,i.body.followLinkObj()}}},n.bindingMultiPosters=function(t){var e,i=[];for(e=0;e<t.length;e++)t[e]!=this&&i.push(t[e]);this.friendPostersArr=i},n.bindingTempMultiPosters=function(t){var e,i=[];for(e=0;e<t.length;e++)t[e]!=this&&i.push(t[e]);this.tmpFriendPostersArr=i},i}(egret.HashObject);e.BindingPoster=i,egret.registerClass(i,"experimentalApparatus.Electricity.BindingPoster")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this,3,"ElecLamp");var e=this;this.bposter0.x=-50,this.bposter1.x=50,this.set_bposterXY(new egret.Point(-50,0),new egret.Point(50,0)),this.addLabel("10Ω 灯泡"),this.txt_=new egret.TextField,e.addChild(this.txt_),this.txt_.border=!0,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x+15,this.txt_.y=this.bposter0.y-15,this.txt_.text="0V 0A",this.txt_.size=18,this.addDrag(),this.Resistance=10}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.width=100,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x+15,i.y=this.bposter0.y-35,i.text=t},s.setWorkPower=function(t){this.txt_.text=t.toFixed(3)+"V "+(t/this.Resistance).toFixed(3)+" A"},e}(t.Electricity.BaseElecComp);e.ElecLamp=i,egret.registerClass(i,"experimentalApparatus.Electricity.ElecLamp")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(t){function e(){t.call(this,2,"ElecPower");var e=this;this.bposter0.x=-50,this.bposter1.x=50,this.set_bposterXY(new egret.Point(-50,0),new egret.Point(50,0)),this.addLabel("1.5V 电池"),this.txt_=new egret.TextField,e.addChild(this.txt_),this.txt_.border=!0,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x+15,this.txt_.y=this.bposter0.y-15,this.txt_.size=18,this.txt_.text="0V",this.addDrag(),this.Power=1.5}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.width=100,i.height=20,i.selectable=!1,i.size=18,i.x=this.bposter0.x+15,i.y=this.bposter0.y-35,i.text=t},s.setWorkPower=function(t){this.txt_.text=t.toFixed(3)+" V"},e}(t.Electricity.BaseElecComp);e.ElecPower=i,egret.registerClass(i,"experimentalApparatus.Electricity.ElecPower")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var experimentalApparatus;!function(t){var e;!function(e){var i=function(e){function i(){e.apply(this,arguments)}__extends(i,e);var s=(__define,i);s.prototype;return i.init_elect_Update=function(e){t.Electricity.ElecUtil.elect_Update=new core.Elect_Update(e)},i.diyChanged=function(){t.Electricity.ElecUtil.elect_Update.checkAllChanged()},i.update_power=function(e,i){t.Electricity.ElecUtil.elect_Update.update_power(e,i)},i.checkIsElec=function(t){return t&&t.cateid&&1==t.cateid?!0:!1},i.checkIsWire=function(e){var i=t.Electricity.ElecUtil.checkIsElec(e);return i&&1==e.iElecInter?!0:!1},i.checkIsPower=function(e){var i=t.Electricity.ElecUtil.checkIsElec(e);return i&&2==e.iElecInter?!0:!1},i.checkIsLamp=function(e){var i=t.Electricity.ElecUtil.checkIsElec(e);return i&&3==e.iElecInter?!0:!1},i.checkIsVoltmeter=function(e){var i=t.Electricity.ElecUtil.checkIsElec(e);return i&&4==e.iElecInter?!0:!1},i.checkIsAmpereMeter=function(e){var i=t.Electricity.ElecUtil.checkIsElec(e);return i&&5==e.iElecInter?!0:!1},i}(egret.HashObject);e.ElecUtil=i,egret.registerClass(i,"experimentalApparatus.Electricity.ElecUtil")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={})),experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE=1e-5;var experimentalApparatus;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this);var i=this;this.iElecInter=1,this.classname="ElecWire",this.bposter0=new t.Electricity.BindMC("h1_mc",this),this.bposter1=new t.Electricity.BindMC("h2_mc",this),i.addChild(this.bposter0),i.addChild(this.bposter1),this.bposter0.x=-50,this.bposter1.x=50,this.bposter0.addDrag(),this.bposter1.addDrag(),this.bposter0.downFunc=flashUtils.bind(this.downFunc,this),this.bposter1.downFunc=flashUtils.bind(this.downFunc,this),this.bposter0.upHandleFunc=flashUtils.bind(this.upHandleFunc,this),this.bposter1.upHandleFunc=flashUtils.bind(this.upHandleFunc,this),this.h1_mc=this.bposter0,this.h2_mc=this.bposter1,this.sp=new egret.Sprite,this.addChild(this.sp)}__extends(i,e);var s=(__define,i),n=s.prototype;return n.downFunc=function(t){t.bindinger.friendPostersArr.length>0&&t.bindinger.breakBinding()},n.upHandleFunc=function(t){t.bindinger.nearToBinding();this.linkeChanged()},n.enterFraneHandle=function(t){this.sp.graphics.clear(),this.sp.graphics.lineStyle(4,16711680,.7),this.sp.graphics.moveTo(this.bposter0.x,this.bposter0.y),this.sp.graphics.lineTo(this.bposter1.x,this.bposter1.y)},n.followLinkObj=function(){},n.linkeChanged=function(){e.prototype.diyChanged.call(this)},i}(t.Electricity.BASEElectricity);e.ElecWire=i,egret.registerClass(i,"experimentalApparatus.Electricity.ElecWire")}(e=t.Electricity||(t.Electricity={}))}(experimentalApparatus||(experimentalApparatus={}));var _BindingPoster=function(t){function e(e,i,s){t.call(this),this.owner=null,this.target=null,this.body=null,this.binPoster=null,this.name="",this.myroad_arr=[],this.tmpNumber=0,this.power=0,this.isConductor=!1,this.isInGroup=!1,this.isBeed=!1,this.tmPower=0,this.Un=0,this.connectMinDistanceNumber=100,this.body=e,this.binPoster=i,this.name=s,this.friendPostersArr=[],this.body_name=this.body.category}__extends(e,t);var i=(__define,e),s=i.prototype;return s.set_myroad=function(t,e){void 0===e&&(e=1e-6);var i=!1;for(var s in this.myroad_arr){var n=this.myroad_arr[s];if(n.to==t){i=!0;break}}if(!i){var r={to:t,zu:e};this.myroad_arr.push(r);var h={to:this,zu:e};t.myroad_arr.push(h)}},s.clear_myroad=function(){for(var t in this.myroad_arr){var e=this.myroad_arr[t],i=0;for(var s in e.to.myroad_arr){var n=e.to.myroad_arr[s];if(n.to==this){e.to.myroad_arr.splice(i,1);break}i++}}this.myroad_arr=[]},s.nearToBinding=function(){if(null==this.body.container)return!1;var t=new egret.Point(this.binPoster.x,this.binPoster.y);t=this.binPoster.parent.localToGlobal(t.x,t.y,t);var e,i,s,n,r=[],h=l.adobe.utils.DisplayUtil.getParenFromName(this.body,"[object BodyView]"),o=h.hardwareContainer,a=h.equipmentContainer;for(n=o?l.adobe.utils.M.getAllChildren(o).concat(l.adobe.utils.M.getAllChildren(a)):l.adobe.utils.M.getAllChildren(a),i=0;i<n.length;i++)if(e=n[i],e.hasOwnProperty("component"))if(null!=e.component){if(e.component==this.body){console.log("b1");break}if(!e.component.hasOwnProperty("isLock")||!e.component.isLock)for(s=0;s<e.component.bPsArr.length;s++){var l=e.component,c=l.bPsArr[s];if(!c.body.hasOwnProperty("isZuHe")||!c.body.isZuHe){var d=c.binPoster,u=new egret.Point(d.x,d.y);if(0!=u.length){u=d.parent.localToGlobal(u.x,u.y,u);var p=egret.Point.distance(t,u);if(void 0!=p&&p<=this.connectMinDistanceNumber){if(l instanceof experimentalApparatus.Electricity.ElecWire)continue;if(c.isConductor&&d.alpha<.5){console.log("c4");continue}r.push({distance:p,component:l,bPsIt:c})}}}}}else console.log("c2");else console.log("c1");var g;return r.length&&(flashUtils.sortOn(r,"distance"),g=this.nearToBinding__0(r[0].component,r[0].bPsIt)),g},s.nearToBinding__0=function(t,e){if("电压表"==t.category||"电流表"==t.category){if(e==t.bposter1.bindinger&&null!=t.bposter2&&t.bposter2.bindinger.friendPostersArr.length>0)return!1;if(null!=t.bposter2&&e==t.bposter2.bindinger&&t.bposter1.bindinger.friendPostersArr.length>0)return!1}var i=t.bindWireBefore(e,this.binPoster);if(!i)return!1;var s,n=t.owenBindingers[e.name],r=n.friendPostersArr.concat(this,n);for(s=0;s<r.length;s++)r[s].bindingMultiPosters(r);if(n.isConductor&&(n.binPoster.alpha=0),n.binPoster.alpha=0,this.isConductor){this.binPoster.alpha=0;
var h=new egret.Point(n.binPoster.x,n.binPoster.y);h=n.binPoster.parent.localToGlobal(h.x,h.y,h),h=this.binPoster.parent.globalToLocal(h.x,h.y,h),this.binPoster.x=h.x,this.binPoster.y=h.y,this.body.followLinkObj()}return t.hasOwnProperty("hasBind")&&t.hasBind(e),t.bindWire(e,this.binPoster),!0},s.breakBinding=function(){var t,e,i=this.friendPostersArr;for(e=0;e<this.friendPostersArr.length;e++)t=this.friendPostersArr[e],t.bindingMultiPosters(i);this.friendPostersArr=[],this.isConductor&&(this.binPoster.alpha=1)},s.clear_friend=function(){for(var t in this.friendPostersArr){var e=this.friendPostersArr[t],i=0;for(var s in e.friendPostersArr){var n=e.friendPostersArr[s];if(n==this){-1!=egret.getQualifiedClassName(e.body).indexOf("ElecWire")&&(e.binPoster.alpha=1),e.friendPostersArr.splice(i,1);break}i++}}this.friendPostersArr=[]},s.remove_last_friend=function(){var t=this.friendPostersArr.length-1,e=this.friendPostersArr[t];-1!=egret.getQualifiedClassName(e.body).indexOf("ElecWire")&&(e.binPoster.alpha=1),e.friendPostersArr.splice(e.friendPostersArr.length-1,1),this.friendPostersArr.splice(t,1)},s.bindingFllowIng=function(){if(null!=this.binPoster){var t,e=new egret.Point(this.binPoster.x,this.binPoster.y);if(null!=this.binPoster.parent){e=this.binPoster.parent.localToGlobal(e.x,e.y,e);var i,s;for(s=0;s<this.friendPostersArr.length;s++)i=this.friendPostersArr[s],i.isConductor&&(t=i.binPoster.parent.globalToLocal(e.x,e.y,e),i.binPoster.x=t.x,i.binPoster.y=t.y,i.body.followLinkObj())}}},s.bindingMultiPosters=function(t){var e,i=[];for(e=0;e<t.length;e++)t[e]!=this&&i.push(t[e]);this.friendPostersArr=i},s.bindingTempMultiPosters=function(t){var e,i=[];for(e=0;e<t.length;e++)t[e]!=this&&i.push(t[e]);this.tmpFriendPostersArr=i},e}(egret.HashObject);egret.registerClass(_BindingPoster,"_BindingPoster");var experimentalApparatus;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.hitTestPoint=function(t,e,i){void 0===i&&(i=!1);var s=new egret.Point(t,e);s=this.globalToLocal(s.x,s.y);var n=this.getBounds();return n.containsPoint(s)?!0:!1},e}(egret.Sprite);t.DynamicSprite=e,egret.registerClass(e,"experimentalApparatus.utils.DynamicSprite")}(e=t.utils||(t.utils={}))}(experimentalApparatus||(experimentalApparatus={}));var CacuManager=function(){function t(){}var e=(__define,t);e.prototype;return t.cacu_huilu=function(t,e){this.comp_arr=t,this.dianxian_arr=e,this.firstComp=null,this.huilu_arr=[],this.firstCacu=!0;for(var i,s,n,r=0;r<t.length;r++)i=t[r],this.firstComp||(this.firstComp=i),n=this.getEffectNodesArr(i._nodeArr),n.length>0&&(s=n[0],this.findNextNode(s,[s]));return this.huilu_arr},t.cacu_huilu2=function(t,e){this.comp_arr=t,this.dianxian_arr=e,this.firstComp=null,this.huilu_arr=[],this.firstCacu=!0;for(var i,s,n,r=t.length-1;r>=0;r--)i=t[r],i.hasBLVoltmeter=!1,experimentalApparatus.Electricity.ElecUtil.checkIsPower(i)&&(n=this.getEffectNodesArr(i._nodeArr),n.length>0&&(s=n[n.length-1],this.findNextNode2(s,[s],s)),this.firstCacu=!0);return this.huilu_arr},t.cacu_comp_huilu=function(t,e){DrawCircuitDiagram.BASIC_ROWS=0,DrawCircuitDiagram.BASIC_COLS=0,this.effect_comp_arr=t,this.effect_lines_arr=e,this.comp_temp_arr=[];for(var i,s,n=this.cacu_huilu2(t,e),r=[],h=0;h<n.length;h++)i=n[h],s=this.findNextComp(i,[]),s.length>0&&(s.length>DrawCircuitDiagram.BASIC_COLS&&(DrawCircuitDiagram.BASIC_COLS=s.length),r.push(s));return r=r.sort(this.sortArrayLength),DrawCircuitDiagram.BASIC_COLS=2*DrawCircuitDiagram.BASIC_COLS,DrawCircuitDiagram.BASIC_ROWS=2*r.length,r},t.sortArrayLength=function(t,e){return t.length-e.length},t.sortBiao=function(t,e){return t.iElecInter-e.iElecInter},t.repeatFilter=function(t){for(var e,i=0,s=0;s<t.length;s++)e=t[s],-1==this.comp_temp_arr.indexOf(e)?this.comp_temp_arr.push(e):i+=1;return i==t.length?[]:t},t.findNextComp=function(t,e){for(var i,s,n=null,r=t[t.length-1],h=0;h<t.length;h++){if(i=t[h],s=i.item,0==h)i.item==r.item&&e.push(s);else if(n&&i.item==n.item){if(this.hasBinglianDianyaBiao(s))return s.hasBLVoltmeter=!0,console.log("有并联的电压表则该数据不要了"),[];-1==e.indexOf(s)&&e.push(s)}n=i}return e=this.repeatFilter(e)},t.outputLinkCompName=function(t){for(var e,i="开始",s=0;s<t.length;s++)e=t[s],i+="-->"+e.name;console.log(i)},t.outputLinkCompAndNodeName=function(t){for(var e,i="开始",s=0;s<t.length;s++)e=t[s],i+="-->"+e.item.name+"."+e.name;console.log(i)},t.outputLinkName=function(t){for(var e,i="开始",s=0;s<t.length;s++)e=t[s],i+="-->"+e.item.name+"."+e.name;console.log(i)},t.getAutoData=function(){for(var t,e=[],i=ElectricsView.getInstance().itemContainer,s=0;s<i.numChildren;s++)if(t=i.getChildAt(s),experimentalApparatus.Electricity.ElecUtil.checkIsAmpereMeter(t)||experimentalApparatus.Electricity.ElecUtil.checkIsVoltmeter(t)){var n={iElecInter:t.iElecInter,name:t.name,deviceID:t.deviceID,uid:t.UID,v:Math.abs(t.realV).toFixed(t.data.accuracy),a:Math.abs(t.realA).toFixed(t.data.accuracy)};e.push(n)}return e=e.sort(this.sortBiao)},t.getEffectNodesArr=function(t){for(var e,i=[],s=0;s<t.length;s++)e=t[s],this.checkNodeEffect(e)&&i.push(e);return i},t.checkNodeEffect=function(t){for(var e,i=0,s=0;s<this.dianxian_arr.length;s++)e=this.dianxian_arr[s],(e.node1==t||e.node2==t)&&(i+=1);return i>0},t.getAnotherBinders=function(t,e){var i=t.concat();return i.splice(i.indexOf(e),1),i},t.getConnectAnother_node=function(t,e){return t.node1==e?t.node2:t.node2==e?t.node1:null},t.getBisideNode=function(t){for(var e,i,s=[],n=0;n<this.dianxian_arr.length;n++)e=this.dianxian_arr[n],i=this.getConnectAnother_node(e,t),i&&s.push(i);if(this.firstCacu)return this.firstCacu=!1,s;var r=t.item._nodeArr,h=this.getAnotherBinders(r,t),o=s.concat(h);return o},t.mergeAllBinders=function(t,e){for(var i,s=0;s<e.length;s++)i=e[s],-1==t.indexOf(i)&&t.push(i);return t},t.hasBinglianDianyaBiao=function(t){if(experimentalApparatus.Electricity.ElecUtil.checkIsVoltmeter(t)){var e,i,s=this.getEffectNodesArr(t._nodeArr),n=[];if(s.length>0){for(var r=0;r<s.length;r++)e=s[r],i=this.getBisideNode(e),n=this.mergeAllBinders(n,i);var h,o=[];for(r=0;r<n.length;r++)if(e=n[r],h=e.item,!experimentalApparatus.Electricity.ElecUtil.checkIsVoltmeter(h)){if(-1!=o.indexOf(h))return!0;o.push(h)}}}return!1},t.findNextNode2=function(t,e,i){if(t)for(var s=this.getBisideNode(t),n=0;n<s.length;n++){var r=s[n];if(-1==e.indexOf(r)&&this.checkNodeEffect(r)){var h=e.concat();h.push(r),r.item==i.item&&i!=r?MyArrayUtil.hasSameArray(this.huilu_arr,h)||h.length>=4&&this.huilu_arr.push(h):this.findNextNode2(r,h,i)}}},t.findNextNode=function(t,e){if(t)for(var i=e[0],s=i.item,n=this.getEffectNodesArr(s._nodeArr),r=this.getAnotherBinders(n,i),h=this.getBisideNode(t),o=0;o<h.length;o++){var a=h[o];if(-1==e.indexOf(a)&&this.checkNodeEffect(a)){var l=e.concat();l.push(a),r.indexOf(a)>-1||a.item==this.firstComp?MyArrayUtil.hasSameArray(this.huilu_arr,l)||l.length>=4&&this.huilu_arr.push(l):this.findNextNode(a,l)}}},t.comp_huilu=function(t){for(var e,i,s=[],n=0;n<t.length;n++)i=t[n],e=i.item,-1==s.indexOf(e)&&s.push(e);return s.push(e),s},t.huilu_arr=[],t.firstCacu=!0,t.firstComp=null,t.comp_arr=null,t.dianxian_arr=null,t.comp_huilu_arr=[],t.comp_temp_arr=[],t.effect_comp_arr=[],t.effect_lines_arr=[],t.dianlutu_comp_arr=null,t}();egret.registerClass(CacuManager,"CacuManager");var DBaseItem=function(t){function e(e){t.call(this),this._listView=null,this.ro=!1,this.bpArr=[],this.currentBp=null,this._lineArr=[],this._listView=e}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLine=function(t){-1==this._lineArr.indexOf(t)&&this._lineArr.push(t)},s.deleteLine=function(){for(var t,e=0;e<this._lineArr.length;e++)t=this._lineArr[e],t&&t.parent&&t.parent.removeChild(t);this._lineArr=null},s.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMouseDown,this)},s.onMouseDown=function(t){var e=t.target.name;return e.indexOf("bp")>-1?(this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDrawLineMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onDrawLineEnd,this),this.currentBp=t.target,void MessageCenter.getInstance().dispatch(ItemEventConst.DRAW_DIANLU_LINE_DOWN,[t.stageX,t.stageY],this.currentBp)):(this.preX=t.stageX,this.preY=t.stageY,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMouseMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onMouseEnd,this),void MessageCenter.getInstance().dispatch(ItemEventConst.MODIFY_DIANLU_ITEM_DOWN,[t.stageX,t.stageY],this))},s.onDrawLineMove=function(t){MessageCenter.getInstance().dispatch(ItemEventConst.DRAW_DIANLU_LINE_MOVE,[t.stageX,t.stageY],this.currentBp)},s.onDrawLineEnd=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMouseMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMouseEnd,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDrawLineMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onDrawLineEnd,this),MessageCenter.getInstance().dispatch(ItemEventConst.DRAW_DIANLU_LINE_END,[t.stageX,t.stageY],this.currentBp),this.currentBp=null},s.onMouseMove=function(t){return this.ro?(this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMouseMove,this),void this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMouseEnd,this)):void MessageCenter.getInstance().dispatch(ItemEventConst.MODIFY_DIANLU_ITEM_MOVE,[t.stageX,t.stageY],this)},s.onMouseEnd=function(t){this.ro=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMouseMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMouseEnd,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDrawLineMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onDrawLineEnd,this),MessageCenter.getInstance().dispatch(ItemEventConst.MODIFY_DIANLU_ITEM_END,[t.stageX,t.stageY],this);var e=new egret.Point(t.stageX,t.stageY),i=new egret.Point(this.preX,this.preY);egret.Point.distance(e,i)<=5&&this._listView.changeSelectItem(this)},s.initData=function(t){this.data=t,this.spr=ElectricsConst.electricItem_swf.createSprite(t.spr),this.spr.touchEnabled=!0,this.bp0=this.spr.getImage("bp0"),this.bp1=this.spr.getImage("bp1"),this.bp0.touchEnabled=!0,this.bp1.touchEnabled=!0,this.bp0.item=this,this.bp1.item=this,this.bpArr.push(this.bp0,this.bp1),this.addChildAt(this.spr,0),this.spr.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)},s.checkHit=function(t,e,i){for(var s,n,r=this.spr.globalToLocal(t,e),h=new egret.Point,o=0;o<this.bpArr.length;o++){if(s=this.bpArr[o],s==i)return null;if(h.x=s.x,h.y=s.y,n=egret.Point.distance(r,h),10>n)return s}return null},s.checkHitPoster=function(t,e,i){var s=new egret.Point(e,i),n=t.parent.localToGlobal(t.x,t.y),r=egret.Point.distance(s,n);return 10>=r?!0:!1},e}(egret.DisplayObjectContainer);egret.registerClass(DBaseItem,"DBaseItem");var DataPanelBase=function(t){function e(){t.call(this),this._prePos=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this._btnMove.touchEnabled=!0,this._btnMove.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressStage,this)},s.pressStage=function(t){ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.upStage,this),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this),this._prePos.x=t.stageX,this._prePos.y=t.stageY},s.moveStage=function(t){var e=t.stageX-this._prePos.x,i=t.stageY-this._prePos.y;this.x+=e,this.y+=i,this._prePos.x=t.stageX,this._prePos.y=t.stageY},s.upStage=function(t){ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.upStage,this),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this)},s.deleteItem=function(){this.visible=!1},s.dispose=function(){this._btnMove.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressStage,this),this.parent&&this.parent.removeChild(this)},s.TLResize=function(t,e){},s.TRResize=function(t,e){},s.BLResize=function(t,e){},s.BRResize=function(t,e){},e}(eui.Component);egret.registerClass(DataPanelBase,"DataPanelBase");var DataGraphicPanel=function(t){function e(){t.call(this),this.borderDist=20,this._startPos=new egret.Point(50,250),this._vEnd=20,this._hEnd=475,this.referenceData=null,this.MaxXUnit=0,this.MaxYUnit=0,this.vUnit=0,this.hUnit=0,this.skinName="resource/skins/electrics/DataGraphicSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.setLabelType(),this._btnStraightL.addEventListener(egret.TouchEvent.TOUCH_TAP,this.straightLine,this),this._btnInverse.addEventListener(egret.TouchEvent.TOUCH_TAP,this.inverseLine,this),this._btnConic.addEventListener(egret.TouchEvent.TOUCH_TAP,this.ConicLine,this),this._btnBrokenL.addEventListener(egret.TouchEvent.TOUCH_TAP,this.brokenLine,this),this._btnModifyData.addEventListener(egret.TouchEvent.TOUCH_TAP,this.modifyData,this),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._line=new egret.Shape,this._graphicsGroup.addChild(this._line),this._dotShape=new egret.Shape,this._graphicsGroup.addChild(this._dotShape),this._txtContainer=new egret.Sprite,this.addChild(this._txtContainer)},s.setData=function(t){for(;this._txtContainer.numChildren>0;)this._txtContainer.removeChildAt(0);if(this._dotShape.graphics.clear(),this._line.graphics.clear(),this._line.graphics.lineStyle(1,16777215),this._line.graphics.moveTo(this._startPos.x,this._startPos.y),this._line.graphics.lineTo(this._startPos.x,this._vEnd),this._line.graphics.moveTo(this._startPos.x,this._startPos.y),this._line.graphics.lineTo(this._hEnd,this._startPos.y),0!=t.length){var e=Math.abs(this._hEnd-this._startPos.x),i=Math.abs(this._vEnd-this._startPos.y);this.MaxXUnit=this.findMax(t,"x"),this.MaxYUnit=this.findMax(t,"y");var s=50;this.drawHorizentalRuler(i,s),this.drawVerticalRuler(e,s),this.drawDataView(t)}},s.findMax=function(t,e){for(var i,s=0,n=0;n<t.length;n++)i=t[n],i[e]>s&&(s=i[e]);return 0==s&&(s=t.length),Math.ceil(s)},s.drawDataView=function(t){this._dotShape.graphics.clear();var e,i,s;this._dotShape.graphics.beginFill(16776960),this._line.graphics.lineStyle(1,16776960);for(var n=null,r=0;r<t.length;r++)e=t[r],i=e.x*this.hUnit+this._startPos.x,s=this._startPos.y-e.y*this.vUnit,this._dotShape.graphics.drawCircle(i,s,5),n?this._line.graphics.lineTo(i,s):(n=new egret.Point(i,s),this._line.graphics.moveTo(i,s))},s.drawHorizentalRuler=function(t,e){var i,s,n=Math.floor(t/e),r=parseFloat((this.MaxYUnit/n).toFixed(1));this.vUnit=50/r;for(var h=this._startPos.y,o=this._startPos.y+e,a=0;n>a;a++)h-=e,this._line.graphics.moveTo(this._startPos.x,h),this._line.graphics.lineTo(this._hEnd,h),i=new egret.TextField,s=r*(a+1),i.text=s,i.size=14,i.textColor=16777215,this._txtContainer.addChild(i),i.width=i.textWidth,i.height=i.textHeight,i.x=this._startPos.x-i.width,i.y=o,o-=e},s.drawVerticalRuler=function(t,e){var i,s,n=this._startPos.x+50,r=Math.floor(t/e),h=parseFloat((this.MaxXUnit/r).toFixed(1));this.hUnit=50/h;for(var o=this._startPos.x,a=0;r>a;a++)o+=e,this._line.graphics.moveTo(o,this._startPos.y),this._line.graphics.lineTo(o,this._vEnd),s=new egret.TextField,i=h*(a+1),s.text=i,s.width=s.textWidth,s.height=s.textHeight,s.x=n,s.y=this._startPos.y+s.height+2*e,s.size=14,s.textColor=16777215,this._txtContainer.addChild(s),n+=e},s.modifyData=function(t){},s.straightLine=function(t){},s.inverseLine=function(t){},s.ConicLine=function(t){},s.brokenLine=function(t){},s.setLabelType=function(){var t=16,e=16777215,i=this._btnStraightL.labelDisplay;i.size=t,i.textColor=e,i.textAlign=egret.HorizontalAlign.CENTER;var s=this._btnInverse.labelDisplay;s.size=t,s.textColor=e,s.textAlign=egret.HorizontalAlign.CENTER;var n=this._btnConic.labelDisplay;n.size=t,n.textColor=e,n.textAlign=egret.HorizontalAlign.CENTER;var r=this._btnBrokenL.labelDisplay;r.size=t,r.textColor=e,r.textAlign=egret.HorizontalAlign.CENTER;var h=this._btnModifyData.labelDisplay;h.size=t,h.textColor=e,h.textAlign=egret.HorizontalAlign.CENTER},e}(DataPanelBase);egret.registerClass(DataGraphicPanel,"DataGraphicPanel");var DataRecordInfoPanel=function(t){function e(){t.call(this),this._meterDataInfo=[],this.testNum=0,this.skinName="resource/skins/electrics/DataRecordSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnRecordData.labelDisplay.size=16,this._btnShowImage.labelDisplay.size=16,this._btnRecordData.labelDisplay.textColor=16777215,this._btnShowImage.labelDisplay.textColor=16777215,this._btnRecordData.addEventListener(egret.TouchEvent.TOUCH_TAP,this.recordData,this),this._btnShowImage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showGraphic,this),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this)},s.showPanel=function(){this._listView.clearAll(),this._listView.initList()},s.recordData=function(){var t=CacuManager.getAutoData();this._listView.addNewExpData(t)},s.showGraphic=function(){e.dataHeaderArr.length>=2?this._meterDataInfo=this._listView.getGraphicArr(e.dataHeaderArr[0].gid,e.dataHeaderArr[1].gid):this._meterDataInfo=[],ElectricsView.getInstance().showDataGraphicPanel(this,this._meterDataInfo)},s.deleteItem=function(){this.visible=!1,this.graphicPanel&&(this.graphicPanel.visible=!1),e.dataHeaderArr=[],this._listView.clearAll()},e.dataHeaderArr=[],e}(DataPanelBase);egret.registerClass(DataRecordInfoPanel,"DataRecordInfoPanel");var DianluItem=function(t){function e(){t.call(this),this.drag=!1,this.skinName="resource/skins/electrics/DianluItemSkin.exml",this.bitMap.touchEnabled=!1,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onSpotBegin,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onSpotBegin=function(t){t.stopImmediatePropagation(),this.drag=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchOut,this),MessageCenter.getInstance().dispatch(ItemEventConst.ADD_DIANLU_ITEM_DOWN,this.data,[t.stageX,t.stageY])},s.onTouchOut=function(t){},s.onStageMove=function(t){1==this.drag&&MessageCenter.getInstance().dispatch(ItemEventConst.ADD_DIANLU_ITEM_MOVE,this.data,[t.stageX,t.stageY])},s.onStagEnd=function(t){this.drag=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this),MessageCenter.getInstance().dispatch(ItemEventConst.ADD_DIANLU_ITEM_END,this.data,[t.stageX,t.stageY])},s.initData=function(t){this.data=t,this.bitMap.texture=RES.getRes(t.icon),null!=this.bitMap.texture&&(this.scale1=80/this.bitMap.texture.textureWidth,this.scale2=40/this.bitMap.texture.textureHeight,this.bitMap.height=this.bitMap.texture.textureHeight*Math.min(this.scale1,this.scale2),this.bitMap.width=this.bitMap.texture.textureWidth*Math.min(this.scale1,this.scale2),this.bitMap.x=(80-this.bitMap.width)/2,this.bitMap.y=(40-this.bitMap.height)/2+5)},e}(eui.Component);egret.registerClass(DianluItem,"DianluItem");var DianluTuView=function(t){function e(){t.call(this),this.gridSize=40,this.deviceGridArr=[],this.dianluList=[],this.iconDataArr=[],this.itemList=[],this.currentScale=1,this.maxScale=1.5,this.minScale=.5,this.drawLine=null,this.startNode=null,this.endNode=null,this.path=null,this.current_baseItem=null,this.current_baseLine=null,this.preIndex=null,this.skinName="resource/skins/electrics/DianlutuViewSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this),this.iconDataArr.push(this.addItemData("����?","dlt_dc_png","DrawDianchiItem","spr_batteryC")),this.iconDataArr.push(this.addItemData("������?","dlt_ddp_png","DrawDianDengpaoItem","spr_lampC")),this.iconDataArr.push(this.addItemData("������","dlt_dlb_png","DrawDianLiubiaoItem","spr_ammeterC")),this.iconDataArr.push(this.addItemData("��ѹ��","dlt_dyb_png","DrawDianYabiaoItem","spr_voltmeterC")),this.iconDataArr.push(this.addItemData("����","dlt_dz_png","DrawDianZuItem","spr_RESC")),this.iconDataArr.push(this.addItemData("����","dlt_kg_png","DrawKaiguanItem","spr_spstC"))}__extends(e,t);var i=(__define,e),s=i.prototype;return s.scaleGrid=function(t){var e=this.parent;t?(e.small_btn.enabled=!0,this.currentScale+=.5,this.currentScale==this.maxScale&&(e.big_btn.enabled=!1)):(e.big_btn.enabled=!0,this.currentScale-=.5,this.currentScale==this.minScale&&(e.small_btn.enabled=!1),this._container.x=0,this._container.y=0),this._container.scaleX=this._container.scaleY=this.currentScale},s.addItemData=function(t,e,i,s){var n={name:null,icon:null,cls:null,spr:null};return n.name=t,n.icon=e,n.cls=i,n.spr=s,n},s.upDataItemList=function(t){ObjectPool.recoverPool(this.itemList);for(var e=0;e<this.itemList.length;e++){var i=this.itemList[e];i.parent.removeChild(i)}this.itemList=[];for(var e=0;e<t.length;e++){var i=ObjectPool.pop("DianluItem",t[e].spr);i.initData(t[e]),this._listGroup.addChild(i),this.itemList.push(i)}},s.createCompleteEvent=function(t){this._container=new egret.DisplayObjectContainer,this._shapeGroup.addChild(this._container),this._gSp=new egret.Shape,this._container.addChild(this._gSp),this._selectRectShape=new egret.Shape,this._container.addChild(this._selectRectShape),this._selectRectShape.graphics.lineStyle(1,16711935),this._selectRectShape.graphics.drawRect(0,0,3*this.gridSize,this.gridSize),this._selectRectShape.visible=!1,this.dragBitmap=new egret.Bitmap,this.dragBitmap.touchEnabled=!1,this.dragBitmap.visible=!1,ElectricsConst.stage.addChild(this.dragBitmap),this._containerVisibleRect=new egret.Rectangle(0,0,this._scrollder1.width,this._scrollder1.height),this._scrollder1.width=this.width,this.initIcon(),this.initGrid(),this._pathFinder=new PathFinding,MessageCenter.getInstance().addListener(ItemEventConst.ADD_DIANLU_ITEM_DOWN,this.itemDragDown,this),MessageCenter.getInstance().addListener(ItemEventConst.ADD_DIANLU_ITEM_MOVE,this.itemDragMove,this),MessageCenter.getInstance().addListener(ItemEventConst.ADD_DIANLU_ITEM_END,this.itemDragEnd,this),MessageCenter.getInstance().addListener(ItemEventConst.MODIFY_DIANLU_ITEM_DOWN,this.itemDownSelf,this),MessageCenter.getInstance().addListener(ItemEventConst.MODIFY_DIANLU_ITEM_MOVE,this.itemMoveSelf,this),MessageCenter.getInstance().addListener(ItemEventConst.MODIFY_DIANLU_ITEM_END,this.itemEndSelf,this),MessageCenter.getInstance().addListener(ItemEventConst.DRAW_DIANLU_LINE_DOWN,this.drawLineStart,this),MessageCenter.getInstance().addListener(ItemEventConst.DRAW_DIANLU_LINE_MOVE,this.drawLineMove,this),MessageCenter.getInstance().addListener(ItemEventConst.DRAW_DIANLU_LINE_END,this.drawLineEnd,this),this._interArea.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.stageDragDown,this)},s.stageDragDown=function(t){this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.stageDragMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stageDragEnd,this),this._preX=t.stageX,this._preY=t.stageY},s.stageDragMove=function(t){var e=-(this._container.width*this.currentScale-this._scrollder1.width),e=-(this._container.height*this.currentScale-this._scrollder1.height),i=0,s=0,n=t.stageX-this._preX,r=t.stageY-this._preY,h=this._container.x+n,o=this._container.y+r;e>h&&(h=e),h>i&&(h=i),e>o&&(o=e),o>s&&(o=s),this._container.x=h,this._container.y=o,this._preX=t.stageX,this._preY=t.stageY},s.stageDragEnd=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.stageDragMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.stageDragEnd,this)},s.drawLineStart=function(t,e){this.changeSelectItem(null);var i=this._container.globalToLocal(t[0],t[1]),s=this.getTileIndex(i),n=this.deviceGridArr[s.y][s.x];this.startNode=n;var r=n.val;this.drawLine=new PathLine(this),this._container.addChild(this.drawLine),this.drawLine._startItem.item=r,this.drawLine._startItem.node=e,r.addLine(this.drawLine)},s.drawLineMove=function(t,e){var i=this._container.globalToLocal(t[0],t[1]),s=e.parent.localToGlobal(e.x,e.y),n=(this._container.globalToLocal(s.x,s.y),this.getTileIndex(i)),r=this.deviceGridArr[n.y][n.x];this.endNode!=r&&r!=this.startNode&&(this.endNode=r,this.path=this._pathFinder.path4(this.deviceGridArr,this.startNode,this.endNode),this.path&&this.path.length>=2&&this.drawLine.drawLine(this.path))},s.drawLineEnd=function(t,e){var i=this.checkAnotherBp(t[0],t[1],e);if(i){var s=i.item;this.drawLine._endItem.item=s,this.drawLine._endItem.node=i,s.addLine(this.drawLine)}else this.drawLine&&this.drawLine.parent.removeChild(this.drawLine);this.drawLine=null,this.path=[],this.startNode=null,this.endNode=null},s.checkAnotherBp=function(t,e,i){for(var s,n,r,h=0;h<this._container.numChildren;h++)if(r=this._container.getChildAt(h),r instanceof DBaseItem&&(n=r,s=n.checkHit(t,e,i)))return s;return null},s.initIcon=function(){this.upDataItemList(this.iconDataArr)},s.resizeMe=function(t,e){this.height=e,this._scrollder1.height=e-this._scrollder1.y,this.initGrid()},s.initGrid=function(){var t=Math.ceil(this._scrollder1.width/this.gridSize),e=Math.ceil(this._scrollder1.height/this.gridSize);t=2*t+1,e=2*e+1;var i=t*this.gridSize,s=e*this.gridSize;this._gSp.graphics.clear(),this._gSp.graphics.lineStyle(1,3355443);for(var n=0;e>n;n++){this.deviceGridArr[n]||(this.deviceGridArr[n]=[]),this._gSp.graphics.moveTo(0,n*this.gridSize),this._gSp.graphics.lineTo(i,n*this.gridSize);for(var r=0;t>r;r++)this.deviceGridArr[n][r]||(this.deviceGridArr[n][r]=new GridNode(n,r)),this._gSp.graphics.moveTo(r*this.gridSize,0),this._gSp.graphics.lineTo(r*this.gridSize,s)}},s.itemDragDown=function(t,e){this.dragBitmap.texture=RES.getRes(t.icon),null!=this.dragBitmap.texture&&(this.scale1=3*this.gridSize/this.dragBitmap.texture.textureWidth,this.scale2=this.gridSize/this.dragBitmap.texture.textureHeight,this.dragBitmap.height=this.dragBitmap.texture.textureHeight*Math.min(this.scale1,this.scale2),this.dragBitmap.width=this.dragBitmap.texture.textureWidth*Math.min(this.scale1,this.scale2)),this._containerVisibleRect.x=0,this._containerVisibleRect.y=0,this._containerVisibleRect.width=this._scrollder1.width-this.gridSize,this._containerVisibleRect.height=this._scrollder1.height,this.dragBitmap.x=e[0]-this.dragBitmap.width/2,this.dragBitmap.y=e[1]-this.dragBitmap.height/2,this.dragBitmap.visible=!1},s.deleteItem=function(){this.current_baseItem&&(this.current_baseItem.deleteLine(),this.deviceGridArr[this.current_baseItem.ty][this.current_baseItem.tx].val=null,this.deviceGridArr[this.current_baseItem.ty][this.current_baseItem.tx+1].val=null,this.deviceGridArr[this.current_baseItem.ty][this.current_baseItem.tx+2].val=null,this._container.removeChild(this.current_baseItem),this.current_baseItem=null,this._selectRectShape.visible=!1),this.current_baseLine&&(this.current_baseLine.lineSelect(!1),this.current_baseLine=null);var t=this.parent;t.delete_btn.enabled=!1},s.changeSelectItem=function(t){var e=this.parent;this.current_baseLine&&(this.current_baseLine.lineSelect(!1),this.current_baseLine=null),t?e.delete_btn.enabled=!0:(this.current_baseItem&&(this.current_baseItem=null,this._selectRectShape.visible=!1),e.delete_btn.enabled=!1),this.current_baseItem!=t&&(this.current_baseItem=t,this._selectRectShape.x=t.tx*this.gridSize,this._selectRectShape.y=t.ty*this.gridSize,this._selectRectShape.visible=!0)},s.changeSelectLine=function(t){this.current_baseItem&&(this.current_baseItem=null,this._selectRectShape.visible=!1),this.current_baseLine&&(this.current_baseLine.lineSelect(!1),this.current_baseLine=null);var e=this.parent;t?e.delete_btn.enabled=!0:e.delete_btn.enabled=!1,this.current_baseLine!=t&&null!=t&&(this.current_baseLine=t,t.lineSelect(!0))},s.createSpr=function(t){var e=egret.getDefinitionByName(t.cls),i=new e(this);return i.initData(t),this._container.addChild(i),i},s.itemDragMove=function(t,e){var i=this._container.globalToLocal(e[0],e[1]);if(this.checkInRect(i.x,i.y)){var s=this.getTileIndex(i),n=s.x*this.gridSize+3*this.gridSize/2,r=s.y*this.gridSize+this.gridSize/2;if(this.checkHit(s.x,s.y))return;this._currentSpr||(this._currentSpr=this.createSpr(t)),this._currentSpr.visible=!0,this._currentSpr.x=n,this._currentSpr.y=r,this.dragBitmap.visible=!1}else this.dragBitmap.visible=!0,this.dragBitmap.x=e[0]-this.dragBitmap.width/2,this.dragBitmap.y=e[1]-this.dragBitmap.height/2,this._currentSpr&&(this._currentSpr.visible=!1)},s.checkInRect=function(t,e){return t*=this.currentScale,e*=this.currentScale,t>this._containerVisibleRect.x&&t<this._containerVisibleRect.width&&e>this._containerVisibleRect.y&&e<this._containerVisibleRect.height?!0:!1},s.itemDragEnd=function(t,e){var i=this._container.globalToLocal(e[0],e[1]);if(this.dragBitmap&&(this.dragBitmap.texture=null,this.dragBitmap.visible=!1),!this.checkInRect(i.x,i.y))return void(this._currentSpr&&this._currentSpr.parent&&(this._currentSpr.parent.removeChild(this._currentSpr),this._currentSpr=null));i=new egret.Point(this._currentSpr.x-3*this.gridSize/2,this._currentSpr.y-this.gridSize/2);var s=this.getTileIndex(i);s.x*this.gridSize+3*this.gridSize/2,s.y*this.gridSize+this.gridSize/2;this._currentSpr.tx=s.x,this._currentSpr.ty=s.y,this.deviceGridArr[s.y][s.x].val=this._currentSpr,this.deviceGridArr[s.y][s.x+1].val=this._currentSpr,this.deviceGridArr[s.y][s.x+2].val=this._currentSpr,this._currentSpr=null},s.checkHit=function(t,e){return this.deviceGridArr[e][t].val?!0:this.deviceGridArr[e][t+1].val?!0:this.deviceGridArr[e][t+2].val?!0:!1},s.itemDownSelf=function(t,e){this._containerVisibleRect.x=0,this._containerVisibleRect.y=0,this._containerVisibleRect.width=this._scrollder1.width-this.gridSize,this._containerVisibleRect.height=this._scrollder1.height,this.changeSelectItem(null),this.deviceGridArr[e.ty][e.tx].val=null,this.deviceGridArr[e.ty][e.tx+1].val=null,this.deviceGridArr[e.ty][e.tx+2].val=null,this.preIndex={y:e.ty,x:e.tx}},s.itemMoveSelf=function(t,e){var i=this._container.globalToLocal(t[0],t[1]);if(this.checkInRect(i.x,i.y)){var s=this.getTileIndex(i);if(!(this.preIndex&&this.preIndex.x==s.x&&this.preIndex.y==s.y||this.checkHit(s.x,s.y))){null!=this.preIndex&&(this.deviceGridArr[this.preIndex.y][this.preIndex.x].val=null,this.deviceGridArr[this.preIndex.y][this.preIndex.x+1].val=null,this.deviceGridArr[this.preIndex.y][this.preIndex.x+2].val=null);var n=s.x*this.gridSize+3*this.gridSize/2,r=s.y*this.gridSize+this.gridSize/2;e.x=n,e.y=r,this.deviceGridArr[s.y][s.x].val=e,this.deviceGridArr[s.y][s.x+1].val=e,this.deviceGridArr[s.y][s.x+2].val=e,this.preIndex=s,this.itemReDrawLine(e)}}},s.itemReDrawLine=function(t){for(var e,i,s,n,r=0;r<t._lineArr.length;r++)e=t._lineArr[r],e&&e.parent&&(i=e._startItem.node,s=e._endItem.node,n=this._pathFinder.path4(this.deviceGridArr,this.findBpGridNode(i),this.findBpGridNode(s)),e.drawLine(n))},s.findBpGridNode=function(t){var e=t.parent.localToGlobal(t.x,t.y),i=this._container.globalToLocal(e.x,e.y),s=this.getTileIndex(i);return this.deviceGridArr[s.y][s.x]},s.itemEndSelf=function(t,e){var i=new egret.Point(e.x-3*this.gridSize/2,e.y-this.gridSize/2),s=this.getTileIndex(i);null!=this.preIndex&&(this.deviceGridArr[this.preIndex.y][this.preIndex.x].val=null,this.deviceGridArr[this.preIndex.y][this.preIndex.x+1].val=null,this.deviceGridArr[this.preIndex.y][this.preIndex.x+2].val=null,this.preIndex=null),e.tx=s.x,e.ty=s.y,this.deviceGridArr[s.y][s.x].val=e,this.deviceGridArr[s.y][s.x+1].val=e,this.deviceGridArr[s.y][s.x+2].val=e},s.getTileIndex=function(t){var e=Math.floor(t.x/this.gridSize),i=Math.floor(t.y/this.gridSize);
return{x:e,y:i}},s.destroyAll=function(){this.dragBitmap&&this.dragBitmap.parent&&(this.dragBitmap.parent.removeChild(this.dragBitmap),this.dragBitmap=null),this._currentSpr&&this._currentSpr.parent&&(this._currentSpr.parent.removeChild(this._currentSpr),this._currentSpr=null),MessageCenter.getInstance().removeListener(ItemEventConst.ADD_DIANLU_ITEM_DOWN,this.itemDragDown,this),MessageCenter.getInstance().removeListener(ItemEventConst.ADD_DIANLU_ITEM_MOVE,this.itemDragMove,this),MessageCenter.getInstance().removeListener(ItemEventConst.ADD_DIANLU_ITEM_END,this.itemDragEnd,this),MessageCenter.getInstance().removeListener(ItemEventConst.MODIFY_DIANLU_ITEM_DOWN,this.itemDownSelf,this),MessageCenter.getInstance().removeListener(ItemEventConst.MODIFY_DIANLU_ITEM_MOVE,this.itemMoveSelf,this),MessageCenter.getInstance().removeListener(ItemEventConst.MODIFY_DIANLU_ITEM_END,this.itemEndSelf,this),MessageCenter.getInstance().removeListener(ItemEventConst.DRAW_DIANLU_LINE_DOWN,this.drawLineStart,this),MessageCenter.getInstance().removeListener(ItemEventConst.DRAW_DIANLU_LINE_MOVE,this.drawLineMove,this),MessageCenter.getInstance().removeListener(ItemEventConst.DRAW_DIANLU_LINE_END,this.drawLineEnd,this)},e}(eui.Component);egret.registerClass(DianluTuView,"DianluTuView");var DrawCircuitDiagram=function(t){function e(){t.call(this),this.line_info={weight:1.5,lineColor:16777215,zoneColor:0},this._allImagesName={Battery:"spr_batteryC",SPST:"spr_spstC",Lamp:"spr_lampC",Ammeter:"spr_ammeterC",Voltmeter:"spr_voltmeterC",RES_BOX:"spr_RESC"},this._gridShape=null,this._linkLine=null,this._gridShape=new egret.Shape,this.addChild(this._gridShape),this._linkLine=new egret.Shape,this.addChild(this._linkLine),this._compContainer=new egret.Sprite,this.addChild(this._compContainer),MessageCenter.getInstance().addListener(ItemEventConst.DIANLU_CONNECT_CHANGED,this.dianlutuChanged,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.drawBaseGrid=function(){this._gridShape.graphics.clear(),this._gridShape.graphics.lineStyle(1,16711680);for(var t=Math.max(e.BASIC_ROWS-1,10),i=Math.max(e.BASIC_COLS-1,10),s=t;s>=0;s--)for(var n=0;i>n;n++)this._gridShape.graphics.drawRect(n*e.GRID_SIZE,s*e.GRID_SIZE,e.GRID_SIZE,e.GRID_SIZE)},s.tempShape=function(t,i,s){void 0===s&&(s=!1);var n=new egret.Sprite;n.UID=i,n.isRigid=s;var r=new egret.Shape,h=new egret.TextField;return s?(r.graphics.beginFill(16773120),r.graphics.drawRect(0,0,e.GRID_SIZE,e.GRID_SIZE),r.graphics.endFill(),r.x=-e.GRID_SIZE/2,r.y=-e.GRID_SIZE/2,n.addChild(r),h.textColor=0):(r.graphics.beginFill(16777215),r.graphics.drawCircle(0,0,20),r.graphics.endFill(),n.addChild(r),h.textColor=65535),h.size=14,h.text=t,h.width=h.textWidth,h.height=h.textHeight,n.addChild(h),h.x=-h.width/2,h.y=-h.height/2,n},s.checkExistComp=function(t){for(var e,i=0;i<this._compContainer.numChildren;i++)if(e=this._compContainer.getChildAt(i),e.UID==t.UID)return!0;return!1},s.getNearestRigid=function(t){for(var e,i,s,n=null,r=1e3,h=new egret.Point(t.x,t.y),o=[],a=0;a<this._compContainer.numChildren;a++)e=this._compContainer.getChildAt(a),e.UID==t.UID&&e!=t&&(e.isRigid?(s=new egret.Point(e.x,e.y),i=egret.Point.distance(h,s),r>i&&(n=e,r=i)):o.push(e));return{item:n,otherArr:o}},s.findPath=function(t,e){},s.connectToRigid=function(t){for(var e,i=this.getNearestRigid(t),s=i.item,n=i.otherArr,r=0;r<n.length;r++)e=n[r],this._linkLine.graphics.moveTo(t.x,t.y),this._linkLine.graphics.lineTo(e.x,e.y),t=e;this._linkLine.graphics.moveTo(t.x,t.y),this._linkLine.graphics.lineTo(s.x,s.y)},s.dianlutuChanged=function(t){for(console.log("更新电路图",t),this.drawBaseGrid();this._compContainer.numChildren>0;)this._compContainer.removeChildAt(0);this._linkLine.graphics.clear(),this._linkLine.graphics.lineStyle(2,65280);for(var i,s,n,r,h=e.BASIC_ROWS-1;h>=0;h--){r=null;for(var o=0;o<e.BASIC_COLS;o++)t[h]&&(i=t[h][o],i&&-1!=i&&(i.ty=h,i.tx=o,s=this.checkExistComp(i),s?(n=this.tempShape(i.name,i.UID,!1),this._compContainer.addChild(n),n.x=(o+1)*(e.GRID_SIZE+e.GRID_SIZE)+e.GRID_SIZE/2,n.y=(h+1)*(e.GRID_SIZE+e.GRID_SIZE)+e.GRID_SIZE/2):(n=this.tempShape(i.name,i.UID,!0),this._compContainer.addChild(n),n.x=(o+1)*(e.GRID_SIZE+e.GRID_SIZE)+e.GRID_SIZE/2,n.y=(h+1)*(e.GRID_SIZE+e.GRID_SIZE)+e.GRID_SIZE/2),r&&n&&n.isRigid&&(this._linkLine.graphics.moveTo(r.x,r.y),this._linkLine.graphics.lineTo(n.x,n.y),0==r.isRigid&&this.connectToRigid(r)),r=n,n=null))}},s.destroyAll=function(){MessageCenter.getInstance().removeListener(ItemEventConst.DIANLU_CONNECT_CHANGED,this.dianlutuChanged,this)},s.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},e.GAP_HEIGHT=25,e.GAP_WIDTH=20,e.SCALE_INC=.4,e.BASIC_ROWS=10,e.BASIC_COLS=10,e.GRID_SIZE=50,e}(egret.DisplayObjectContainer);egret.registerClass(DrawCircuitDiagram,"DrawCircuitDiagram");var DrawDianDengpaoItem=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e}(DBaseItem);egret.registerClass(DrawDianDengpaoItem,"DrawDianDengpaoItem");var DrawDianLiubiaoItem=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e}(DBaseItem);egret.registerClass(DrawDianLiubiaoItem,"DrawDianLiubiaoItem");var DrawDianYabiaoItem=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e}(DBaseItem);egret.registerClass(DrawDianYabiaoItem,"DrawDianYabiaoItem");var DrawDianZuItem=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e}(DBaseItem);egret.registerClass(DrawDianZuItem,"DrawDianZuItem");var DrawDianchiItem=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e}(DBaseItem);egret.registerClass(DrawDianchiItem,"DrawDianchiItem");var DrawKaiguanItem=function(t){function e(e){t.call(this,e)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(e){t.prototype.onAddToStage.call(this,e)},e}(DBaseItem);egret.registerClass(DrawKaiguanItem,"DrawKaiguanItem");var DrawLineItem=function(t){function e(){t.call(this),this.infoPanel=null,this._prePoint=null,this._preAngle=0/0,this._curvArr=[],this._startItem={item:null,node:null},this._endItem={item:null,node:null},this._controlerIndex=-1,this.elecID=null,this.typeid=-1,this.infoCls=null,this.cls=null,this.data={drawColor:16711680,lineColor:16711680,weight:5},this.node1=null,this.node2=null,this._numPoints=20,this._speed=15,this.data.drawColor=ElectricsConst.COLOR_WIRE_SILVER,this.data.lineColor=ElectricsConst.COLOR_WIRE_SILVER,this.data.weight=ElectricsConst.WEIGHT_WIRE,this.initPoster()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initPoster=function(){var t=this;this.iElecInter=1,this.classname="ElecWire",this.bposter0=new experimentalApparatus.Electricity.BindMC("h1_mc",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("h2_mc",this),this.h1_mc=this.bposter0,this.h2_mc=this.bposter1,this._line=new egret.Sprite,this._line.graphics.lineStyle(this.data.weight,this.data.drawColor),this._line.touchEnabled=!0,this.addChild(this._line),t.addChild(this.bposter0),t.addChild(this.bposter1)},s.downFunc=function(t){t.bindinger.friendPostersArr.length>0||this.addEventListener(egret.Event.ENTER_FRAME,this.enterFraneHandle,this)},s.upHandleFunc=function(t){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFraneHandle,this);t.bindinger.nearToBinding();this.linkeChanged()},s.updateLine=function(){this._curvArr[0].x=this.bposter0.x,this._curvArr[0].y=this.bposter0.y,this._curvArr[this._curvArr.length-1].x=this.bposter1.x,this._curvArr[this._curvArr.length-1].y=this.bposter1.y,this._line.graphics.clear(),this._painCurv()},s.enterFraneHandle=function(t){this.updateLine()},s.followLinkObj=function(){},s.linkeChanged=function(){t.prototype.diyChanged.call(this)},s.updateColor=function(){this._line.graphics.clear(),this._painCurv()},s.findRightItemData=function(t){if(!this.hasItemAndNode(t))return null;if(!this.hasItemAndNode(this._startItem))return null;if(!this.hasItemAndNode(this._endItem))return null;if(t.item==this._startItem.item||t.item==this._endItem.item){if(t.node!=this._startItem.node)return this._startItem;if(t.node!=this._endItem.node)return this._endItem}},s.hasItemAndNode=function(t){return t.item&&t.item.parent&&t.node&&t.node.parent?!0:!1},s.isLineEffect=function(){return this.node1&&this.node1.item.parent&&this.node2&&this.node2.item.parent?!0:!1},s.openProPanel=function(){this.infoPanel||(this.infoPanel=ElectricsView.getInstance().getInfoPanel(3011,"WireInfoPanel")),ElectricsView.getInstance().showInfoPanel(this.infoPanel,this)},s.checkHitPoster=function(t,e,i){var s=new egret.Point(e,i),n=t.parent.localToGlobal(t.x,t.y),r=egret.Point.distance(s,n);return 20>=r?!0:!1},s.checkLine=function(t,e){if(this.checkHitPoster(this.bposter0,t,e))return this._controlerIndex=0,!0;if(this.checkHitPoster(this.bposter1,t,e))return this._controlerIndex=this._curvArr.length-1,!0;if(this._line.hitTestPoint(t,e,!0)){for(var i,s=Number.MAX_VALUE,n=new egret.Point(t,e),r=0;r<this._curvArr.length;r++)i=this._curvArr[r],egret.Point.distance(n,i)<s&&(s=egret.Point.distance(n,i),this._controlerIndex=r);return 0==this._controlerIndex&&this._startItem.item&&this._startItem.item.parent?!1:this._controlerIndex==this._curvArr.length-1&&this._endItem.item&&this._endItem.item.parent?!1:!0}return!1},s.modifyLineMoving=function(t,e,i){if(-1!=this._controlerIndex){for(var s,n=0;n<this._curvArr.length;n++)if(s=this._curvArr[n],0==this._controlerIndex){if(0==n){if(this._startItem.item&&this._startItem.item.parent)continue}else if(n==this._curvArr.length-1)continue}else if(this._controlerIndex==this._curvArr.length-1){if(n==this._curvArr.length-1){if(this._endItem.item&&this._endItem.item.parent)continue}else if(0==n)continue}else{if(0==n||n==this._curvArr.length-1)continue;this._controlerIndex==n&&(s.x+=e,s.y+=i)}this._line.graphics.clear(),this._painCurv()}},s.modifyLineEnd=function(t,e,i){if(i){var s=i.parent.localToGlobal(i.x,i.y);0==this._controlerIndex&&(this._startItem.item&&null!=this._startItem.item.parent||(this._curvArr[this._controlerIndex].x=s.x,this._curvArr[this._controlerIndex].y=s.y,this._startItem.item=e,this._startItem.node=i)),this._controlerIndex==this._curvArr.length-1&&(this._endItem.item&&null!=this._endItem.item.parent||(this._curvArr[this._controlerIndex].x=s.x,this._curvArr[this._controlerIndex].y=s.y,this._endItem.item=e,this._endItem.node=i)),this.bposter0.bindinger.nearToBinding(),this.bposter1.bindinger.nearToBinding(),this.linkeChanged(),this._curvArr[0].x=this.bposter0.x,this._curvArr[0].y=this.bposter0.y,this._curvArr[this._curvArr.length-1].x=this.bposter1.x,this._curvArr[this._curvArr.length-1].y=this.bposter1.y,this._line.graphics.clear(),this._painCurv()}this.openProPanel(),this._controlerIndex=-1},s.updateAllCurv=function(t,e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var n,r=0;r<this._curvArr.length;r++)i&&0==r||s&&r==this._curvArr.length-1||(n=this._curvArr[r],n.x+=t,n.y+=e);this._line.graphics.clear(),this._painCurv()},s.drawStartElecLine=function(t,e,i){this._startItem.item=t,this._startItem.node=e,this.node1=e,this._line.graphics.moveTo(i[0],i[1]),this._line.graphics.lineTo(i[0],i[1]),this._curvArr.push(new egret.Point(Math.floor(i[0]),Math.floor(i[1]))),this._prePoint=new egret.Point(i[0],i[1])},s.joinNewPoint=function(t){var e=ElectricsConst.getAngle(t,this._prePoint);if(1==this._curvArr.length)this._preAngle=e,this._curvArr.push(t),this._prePoint=t;else if(Math.abs(e-this._preAngle)>30)egret.Point.distance(t,this._prePoint)>30&&(this._preAngle=e,this._curvArr.push(t),this._prePoint=t);else{var i=this._curvArr[this._curvArr.length-1];i.x=t.x,i.y=t.y}},s._onMoveDraw=function(t){this._line.graphics.lineTo(t.stageX,t.stageY),this.joinNewPoint(new egret.Point(Math.floor(t.stageX),Math.floor(t.stageY)))},s._onEndDraw=function(t,e,i){if(i){if(this._startItem.item==e)return this.dispose(),void console.log("画到自己身上则删除");var s=i.parent.localToGlobal(i.x,i.y);this._curvArr.push(s),this._endItem.item=e,this._endItem.node=i,i&&(this.node2=i),console.log("吸附")}else this._curvArr.push(new egret.Point(Math.floor(t.stageX),Math.floor(t.stageY)));this._line.graphics.clear(),this._painCurv(),this.bposter0.bindinger.nearToBinding(),this.bposter1.bindinger.nearToBinding(),this.linkeChanged()},s._painCurv=function(){if(this._numPoints=this._curvArr.length,!(this._numPoints<3)){this._line.graphics.moveTo(this._curvArr[0].x,this._curvArr[0].y),this._line.graphics.lineStyle(this.data.weight,16773120,0),this._line.graphics.drawCircle(this._curvArr[0].x,this._curvArr[0].y,8),this._line.graphics.lineStyle(this.data.weight,this.data.lineColor);for(var t=1;t<this._numPoints-2;t++){var e=(this._curvArr[t].x+this._curvArr[t+1].x)/2,i=(this._curvArr[t].y+this._curvArr[t+1].y)/2;this._line.graphics.curveTo(this._curvArr[t].x,this._curvArr[t].y,e,i)}this._line.graphics.curveTo(this._curvArr[t].x,this._curvArr[t].y,this._curvArr[t+1].x,this._curvArr[t+1].y),this._line.graphics.lineStyle(8,16773120,0),this._line.graphics.drawCircle(this._curvArr[t+1].x,this._curvArr[t+1].y,8),this._curvArr.length>0&&(this.bposter0.x=this._curvArr[0].x,this.bposter0.y=this._curvArr[0].y,this.bposter1.x=this._curvArr[this._curvArr.length-1].x,this.bposter1.y=this._curvArr[this._curvArr.length-1].y)}},s.initWireItem=function(t){this._curvArr=t.drawData,this._painCurv(),this.bposter0.bindinger.nearToBinding(),this.bposter1.bindinger.nearToBinding(),this.linkeChanged(),this.data=t},s.getProName=function(t,e){return t.bposter0==e?"bposter0":t.bposter1==e?"bposter1":t.bposter2==e?"bposter2":"bposter0"},s.getProObj=function(){return this._startItem.item&&(this.data.startElecid=this._startItem.item.elecID,this.data.startNodeName=this.getProName(this._startItem.item,this._startItem.node)),this._endItem.item&&(this.data.endElectid=this._endItem.item.elecID,this.data.endNodeName=this.getProName(this._endItem.item,this._endItem.node)),this.cls="DrawLineItem",this.data.cls=this.cls,this.data.x=this.x,this.data.y=this.y,this.data.typeid=3011,this.data.infoCls="WireInfoPanel",this.data.iElecInter=this.iElecInter,this.elecID=this.UID,this.data.elecID=this.elecID,this.data.drawData=this._curvArr,this.data},s.dispose=function(){this._curvArr=null,this._startItem=null,this._endItem=null,this.parent.removeChild(this)},s._onTimer=function(){this._currentStep++,this._currentStep>this._totalStep-1&&this._curPoint<this._numPoints-3&&(this._curPoint++,this._currentStep=0,this.nextStep()),this._currentStep>this._totalStep&&this.removeEventListener(egret.Event.ENTER_FRAME,this._onTimer,this)},s.nextStep=function(){var t=0==this._curPoint?this._curvArr[0]:new egret.Point((this._curvArr[this._curPoint].x+this._curvArr[this._curPoint+1].x)/2,(this._curvArr[this._curPoint].y+this._curvArr[this._curPoint+1].y)/2),e=new egret.Point(this._curvArr[this._curPoint+1].x,this._curvArr[this._curPoint+1].y),i=this._curPoint<=this._numPoints-4?new egret.Point((this._curvArr[this._curPoint+1].x+this._curvArr[this._curPoint+2].x)/2,(this._curvArr[this._curPoint+1].y+this._curvArr[this._curPoint+2].y)/2):this._curvArr[this._curPoint+2];this._totalStep=Bezier.init(t,e,i,this._speed),this._line.graphics.lineStyle(1,this.data.drawColor);for(var s=1;s<=this._totalStep;s++){var n=Bezier.getAnchorPoint(s),r=new egret.Point(n[0],n[1]);this._line.graphics.moveTo(r.x-2,r.y),this._line.graphics.lineTo(r.x+2,r.y),this._line.graphics.moveTo(r.x,r.y-2),this._line.graphics.lineTo(r.x,r.y+2)}},e}(experimentalApparatus.Electricity.BASEElectricity);egret.registerClass(DrawLineItem,"DrawLineItem");var Bezier=function(){function t(){}var e=(__define,t);e.prototype;return t.s=function(e){return Math.sqrt(t.A*e*e+t.B*e+t.C)},t.L=function(e){var i=Math.sqrt(t.C+e*(t.B+t.A*e)),s=2*t.A*e*i+t.B*(i-Math.sqrt(t.C)),n=Math.log(t.B+2*Math.sqrt(t.A)*Math.sqrt(t.C)),r=Math.log(t.B+2*t.A*e+2*Math.sqrt(t.A)*i),h=2*Math.sqrt(t.A)*s,o=(t.B*t.B-4*t.A*t.C)*(n-r);return(h+o)/(8*Math.pow(t.A,1.5))},t.InvertL=function(e,i){for(var s,n=e;;){if(s=n-(t.L(n)-i)/t.s(n),Math.abs(n-s)<1e-6)break;n=s}return s},t.init=function(e,i,s,n){return t.p0=e,t.p1=i,t.p2=s,t.ax=t.p0.x-2*t.p1.x+t.p2.x,t.ay=t.p0.y-2*t.p1.y+t.p2.y,t.bx=2*t.p1.x-2*t.p0.x,t.by=2*t.p1.y-2*t.p0.y,t.A=4*(t.ax*t.ax+t.ay*t.ay),t.B=4*(t.ax*t.bx+t.ay*t.by),t.C=t.bx*t.bx+t.by*t.by,t.total_length=t.L(1),t.total_length=Math.ceil(egret.Point.distance(e,s)),console.log(t.total_length,"vvvvvvvvv",egret.Point.distance(e,s)),t.step=Math.floor(t.total_length/n),t.total_length%n>n/2&&t.step++,console.log("������"+t.total_length),console.log("������"+t.step),t.step},t.getAnchorPoint=function(e){if(e>=0&&e<=t.step){var i=e/t.step,s=i*t.total_length;i=t.InvertL(i,s);var n=(1-i)*(1-i)*t.p0.x+2*(1-i)*i*t.p1.x+i*i*t.p2.x,r=(1-i)*(1-i)*t.p0.y+2*(1-i)*i*t.p1.y+i*i*t.p2.y,h=new egret.Point((1-i)*t.p0.x+i*t.p1.x,(1-i)*t.p0.y+i*t.p1.y),o=new egret.Point((1-i)*t.p1.x+i*t.p2.x,(1-i)*t.p1.y+i*t.p2.y),a=o.x-h.x,l=o.y-h.y,c=Math.atan2(l,a),d=180*c/Math.PI;return[n,r,d]}return[]},t}();egret.registerClass(Bezier,"Bezier");var ElecDataManager=function(){function t(){t._instance=this}var e=(__define,t);e.prototype;return t.getInstance=function(){return t._instance},t._instance=null,t}();egret.registerClass(ElecDataManager,"ElecDataManager");var ElectricsConst=function(){function t(){}var e=(__define,t);e.prototype;return t.initSwf=function(){if(!t.electricItem_swf){var e=RES.getRes("electricItems_swf_json"),i=RES.getRes("electricItems_json"),s=new starlingswf.SwfAssetManager;s.addSpriteSheet("electricItems_json",i),t.electricItem_swf=new starlingswf.Swf(e,s,60)}},t.getAngle=function(t,e){var i=e.x-t.x,s=e.y-t.y,n=Math.atan2(s,i),r=180*n/Math.PI;return r},t.stage=null,t.ACTION_DRAW_NEWLINE=0,t.ACTION_MODIFY_LINE=1,t.ACTION_DRAG_ITEM=2,t.ACTION_DRAG_INFO=3,t.ACTION_TAP_WIRE=4,t.ACTION_NONE=-1,t.COLOR_FIREWIRE=16711680,t.COLOR_NULLWIRE=3192575,t.COLOR_GROUNDWIRE=16777215,t.COLOR_WIRE_INDEX_RED=0,t.COLOR_WIRE_INDEX_SILVER=1,t.COLOR_WIRE_INDEX_BLACK=2,t.COLOR_WIRE_RED=16724736,t.COLOR_WIRE_SILVER=12632256,t.COLOR_WIRE_BLACK=0,t.WEIGHT_WIRE=5,t}();egret.registerClass(ElectricsConst,"ElectricsConst");var ElectricsView=function(t){function e(i){t.call(this,i,!1),this._currentInfoPanel=null,this._actionType=-1,this._prePos=new egret.Point,this._allEffectLinesArr=[],this._allEffectItemsArr=[],this.allCompArr=[],this.huiluGroupArr=[],this.linesArr=[],this.powerArr=[],this.suojian_delBindingerArr=[],this.elecAndArr=[],this.isFir_cacu=!1,this.delCompArr=[],this.delWireArr=[],this.CapacitanceArr=[],this.ElecPowerStudentArr=[],this._dataGraphicPanel=null,this._actionType=ElectricsConst.ACTION_NONE,ElectricsConst.stage=i,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressStage,this),e._instance=this}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){return e._instance},s.initUI=function(){ElectricsConst.initSwf(),this.itemContainer=new egret.Sprite,this.itemContainer.graphics.beginFill(MainView.MainColor),this.itemContainer.graphics.drawRect(MainView.mainRect[0],MainView.mainRect[1],MainView.mainRect[2]-MainView.mainRect[0],MainView.mainRect[3]-MainView.mainRect[1]),this.itemContainer.graphics.endFill(),this.addChildAt(this.itemContainer,0),this.panelContainer=new egret.Sprite,this.addChildAt(this.panelContainer,2),this.maskC=new egret.Sprite,this.maskC.touchEnabled=!1,this.maskC.graphics.beginFill(65280),this.maskC.graphics.drawRect(MainView.mainRect[0],MainView.mainRect[1],MainView.mainRect[2]-MainView.mainRect[0],MainView.mainRect[3]-MainView.mainRect[1]),this.maskC.graphics.endFill(),this.addChild(this.maskC),this.itemContainer.mask=this.maskC,MessageCenter.getInstance().addListener(ItemEventConst.ADD_ITEM,this.addItem,this),MessageCenter.getInstance().addListener(ItemEventConst.COPY_ITEM,this.copyItem,this),this.dianlutuViewPanel=new CircuitDiagramInfoPanel,this.dianlutuViewPanel.visible=!1,this.dianlutuViewPanel.x=MainView.mainRect[0],this.dianlutuViewPanel.y=MainView.mainRect[1],this.addChild(this.dianlutuViewPanel),this.itemContainer.name="elec_equipmentContainer",experimentalApparatus.Electricity.ElecUtil.init_elect_Update(this)},s.showDataRecordPanel=function(){this.dataRecordPanel||(this.dataRecordPanel=new DataRecordInfoPanel,this.dataRecordPanel.x=MainView.mainRect[0],this.dataRecordPanel.y=MainView.mainRect[1]+20,this.addChild(this.dataRecordPanel)),this.dataRecordPanel.showPanel(),this.dataRecordPanel.visible=!0},s.showDianlutu=function(){this.dianlutuViewPanel&&(this.dianlutuViewPanel.visible=!0)},s.showDataGraphicPanel=function(t,e){this._dataGraphicPanel||(this._dataGraphicPanel=new DataGraphicPanel,this.dataRecordPanel.graphicPanel=this._dataGraphicPanel,this.addChild(this._dataGraphicPanel)),this._dataGraphicPanel.x=t.x,this._dataGraphicPanel.y=t.y+t.height+20,this._dataGraphicPanel.setData(e),this._dataGraphicPanel.visible=!0},s.itemDraging=function(t,e,i){for(var s,n=0;n<this.itemContainer.numChildren;n++)if(s=this.itemContainer.getChildAt(n),s instanceof DrawLineItem){var r=s._startItem.item,h=s._endItem.item;r==t&&h==t?s.updateAllCurv(e,i):r==t&&h!=t?s.updateAllCurv(e,i,!1,!0):r!=t&&h==t&&s.updateAllCurv(e,i,!0,!1)}},s.hittestObjects=function(t,e){for(var i,s=0;s<this.itemContainer.numChildren;s++)if(i=this.itemContainer.getChildAt(s),i.typeid==e&&i.spr.hitTestPoint(t.x,t.y))return!0;return!1},s.getElecComp=function(t){for(var e=!1,i=t;i;){if(experimentalApparatus.Electricity.ElecUtil.checkIsElec(i)){e=!0;break}i=i.parent}return e?i:null},s.cacu_elec=function(t){var e=this.getElecComp(t.target);e&&(this.downElec=e,this.downElec.dragIng())},s.pressStage=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressStage,this),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.upStage,this),this._prePos.x=t.stageX,this._prePos.y=t.stageY;var e=t.target.parent;if(e instanceof InfoPanelBase&&e.isInHeader(t.stageX,t.stageY))return this._actionType=ElectricsConst.ACTION_DRAG_INFO,void ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this);for(var i,s,n=0;n<this.itemContainer.numChildren;n++)if(i=this.itemContainer.getChildAt(n),!(i instanceof DrawLineItem)&&i&&(s=i.checkDraw(t.stageX,t.stageY))){ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this);var r=s.parent.localToGlobal(s.x,s.y);return this._drawLineItem=new DrawLineItem,this.itemContainer.addChild(this._drawLineItem),this._actionType=ElectricsConst.ACTION_DRAW_NEWLINE,void this._drawLineItem.drawStartElecLine(i,s,[r.x,r.y])}for(var h,n=0;n<this.itemContainer.numChildren;n++)if(h=this.itemContainer.getChildAt(n),h instanceof DrawLineItem&&h.checkLine(t.stageX,t.stageY))return this._actionType=ElectricsConst.ACTION_MODIFY_LINE,this._drawLineItem=h,void ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this)},s.moveStage=function(t){var e,i;switch(this._actionType){case ElectricsConst.ACTION_DRAG_ITEM:break;case ElectricsConst.ACTION_DRAW_NEWLINE:this._drawLineItem&&this._drawLineItem._onMoveDraw(t);break;case ElectricsConst.ACTION_MODIFY_LINE:this._drawLineItem&&(e=t.stageX-this._prePos.x,i=t.stageY-this._prePos.y,this._drawLineItem.modifyLineMoving(t,e,i),this._prePos.x=t.stageX,this._prePos.y=t.stageY);break;case ElectricsConst.ACTION_DRAG_INFO:this._currentInfoPanel&&(e=t.stageX-this._prePos.x,i=t.stageY-this._prePos.y,this._currentInfoPanel.onDraging(e,i),this._prePos.x=t.stageX,this._prePos.y=t.stageY)}},s.upStage=function(t){ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.upStage,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressStage,this);var e,i;switch(this._actionType){case ElectricsConst.ACTION_DRAG_ITEM:break;case ElectricsConst.ACTION_DRAW_NEWLINE:if(this._drawLineItem){for(var s=0;s<this.itemContainer.numChildren&&(e=this.itemContainer.getChildAt(s),e instanceof DrawLineItem||!e||!(i=e.checkDraw(t.stageX,t.stageY)));s++);this._drawLineItem._onEndDraw(t,e,i),this._drawLineItem=null}break;case ElectricsConst.ACTION_MODIFY_LINE:if(this._drawLineItem){for(var s=0;s<this.itemContainer.numChildren&&(e=this.itemContainer.getChildAt(s),e instanceof DrawLineItem||!e||!(i=e.checkDraw(t.stageX,t.stageY)));s++);this._drawLineItem.modifyLineEnd(t,e,i),this._drawLineItem=null}break;case ElectricsConst.ACTION_DRAG_INFO:this._currentInfoPanel&&this._currentInfoPanel.onDragEnd(t)}this._actionType=ElectricsConst.ACTION_NONE},s.showInfoPanel=function(t,e){this._currentInfoPanel!=t?(this._currentInfoPanel&&(this._currentInfoPanel.visible=!1,this._currentInfoPanel=null),this._currentInfoPanel=t,this._currentInfoPanel.setData(e),this._currentInfoPanel.visible=!0):this._currentInfoPanel._item!=e?(this._currentInfoPanel.setData(e),this._currentInfoPanel.visible=!0):this._currentInfoPanel.visible=this._currentInfoPanel.visible?!1:!0},s.getInfoPanel=function(t,e){for(var i,s=0;s<this.panelContainer.numChildren;s++)if(i=this.panelContainer.getChildAt(s),i.typeid==t)return i;var n=egret.getDefinitionByName(e);return i=new n,i.typeid=t,i.x=MainView.mainRect[2]-i.width,i.y=MainView.mainRect[1],this.panelContainer.addChild(i),i},s.isSameLine=function(t,e){return!t&&e?!1:!e&&t?!1:t==e?!0:t.node1==e.node2&&t.node2==e.node2?!0:t.node1==e.node2&&t.node2==e.node1?!0:!1},s.checkExistLine=function(t,e){for(var i,s=0;s<t.length;s++)if(i=t[s],this.isSameLine(i,e))return!0;return!1},s.checkExistNode=function(t,e){for(var i,s=0;s<t.length;s++)if(i=t[s],i.item==e.item&&i.node==e.node)return!0;return!1},s.getAll_comp=function(){for(var t=[],e=0;e<this.itemContainer.numChildren;e++)t.push(this.itemContainer.getChildAt(e));return t},s.getAll_lines=function(){var t=[];this._allEffectLinesArr=[];for(var e,i=0;i<this.itemContainer.numChildren;i++)e=this.itemContainer.getChildAt(i),e instanceof DrawLineItem&&e.isLineEffect()&&0==this.checkExistLine(t,e)&&t.push(e);return t},e.showElectView=function(t,e){t.dispose(),t.itemContainer.removeChildren();var i,s;for(var n in e)i=e[n],1!=i.iElecInter&&this.initDev(t,i);for(var n in e)i=e[n],1!=i.iElecInter||this.initWire(t,i);for(var r=0;r<t.itemContainer.numChildren;r++)s=t.itemContainer.getChildAt(r),1==s.iElecInter&&this.initNodeItem(t,s,s.data);s&&s instanceof DrawLineItem&&s.linkeChanged()},e.initDev=function(t,e){var i,s=egret.getDefinitionByName(e.cls);i=new s(null,t),i.typeid=e.typeid,i.cls=e.cls,i.infoCls=e.infoCls,i.elecID=e.elecID,i.Position([e.x,e.y]),t.itemContainer.addChildAt(i,0),i.setCopyData&&i.setCopyData(e)},e.initWire=function(t,e){var i,s=egret.getDefinitionByName(e.cls);i=new s,i.typeid=e.typeid,i.cls=e.cls,i.infoCls=e.infoCls,i.elecID=e.elecID,t.itemContainer.addChild(i),i.initWireItem(e)},e.initNodeItem=function(t,e,i){for(var s,n=i.startElecid,r=i.startNodeName,h=i.endElectid,o=i.endNodeName,a=0;a<t.itemContainer.numChildren;a++)s=t.itemContainer.getChildAt(a),s.elecID==n?e._startItem={item:s,node:s[r]}:s.elecID==h&&(e._endItem={item:s,node:s[o]})},s.copyItem=function(t){var e,i=egret.getDefinitionByName(t.cls);e=new i(null,this),e.typeid=t.typeid,e.cls=t.cls,e.infoCls=t.infoCls,e.Position([t.x,t.y-200]),this.itemContainer.addChild(e),e.setCopyData&&e.setCopyData(t)},s.addItem=function(t,e){if(t.cls&&LightUtils.isInRect(e)){var i,s=egret.getDefinitionByName(t.cls);if("Wire"==t.cls)return i=new s,this.itemContainer.addChild(i),void i.Position(e);i=new s(null,this),i.typeid=t.type,i.cls=t.cls,i.infoCls=t.infoCls,i.Position(e),this.itemContainer.addChildAt(i,0)}},s.dispose=function(){for(this.dianlutuViewPanel&&this.dianlutuViewPanel.destroyAll();this.itemContainer.numChildren>0;)this.itemContainer.removeChildAt(0);for(;this.panelContainer.numChildren>0;)this.panelContainer.removeChildAt(0)},s.removeEvents=function(){MessageCenter.getInstance().removeListener(ItemEventConst.ADD_ITEM,this.addItem,this),MessageCenter.getInstance().removeListener(ItemEventConst.COPY_ITEM,this.copyItem,this)},e._instance=null,e}(BasePhyView);egret.registerClass(ElectricsView,"ElectricsView");var GridNode=function(t){function e(e,i){t.call(this),this.val=null,this.open=!1,this.block=!1,this.value_g=0,this.value_h=0,this.value_f=0,this.col=i,this.row=e,this.x=i,this.y=e}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.HashObject);egret.registerClass(GridNode,"GridNode");var MyArrayUtil=function(){function t(){}var e=(__define,t);e.prototype;return t.hasSameArray=function(e,i){for(var s,n=0;n<e.length;n++)if(s=e[n],t.isSameArray(s,i))return!0;return!1},t.isSameArray=function(t,e){if(t.length!=e.length)return!1;for(var i,s=0;s<t.length;s++)if(i=t[s],e.indexOf(i)<0)return!1;return!0},t.checkExistRepeatElement=function(t){for(var e=[],i=0;i<t.length;i++){if(!(e.indexOf(t[i])<0))return!0;e.push(t[i])}return!1},t}();egret.registerClass(MyArrayUtil,"MyArrayUtil");var PannelScaleBase=function(){function t(t){this.resizeDir=null,this.prex=0,this.prey=0,this.panel=t}var e=(__define,t),i=e.prototype;return i.initScaleItem=function(t,e,i,s,n){this.border=t,this.box1=e,this.box2=i,this.box3=s,this.box4=n,this.box1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMouseDown,this),this.box2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMouseDown,this),this.box3.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMouseDown,this),this.box4.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMouseDown,this)},i.resizeMe=function(t,e){this.border.graphics.clear(),this.border.graphics.lineStyle(2,12500670),LightUtils.drawDotBorder(this.border,0,0,t,0,t,e,0,e),this.border.anchorOffsetX=0,this.border.anchorOffsetY=0,this.setPos()},i.setPos=function(){this.box1.x=this.border.x,this.box1.y=this.border.y,this.box2.x=this.border.x+this.border.width,this.box2.y=0,this.box3.x=0,this.box3.y=this.border.y+this.border.height,this.box4.x=this.border.x+this.border.width,this.box4.y=this.border.y+this.border.height},i.onMouseDown=function(t){switch(t.target){case this.box1:this.resizeDir="TL";break;case this.box2:this.resizeDir="TR";break;case this.box3:this.resizeDir="BL";break;case this.box4:this.resizeDir="BR"}this.prex=t.stageX,this.prey=t.stageY,ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMouseMove,this),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onMouseUp,this)},i.onMouseMove=function(t){var e=Math.floor(t.stageX-this.prex),i=Math.floor(t.stageY-this.prey);switch(this.resizeDir){case"TL":this.panel.TLResize(e,i);break;case"TR":this.panel.TRResize(e,i);break;case"BL":this.panel.BLResize(e,i);break;case"BR":this.panel.BRResize(e,i)}this.prex=t.stageX,this.prey=t.stageY},i.onMouseUp=function(t){ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMouseMove,this),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMouseUp,this)},t}();egret.registerClass(PannelScaleBase,"PannelScaleBase");var PathFinding=function(t){function e(){t.call(this),this._w=0,this._h=0,this.path=[]}__extends(e,t);var i=(__define,e),s=i.prototype;return s.path4=function(t,e,i){this._map=t,this._w=t[0].length,this._h=t.length,this.path=[],this._starPoint=this._map[e.y][e.x],this._endPoint=this._map[i.y][i.x];var s=!1;this.initBlock();for(var n=this._starPoint;!s;){n.block=!0;var r=[];n.y>0&&r.push(this._map[n.y-1][n.x]),n.x>0&&r.push(this._map[n.y][n.x-1]),n.x<this._w-1&&r.push(this._map[n.y][n.x+1]),n.y<this._h-1&&r.push(this._map[n.y+1][n.x]);for(var h=r.length,o=0;h>o;o++){var a=r[o];if(a==this._endPoint){a.nodeparent=n,s=!0;break}null==a.val&&this.count(a,n)}if(!s){if(!(this._open.length>0))return[];n=this._open.splice(this.getMin(),1)[0]
}}return this.drawPath(),this.path},s.initBlock=function(){for(var t=0;t<this._h;t++)for(var e=0;e<this._w;e++)this._map[t][e].open=!1,this._map[t][e].block=!1,this._map[t][e].value_g=0,this._map[t][e].value_h=0,this._map[t][e].value_f=0,this._map[t][e].nodeparent=null;this._open=[]},s.count=function(t,e){if(!t.block){var i=e.value_g+10;t.open?t.value_g>=i&&(t.value_g=i,this.ghf(t),t.nodeparent=e):(this.addToOpen(t),t.value_g=i,this.ghf(t),t.nodeparent=e)}},s.drawPath=function(){for(var t=this._endPoint;t!=this._starPoint;)this.path.unshift(new egret.Point(t.x,t.y)),t=t.nodeparent;this.path.unshift(new egret.Point(t.x,t.y))},s.addToOpen=function(t){this._open.push(t),t.open=!0},s.ghf=function(t){var e=Math.abs(t.x-this._endPoint.x),i=Math.abs(t.y-this._endPoint.y);t.value_h=10*(e+i),t.value_f=t.value_g+t.value_h},s.getMin=function(){for(var t=this._open.length,e=1e5,i=0,s=0;t>s;s++)e>this._open[s].value_f&&(e=this._open[s].value_f,i=s);return i},e}(egret.HashObject);egret.registerClass(PathFinding,"PathFinding");var PathLine=function(t){function e(e){t.call(this),this._startItem={item:null,node:null},this._endItem={item:null,node:null},this._listView=null,this.arrTemp=null,this._listView=e,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchClick,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onTouchClick=function(t){this._listView.changeSelectLine(this)},s.drawLine=function(t,e){void 0===e&&(e=16777215),this.arrTemp=t,this.graphics.clear();var i;this.graphics.lineStyle(2,e),i=t[0];var s=40*i.y+20,n=40*i.x+20;this.graphics.moveTo(n,s);for(var r=1;r<t.length;r++)i=t[r],s=40*i.y+20,n=40*i.x+20,this.graphics.lineTo(n,s)},s.lineSelect=function(t){t?this.drawLine(this.arrTemp,16711935):this.drawLine(this.arrTemp)},e}(egret.Sprite);egret.registerClass(PathLine,"PathLine");var EBaseItem=function(t){function e(e,i,s,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null),t.call(this),this.infoPanel=null,this.typeid=-1,this.infoCls=null,this.cls=null,this.data=null,this._nodeArr=[],this.hasBLVoltmeter=!1,this.bposter0=null,this.bposter1=null,this.curPower=0,this.curElec=0,this.deviceID=1e4,this.elecID=null,this._prePos=new egret.Point,this.tapView=i,this.data={};this.iElecInter=s,this.classname=n}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initPoster=function(){},s.createPosterShape=function(t){var e=new egret.Sprite;e.alpha=0,this.addChild(e),DisplayUtil.drawRect(e.graphics,t.measuredWidth,t.measuredHeight,6,16711680),e.x=t.x-t.measuredWidth/2,e.y=t.y-t.measuredHeight/2},s.set_bposterXY=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=null)},s.set_bposter=function(t,e,i){this.bposter0=t,this.bposter1=e,this.Resistance=i,t.bindinger.set_myroad(e.bindinger,this.Resistance)},s.setWorkPower=function(t){this.curPower=t},s.setWorkElec=function(t){this.curElec=t},s.init=function(t){void 0===t&&(t="tri_png"),this.spr=ElectricsConst.electricItem_swf.createSprite(t),this.spr.touchEnabled=!0,this.addChildAt(this.spr,0),this.spr.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onBegin,this),this.bitMap=this.spr,this.itemTop=new EItemTop(this),this.addChild(this.itemTop),this.itemTop.setPos(-this.itemTop.width/2,-this.measuredHeight/2-140),this.itemTop.visible=!1,this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.openProPanelBegin,this)},s.checkDraw=function(t,e){return null},s.openProPanel=function(){if(this.openPro){for(var t=this.parent.numChildren,e=0;t>e;e++){var i=this.parent.getChildAt(e);i!==this&&i.itemTop&&(i.itemTop.visible=!1)}this.itemTop&&(this.itemTop.visible=!this.itemTop.visible,this.openPro=!1)}this.tapView&&(this.infoPanel||(this.infoPanel=this.tapView.getInfoPanel(this.typeid,this.infoCls)),this.tapView.showInfoPanel(this.infoPanel,this))},s._onBegin=function(t){this._startX=t.stageX,this._startY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.x,this.y,e);this._offX=this._startX-i.x,this._offY=this._startY-i.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._onEnd,this),this._prePos.x=t.stageX,this._prePos.y=t.stageY},s.onMove=function(t){if(this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.ro)return this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),void this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this._onEnd,this);this.x=t.stageX-this._offX,this.y=t.stageY-this._offY;var e=t.stageX-this._prePos.x,i=t.stageY-this._prePos.y;ElectricsView.getInstance().itemDraging(this,e,i),this._prePos.x=t.stageX,this._prePos.y=t.stageY},s._onEnd=function(t){this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this._onEnd,this)},s.checkHitPoster=function(t,e,i){var s=new egret.Point(e,i),n=t.parent.localToGlobal(t.x,t.y),r=egret.Point.distance(s,n);return 20>=r?!0:!1},s.getBinders=function(){var t=[];return t},s.Position=function(t){this.x=t[0],this.y=t[1]},s.Scale=function(t){},s.revertItem=function(){1==this.spr.scaleX?this.spr.scaleX=-1:this.spr.scaleX=1},s.setRotation=function(t){this.rotation=-t},s.getProObj=function(){return this.data.x=this.x,this.data.y=this.y,this.data.typeid=this.typeid,this.data.cls=this.cls,this.data.infoCls=this.infoCls,this.data.iElecInter=this.iElecInter,this.data.Resistance=this.Resistance,this.elecID=this.UID,this.data.elecID=this.elecID,this.data},s.dispose=function(){this.spr.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this._onEnd,this),this.spr=null,this.data=null,this.infoPanel&&(this.infoPanel.visible=!1),ElectricsView.getInstance()._currentInfoPanel=null,this.Power=0,this.diyChanged(),t.prototype.dispose.call(this)},e}(experimentalApparatus.Electricity.BASEElectricity);egret.registerClass(EBaseItem,"EBaseItem");var Ammeter=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,5,"ElecLamp"),this.ammeterRES=1e-5,this.ammeterMaxValue=.6,this.ammeterAccuracy=1,this.isDamaged=!1,this._totalAngle=108,this._perVolAng=0,this.bposter2=null,this.bar1_=null,this.bar2_=null,this.bar3_=null,this.isLinkError=!1,this.deviceID=++e.uniqueID,this.name="电流表"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=this.width+20,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-20,i.y=this.bposter0.y-200,i.text=t,i.touchEnabled=!1,this.label=i},s.caculateOver=function(){if(this.isLinkError=!1,1!=this.bar1_.isBreak){var t=this.getValidLinkWires(this.bposter0).length,e=this.getValidLinkWires(this.bposter1).length,i=this.getValidLinkWires(this.bposter2).length;t>0&&e>0&&i>0&&(this.isLinkError=!0);var s=this.bar1_.tempPower+this.bar2_.tempPower+this.bar3_.tempPower,n=this.bar1_.tempElec+this.bar2_.tempElec+this.bar3_.tempElec,r=this.bar1_.Resistance+this.bar2_.Resistance+this.bar3_.Resistance;this.realV=s,this.realA=n,this.txt_.text=s.toFixed(this.ammeterAccuracy)+" V\n"+n.toFixed(this.ammeterAccuracy)+" A",this.label.text=r.toFixed(this.ammeterAccuracy)+"Ω "+this.name,this.setCurrentValue(n)}},s.setWorkPower=function(t){this.txt_.text=t.toFixed(this.ammeterAccuracy)+" V\n"+(t/this.Resistance).toFixed(this.ammeterAccuracy)+" A",this.setCurrentValue(t/this.Resistance)},s.setRES=function(t){0==t&&(t=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.bar1_.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,this.bar2_.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter1.bindinger.friendPostersArr.length>1&&this.bposter2.bindinger.friendPostersArr.length>0?this.bar1_.Resistance=t:this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter1.bindinger.friendPostersArr.length>1?this.bar1_.Resistance=t:this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter2.bindinger.friendPostersArr.length>0&&(this.bar2_.Resistance=t),this.ammeterRES=t,this.label.text=t.toFixed(this.ammeterAccuracy)+"Ω "+this.name,this.diyChanged()},s.setAccuracy=function(t){this.ammeterAccuracy=t,this.diyChanged()},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_amm"),this.onAddToStage(null)},s.getBinders=function(){var t=[{item:this,node:this._anode06},{item:this,node:this._anode3},{item:this,node:this._cathode}];return t},s.onAddToStage=function(t){this._pointer=this.spr.getImage("pointer"),this._anode06=this.spr.getImage("anode_06"),this._anode06.touchEnabled=!0,this._anode3=this.spr.getImage("anode_3"),this._anode3.touchEnabled=!0,this._cathode=this.spr.getImage("cathode"),this._cathode.touchEnabled=!0,this._anode3.type="out",this._anode3.value="3",this._anode06.type="out",this._anode06.value="0.6",this._cathode.type="in",this._anode06.name="红线",this._anode3.name="蓝线",this._cathode.name="蓝线",this._anode06.item=this,this._anode3.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1,this.bposter2),this.ammeterMaxValue&&(this._perVolAng=this._totalAngle/this.ammeterMaxValue),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.isCon=!1,this.bposter2.isCon=!1,this.data.accuracy=this.ammeterAccuracy},s.initPoster=function(){this.bposter0=this._cathode,this.bposter1=this._anode06,this.bposter2=this._anode3,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.createPosterShape(this.bposter2),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter2.name="bposter2",this.bar1_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bposterX0=new experimentalApparatus.utils.DynamicSprite,this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0",this.bar1_),this.bposterX0.bindinger=this.addBinPoster(this.bposterX0,"bposterX0",this.bar1_),this.bar1_.set_bposter(this.bposter0,this.bposterX0,.019999),this.zuheCompArr.push(this.bar1_),this.bar2_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bposterX1=new experimentalApparatus.utils.DynamicSprite,this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1",this.bar2_),this.bposterX1.bindinger=this.addBinPoster(this.bposterX1,"bposterX1",this.bar2_),this.bar2_.set_bposter(this.bposter1,this.bposterX1,7e-6),this.zuheCompArr.push(this.bar2_),this.bar3_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bposterX2=new experimentalApparatus.utils.DynamicSprite,this.bposter2.bindinger=this.addBinPoster(this.bposter2,"bposter2",this.bar3_),this.bposterX2.bindinger=this.addBinPoster(this.bposterX2,"bposterX2",this.bar3_),this.bar3_.set_bposter(this.bposter2,this.bposterX2,1e-6),this.zuheCompArr.push(this.bar3_);var t=new experimentalApparatus.Electricity.BaseElecWire;t.set_bindingers(this.bposterX0,this.bposter1),this.zuheCompArr.push(t);var e=new experimentalApparatus.Electricity.BaseElecWire;e.set_bindingers(this.bposterX1,this.bposter2),this.zuheCompArr.push(e);var i=new experimentalApparatus.Electricity.BaseElecWire;i.set_bindingers(this.bposterX2,this.bposter0),this.zuheCompArr.push(i),this.bar1_.isBreak=!1,this.bar2_.isBreak=!1,this.bar3_.isBreak=!1,this.isZuHe=!0;var s=this;this.txt_=new egret.TextField,s.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=100,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x,this.txt_.y=this.bposter0.y-170,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.addLabel((this.bar1_.Resistance+this.bar2_.Resistance+this.bar3_.Resistance).toFixed(this.ammeterAccuracy)+"Ω "+this.name)},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.resetPerAmAngle=function(t){this.ammeterMaxValue=t,this._perVolAng=this._totalAngle/this.ammeterMaxValue},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?(this.resetPerAmAngle(.6),this.bposter1.isCon=!0,this.bposter1):this.checkHitPoster(this.bposter2,t,e)?(this.resetPerAmAngle(3),this.bposter2.isCon=!0,this.bposter2):(this.bposter1.isCon&&this.bposter2.isCon&&this.resetPerAmAngle(3),null)},s.setCurrentMaxValue=function(t){void 0!=t&&(this.ammeterMaxValue=t,this._perVolAng=this._totalAngle/t)},s.setCurrentValue=function(t){if(void 0!=t){this.currentValue=Math.abs(t);var e=Math.ceil(this.currentValue*this._perVolAng);e>this._totalAngle&&(this.isDamaged=!0,e=0,console.log(this.currentValue,"电流表损坏")),0>e&&(console.log(t,"---电流值为负"),e=0),this._pointer.rotation=e}},s.getCurrentValue=function(){return this.currentValue},s.setCurrentVoltage=function(t){void 0!=t&&(this.currentVoltage=t)},s.getProObj=function(){return this.data.ammeterRES=this.ammeterRES,this.data.ammeterAccuracy=this.ammeterAccuracy,this.data.accuracy=this.ammeterAccuracy,this.data.innerRES=this.ammeterRES,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.innerRES&&this.setRES(t.innerRES),t.accuracy&&this.setAccuracy(t.accuracy)},s.dispose=function(){this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e}(EBaseItem);egret.registerClass(Ammeter,"Ammeter");var InfoPanelBase=function(t){function e(){t.call(this),this._data=null,this._item=null,this.typeid=-1,this._preP=new egret.Point(0,0),this._rect=new egret.Rectangle(0,0,265,34)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){},s.isInHeader=function(t,e){if(this._rect){var i=this._btnMove.parent.globalToLocal(t,e);return t=i.x,e=i.y,t>this._rect.x&&t<this._rect.width&&e>this._rect.y&&e<this._rect.height?!0:!1}},s.onDraging=function(t,e){this.x+=t,this.y+=e},s.onDragEnd=function(t){},s.setData=function(t){this._item=t,this._data=t.getProObj()},s.deleteItem=function(){this.visible=!1,this._item&&this._item.itemTop&&(this._item.itemTop.visible=!1)},s.revertItem=function(){},s.dispose=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Component);egret.registerClass(InfoPanelBase,"InfoPanelBase");var AmmeterInfoPanel=function(t){function e(){t.call(this),this._scale=.7,this.skinName="resource/skins/electrics/AmmeterInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this._dropDownList_R.setFun(this.changeFocusRES,this),this._dropDownList_A.setFun(this.changeFocusAccuracy,this),this.panel.proName.text="电流表"},s.changeFocusRES=function(t){this._data.ammeterRES=t,this._item.setRES(t),this._item.getProObj().innerRES=t},s.changeFocusAccuracy=function(t){this._data.ammeterAccuracy=t,this._item.setAccuracy(t),this._item.getProObj().accuracy=t},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[0,"0Ω"],[.5,"0.5Ω"],[1,"1Ω"],[2,"2Ω"],[5,"5Ω"]],s=0,n=0,r=0;r<i.length;r++){var h=i[r];h[0]==this._data.ammeterRES&&(s=r)}this._dropDownList_R.setData(i,s);for(var o=[[1,"1"],[2,"2"],[3,"3"]],r=0;r<o.length;r++){var h=o[r];h[0]==this._data.ammeterAccuracy&&(n=r)}this._dropDownList_A.setData(o,n)},s.deleteitem=function(e){t.prototype.deleteItem.call(this)},e}(InfoPanelBase);egret.registerClass(AmmeterInfoPanel,"AmmeterInfoPanel");var BatteryElec=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,2,"ElecPower"),this.deviceID=++e.uniqueID,this.name="电池"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;i.textAlign=egret.HorizontalAlign.CENTER,e.addChild(i),i.width=this.width+50,i.height=20,i.selectable=!1,i.size=18,i.x=this.bposter0.x-30,i.y=this.bposter0.y-75,i.text=t,i.touchEnabled=!1,this.label=i},s.setWorkPower=function(t){this.label.text=this.Resistance.toFixed(1)+"Ω 1.5V "+this.name,t&&(this.txt_.text=t.toFixed(3)+" V")},s.setInternalRES=function(t){this.Resistance=t,0==t&&(this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.diyChanged()},s.getBinders=function(){var t=[{item:this,node:this._anode},{item:this,node:this._cathode}];return t},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_elcS"),this._anode=this.spr.getImage("anode"),this._cathode=this.spr.getImage("cathode"),this._anode.touchEnabled=!0,this._cathode.touchEnabled=!0,this._anode.type="out",this._cathode.type="in",this._anode.name="红线",this._cathode.name="蓝线",this._anode.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1),this._anode.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._cathode.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},s.initPoster=function(){this.bposter0=this._cathode,this.bposter1=this._anode,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1"),this.bposter0.bindinger.set_myroad(this.bposter1.bindinger,1),this.bposter0.body=this.bposter1.body=this,this.Power=1.5;var t=this;this.addLabel("0Ω 1.5V "+this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x+15,this.txt_.y=this.bposter0.y-45,this.txt_.size=18,this.txt_.text="0V",this.txt_.touchEnabled=!1,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,this.data.batteryRES=this.Resistance},s.onTouchBegin=function(t){this.ro=!0,this._anode.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._cathode.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._anode.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this._cathode.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this._anode.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._cathode.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._anode.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this._cathode.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.checkDraw=function(t,e){return this._anode.hitTestPoint(t,e)?this._anode:this._cathode.hitTestPoint(t,e)?this._cathode:null},s.setCopyData=function(t){this.data=t,this.setInternalRES(t.batteryRES)},s.dispose=function(){this._anode.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._cathode.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e}(EBaseItem);egret.registerClass(BatteryElec,"BatteryElec");var BatteryElecInfoPanel=function(t){function e(){t.call(this),this._scale=.7,this.skinName="resource/skins/electrics/BatteryInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.panel.panel1.tite.text="高级设置",this._dropDownList_R.setFun(this.changeFocusRES,this),this.panel.proName.text="电池"},s.changeFocusRES=function(t){this._data.batteryRES=t,this._item.setInternalRES(t),this._item.getProObj().RES=t},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[0,"0Ω"],[.1,"0.1Ω"],[.2,"0.2Ω"],[.5,"0.5Ω"],[1,"1Ω"],[2,"2Ω"]],s=0,n=0;n<i.length;n++){var r=i[n];if(r[0]==this._data.batteryRES){s=n;break}}this._dropDownList_R.setData(i,s)},s.deleteitem=function(){t.prototype.deleteItem.call(this)},s.Inversion=function(){t.prototype.revertItem.call(this)},e}(InfoPanelBase);egret.registerClass(BatteryElecInfoPanel,"BatteryElecInfoPanel");var BatteryGroupElec=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,2,"ElecPower"),this.voltage=3,this.deviceID=++e.uniqueID,this.name="电池组"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=210,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x+0,i.y=this.bposter0.y-95,i.text=t,i.touchEnabled=!1,this.label=i},s.setWorkPower=function(t){this.label.text=this.Resistance.toFixed(1)+"Ω "+this.Power+"V 电池组",this.txt_.text=t.toFixed(3)+" V\n"+(t/this.Resistance).toFixed(3)+" A"},s.setVoltage=function(t){switch(this.Power=t,t){case 3:this._battery.gotoAndStop(0);break;case 4.5:this._battery.gotoAndStop(1);break;case 6:this._battery.gotoAndStop(2)}this.diyChanged()},s.setRES=function(t){this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,t>0&&(this.Resistance=t),this.diyChanged()},s.getBinders=function(){var t=[{item:this,node:this._anode},{item:this,node:this._cathode}];return t},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_batgspr"),this._battery=this.spr.getMovie("batt"),this._battery.gotoAndStop(0),this._anode=this._battery.getImage("anode"),this._cathode=this._battery.getImage("cathode"),this._anode.touchEnabled=!0,this._cathode.touchEnabled=!0,this._anode.type="out",this._cathode.type="in",this._anode.name="红线",this._cathode.name="蓝线",this._anode.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},s.initPoster=function(){this.bposter0=this._cathode,this.bposter1=this._anode,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1"),this.bposter0.bindinger.set_myroad(this.bposter1.bindinger,1),this.bposter0.body=this.bposter1.body=this,this.Power=3;var t=this;this.addLabel("0Ω 3.0V "+this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=140,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x+40,this.txt_.y=this.bposter0.y-70,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?this.bposter1:null},s.getProObj=function(){return this.data.batteryGroupVol=this.Power,this.data.batteryGroupRES=this.Resistance,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,this.setVoltage(t.batteryGroupVol),this.setRES(t.Resistance)},s.dispose=function(){this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e}(EBaseItem);egret.registerClass(BatteryGroupElec,"BatteryGroupElec");var BatteryGroupElecInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/BatteryGroupInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.panel2.setH(this.group2.height),this.panel.panel2.proGroup.addChild(this.group2),this.group2.x=0,this.group2.y=0,this.panel.panel2.tite.text="高级设置",this._dropDownList_V.setFun(this.changeFocusVoltage,this),this._dropDownList_R.setFun(this.changeFocusRES,this),this.panel.proName.text="电池组"},s.changeFocusVoltage=function(t){this._data.batteryGroupVol=t,this._item.setVoltage(t),this._item.getProObj().voltage=t},s.changeFocusRES=function(t){this._data.batteryGroupRES=t,this._item.setRES(t),this._item.getProObj().innerRES=t},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[3,"3V"],[4.5,"4.5V"],[6,"6V"]],s=0,n=0;n<i.length;n++){var r=i[n];r[0]==this._data.batteryGroupVol&&(s=n)}this._dropDownList_V.setData(i,s);for(var i=[[0,"0Ω"],[.1,"0.1Ω"],[.2,"0.2Ω"],[.5,"0.5Ω"],[1,"1Ω"],[2,"2Ω"]],h=0,n=0;n<i.length;n++){var o=i[n];if(o[0]==this._data.batteryGroupRES){h=n;break}}this._dropDownList_R.setData(i,h)},s.btnDelete=function(){t.prototype.deleteItem.call(this)},s.btnInvert=function(){t.prototype.revertItem.call(this)},e}(InfoPanelBase);egret.registerClass(BatteryGroupElecInfoPanel,"BatteryGroupElecInfoPanel");var CircuitDiagramInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/CircuitDiagramPanel.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this),this.name="circuit",this.maxWidth=MainView.mainRect[2]-MainView.mainRect[0],this.maxHeight=MainView.mainRect[3]-MainView.mainRect[1]}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickView,this),this.border=new egret.Sprite,this.addChild(this.border),this.scaleItem=new PannelScaleBase(this),this.scaleItem.initScaleItem(this.border,this.box1,this.box2,this.box3,this.box4),this.scaleItem.resizeMe(this.width,this.height),this.delete_btn.enabled=!1},s.TLResize=function(t,e){this.x+=t,this.y+=e,t>0?this.width-=Math.abs(t):this.width+=Math.abs(t),e>0?this.height-=Math.abs(e):this.height+=Math.abs(e),this.scaleItem.resizeMe(this.width,this.height),this._dianlutuView.resizeMe(this.width,this.height-this._btnMove.height)},s.TRResize=function(t,e){this.y+=e,t>0?this.width+=Math.abs(t):this.width-=Math.abs(t),e>0?this.height-=Math.abs(e):this.height+=Math.abs(e),this.scaleItem.resizeMe(this.width,this.height),this._dianlutuView.resizeMe(this.width,this.height-this._btnMove.height)},s.BLResize=function(t,e){this.x+=t,t>0?this.width-=Math.abs(t):this.width+=Math.abs(t),e>0?this.height+=Math.abs(e):this.height-=Math.abs(e),this.scaleItem.resizeMe(this.width,this.height),this._dianlutuView.resizeMe(this.width,this.height-this._btnMove.height)},s.BRResize=function(t,e){t>0?this.width+=Math.abs(t):this.width-=Math.abs(t),e>0?this.height+=Math.abs(e):this.height-=Math.abs(e),this.scaleItem.resizeMe(this.width,this.height),this._dianlutuView.resizeMe(this.width,this.height-this._btnMove.height)},s.onClickView=function(t){var e=t.target;switch(e){case this.delete_btn:this._dianlutuView.deleteItem();break;case this.big_btn:this._dianlutuView.scaleGrid(!0);break;case this.small_btn:this._dianlutuView.scaleGrid(!1);break;case this._btnClosed:this.dispose();break;case this._dianlutuView._interArea:this._dianlutuView.changeSelectItem(null),this._dianlutuView.changeSelectLine(null)}},s.destroyAll=function(){this._dianlutuView.destroyAll()},s.dispose=function(){this.visible=!1},e}(DataPanelBase);egret.registerClass(CircuitDiagramInfoPanel,"CircuitDiagramInfoPanel");var LampBulb=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,3,"ElecLamp"),this.ratedVoltage=3,this.ratedPower=3.6,this.deviceID=++e.uniqueID,this.name="标准灯泡"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=200,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-20,i.y=this.bposter0.y-75,i.text=t,i.touchEnabled=!1,this.label=i},s.setWorkPower=function(t){this.label.text=this.Resistance.toFixed(1)+"Ω "+this.name;var e=Math.abs(t);if(e&&0!=e){this.txt_.text=t.toFixed(3)+" V "+(t/this.Resistance).toFixed(3)+" A";Math.abs(t/this.Resistance),Math.abs(this.ratedPower/this.ratedVoltage);this._lampLight.alpha=e/this.ratedVoltage}else this._lampLight.alpha=0},s.setRatedVoltage=function(t){this.ratedVoltage=t,this.Resistance=this.ratedVoltage*this.ratedVoltage/this.ratedPower,this.diyChanged()},s.setRatedPower=function(t){this.ratedPower=t,this.Resistance=this.ratedVoltage*this.ratedVoltage/this.ratedPower,this.diyChanged()},s.getBinders=function(){var t=[{item:this,node:this._anode},{item:this,node:this._cathode}];return t},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_lamph"),this._lamp=this.spr.getMovie("lamp"),this._lamp.gotoAndStop(0),this._lampLight=this._lamp.getImage("lamp"),this._lampLight.alpha=0,this._anode=this.spr.getImage("anode"),this._cathode=this.spr.getImage("cathode"),this._anode.touchEnabled=!0,this._cathode.touchEnabled=!0,this._anode.type="out",this._cathode.type="in",this._anode.name="红线",this._cathode.name="蓝线",this._anode.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)
},s.initPoster=function(){this.bposter0=this._anode,this.bposter1=this._cathode,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1");var t=this;this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=170,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-10,this.txt_.y=this.bposter0.y-55,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=this.ratedVoltage*this.ratedVoltage/this.ratedPower,this.addLabel(this.Resistance.toFixed(1)+"Ω "+this.name)},s.lightLamp=function(t){t?this._lamp.gotoAndStop(1):this._lamp.gotoAndStop(0)},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?this.bposter1:null},s.getProObj=function(){return this.data.lampVol=this.ratedVoltage,this.data.lampPower=this.ratedPower,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.voltage&&this.setRatedVoltage(t.voltage),t.pwork&&this.setRatedPower(t.pwork)},s.dispose=function(){this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e}(EBaseItem);egret.registerClass(LampBulb,"LampBulb");var LampBulbInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/LampInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this._dropDownList_V.setFun(this.changeFocusVol,this),this._dropDownList_W.setFun(this.changeFocusPower,this),this.panel.proName.text="标准灯泡"},s.changeFocusVol=function(t){this._data.lampVol=t,this._item.setRatedVoltage(t),this._item.getProObj().voltage=t},s.changeFocusPower=function(t){this._data.lampPower=t,this._item.setRatedPower(t),this._item.getProObj().pwork=t},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[2.5,"2.5V"],[3,"3V"],[6,"6V"],[12,"12V"],[220,"220V"]],s=1,n=2,r=0;r<i.length;r++){var h=i[r];if(h[0]==this._data.lampRES){s=r;break}}this._dropDownList_V.setData(i,s);for(var o=[[.75,"0.75W"],[.9,"0.9W"],[3.6,"3.6W"],[10,"10W"],[25,"25W"],[60,"60W"],[100,"100W"]],r=0;r<o.length;r++){var a=o[r];if(a[0]==this._data.lampPower){n=r;break}}this._dropDownList_W.setData(o,n)},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(InfoPanelBase);egret.registerClass(LampBulbInfoPanel,"LampBulbInfoPanel");var Resistance=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,3,"ElecLamp"),this._res=5,this.deviceID=++e.uniqueID,this.name="定值电阻"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=200,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-45,i.y=this.bposter0.y-80,i.text=t,i.touchEnabled=!1,this.label=i},s.setWorkPower=function(t){this.label.text=this.Resistance.toFixed(1)+"Ω "+this.name,this.txt_.text=t.toFixed(3)+" V\n"+(t/this.Resistance).toFixed(3)+" A"},s.setInternalRES=function(t){this.Resistance=t,0==t&&(this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.diyChanged()},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_res"),this.onAdd(null)},s.getBinders=function(){var t=[{item:this,node:this._anode},{item:this,node:this._cathode}];return t},s.onAdd=function(t){this._anode=this.spr.getImage("anode"),this._cathode=this.spr.getImage("cathode"),this._anode.touchEnabled=!0,this._cathode.touchEnabled=!0,this._anode.type="out",this._cathode.type="in",this._anode.name="红线",this._cathode.name="蓝线",this._anode.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},s.initPoster=function(){this.bposter0=this._cathode,this.bposter1=this._anode,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1");var t=this;this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=150,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-30,this.txt_.y=this.bposter0.y-60,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=this._res,this.addLabel(this.Resistance+"Ω "+this.name)},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?this.bposter1:null},s.getProObj=function(){return this.data.resRES=this.Resistance,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.RES&&this.setInternalRES(t.RES)},s.dispose=function(){this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e}(EBaseItem);egret.registerClass(Resistance,"Resistance");var ResistanceBox=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,3,"ElecLamp"),this.RBoxData=0,this.RBoxData1=0,this.RBoxData2=0,this.RBoxData3=0,this.RBoxData4=0,this._perOM_Angle=36,this.coords=new egret.Point,this._maxAngleValue=270,this._boundaryA=0,this._boundaryB=180,this._boundary_A=-180,this._boundary_B=-90,this.deviceID=++e.uniqueID,this.name="四旋钮电阻箱"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=200,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-this.width-40,i.y=this.bposter0.y-260,i.text=t,i.touchEnabled=!1,this.label=i},s.setWorkPower=function(t){this.label.text=this.Resistance.toFixed(1)+"Ω "+this.name,this.txt_.text=t.toFixed(3)+" V\n"+(t/this.Resistance).toFixed(3)+" A"},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_fourB"),this.onAdd(null)},s.getBinders=function(){var t=[{item:this,node:this._anode},{item:this,node:this._cathode}];return t},s.onAdd=function(t){this._anode=this.spr.getImage("anode"),this._cathode=this.spr.getImage("cathode"),this._anode.touchEnabled=!0,this._cathode.touchEnabled=!0,this._anode.type="out",this._cathode.type="in",this._anode.name="红线",this._cathode.name="蓝线",this._anode.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this);for(var e=1;5>e;e++)this["knob"+e]=this.spr.getImage("knob"+e),this["knob"+e].touchEnabled=!0,this["knob"+e].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onbegin,this)},s.initPoster=function(){this.bposter0=this._cathode,this.bposter1=this._anode,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1");var t=this;this.addLabel("0Ω "+this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=150,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-this.width-10,this.txt_.y=this.bposter0.y-230,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?this.bposter1:null},s.dispose=function(){this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this);for(var e=1;5>e;e++)this["knob"+e].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onbegin,this);t.prototype.dispose.call(this)},s.onbegin=function(t){this.ro=!0;for(var e=1;5>e;e++)this["knob"+e].addEventListener(egret.TouchEvent.TOUCH_MOVE,this.OnMove,this),this["knob"+e].addEventListener(egret.TouchEvent.TOUCH_END,this.onPU,this),this["knob"+e].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onPU,this)},s.OnMove=function(t){var e=t.target.name;this[e].parent.localToGlobal(this[e].x,this[e].y,this.coords);var i=t.stageX-this.coords.x,s=t.stageY-this.coords.y,n=180*Math.atan2(s,i)/Math.PI;switch(e){case"knob1":this.RBoxData1=this.knobHandle(this.knob1,n);break;case"knob2":this.RBoxData2=this.knobHandle(this.knob2,n);break;case"knob3":this.RBoxData3=this.knobHandle(this.knob3,n);break;case"knob4":this.RBoxData4=this.knobHandle(this.knob4,n)}this.RBoxData=100*this.RBoxData1+this.RBoxData2+10*this.RBoxData3+1e3*this.RBoxData4},s.knobHandle=function(t,e){var i=Math.floor(e/30);e=30*i,(e>=this._boundaryA&&e<=this._boundaryB||e<=this._boundary_B&&e>=this._boundary_A)&&(t.rotation=e);var s=0;if(i>=0)s=i;else switch(i){case-6:s=6;break;case-5:s=7;break;case-4:s=8;break;case-3:case-2:s=9}return s},s.onPU=function(t){this.ro=!1;for(var e=1;5>e;e++)this["knob"+e].removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.OnMove,this),this["knob"+e].removeEventListener(egret.TouchEvent.TOUCH_END,this.onPU,this),this["knob"+e].removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onPU,this);this.data.knobRotation=[this.knob1.rotation,this.knob2.rotation,this.knob3.rotation,this.knob4.rotation],this.data.boxDatas=[this.RBoxData1,this.RBoxData2,this.RBoxData3,this.RBoxData4],this.data.RBoxData=this.RBoxData,this.Resistance=this.RBoxData,this.diyChanged()},s.getProObj=function(){return t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.RBoxData&&(this.Resistance=this.RBoxData=t.RBoxData),t.knobRotation&&(this.knob1.rotation=t.knobRotation[0],this.knob2.rotation=t.knobRotation[1],this.knob3.rotation=t.knobRotation[2],this.knob4.rotation=t.knobRotation[3]),t.boxDatas&&(this.RBoxData1=this.data.boxDatas[0],this.RBoxData2=this.data.boxDatas[1],this.RBoxData3=this.data.boxDatas[2],this.RBoxData4=this.data.boxDatas[3]),this.label.text=this.Resistance.toFixed(1)+"Ω "+this.name},s.getBRoxdata=function(){return this.RBoxData},e.uniqueID=0,e}(EBaseItem);egret.registerClass(ResistanceBox,"ResistanceBox");var ResistanceBoxInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/ResistanceBoxInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnDelete,this),this.proName.text="电阻箱"},s.btnDelete=function(){t.prototype.deleteItem.call(this)},e}(InfoPanelBase);egret.registerClass(ResistanceBoxInfoPanel,"ResistanceBoxInfoPanel");var ResistanceInfoPanel=function(t){function e(){t.call(this),this._scale=.7,this.skinName="resource/skins/electrics/ResistanceInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this._dropDownList_R.setFun(this.changeFocusRES,this),this.panel.proName.text="定值电阻"},s.changeFocusRES=function(t){this._data.resRES=t,this._item.setInternalRES(t),this._item.getProObj().RES=t},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[5,"5Ω"],[10,"10Ω"],[15,"15Ω"],[20,"20Ω"],[50,"50Ω"],[100,"100Ω"]],s=0,n=0;n<i.length;n++){var r=i[n];if(r[0]==this._data.resRES){s=n;break}}this._dropDownList_R.setData(i,s)},s.deleteitem=function(){t.prototype.deleteItem.call(this)},s.Inversion=function(){t.prototype.revertItem.call(this)},e}(InfoPanelBase);egret.registerClass(ResistanceInfoPanel,"ResistanceInfoPanel");var SPDTSwitch=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,3,"ElecSinglePloeDoubleThrowSwitch"),this.SPDTSdata=!1,this.bposter2=null,this.type=0,this.ammeterAccuracy=1,this.coords=new egret.Point,this._flagType=-1,this.deviceID=++e.uniqueID,this.name="单刀双掷开关"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=160,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x,i.y=this.bposter0.y-130,i.text=t,i.touchEnabled=!1,this.label=i},s.caculateOver=function(){var t=0,e=0,i=0;1==this.bar2_.isBreak&&0==this.bar1_.isBreak?(t=this.bar1_.tempPower,e=this.bar1_.tempElec,i=this.bar1_.Resistance):0==this.bar2_.isBreak&&1==this.bar1_.isBreak&&(t=this.bar2_.tempPower,e=this.bar2_.tempElec,i=this.bar2_.Resistance),this.txt_.text=t.toFixed(this.ammeterAccuracy)+" V\n"+e.toFixed(this.ammeterAccuracy)+" A",this.label.text=i.toFixed(this.ammeterAccuracy)+"Ω "+this.name},s.setWorkPower=function(t){var e=this.bar1_.Resistance+this.bar2_.Resistance;this.label.text=e.toFixed(1)+"Ω 双掷开关",this.label.width=this.label.textWidth,this.txt_.text=t.toFixed(3)+"V "+(t/this.Resistance).toFixed(3)+" A"},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_spdt"),this.onAddbagin(null),this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE},s.getBinders=function(){var t=[{item:this,node:this._anode},{item:this,node:this._cathode_L},{item:this,node:this._cathode_R}];return t},s.onAddbagin=function(t){this.knife=this.spr.getImage("knife"),this.knife.touchEnabled=!0,this.knife.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._anode=this.spr.getImage("anode"),this._cathode_L=this.spr.getImage("cathode_L"),this._cathode_R=this.spr.getImage("cathode_R"),this._anode.touchEnabled=!0,this._cathode_L.touchEnabled=!0,this._cathode_R.touchEnabled=!0,this._anode.type="out",this._cathode_L.type="in",this._cathode_R.type="in",this._anode.name="红线",this._cathode_L.name="蓝线",this._cathode_R.name="蓝线",this._anode.item=this,this._cathode_L.item=this,this._cathode_R.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1,this.bposter2),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},s.initPoster=function(){this.bposter0=this._anode,this.bposter1=this._cathode_L,this.bposter2=this._cathode_R,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.createPosterShape(this.bposter2),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter2.name="bposter2",this.bar1_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar1_.name=this.name+"bar1_",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0",this.bar1_),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1",this.bar1_),this.bar1_.set_bposter(this.bposter0,this.bposter1,this.Resistance),this.zuheCompArr.push(this.bar1_),this.bar2_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar2_.name=this.name+"bar2_";var t=new experimentalApparatus.utils.DynamicSprite;t.bindinger=this.addBinPoster(t,"bposterX1",this.bar2_),this.bposter2.bindinger=this.addBinPoster(this.bposter2,"bposter2",this.bar2_),this.bar2_.set_bposter(t,this.bposter2,this.Resistance),this.zuheCompArr.push(this.bar2_);var e=new experimentalApparatus.Electricity.BaseElecWire;e.set_bindingers(this.bposter1,t),this.zuheCompArr.push(e),this.bar1_.isBreak=!0,this.bar2_.isBreak=!0,this.isZuHe=!0;var i=this;this.addLabel("0Ω "+this.name),this.txt_=new egret.TextField,i.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=140,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x,this.txt_.y=this.bposter0.y-100,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTOUbagin=function(t){this.ro=!0,ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onmove,this),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onend,this)},s.onmove=function(t){this.knife.parent.localToGlobal(this.knife.x,this.knife.y,this.coords);var e=t.stageX-this.coords.x,i=t.stageY-this.coords.y,s=180*Math.atan2(i,e)/Math.PI;s>0&&50>s?(s=0,this.SPDTSdata=!0):s>50?(s=-177,this.SPDTSdata=!0):this.SPDTSdata=!1,this.knife.rotation=s+23,this.ro=!0},s.kaiguanChange=function(){return this.type=0,this.knife.rotation>=11?(console.log("双掷开关--右边闭合"),this.type=2,this._flagType=2,this.bar1_.isBreak=!0,this.bar2_.isBreak=!1,void this.diyChanged()):void(this.knife.rotation<=-145?(console.log("双掷开关--左边闭合"),this._flagType=1,this.type=1,this.bar1_.isBreak=!1,this.bar2_.isBreak=!0,this.diyChanged()):(console.log("断开"),this.type=0,this._flagType=-1,this.bar1_.isBreak=!0,this.bar2_.isBreak=!0,this.diyChanged()))},s.onend=function(t){this.ro=!1,ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onmove,this),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onend,this),this.kaiguanChange()},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?this.bposter1:this.checkHitPoster(this.bposter2,t,e)?this.bposter2:null},s.dispose=function(){this._anode.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._cathode_L.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._cathode_R.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e}(EBaseItem);egret.registerClass(SPDTSwitch,"SPDTSwitch");var SPDTSwitchInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/SPDTSwitchInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnDelete,this),this.proName.text="双掷开关"},s.btnDelete=function(){t.prototype.deleteItem.call(this)},e}(InfoPanelBase);egret.registerClass(SPDTSwitchInfoPanel,"SPDTSwitchInfoPanel");var SPSTSwitch=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,3,"ElecSinglePloeSingleThrowSwitch"),this.SPSTSdata=!1,this._gobPos=new egret.Point,this.deviceID=++e.uniqueID,this.name="单刀单掷开关"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=180,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-30,i.y=this.bposter0.y-130,i.text=t,i.touchEnabled=!1,this.label=i},s.setWorkPower=function(t){this.label.text=this.Resistance.toFixed(1)+"Ω "+this.name,t&&(this.txt_.text=t.toFixed(3)+"V "+(t/this.Resistance).toFixed(3)+"A")},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_dkdz"),this.onAddStage(null),this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE},s.getBinders=function(){var t=[{item:this,node:this._anode},{item:this,node:this._cathode}];return t},s.onAddStage=function(t){this.hand=this.spr.getImage("hand"),this.hand.touchEnabled=!0,this.hand.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.TouchBegin,this),this._anode=this.spr.getImage("anode"),this._cathode=this.spr.getImage("cathode"),this._anode.touchEnabled=!0,this._cathode.touchEnabled=!0,this._anode.type="out",this._cathode.type="in",this._anode.name="红线",this._cathode.name="蓝线",this._anode.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},s.initPoster=function(){this.bposter0=this._cathode,this.bposter1=this._anode,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1"),this.bindPosterAry=[this.bposter0,this.bposter1],this.isBreak=!0;var t=this;this.addLabel("0Ω "+this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=140,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x,this.txt_.y=this.bposter0.y-100,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?this.bposter1:null},s.dispose=function(){this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.hand.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.TouchBegin,this),t.prototype.dispose.call(this)},s.TouchBegin=function(t){ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.TouchMove,this),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.TouchEnd,this)},s.TouchMove=function(t){this.hand.parent.localToGlobal(this.hand.x,this.hand.y,this._gobPos);var e=this._gobPos.x-t.stageX,i=this._gobPos.y-t.stageY,s=180*Math.atan2(i,e)/Math.PI;0>s?s=0:s>45&&(s=45),10>s?this.SPSTSdata=!0:this.SPSTSdata=!1,this.hand.rotation=s-20,this.hand.rotation<-5?this.isBreak&&this.kaiguanChange(!1):this.isBreak||this.kaiguanChange(!0),this.ro=!0},s.kaiguanChange=function(t){t?(this.isBreak=!0,this.bposter0.bindinger.clear_myroad()):(this.isBreak=!1,this.bposter0.bindinger.set_myroad(this.bposter1.bindinger,0)),this.diyChanged()},s.TouchEnd=function(t){this.ro=!1,ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.TouchMove,this),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.TouchEnd,this)},s.getSPSTSdata=function(){return this.SPSTSdata},e.uniqueID=0,e}(EBaseItem);egret.registerClass(SPSTSwitch,"SPSTSwitch");var SPSTSwitchInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/SPSTSwitchInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnDelete,this),this.proName.text="单掷开关"},s.btnDelete=function(){t.prototype.deleteItem.call(this)},e}(InfoPanelBase);egret.registerClass(SPSTSwitchInfoPanel,"SPSTSwitchInfoPanel");var SlideRheostat=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,3,"ElecSlideRheostat"),this.RESMaxValue=20,this.currentRESValue=0,this.slidePosition=0,this.bposter2=null,this.bposter3=null,this.isShowElec=!1,this.res=20,this.bar1_=null,this.bar2_=null,this.bar3_=null,this.bar4_=null,this._slideGloPos=new egret.Point,this.deviceID=++e.uniqueID,this.name="滑动变阻器"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=150,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x,i.y=this.bposter0.y-130,i.text=t,i.touchEnabled=!1,this.label=i},s.setWorkPower=function(t){console.log(t,"------呼呼呼呼")},s.setMaxRES=function(t){this.RESMaxValue=t,this.setRESMaxValue(t),this.Resistance=this.currentRESValue,this.res=t,this.diyChanged()},s.setRES=function(t){this.currentRESValue=this.Resistance=this.RESMaxValue*t/100,this.setSlidePosition(t),this.diyChanged()},s.getBinders=function(){var t=[{item:this,node:this._anode_L},{item:this,node:this._anode_R},{item:this,node:this._cathode_L},{item:this,node:this._cathode_R}];return t},s.init=function(i){void 0===i&&(i="tri_png"),t.prototype.init.call(this,"spr_slid"),this._slide=this.spr.getImage("slid"),this._slide.touchEnabled=!0,e._slideOriX=this._slide.x,this._slide.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._anode_L=this.spr.getImage("anode_L"),this._anode_R=this.spr.getImage("anode_R"),this._cathode_L=this.spr.getImage("cathode_L"),this._cathode_R=this.spr.getImage("cathode_R"),this._anode_L.touchEnabled=!0,this._anode_R.touchEnabled=!0,this._cathode_L.touchEnabled=!0,this._cathode_R.touchEnabled=!0,this._anode_L.type="out",this._anode_R.type="out",this._cathode_L.type="in",this._cathode_R.type="in",this._anode_L.value="L",this._anode_R.value="R",this._cathode_L.value="L",this._cathode_R.value="R",this._anode_L.name="红线",this._anode_R.name="蓝线",this._cathode_L.name="红线",this._cathode_R.name="蓝线",this._anode_L.item=this,this._anode_R.item=this,this._cathode_L.item=this,this._cathode_R.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1,this.bposter2,this.bposter3),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchLineBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchLineBegin,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchLineBegin,this),this.bposter3.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchLineBegin,this)},s.initPoster=function(){this.bposter0=this._anode_L,this.bposter1=this._anode_R,this.bposter2=this._cathode_L,this.bposter3=this._cathode_R,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.createPosterShape(this.bposter2),this.createPosterShape(this.bposter3),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter2.name="bposter2",this.bposter3.name="bposter3",this.isZuHe=!0;var t=new experimentalApparatus.utils.DynamicSprite,e=new experimentalApparatus.utils.DynamicSprite,i=new experimentalApparatus.utils.DynamicSprite,s=new experimentalApparatus.utils.DynamicSprite;this.bar1_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar1_.name="bar1",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0",this.bar1_),t.bindinger=this.addBinPoster(t,"bposterX0",this.bar1_),this.bar1_.set_bposter(this.bposter0,t,experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.zuheCompArr.push(this.bar1_),this.bar2_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar2_.name="bar2",this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1",this.bar2_),e.bindinger=this.addBinPoster(e,"bposterX1",this.bar2_),this.bar2_.set_bposter(this.bposter1,e,experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.zuheCompArr.push(this.bar2_),this.bar3_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar3_.name="bar3",this.bposter2.bindinger=this.addBinPoster(this.bposter2,"bposter2",this.bar3_),i.bindinger=this.addBinPoster(i,"bposterX2",this.bar3_),this.bar3_.set_bposter(this.bposter2,i,experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.zuheCompArr.push(this.bar3_),this.bar4_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar4_.name="bar4",this.bposter3.bindinger=this.addBinPoster(this.bposter3,"bposter3",this.bar4_),s.bindinger=this.addBinPoster(s,"bposterX3",this.bar4_),this.bar4_.set_bposter(this.bposter3,s,experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.zuheCompArr.push(this.bar4_);
var n=new experimentalApparatus.Electricity.BaseElecWire;n.set_bindingers(this.bar1_.bposter1,this.bar2_.bposter1),this.zuheCompArr.push(n);var r=new experimentalApparatus.Electricity.BaseElecWire;r.set_bindingers(this.bar1_.bposter1,this.bar3_.bposter1),this.zuheCompArr.push(r);var h=new experimentalApparatus.Electricity.BaseElecWire;h.set_bindingers(this.bar2_.bposter1,this.bar4_.bposter1),this.zuheCompArr.push(h),n.bposter0.bindinger.friendPostersArr.push(r.bposter0.bindinger),r.bposter0.bindinger.friendPostersArr.push(n.bposter0.bindinger),n.bposter1.bindinger.friendPostersArr.push(h.bposter0.bindinger),h.bposter0.bindinger.friendPostersArr.push(n.bposter1.bindinger),this.bar1_.bposter1.bindinger.friendPostersArr.push(r.bposter0.bindinger),this.bar2_.bposter1.bindinger.friendPostersArr.push(h.bposter0.bindinger),this.set_poster_connect(0);var o=this;this.txt_=new egret.TextField,o.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=140,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x,this.txt_.y=this.bposter0.y-105,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.addLabel("0Ω "+this.name),this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE},s.caculateOver=function(){this.freshMaskPa()},s.freshMaskPa=function(){Math.abs(this.bar1_.tempElec)>0||Math.abs(this.bar2_.tempElec)>0?this.isShowElec=!0:this.isShowElec=!1;var t=0,e=0;return this.isShowElec?(0!=this.bar1_.tempElec&&0!=this.bar2_.tempElec&&Math.abs(Math.abs(this.bar1_.tempElec)-Math.abs(this.bar2_.tempElec))<1e-6?t=this.RESMaxValue:Math.abs(this.bar1_.tempElec)>Math.abs(this.bar2_.tempElec)?(0!=this.bar1_.tempElec&&(t=this.bar1_.Resistance,e=Math.abs(this.bar1_.tempPower)),0!=this.bar2_.tempElec):(0!=this.bar2_.tempElec&&(t=this.bar2_.Resistance,e=Math.abs(this.bar2_.tempPower)),0!=this.bar1_.tempElec),this.txt_.text=e.toFixed(1)+"V "+(e/t).toFixed(3)+"A",this.Resistance=t,void(this.label.text=t.toFixed(1)+"Ω "+this.name)):(this.label.text=this.currentRESValue.toFixed(1)+"Ω "+this.name,void(this.txt_.text="0V 0A"))},s.set_poster_connect=function(t){this.bar1_.Resistance=Math.max(1e-5,this.res*t/100),this.bar2_.Resistance=Math.max(1e-5,this.res*(100-t)/100)},s.onTouchLineBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLineEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLineEnd,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLineEnd,this),this.bposter3.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLineEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchLineEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchLineEnd,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchLineEnd,this),this.bposter3.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchLineEnd,this)},s.onTouchLineEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLineEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLineEnd,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLineEnd,this),this.bposter3.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLineEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchLineEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchLineEnd,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchLineEnd,this),this.bposter3.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchLineEnd,this)},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?this.bposter1:this.checkHitPoster(this.bposter2,t,e)?this.bposter2:this.checkHitPoster(this.bposter3,t,e)?this.bposter3:null},s.onTouchBegin=function(t){this.ro=!0,this._sX=t.stageX,this._slide.parent.localToGlobal(this._slide.x,this._slide.y,this._slideGloPos),this._oX=this._sX-this._slideGloPos.x,ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},s.onTouchMove=function(t){var i=this._slide.parent.globalToLocal(t.stageX-this._oX,0);this._slide.x=i.x,this._slide.x<=e._slideOriX?this._slide.x=e._slideOriX:this._slide.x>e._slideOriX+e._slideLength&&(this._slide.x=e._slideOriX+e._slideLength);var s=(this._slide.x-e._slideOriX)/e._slideLength*100;this.slidePosition=s,this.currentRESValue=this.RESMaxValue*s/100,this.currentRESValue<=0&&(this.currentRESValue=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.dispatchEventWith("slideRESChange",!1,this.slidePosition),this.set_poster_connect(s)},s.onTouchEnd=function(t){this.ro=!1,ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this);var i=(this._slide.x-e._slideOriX)/e._slideLength*100;this.slidePosition=i,this.currentRESValue=this.RESMaxValue*i/100,this.dispatchEventWith("slideRESChange",!1,this.slidePosition),this.diyChanged()},s.setRESMaxValue=function(t){void 0!=t&&(this.RESMaxValue=t);var i=this.RESMaxValue,s=i/e._slideLength;this.currentRESValue=(this._slide.x-e._slideOriX)*s},s.setSlidePosition=function(t){void 0!=t&&(this.slidePosition=t);var i=e._slideOriX,s=this.slidePosition/100,n=e._slideLength*s;i+=n,this._slide.x=i,this.set_poster_connect(t)},s.getProObj=function(){return this.data.slideRheostatMaxRES=this.RESMaxValue,this.data.slideRheostatPosition=this.slidePosition,this.data.slidePercent=this.slidePosition,this.data.maxRES=this.RESMaxValue,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.maxRES&&this.setMaxRES(t.maxRES),t.slidePercent&&this.setSlidePosition(t.slidePercent),this.currentRESValue=t.maxRES*t.slidePercent/100,this.caculateOver()},s.dispose=function(){this._slide.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchLineBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchLineBegin,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchLineBegin,this),this.bposter3.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchLineBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e._slideLength=140,e._slideOriX=0,e}(EBaseItem);egret.registerClass(SlideRheostat,"SlideRheostat");var SlideRheostatInfoPanel=function(t){function e(){t.call(this),this._scale=.7,this.skinName="resource/skins/electrics/SlideRheostatInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this._dropDownList_MaxR.setFun(this.changeFocusMaxRES,this),this._dropDownList_Pos.setFun(this.changeFocusPosition,this),this.panel.proName.text="滑动变阻器"},s.changeFocusMaxRES=function(t){this._data.slideRheostatMaxRES=t,this._item.setMaxRES(t),this._item.getProObj().maxRES=t},s.changeFocusPosition=function(t){this._data.slideRheostatPosition=t,this._item.setRES(t),this._item.getProObj().slidePercent=t},s.changePos=function(t){this._dropDownList_Pos.setCurLabel(t.data+"%"),this._item.getProObj().slidePercent=t.data},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[5,"5Ω"],[10,"10Ω"],[20,"20Ω"],[50,"50Ω"],[200,"200Ω"],[1e3,"1000Ω"],[1e4,"10000Ω"],[1e5,"100000Ω"]],s=2,n=0;n<i.length;n++){var r=i[n];r[0]==this._data.slideRheostatMaxRES&&(s=n)}this._dropDownList_MaxR.setData(i,s);for(var h=[[0,"0%"],[20,"20%"],[33,"33%"],[50,"50%"],[67,"67%"],[75,"75%"]],o=0,n=0;n<h.length;n++){var r=h[n];r[0]==this._data.slideRheostatPosition&&(o=n)}this._dropDownList_Pos.setData(h,o),this._item.slidePosition&&this._dropDownList_Pos.setCurLabel(this._item.slidePosition+"%"),this._item.addEventListener("slideRESChange",this.changePos,this)},s.btnDelete=function(){t.prototype.deleteItem.call(this)},e}(InfoPanelBase);egret.registerClass(SlideRheostatInfoPanel,"SlideRheostatInfoPanel");var SourceItem=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"rect_png")},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.setCopy=function(t){},s.getProObj=function(){return{}},e}(EBaseItem);egret.registerClass(SourceItem,"SourceItem");var StudentPower=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,2,"ElecPower"),this.voltage=0,this._angle=0,this._angleIncrement=0,this._perAngleV=15,this._knobPosition=new egret.Point,this._boundaryA=0,this._boundaryB=180,this._boundary_A=-125,this._boundary_B=-180,this._circleAngle=360,this._maxV=16,this.deviceID=++e.uniqueID,this.name="学生电源"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=220,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-i.width/2-20,i.y=this.bposter0.y-190,i.text=t,i.touchEnabled=!1,this.label=i},s.setWorkPower=function(t){this.label.text=this.Resistance.toFixed(1)+"Ω "+this.Power+"V "+this.name,this.txt_.text=t.toFixed(3)+" V\n"+(t/this.Resistance).toFixed(3)+" A"},s.setVol=function(t){this.Power=t,this.voltage=t,this.diyChanged(),this.setCurrentVol(t)},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_stdP"),this.onAddToStage(null),this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE},s.getBinders=function(){var t=[{item:this,node:this._anode},{item:this,node:this._cathode}];return t},s.onAddToStage=function(t){this._knob=this.spr.getImage("knob"),this._knob.touchEnabled=!0,this._anode=this.spr.getImage("anode"),this._anode.touchEnabled=!0,this._cathode=this.spr.getImage("cathode"),this._cathode.touchEnabled=!0,this._anode.type="out",this._cathode.type="in",this._anode.name="红线",this._cathode.name="蓝线",this._anode.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onLineATouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onLineATouchBegin,this),this._knob.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},s.initPoster=function(){this.bposter0=this._cathode,this.bposter1=this._anode,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1"),this.bposter0.bindinger.set_myroad(this.bposter1.bindinger,1),this.bposter0.body=this.bposter1.body=this,this.Power=0;var t=this;this.addLabel("0Ω 0.0V "+this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=160,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-this.txt_.width/2-20,this.txt_.y=this.bposter0.y-170,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1},s.onLineATouchBegin=function(t){this.ro=!0,console.log("vvvv"),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onLineATouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onLineATouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onLineATouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onLineATouchEnd,this)},s.onLineATouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onLineATouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onLineATouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onLineATouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onLineATouchEnd,this)},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?this.bposter1:null},s.onTouchBegin=function(t){this.ro=!0,this._knob.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._knob.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._knob.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchMove=function(t){this._knob.parent.localToGlobal(this._knob.x,this._knob.y,this._knobPosition);var e=t.stageX-this._knobPosition.x,i=t.stageY-this._knobPosition.y;this._angleIncrement=Math.atan2(i,e)*(this._circleAngle/2)/Math.PI,(this._angleIncrement>=this._boundaryA&&this._angleIncrement<=this._boundaryB||this._angleIncrement<=this._boundary_A&&this._angleIncrement>=this._boundary_B)&&(this._knob.rotation=this._angleIncrement),this.voltage=this._knob.rotation/this._perAngleV,this._angleIncrement<=this._boundary_A&&this._angleIncrement>=this._boundary_B&&(this.voltage=(this._circleAngle+this._knob.rotation)/this._perAngleV),this.voltage<0&&(this.voltage=this._maxV),this.voltage<.099&&(this.voltage=0),this.voltage=parseFloat(this.voltage.toFixed(2))},s.onTouchEnd=function(t){this.ro=!1,this.setPowerData(),this.data.knobRotation=this._knob.rotation,this.data.voltage=this.voltage,this.data.knobPositon=[this._knobPosition.x,this._knobPosition.y]},s.setPowerData=function(){this.voltage&&(this.voltage=parseFloat(this.voltage.toFixed(2))),this.voltage<.1&&(this.voltage=0),this.voltage=Math.floor(parseFloat(this.voltage.toFixed(1))),this.Power=this.voltage,this.dispatchEventWith("studentPower",!1,this.Power),this._knob.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._knob.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._knob.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.diyChanged()},s.setCurrentVol=function(t){this._knob.rotation=t*this._perAngleV},s.getVoltage=function(){return this.voltage},s.getProObj=function(){return this.data.stpVol=this.Power,this.data.voltage=this.Power,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,this._knob.rotation=t.knobRotation,this.voltage=t.voltage,this.setPowerData(),this.setVol(t.stpVol)},s.dispose=function(){this._knob.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onLineATouchBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onLineATouchBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e}(EBaseItem);egret.registerClass(StudentPower,"StudentPower");var StudentPowerInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/StudentPowerInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.panel.panel1.tite.text="常用设置",this.panel.proName.text="学生电源",this._dropDownList_V.setFun(this.setFocusVol,this)},s.setFocusVol=function(t){this._data.stpVol=t,this._item.setVol(t),this._item.getProObj().vol=t},s.changeVol=function(t){this._dropDownList_V.setCurLabel(t.data+"V")},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[0,"0V"],[1,"1V"],[2,"2V"],[3,"3V"],[5,"5V"],[10,"10V"],[11,"11V"],[12,"12V"],[13,"13V"],[15,"15V"],[16,"16V"]],s=0,n=0;n<i.length;n++){var r=i[n];if(r[0]==this._data.stpVol){s=n;break}}this._dropDownList_V.setData(i,s),this._item.Power!=this._data.stpVol&&this._dropDownList_V.setCurLabel(this._item.Power+"V"),this._item.addEventListener("studentPower",this.changeVol,this)},s.btnDelete=function(){t.prototype.deleteItem.call(this)},e}(InfoPanelBase);egret.registerClass(StudentPowerInfoPanel,"StudentPowerInfoPanel");var Voltmeter=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,4,""),this.voltmeterRES=1e6,this.voltmeterMaxValue=3,this.voltmeterAccuracy=1,this.isDamaged=!1,this._totalAngle=108,this._perVolAng=0,this.bposter2=null,this.bar1_=null,this.bar2_=null,this.mmR=3e6,this.isLinkError=!1,this.deviceID=++e.uniqueID,this.name="电压表"+this.deviceID}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this;this.label=new egret.TextField,e.addChild(this.label),this.label.textAlign=egret.HorizontalAlign.CENTER,this.label.width=200,this.label.height=20,this.label.size=18,this.label.selectable=!1,this.label.x=this.bposter0.x-40,this.label.y=this.bposter0.y-180,this.label.text=t,this.label.touchEnabled=!1},s.caculateOver=function(){if(this.isLinkError=!1,1!=this.bar1_.isBreak){if(this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter1.bindinger.friendPostersArr.length>1&&this.bposter2.bindinger.friendPostersArr.length>0)return this.isLinkError=!0,void console.log("连接电压表错误");var t,e=this.bar1_.tempPower+this.bar2_.tempPower,i=this.bar1_.tempElec+this.bar2_.tempElec;this.realV=e,this.realA=i,this.txt_.text=e.toFixed(this.voltmeterAccuracy)+" V\n"+i.toFixed(this.voltmeterAccuracy)+" A",t=this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter1.bindinger.friendPostersArr.length>1&&this.bposter2.bindinger.friendPostersArr.length>0?this.bar1_.Resistance+this.bar2_.Resistance:this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter1.bindinger.friendPostersArr.length>1&&this.bposter2.bindinger.friendPostersArr.length<=0?this.bar1_.Resistance:this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter1.bindinger.friendPostersArr.length<=1&&this.bposter2.bindinger.friendPostersArr.length>0?this.bar1_.Resistance+this.bar2_.Resistance:this.bar1_.Resistance+this.bar2_.Resistance,this.setCurrentVoltage(e)}},s.setWorkPower=function(t){},s.setRES=function(t){0==t&&(t=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE),this.bar1_.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,this.bar2_.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter1.bindinger.friendPostersArr.length>1&&this.bposter2.bindinger.friendPostersArr.length>0?this.bar1_.Resistance=t:this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter1.bindinger.friendPostersArr.length>1?this.bar1_.Resistance=t:this.bposter0.bindinger.friendPostersArr.length>0&&this.bposter2.bindinger.friendPostersArr.length>0?this.bar2_.Resistance=t:this.bar1_.Resistance=t,this.voltmeterRES=t,this.label.text=(5*t).toFixed(this.voltmeterAccuracy)+"Ω "+this.name,this.diyChanged()},s.setAccuracy=function(t){this.voltmeterAccuracy=t,this.diyChanged()},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_vol"),this.onAddToStage(null)},s.getBinders=function(){var t=[{item:this,node:this._cathode},{item:this,node:this._anode3},{item:this,node:this._anode15}];return t},s.onAddToStage=function(t){this._pointer=this.spr.getImage("pointer"),this._anode15=this.spr.getImage("anode_15"),this._anode15.touchEnabled=!0,this._anode3=this.spr.getImage("anode_3"),this._anode3.touchEnabled=!0,this._cathode=this.spr.getImage("cathode"),this._cathode.touchEnabled=!0,this._anode3.type="out",this._anode3.value="3",this._anode15.type="out",this._anode15.value="0.6",this._cathode.type="in",this._anode3.name="红线",this._anode15.name="蓝线",this._cathode.name="蓝线",this._anode3.item=this,this._anode15.item=this,this._cathode.item=this,this.initPoster(),this._nodeArr.push(this.bposter0,this.bposter1,this.bposter2),this.voltmeterMaxValue&&(this._perVolAng=this._totalAngle/this.voltmeterMaxValue),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.isCon=!1,this.bposter2.isCon=!1,this.data.accuracy=this.voltmeterAccuracy},s.initPoster=function(){this.bposter0=this._cathode,this.bposter1=this._anode3,this.bposter2=this._anode15,this.createPosterShape(this.bposter0),this.createPosterShape(this.bposter1),this.createPosterShape(this.bposter2),this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter2.name="bposter2",this.bar1_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar1_.name=this.name+"bar1_",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0",this.bar1_),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1",this.bar1_),this.bar1_.set_bposter(this.bposter0,this.bposter1,this.voltmeterRES),this.zuheCompArr.push(this.bar1_),this.bar2_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar2_.name=this.name+"bar2_";var t=new experimentalApparatus.utils.DynamicSprite;t.bindinger=this.addBinPoster(t,"bposterX1",this.bar2_),this.bposter2.bindinger=this.addBinPoster(this.bposter2,"bposter2",this.bar2_),this.bar2_.set_bposter(t,this.bposter2,4*this.voltmeterRES),this.zuheCompArr.push(this.bar2_);var e=new experimentalApparatus.Electricity.BaseElecWire;e.name=this.name+"wire1",e.set_bindingers(this.bposter1,t),this.zuheCompArr.push(e),this.isZuHe=!0;var i=this;this.txt_=new egret.TextField,i.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=100,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x,this.txt_.y=this.bposter0.y-160,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.addLabel((this.bar1_.Resistance+this.bar2_.Resistance).toFixed(this.voltmeterAccuracy)+"Ω "+this.name)},s.deassignData=function(t,e){void 0===e&&(e=!1);var i=t,s=i[0];s>1e4?this.mmR=3e6:this.mmR=s,this.bar1_.Resistance=this.mmR,this.bar2_.Resistance=4*this.mmR,this.diyChanged()},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter2.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.resetPerVolAngle=function(t){this.voltmeterMaxValue=t,this._perVolAng=this._totalAngle/this.voltmeterMaxValue},s.checkDraw=function(t,e){return this.checkHitPoster(this.bposter0,t,e)?this.bposter0:this.checkHitPoster(this.bposter1,t,e)?(this.resetPerVolAngle(3),this.bposter1.isCon=!0,this.bposter1):this.checkHitPoster(this.bposter2,t,e)?(this.resetPerVolAngle(15),this.bposter2.isCon=!0,this.bposter2):(this.bposter1.isCon&&this.bposter2.isCon&&this.resetPerVolAngle(3),null)},s.setCurrentMaxValue=function(t){void 0!=t&&(this.voltmeterMaxValue=t,this._perVolAng=this._totalAngle/t)},s.setCurrentVoltage=function(t){if(void 0!=t){this.currentVoltage=Math.abs(t);var e=Math.ceil(this.currentVoltage*this._perVolAng);e>this._totalAngle&&(this.isDamaged=!0,e=0,console.log(this.currentVoltage,"电压表损坏")),0>e&&(console.log(t,"---电压值为负"),e=0),this._pointer.rotation=e}},s.getCurrentVoltage=function(){return this.currentVoltage},s.getProObj=function(){return this.data.voltmeterRES=this.voltmeterRES,this.data.voltmeterAccuracy=this.voltmeterAccuracy,this.data.innerRES=this.voltmeterRES,this.data.accuracy=this.voltmeterAccuracy,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.innerRES&&this.setRES(t.innerRES),t.accuracy&&this.setAccuracy(t.accuracy)},s.dispose=function(){this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter2.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.prototype.dispose.call(this)},e.uniqueID=0,e}(EBaseItem);egret.registerClass(Voltmeter,"Voltmeter");var VoltmeterInfoPanel=function(t){function e(){t.call(this),this._scale=.7,this.skinName="resource/skins/electrics/VoltmeterInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this._dropDownList_R.setFun(this.changeFocusRES,this),this._dropDownList_A.setFun(this.changeFocusAccuracy,this),this.panel.proName.text="电压表"},s.changeFocusRES=function(t){this._data.voltmeterRES=t,this._item.setRES(t),this._item.getProObj().innerRES=t},s.changeFocusAccuracy=function(t){this._data.voltmeterAccuracy=t,this._item.setAccuracy(t),this._item.getProObj().accuracy=t},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[1e5,"500000Ω"],[1e3,"5000Ω"],[2e3,"10000Ω"],[5e3,"25000Ω"],[1e4,"50000Ω"],[1e6,"5000000"]],s=i.length-1,n=0,r=0;r<i.length;r++){var h=i[r];if(h[0]==this._data.voltmeterRES){s=r;break}}this._dropDownList_R.setData(i,s);for(var o=[[1,"1"],[2,"2"],[3,"3"]],r=0;r<o.length;r++){var h=o[r];if(h[0]==this._data.voltmeterAccuracy){n=r;break}}this._dropDownList_A.setData(o,n)},s.btnDelete=function(){t.prototype.deleteItem.call(this)},e}(InfoPanelBase);egret.registerClass(VoltmeterInfoPanel,"VoltmeterInfoPanel");var Wire=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initPoster=function(){var t=this;this.iElecInter=1,this.classname="ElecWire",this.bposter0=new experimentalApparatus.Electricity.BindMC("h1_mc",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("h2_mc",this),this.bposter0.x=-50,this.bposter1.x=50,this.h1_mc=this.bposter0,this.h2_mc=this.bposter1,this._line=new egret.Sprite,this._line.graphics.lineStyle(this.data.weight,this.data.drawColor),this._line.touchEnabled=!0,this.addChild(this._line),t.addChild(this.bposter0),t.addChild(this.bposter1),this._curvArr.push(new egret.Point(this.bposter0.x,0),new egret.Point(this.bposter1.x,0))},s.downFunc=function(t){t.bindinger.friendPostersArr.length>0||this.addEventListener(egret.Event.ENTER_FRAME,this.enterFraneHandle,this)},s.upHandleFunc=function(t){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFraneHandle,this);t.bindinger.nearToBinding();this.linkeChanged()},s.enterFraneHandle=function(t){var e=this._curvArr[0],i=this._curvArr[1];e.x=this.bposter0.x,e.y=this.bposter0.y,i.x=this.bposter1.x,i.y=this.bposter1.y,this.drawLine()},s.setWireColor=function(t){this.data.lineColor=t,this.updateColor()},s.updateColor=function(){this._line.graphics.clear(),this.drawLine()},s.drawLine=function(){this._curvArr[0],this._curvArr[1];this._line.graphics.clear(),this._line.graphics.lineStyle(this.data.weight,this.data.lineColor),this._line.graphics.moveTo(this.bposter0.x,this.bposter0.y),this._line.graphics.lineTo(this.bposter1.x,this.bposter1.y)},s.Position=function(t){var e=this._curvArr[0],i=this._curvArr[1];e.x=this.bposter0.x,e.y=this.bposter0.y,i.x=this.bposter1.x,i.y=this.bposter1.y,this.drawLine(),this.x=t[0],this.y=t[1]},s.checkLine=function(t,e){if(this._startItem.node&&this._endItem.node)return!1;if(this.checkHitPoster(this.bposter0,t,e))return this._controlerIndex=0,!0;if(this.checkHitPoster(this.bposter1,t,e))return this._controlerIndex=1,!0;if(this._line.hitTestPoint(t,e,!0)){for(var i,s=10,n=new egret.Point(t,e),r=0;r<this._curvArr.length;r++)if(i=this._curvArr[r],egret.Point.distance(n,i)<s)return this._controlerIndex=r,!0;return this._controlerIndex=-1,!0}return!1},s.modifyLineMoving=function(t,e,i){0==this._controlerIndex?(this.bposter0.x+=e,this.bposter0.y+=i):(this.bposter1.x+=e,this.bposter1.y+=i);var s=this._curvArr[0],n=this._curvArr[1];s.x=this.bposter0.x,s.y=this.bposter0.y,n.x=this.bposter1.x,n.y=this.bposter1.y,this.drawLine()},s.modifyLineEnd=function(t,e,i){i&&(0==this._controlerIndex&&(this._startItem.item=e,this._startItem.node=i),this._controlerIndex==this._curvArr.length-1&&(this._endItem.item=e,this._endItem.node=i),this._line.graphics.clear(),this.drawLine()),this.bposter0.bindinger.nearToBinding(),this.bposter1.bindinger.nearToBinding(),this.linkeChanged(),this.openProPanel(),this._controlerIndex=-1},s.updateAllCurv=function(t,e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var n,r=0;r<this._curvArr.length;r++)i&&0==r||s&&r==this._curvArr.length-1||(n=this._curvArr[r],n.x+=t,n.y+=e);var h=this._curvArr[0],o=this._curvArr[1];this.bposter0.x=h.x,this.bposter0.y=h.y,this.bposter1.x=o.x,this.bposter1.y=o.y,this._line.graphics.clear(),this.drawLine()},s.initWireItem=function(t){this._startItem.item&&(this.data.startElecid=this._startItem.item.elecID,this.data.startNodeName=this.getProName(this._startItem.item,this._startItem.node)),this._endItem.item&&(this.data.endElectid=this._endItem.item.elecID,this.data.endNodeName=this.getProName(this._endItem.item,this._endItem.node)),this._curvArr=t.drawData;var e=this._curvArr[0],i=this._curvArr[1];this.bposter0.x=e.x,this.bposter0.y=e.y,this.bposter1.x=i.x,this.bposter1.y=i.y,this._line.graphics.clear(),this.drawLine(),this.bposter0.bindinger.nearToBinding(),this.bposter1.bindinger.nearToBinding(),this.linkeChanged(),this.data=t},s.getProObj=function(){return this.data.drawData=this._curvArr,this.cls="DrawLineItem",this.infoCls="WireInfoPanel",this.typeid=3011,this.data.cls=this.cls,this.data.x=this.x,this.data.y=this.y,this.data.typeid=this.typeid,this.data.infoCls=this.infoCls,this.data.iElecInter=this.iElecInter,this.elecID=this.UID,this.data.elecID=this.elecID,this.data},e}(DrawLineItem);egret.registerClass(Wire,"Wire");var WireInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/WireInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnDelete0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteLine,this),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this._dropListColor.setFun(this.changeColor,this),this.panel.proName.text="导线"},s.changeColor=function(t){this._data.color=t,this._item.setWireColor&&this._item.setWireColor(t),this._item.updateColor&&(this._item.data.lineColor=t,this._item.updateColor()),this._item.getProObj().color=t},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[ElectricsConst.COLOR_WIRE_RED,"红色"],[ElectricsConst.COLOR_WIRE_SILVER,"银色"],[ElectricsConst.COLOR_WIRE_BLACK,"黑色"]],s=0,n=0;n<i.length;n++){var r=i[n];
r[0]==this._data.color&&(s=n)}this._dropListColor.setData(i,s)},s.btnDelete=function(t){this.deleteItem()},s.deleteLine=function(){this._item.dispose(),this.deleteItem(),this._item&&this._item.diyChanged()},e}(InfoPanelBase);egret.registerClass(WireInfoPanel,"WireInfoPanel");var ElectromagUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.getMagConfig=function(t){var e=RES.getRes("electromag_json");for(var i in e)if(e[i].type==t)return e[i];return null},t}();egret.registerClass(ElectromagUtils,"ElectromagUtils");var ArrayUtil=com.adobe.utils.ArrayUtil,ElectromagView=function(t){function e(e){t.call(this,e,!1),this._currentInfoPanel=null,this.allCompArr=[],this.staCompArr=[]}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initUI=function(){t.prototype.initUI.call(this),MessageCenter.getInstance().addListener(ItemEventConst.ADD_ITEM,this.addItem,this),MessageCenter.getInstance().addListener(ItemEventConst.COPY_ITEM,this.copyItem,this)},s.addItem=function(t,e){if(t.cls&&LightUtils.isInRect(e)){var i,s=egret.getDefinitionByName(t.cls);i=new s(null,this),i.typeid=t.type,i.cls=t.cls,i.infoCls=t.infoCls,i.config=t,i.Position(e),this.itemContainer.addChildAt(i,0)}},s.copyItem=function(t){var e=ElectromagUtils.getMagConfig(t.type);if(e){var i,s=egret.getDefinitionByName(e.cls);i=new s(null,this),i.typeid=e.type,i.cls=e.cls,i.infoCls=e.infoCls,i.config=e,i.Position([t.x+50,t.y]),this.itemContainer.addChild(i),i.setCopy(t)}},s.showInfoPanel=function(t,e){this._currentInfoPanel!=t?(this._currentInfoPanel&&(this._currentInfoPanel.visible=!1,this._currentInfoPanel=null),this._currentInfoPanel=t,this._currentInfoPanel.setData(e),this._currentInfoPanel.visible=!0):this._currentInfoPanel._item!=e?(this._currentInfoPanel.setData(e),this._currentInfoPanel.visible=!0):this._currentInfoPanel.visible=this._currentInfoPanel.visible?!1:!0},s.getInfoPanel=function(t,e){for(var i,s=0;s<this.panelContainer.numChildren;s++)if(i=this.panelContainer.getChildAt(s),i.typeid==t)return i;if(""==e)return console.log("属性面板缺失"),null;var n=egret.getDefinitionByName(e);return i=new n,i.typeid=t,i.x=MainView.mainRect[2]-i.width,i.y=MainView.mainRect[1]+48,this.panelContainer.addChild(i),i},s.dispose=function(){for(t.prototype.dispose.call(this);this.itemContainer.numChildren>0;)this.itemContainer.removeChildAt(0);for(;this.panelContainer.numChildren>0;)this.panelContainer.removeChildAt(0)},s.removeEvents=function(){MessageCenter.getInstance().removeListener(ItemEventConst.ADD_ITEM,this.addItem,this),MessageCenter.getInstance().removeListener(ItemEventConst.COPY_ITEM,this.copyItem,this)},e}(BasePhyView);egret.registerClass(ElectromagView,"ElectromagView");var Vector2DMath=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}var e=__define,i=t,s=i.prototype;return s.add=function(t){return this.x+=t.x,this.y+=t.y,this},e(s,"length",function(){return Math.sqrt(this.x*this.x+this.y*this.y)},function(t){var e=this.angle;this.x=t*Math.cos(e),this.y=t*Math.sin(e)}),e(s,"angle",function(){return this.isZero()?0:Math.atan2(this.y,this.x)},function(t){var e=this.length;this.x=e*Math.cos(t),this.y=e*Math.sin(t)}),s.isZero=function(){return Math.abs(this.x)<t.EPSILON&&Math.abs(this.y)<t.EPSILON},s.dist_XY=function(t,e){var i=t-this.x,s=e-this.y;return Math.sqrt(i*i+s*s)},s.distSquared_XY=function(t,e){var i=t-this.x,s=e-this.y;return i*i+s*s},t.EPSILON=1e-7,t}();egret.registerClass(Vector2DMath,"Vector2DMath");var MagnetBar=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(MagnetBar,"MagnetBar");var StaticMagBC=function(t){function e(e,i){t.call(this,e,i),this.infoPanel=null,this.typeid=-1,this.infoCls=null,this.bodyArr=[],this.isZuHe=!1,this.zuheCompArrMag=[],this.isYuan=!0,this.isLock=!1,this.allCompArr=[],this.staCompArr=[],this.magPoint=new egret.Point,this.tapView=i}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),this.isZuHe?console.log("这是一个组合组建"):(this.bitMap=new egret.Bitmap,this.bitMap.texture=RES.getRes(e),this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.bitMap.touchEnabled=!0,this.addChild(this.bitMap)),this.bodyArr=[],t.prototype.init.call(this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.openProPanelBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this)},s.openProPanel=function(e){t.prototype.openProPanel.call(this,e),this.tapView&&(this.infoPanel||(this.infoPanel=this.tapView.getInfoPanel(this.typeid,this.infoCls)),null!=this.infoPanel&&this.tapView.showInfoPanel(this.infoPanel,this))},s.Position=function(t){for(var e=0;e<this.bodyArr.length;e++){var i=this.bodyArr[e];i.position=t}this.x=t[0],this.y=t[1]},s.Scale=function(t){},s.setRotation=function(t){for(var e=0;e<this.bodyArr.length;e++){var i=this.bodyArr[e];i.angle=-t*Math.PI/180}this.rotation=-t},s.getProObj=function(){return null},s.dispose=function(){for(var e=0;e<this.bodyArr.length;e++){var i=this.bodyArr[e];this.world.removeBody(i)}this.bodyArr=[],t.prototype.dispose.call(this)},e}(Item);egret.registerClass(StaticMagBC,"StaticMagBC");var MagnetHorseShoe=function(t){function e(e,i){t.call(this,e,i),this.showMagLine=!1,this.magLine=null}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.magLine=new egret.Bitmap(RES.getRes("magLine2_png")),this.magLine.anchorOffsetY=this.magLine.height/2,this.magLine.anchorOffsetX=this.magLine.width/2-60,this.addChild(this.magLine),this.magLine.touchEnabled=!1,this.magLine.visible=!1,t.prototype.init.call(this,"uMagnets0_png")},s.setCopy=function(t){this.changeMagLine(t.showMagLine),this.setRotation(t.rotation)},s.changeMagLine=function(t){this.showMagLine=t,this.magLine.visible=this.showMagLine},s.getProObj=function(){return{type:5001,x:this.x,y:this.y,rotation:-this.rotation,showMagLine:this.showMagLine}},e}(StaticMagBC);egret.registerClass(MagnetHorseShoe,"MagnetHorseShoe");var MagnetHorseShoePanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electromag/MagnetHorseShoeProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.disBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeMagLine,this),this.showBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeMagLine,this),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.dropDownList.setFun(this.changeRotation,this)},s.setData=function(e){t.prototype.setData.call(this,e);var i=[[0,"0°"],[30,"30°"],[45,"45°"],[60,"60°"],[90,"90°"]];this.dropDownList.setData(i,0),this.setRotaLabel(Math.floor(Math.abs(this._item.rotation))),this.panel.proName.text=this._item.config.name,this.disBtn.selected=!1,this.showBtn.selected=!1,this._data.showMagLine?this.showBtn.selected=!0:this.disBtn.selected=!0},s.changeMagLine=function(t){var e=t.currentTarget;e==this.showBtn?this._item.changeMagLine(!0):e==this.disBtn&&this._item.changeMagLine(!1)},s.changeRotation=function(t){this._item.setRotation(t)},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){var e=this._item.getProObj();MessageCenter.getInstance().dispatch(ItemEventConst.COPY_ITEM,e)},s.setRotaLabel=function(t){this.dropDownList.setCurLabel(Math.floor(t)+"°")},s.dispose=function(){t.prototype.dispose.call(this),console.log("remove panel")},e}(InfoPanelBase);egret.registerClass(MagnetHorseShoePanel,"MagnetHorseShoePanel");var MagnetNeedle=function(t){function e(e,i){t.call(this,e,i),this.canFreshMag=!0,this._tInd=0,this._old=0,this.skinName="resource/skins/electromag/MagnetNeedleSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.needle.anchorOffsetX=this.needle.width/2,this.needle.anchorOffsetY=this.needle.height/2,this.MagnetNeedleBG.anchorOffsetY=this.MagnetNeedleBG.height/2,this.MagnetNeedleBG.anchorOffsetX=this.MagnetNeedleBG.width/2,this.MagnetNeedleBG.x=this.MagnetNeedleBG.y=0,this.needle.x=this.needle.y=0,this.MagnetNeedleCover.anchorOffsetX=this.MagnetNeedleCover.width/2,this.MagnetNeedleCover.x=0,this.MagnetNeedleCover.y=-(this.needle.height/2+5),this.needle.touchEnabled=!1},s.init=function(){t.prototype.init.call(this,"MagnetNeedle_bg_png"),this.bitMap.alpha=1e-4},s.getProObj=function(){return{type:5002,x:this.x,y:this.y,rotation:-this.rotation}},s.freshRotation=function(t){t&&0==t.x&&0==t.y?this.canFreshMag=!0:this.canFreshMag=!1;var e,i=Math.atan2(t.y,t.x);e=0==i?0:i+Math.PI/2,this.needle.rotation=e},s.freshMag=function(t){if(this._tInd>=5){if(Math.abs(Math.abs(t)-Math.abs(this._old))<1)return void(this._old=t);this._old=t,this._tInd=0,this.canFreshMag&&(this.needle.rotation=(-90-Math.round(t))/180*Math.PI)}this._tInd++},s.dispose=function(){t.prototype.dispose.call(this)},e}(StaticMagBC);egret.registerClass(MagnetNeedle,"MagnetNeedle");var DrawWireItem=function(t){function e(e){void 0===e&&(e=1044480),t.call(this),this.infoPanel=null,this._prePoint=null,this._preAngle=0/0,this._curvArr=[],this._startItem={item:null,node:null},this._endItem={item:null,node:null},this._controlerIndex=-1,this.elecID=null,this.typeid=-1,this.infoCls=null,this.cls=null,this.data={drawColor:16711680,lineColor:16711680,weight:5},this.node1=null,this.node2=null,this._beginPoint=null,this.data.drawColor=e,this.data.lineColor=e,this.data.weight=ElectricsConst.WEIGHT_WIRE,this.initPoster()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initPoster=function(){var t=this;this.iElecInter=1,this.classname="ElecWire",this.bposter0=new experimentalApparatus.Electricity.BindMC("h1_mc",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("h2_mc",this),this.h1_mc=this.bposter0,this.h2_mc=this.bposter1,this._line=new egret.Sprite,this._line.graphics.lineStyle(this.data.weight,this.data.drawColor),this._line.touchEnabled=!0,this.addChild(this._line),t.addChild(this.bposter0),t.addChild(this.bposter1),this._curvArr=[];for(var e=0;3>e;e++)this._curvArr.push(new egret.Point(0,0))},s.downFunc=function(t){t.bindinger.friendPostersArr.length>0||this.addEventListener(egret.Event.ENTER_FRAME,this.enterFraneHandle,this)},s.upHandleFunc=function(t){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFraneHandle,this);t.bindinger.nearToBinding();this.linkeChanged()},s.updateLine=function(){console.log("onenterframe")},s.enterFraneHandle=function(t){this.updateLine()},s.followLinkObj=function(){},s.linkeChanged=function(){t.prototype.diyChanged.call(this)},s.updateColor=function(){this._line.graphics.clear()},s.openProPanel=function(){this.infoPanel||(this.infoPanel=HomeElectricsView.getInstance().getInfoPanel(3011,"HWireInfoPanel")),HomeElectricsView.getInstance().showInfoPanel(this.infoPanel,this)},s.customDrawLine=function(){this._line.graphics.clear(),this._line.graphics.lineStyle(this.data.weight,this.data.lineColor);var t;t=this._curvArr[0],this._line.graphics.moveTo(t.x,t.y);for(var e=1;3>e;e++)this._curvArr[e]&&(t=this._curvArr[e],this._line.graphics.lineTo(t.x,t.y))},s.startDrawWire=function(t,e,i){this._startItem.item=t,this._startItem.node=e,this._beginPoint=i;var s=e.parent.localToGlobal(e.x,e.y),n=this._curvArr[0];n.x=s.x,n.y=s.y,this.bposter0.x=s.x,this.bposter0.y=s.y},s.movingDraw=function(t){var e=this._curvArr[0],i=this._curvArr[1],s=this._curvArr[2];this._startItem.item instanceof HomeElectric?(t.stageX<=HomeElectric.BOUNDRY_LeftX?e.x=HomeElectric.BOUNDRY_LeftX:e.x=t.stageX,i.x=e.x,i.y=t.stageY):t.stageY>e.y?(i.x=t.stageX,i.y=e.y):(i.x=e.x,i.y=t.stageY),s.x=t.stageX,s.y=t.stageY,this.bposter1.x=s.x,this.bposter1.y=s.y,this.customDrawLine()},s.onEndDraw=function(t,e,i){if(!(e&&e.parent&&i&&i.parent))return void this.dispose();if(this._startItem.item==e)return void this.dispose();var s=i.parent.localToGlobal(i.x,i.y),n=this._curvArr[0],r=this._curvArr[1],h=this._curvArr[2];if(this._startItem.item instanceof HomeElectric)t.stageX<=HomeElectric.BOUNDRY_LeftX+i.gap?(n.x=HomeElectric.BOUNDRY_LeftX+i.gap,h.x=s.x,h.y=s.y,r.x=n.x,r.y=h.y):(n.x=s.x,h.x=s.x,h.y=s.y,r.x=h.x,r.y=h.y);else{var o=this._startItem.node;e instanceof HomeElectric?n.x<=HomeElectric.BOUNDRY_LeftX+o.gap?(t.stageX<=HomeElectric.BOUNDRY_LeftX+o.gap?h.x=HomeElectric.BOUNDRY_LeftX+o.gap:h.x=t.stageX,h.y=s.y,r.x=h.x,r.y=n.y):(h.x=n.x,h.y=s.y,r.x=h.x,r.y=h.y):(h.x=s.x,h.y=s.y,h.y>=n.y?(r.y=n.y,r.x=h.x):(r.y=h.y,r.x=n.x))}this._endItem.item=e,this._endItem.node=i,this._drawWireLine(),this.bposter0.bindinger.nearToBinding(),this.bposter1.bindinger.nearToBinding(),this.linkeChanged()},s.updateDragLine=function(t,e,i){var s=this._curvArr[0],n=this._curvArr[1],r=this._curvArr[2];"end"==i?(r.x+=t,r.y+=e,this._startItem.item instanceof HomeElectric?(s.x+=t,r.x<=HomeElectric.BOUNDRY_LeftX+this._endItem.node.gap?s.x=HomeElectric.BOUNDRY_LeftX+this._endItem.node.gap:s.x=r.x,n.x=s.x,n.y=r.y):r.y>=s.y?(n.y=s.y,n.x=r.x):(n.y=r.y,n.x=s.x)):(s.x+=t,s.y+=e,this._endItem.item instanceof HomeElectric?(r.x+=t,s.x<=HomeElectric.BOUNDRY_LeftX+this._startItem.node.gap?r.x=HomeElectric.BOUNDRY_LeftX+this._startItem.node.gap:r.x=s.x,n.x=r.x,n.y=s.y):r.y>=s.y?(n.y=s.y,n.x=r.x):(n.y=r.y,n.x=s.x)),this._drawWireLine()},s._drawWireLine=function(){this._line.graphics.clear(),this._line.graphics.lineStyle(this.data.weight,this.data.lineColor);var t;t=this._curvArr[0],this._line.graphics.moveTo(t.x,t.y),this.bposter0.x=t.x,this.bposter0.y=t.y;for(var e=1;3>e;e++)this._curvArr[e]&&(t=this._curvArr[e],this._line.graphics.lineTo(t.x,t.y));this.bposter1.x=t.x,this.bposter1.y=t.y},s.getProObj=function(){return this._startItem.item&&this._startItem.node&&this._endItem.item&&this._endItem.node&&(this.data.startElecid=this._startItem.item.elecID,this.data.startNodeName=this.getProName(this._startItem.item,this._startItem.node),this.data.endElectid=this._endItem.item.elecID,this.data.endNodeName=this.getProName(this._endItem.item,this._endItem.node)),this.data.drawData=this._curvArr,this.cls="DrawWireItem",this.infoCls="HWireInfoPanel",this.typeid=3011,this.data.cls=this.cls,this.data.x=this.x,this.data.y=this.y,this.data.typeid=this.typeid,this.data.infoCls=this.infoCls,this.data.iElecInter=this.iElecInter,this.data.bp0X=this.bposter0.x,this.data.bp0Y=this.bposter0.y,this.data.bp1X=this.bposter1.x,this.data.bp1Y=this.bposter1.y,this.elecID=this.UID,this.data.elecID=this.elecID,this.data},s.getProName=function(t,e){return t.bposter0==e?"bposter0":t.bposter1==e?"bposter1":t.bposter2==e?"bposter2":"bposter0"},s.initWireItem=function(t){this.data=t,this._curvArr=t.drawData,this._line.graphics.clear(),this._drawWireLine();var e=this.bposter0.bindinger.nearToBinding(),i=this.bposter1.bindinger.nearToBinding();console.log(e,i),this.linkeChanged()},s.dispose=function(){this._curvArr=null,this._startItem=null,this._endItem=null,this.parent.removeChild(this)},e}(experimentalApparatus.Electricity.BASEElectricity);egret.registerClass(DrawWireItem,"DrawWireItem");var HomeElectricsView=function(t){function e(i){t.call(this,i,!1),this._currentInfoPanel=null,this._drawWireItem=null,this._actionType=-1,this._prePos=new egret.Point,this._switchArr=[],this._dianqiArr=[],this._dianxianArr=[],this._allBindersArr=[],this._huiArr=[],this._firstCacu=!0,this._currentSelectLine=null,ElectricsConst.stage=i,e._instance=this}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){return e._instance},s.initUI=function(){ElectricsConst.initSwf(),this.itemContainer=new egret.Sprite,this.itemContainer.graphics.beginFill(MainView.MainColor),this.itemContainer.graphics.drawRect(MainView.mainRect[0],MainView.mainRect[1],MainView.mainRect[2]-MainView.mainRect[0],MainView.mainRect[3]-MainView.mainRect[1]),this.itemContainer.graphics.endFill(),this.addChildAt(this.itemContainer,0),this.initItemView(),this.panelContainer=new egret.Sprite,this.addChildAt(this.panelContainer,2),this.maskC=new egret.Sprite,this.maskC.graphics.beginFill(65280),this.maskC.graphics.drawRect(MainView.mainRect[0],MainView.mainRect[1],MainView.mainRect[2]-MainView.mainRect[0],MainView.mainRect[3]-MainView.mainRect[1]),this.maskC.graphics.endFill(),this.addChild(this.maskC),this.itemContainer.mask=this.maskC,this.itemContainer.name="elec_equipmentContainer",experimentalApparatus.Electricity.ElecUtil.init_elect_Update(this),MessageCenter.getInstance().addListener(ItemEventConst.ADD_ITEM,this.addItem,this),MessageCenter.getInstance().addListener(ItemEventConst.COPY_ITEM,this.copyItem,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressStage,this)},s.initItemView=function(t){void 0===t&&(t=null),this._homeElectric||(this._homeElectric=new HomeElectric,t?(this._homeElectric.x=t.x,this._homeElectric.y=t.y):(this._homeElectric.x=MainView.mainRect[0]+250,this._homeElectric.y=240),this.itemContainer.addChild(this._homeElectric),this._homeElectric.addEventListener("zhaChange",this.listenerPower,this))},e.showElectView=function(t,e){var i,s;for(var n in e)i=e[n],i.cls?1!=i.iElecInter&&this.initDev(t,i):(t._homeElectric.x=i.x,t._homeElectric.y=i.y,t._homeElectric.elecID=i.elecID,t._homeElectric.setCopyData&&t._homeElectric.setCopyData(i));for(var n in e)i=e[n],1==i.iElecInter&&this.initWire(t,i);for(var r=0;r<t.itemContainer.numChildren;r++)s=t.itemContainer.getChildAt(r),1==s.iElecInter&&this.initNodeItem(t,s,s.data);s&&s instanceof DrawWireItem&&s.linkeChanged()},e.initDev=function(t,e){var i,s=egret.getDefinitionByName(e.cls);i=new s(null,t),i.typeid=e.typeid,i.cls=e.cls,i.infoCls=e.infoCls,i.elecID=e.elecID,i.Position([e.x,e.y]),t.itemContainer.addChild(i),i.setCopyData&&i.setCopyData(e)},e.initWire=function(t,e){var i,s=egret.getDefinitionByName(e.cls);i=new s,i.typeid=e.typeid,i.cls=e.cls,i.infoCls=e.infoCls,i.elecID=e.elecID,t.itemContainer.addChildAt(i,0),i.initWireItem(e)},e.initNodeItem=function(t,e,i){for(var s,n=i.startElecid,r=i.startNodeName,h=i.endElectid,o=i.endNodeName,a=0;a<t.itemContainer.numChildren;a++)s=t.itemContainer.getChildAt(a),s.elecID==n?e._startItem={item:s,node:s[r]}:s.elecID==h&&(e._endItem={item:s,node:s[o]})},s.listenerPower=function(t){var e=t.data;e?console.log(e,"pppOn"):console.log(e,"pppOff"),this.checkConnect(),this.checkComsPower(e)},s.checkComsPower=function(t){for(var e,i=0;i<this.itemContainer.numChildren;i++)e=this.itemContainer.getChildAt(i),e instanceof DrawWireItem||e.getbool&&e.getbool(t)},s.checkConnect=function(){this.getAllComps(),this.getAllDianxian(),this.cacu_huilu(),this.checkPowerChange()},s.checkPowerChange=function(){for(var t,e=0;e<this.itemContainer.numChildren;e++)t=this.itemContainer.getChildAt(e),t instanceof DrawWireItem||t.diyChanged()},s.getAllComps=function(){this._switchArr=[],this._dianqiArr=[],this._allBindersArr=[],this._switchArr.push(HomeElectric.getInstance()),this._allBindersArr=this._allBindersArr.concat(HomeElectric.getInstance().getBinders());for(var t,e=0;e<this.itemContainer.numChildren;e++)t=this.itemContainer.getChildAt(e),t instanceof DrawWireItem||(4012==t.typeid||4013==t.typeid||4014==t.typeid||4015==t.typeid||4016==t.typeid?(this._switchArr.push(t),this._allBindersArr=this._allBindersArr.concat(t._nodeArr)):-1!=t.typeid&&this._dianqiArr.push(t))},s.getAllDianxian=function(){this._dianxianArr=[];for(var t,e=0;e<this.itemContainer.numChildren;e++)t=this.itemContainer.getChildAt(e),t instanceof DrawWireItem&&this._dianxianArr.push(t)},s.cacu_huilu=function(){this._huiArr=CacuManager.cacu_huilu(this._switchArr,this._dianxianArr)},s.itemDraging=function(t,e,i){for(var s,n=0;n<this.itemContainer.numChildren;n++)if(s=this.itemContainer.getChildAt(n),s instanceof DrawWireItem){var r=s._startItem.item,h=s._endItem.item;r==t&&h!=t?s.updateDragLine(e,i,"start"):r!=t&&h==t&&s.updateDragLine(e,i,"end")}},s.hittestObjects=function(t,e){for(var i,s=0;s<this.itemContainer.numChildren;s++)if(i=this.itemContainer.getChildAt(s),!(i instanceof DrawWireItem)&&i.typeid==e&&i.spr.hitTestPoint(t.x,t.y))return i;return null},s.hitTestRectObjs=function(t,e){var i=t.getBounds(),s=t.parent.localToGlobal(t.x,t.y);i.x=s.x,i.y=s.y;for(var n,r=new egret.Point,h=0;h<this.itemContainer.numChildren;h++)if(n=this.itemContainer.getChildAt(h),!(n instanceof DrawWireItem)&&n.typeid==e){n.parent.localToGlobal(n.x,n.y,r);var o=n.getBounds();if(o.x=r.x,o.y=r.y,o.intersects(i))return n}return null},s.showInfoPanel=function(t,e){this._currentInfoPanel!=t?(this._currentInfoPanel&&(this._currentInfoPanel.visible=!1,this._currentInfoPanel=null),this._currentInfoPanel=t,this._currentInfoPanel.setData(e),this._currentInfoPanel.visible=!0):this._currentInfoPanel._item!=e?(this._currentInfoPanel.setData(e),this._currentInfoPanel.visible=!0):this._currentInfoPanel.visible=this._currentInfoPanel.visible?!1:!0},s.getInfoPanel=function(t,e){for(var i,s=0;s<this.panelContainer.numChildren;s++)if(i=this.panelContainer.getChildAt(s),i.typeid==t)return i;var n=egret.getDefinitionByName(e);return i=new n,i.typeid=t,i.x=MainView.mainRect[2]-i.width,i.y=MainView.mainRect[1],this.panelContainer.addChild(i),i},s.copyItem=function(t){var e,i=egret.getDefinitionByName(t.cls);e=new i(null,this),e.typeid=t.typeid,e.cls=t.cls,e.infoCls=t.infoCls,e.Position([t.x,t.y-200]),this.itemContainer.addChild(e),e.setCopyData&&e.setCopyData(t)},s.addItem=function(t,e){if(t.cls&&LightUtils.isInRect(e)){var i,s=egret.getDefinitionByName(t.cls);i=new s(null,this),i.typeid=t.type,i.cls=t.cls,i.infoCls=t.infoCls,i.Position(e),this.itemContainer.addChild(i)}},s.pressStage=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressStage,this),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.upStage,this),this._prePos.x=t.stageX,this._prePos.y=t.stageY;var e=t.target.parent;if(e instanceof HInfoPanelBase&&e.isInHeader(t.stageX,t.stageY))return this._actionType=ElectricsConst.ACTION_DRAG_INFO,void ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this);for(var i=0;i<this.itemContainer.numChildren;i++)if(s=this.itemContainer.getChildAt(i),s instanceof DrawWireItem&&s.hitTestPoint(t.stageX,t.stageY,!0)){this._currentSelectLine=s,this._actionType=ElectricsConst.ACTION_TAP_WIRE;break}for(var s,n,i=0;i<this.itemContainer.numChildren;i++)if(s=this.itemContainer.getChildAt(i),!(s instanceof DrawWireItem)&&s&&(n=s.checkDraw(t.stageX,t.stageY))){ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this);var r=n.parent.localToGlobal(n.x,n.y);return this._drawWireItem=new DrawWireItem(n.color),this.itemContainer.addChildAt(this._drawWireItem,0),this._actionType=ElectricsConst.ACTION_DRAW_NEWLINE,void this._drawWireItem.startDrawWire(s,n,r)}},s.moveStage=function(t){var e,i;switch(this._actionType){case ElectricsConst.ACTION_DRAW_NEWLINE:this._drawWireItem&&this._drawWireItem.movingDraw(t);break;case ElectricsConst.ACTION_DRAG_INFO:this._currentInfoPanel&&(e=t.stageX-this._prePos.x,i=t.stageY-this._prePos.y,this._currentInfoPanel.onDraging(e,i),this._prePos.x=t.stageX,this._prePos.y=t.stageY)}},s.upStage=function(t){var e,i,s;switch(this._actionType){case ElectricsConst.ACTION_DRAW_NEWLINE:if(this._drawWireItem){for(var n=0;n<this.itemContainer.numChildren&&(e=this.itemContainer.getChildAt(n),e instanceof DrawWireItem||!e||(s=this._drawWireItem.bposter1,!(i=e.checkRectHittest(s))));n++);this._drawWireItem.onEndDraw(t,e,i),this._drawWireItem=null}break;case ElectricsConst.ACTION_DRAG_INFO:this._currentInfoPanel&&this._currentInfoPanel.onDragEnd(t);break;case ElectricsConst.ACTION_TAP_WIRE:this._currentSelectLine&&this._currentSelectLine.openProPanel()}this._actionType=ElectricsConst.ACTION_NONE,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.pressStage,this)},s.deleteSelectedLine=function(){this._currentSelectLine&&(this.itemContainer.removeChild(this._currentSelectLine),this._currentSelectLine=null,this.checkConnect(),this.checkPowerChange())},s.dispose=function(){for(this._homeElectric.removeEventListener("zhaChange",this.listenerPower,this),this._homeElectric=null;this.itemContainer.numChildren>0;)this.itemContainer.removeChildAt(0);for(;this.panelContainer.numChildren>0;)this.panelContainer.removeChildAt(0);ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveStage,this),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.upStage,this)},s.removeEvents=function(){MessageCenter.getInstance().removeListener(ItemEventConst.ADD_ITEM,this.addItem,this),MessageCenter.getInstance().removeListener(ItemEventConst.COPY_ITEM,this.copyItem,this)},e._instance=null,e}(BasePhyView);egret.registerClass(HomeElectricsView,"HomeElectricsView");var HBaseItem=function(t){function e(e,i,s,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null),t.call(this),this.infoPanel=null,this.typeid=-1,this.infoCls=null,this.cls=null,this.data=null,this._isPowerOn=!1,this._nodeArr=[],this._jtLine=null,this.powerOn=!0,this.isConnect=!1,this.bposter0=null,this.bposter1=null,this.bposter2=null,this.curPower=0,this.curElec=0,this.elecID=null,this._prePos=new egret.Point,this.tapView=i,this.data={},this.iElecInter=s,this.classname=n,this.elecID=this.UID}__extends(e,t);var i=__define,s=e,n=s.prototype;return i(n,"isPowerOn",function(){return this.powerOn&&this.isConnect}),n.initPoster=function(){},n.createPosterShape=function(t,e,i){void 0===i&&(i=16711680);var s=new egret.Sprite,n=new egret.Shape;return s.addChild(n),DisplayUtil.drawRect(n.graphics,t,e,.2,i),this.addChild(s),n.y=-n.height/2,s},n.set_bposterXY=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=null)},n.set_bposter=function(t,e,i){this.bposter0=t,this.bposter1=e,this.Resistance=i,t.bindinger.set_myroad(e.bindinger,this.Resistance)},n.setWorkPower=function(t){this.curPower=t},n.setWorkElec=function(t){this.curElec=t},n.getBinders=function(){return[]},n.init=function(t){void 0===t&&(t="tri_png"),this.spr=ElectricsConst.electricItem_swf.createSprite(t),this.spr.touchEnabled=!0,this.addChild(this.spr),this.spr.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onBegin,this),this.bitMap=this.spr,this.itemTop=new EItemTop(this),this.addChild(this.itemTop),this.itemTop.setPos(-this.itemTop.width/2,-this.measuredHeight/2-140),this.itemTop.visible=!1,this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.openProPanelBegin,this)},n.checkDraw=function(t,e){return null},n.checkRectHittest=function(t){return null},n.hitTestObjs=function(t,e){if(!t||!e)return!1;var i=t.getBounds(),s=e.getBounds(),n=t.parent.localToGlobal(t.x,t.y),r=e.parent.localToGlobal(e.x,e.y);return i.x=n.x,i.y=n.y,s.x=r.x,s.y=r.y,s.intersects(i)},n.openProPanel=function(){if(this.openPro){for(var t=this.parent.numChildren,e=0;t>e;e++){var i=this.parent.getChildAt(e);i!==this&&i.itemTop&&(i.itemTop.visible=!1)}this.itemTop&&(this.itemTop.visible=!this.itemTop.visible,this.openPro=!1)}this.tapView&&(this.infoPanel||(this.infoPanel=this.tapView.getInfoPanel(this.typeid,this.infoCls)),this.tapView.showInfoPanel(this.infoPanel,this))},n._onBegin=function(t){this._startX=t.stageX,this._startY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.x,this.y,e);this._offX=this._startX-i.x,this._offY=this._startY-i.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._onEnd,this),this._prePos.x=t.stageX,this._prePos.y=t.stageY},n.onMove=function(t){if(this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.ro)return this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),void this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this._onEnd,this);this.x=t.stageX-this._offX,this.y=t.stageY-this._offY;var e=t.stageX-this._prePos.x,i=t.stageY-this._prePos.y;HomeElectricsView.getInstance().itemDraging(this,e,i),this._prePos.x=t.stageX,this._prePos.y=t.stageY},n._onEnd=function(t){this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this._onEnd,this)},n.Position=function(t){this.x=t[0],this.y=t[1]},n.Scale=function(t){},n.revertItem=function(){1==this.spr.scaleX?this.spr.scaleX=-1:this.spr.scaleX=1},n.setRotation=function(t){this.rotation=-t},n.getPosition=function(t){return new egret.Point(t.x,t.y)},n.setPosition=function(t,e){t.x=e.x,t.y=e.y},n.initChaTouDropItem=function(t){t._chaTou.dropItem&&(t._chaTou.removeEventListener("PowerChange",t.getbool,this),t._chaTou.dropItem.currentAppliance=null,t._chaTou.dropItem=null)},n.getProObj=function(){return this.data.x=this.x,this.data.y=this.y,this.data.typeid=this.typeid,this.data.cls=this.cls,this.data.infoCls=this.infoCls,this.data.iElecInter=this.iElecInter,this.elecID=this.UID,this.data.elecID=this.elecID,this.data},n.getLineEnd=function(t,e){if(!e)return null;for(var i=HomeElectricsView.getInstance().itemContainer,s=0;s<i.numChildren;s++){var n=i.getChildAt(s);if(n instanceof DrawWireItem){if(n._startItem.item==t&&n._startItem.node==e)return n._endItem.node;if(n._endItem.item==t&&n._endItem.node==e)return n._startItem.node}}return null},n.dispose=function(){this.spr.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._onBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this._onEnd,this),this.spr=null,this.data=null,this.infoPanel&&(this.infoPanel.visible=!1),HomeElectricsView.getInstance()._currentInfoPanel=null,t.prototype.dispose.call(this),HomeElectricsView.getInstance().checkConnect()},e}(experimentalApparatus.Electricity.BASEElectricity);egret.registerClass(HBaseItem,"HBaseItem");var AirCondition=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._chaTou=null,this._kongTiao=null,this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_air"),this._chaTou=this.spr.getMovie("plug"),this._kongTiao=this.spr.getMovie("air"),this._chaTou.touchEnabled=!0,this._kongTiao.touchEnabled=!0,this._kongTiao.gotoAndStop(0),this._chaTou.gotoAndStop(0),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._kongTiao.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._kongTiao.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null,this._chaTou.addEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),this.drawLine()},s.drawLine=function(){1==this._chaTou.getCurrentFrame()?this._chaTou.anchorOffsetX=0:this._chaTou.anchorOffsetX=-5,this._kongTiao.anchorOffsetY=20;var t=this.getPosition(this._kongTiao),e=new egret.Point(this._chaTou.x,this._kongTiao.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this._kongTiao.parent.localToGlobal(this._kongTiao.x,this._kongTiao.y,this.coords),"air"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target
},s.onTOUmove=function(t){if("air"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this._kongTiao.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._kongTiao.x=e.x,this._kongTiao.y=e.y,this.itemTop.x=this._kongTiao.x-120,this.itemTop.y=this._kongTiao.y-160}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){"air"!=t.target.name&&this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4012);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y+6,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this._kongTiao&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this._kongTiao.x-120,this.itemTop.y=this._kongTiao.y-160},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._chaTou.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&this._kongTiao.gotoAndStop(1),this._chaTou.anchorOffsetX=0):this._chaTou.dropItem?this._kongTiao.gotoAndStop(0):(this._chaTou.gotoAndStop(0),this._kongTiao.gotoAndStop(0),this._chaTou.anchorOffsetX=-5)},s.socketRemoveFromParent=function(){this._chaTou.gotoAndStop(0),this._kongTiao.gotoAndStop(0),this._chaTou.anchorOffsetX=-5,this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(AirCondition,"AirCondition");var HInfoPanelBase=function(t){function e(){t.call(this),this._data=null,this._item=null,this.typeid=-1,this._preP=new egret.Point(0,0),this._rect=new egret.Rectangle(0,0,265,34)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){},s.isInHeader=function(t,e){if(this._rect){var i=this._btnMove.parent.globalToLocal(t,e);return t=i.x,e=i.y,t>this._rect.x&&t<this._rect.width&&e>this._rect.y&&e<this._rect.height?!0:!1}},s.onDraging=function(t,e){this.x+=t,this.y+=e},s.onDragEnd=function(t){},s.setData=function(t){this._item=t,this._data=t.getProObj()},s.deleteItem=function(){this.visible=!1,this._item&&this._item.itemTop&&(this._item.itemTop.visible=!1)},s.revertItem=function(){},s.dispose=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Component);egret.registerClass(HInfoPanelBase,"HInfoPanelBase");var AirConditionInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="空调",this._ratedWorkLab.text="1500W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(AirConditionInfoPanel,"AirConditionInfoPanel");var Bulb=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_bulb"),this._buib=this.spr.getMovie("bulb"),this._buib.gotoAndStop(0),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEND,this),this.topItem=null,this.addEventListener("LampHolderRemove",this.holderRemoveFromParent,this),this.addEventListener("PowerChange",this.getbool,this)},s.onEND=function(t){var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(this.x,this.y-50),4016);if(e&&!e.currentAppliance){this.x=e.x,this.y=e.y+140;var i=this.parent.getChildIndex(this),s=this.parent.getChildIndex(e);this.parent.setChildIndex(this,i>s?s:i),this.parent.setChildIndex(e,s>i?s:i),this.topItem=e,e.currentAppliance=this,this.getbool(!0),e.setTxtInfo(e.Power)}else e&&e.currentAppliance!=this||!e?(this.initBulbDropItem(),this.getbool(!1)):!e||this.x==e.x&&this.y==e.y+140||(this.x=e.x,this.y=e.y+140)},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this.topItem?this.topItem.Power>0&&ElectricBrake.getInstance()._isOpen&&this._buib.gotoAndStop(1):this._buib.gotoAndStop(0)},s.holderRemoveFromParent=function(){this._buib.gotoAndStop(0),this.initBulbDropItem()},s.initBulbDropItem=function(){this.topItem&&(this.topItem.setTxtInfo(0),this.topItem.currentAppliance=null,this.topItem=null)},s.getProObj=function(){return t.prototype.getProObj.call(this),this.data},s.dispose=function(){this.initBulbDropItem(),this.removeEventListener("PowerChange",this.getbool,this),this.removeEventListener("LampHolderRemove",this.holderRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Bulb,"Bulb");var BulbInfoPanel=function(t){function e(){t.call(this),this._scale=.7,this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnDelete,this),this._proName.text="白炽灯",this._workLab.text="",this._volLab.text="",this._ratedVolLab.text="",this._ratedWorkLab.text=""},s.setData=function(e){t.prototype.setData.call(this,e)},s.btnDelete=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(BulbInfoPanel,"BulbInfoPanel");var Cooker=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._chaTou=null,this._fanBao=null,this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_cooker"),this._chaTou=this.spr.getMovie("plug"),this._fanBao=this.spr.getMovie("cooker"),this._chaTou.touchEnabled=!0,this._fanBao.touchEnabled=!0,this._fanBao.gotoAndStop(0),this._chaTou.gotoAndStop(0),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._fanBao.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._fanBao.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null,this._chaTou.addEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),this.drawLine()},s.drawLine=function(){1==this._chaTou.getCurrentFrame()?this._chaTou.anchorOffsetX=0:this._chaTou.anchorOffsetX=-5,this._fanBao.anchorOffsetY=60;var t=this.getPosition(this._fanBao),e=new egret.Point(this._chaTou.x,this._fanBao.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this._fanBao.parent.localToGlobal(this._fanBao.x,this._fanBao.y,this.coords),"cooker"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("cooker"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this._fanBao.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._fanBao.x=e.x,this._fanBao.y=e.y,this.itemTop.x=this._fanBao.x-120,this.itemTop.y=this._fanBao.y-200}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){"cooker"!=t.target.name&&this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4012);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y+6,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this._fanBao&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this._fanBao.x-120,this.itemTop.y=this._fanBao.y-200},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._chaTou.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&this._fanBao.gotoAndStop(1),this._chaTou.anchorOffsetX=0):this._chaTou.dropItem?this._fanBao.gotoAndStop(0):(this._chaTou.gotoAndStop(0),this._fanBao.gotoAndStop(0),this._chaTou.anchorOffsetX=-5)},s.socketRemoveFromParent=function(){this._chaTou.gotoAndStop(0),this._fanBao.gotoAndStop(0),this._chaTou.anchorOffsetX=-5,this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Cooker,"Cooker");var CookerInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="电饭煲",this._ratedWorkLab.text="1000W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(CookerInfoPanel,"CookerInfoPanel");var DoubleControlSwitch=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i,3,"ElecSinglePloeSingleThrowSwitch"),this._isOpen=!1,this._touchZg=null,this._wire1=null,this._wire2=null,this._wire3=null,this._nodeData1=null,this._nodeData2=null,this._nodeData3=null,this.ammeterAccuracy=1,this.isPowerMove=!1,this.name="双控开关"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=160,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-80,i.y=this.bposter0.y-120,i.text=t,i.touchEnabled=!1,this.label=i},s.caculateOver=function(){var t=0,e=0,i=0;1==this.bar2_.isBreak&&0==this.bar1_.isBreak?(t=this.bar1_.tempPower,e=this.bar1_.tempElec,i=this.bar1_.Resistance):0==this.bar2_.isBreak&&1==this.bar1_.isBreak&&(t=this.bar2_.tempPower,e=this.bar2_.tempElec,i=this.bar2_.Resistance),this.txt_.text=t.toFixed(this.ammeterAccuracy)+" V\n"+e.toFixed(this.ammeterAccuracy)+" A",this.label.text=i.toFixed(this.ammeterAccuracy)+"Ω "+this.name},s.setWorkPower=function(t){var e=this.bar1_.Resistance+this.bar2_.Resistance;this.label.text=e.toFixed(1)+"Ω 双控开关",this.label.width=this.label.textWidth,this.txt_.text=t.toFixed(3)+"V "+(t/this.Resistance).toFixed(3)+" A"},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_power"),this._Power=this.spr.getMovie("power"),this._Power.gotoAndStop(0),this._touchZg=this.spr.getImage("touchZone"),this._touchZg.touchEnabled=!0,this._touchZg.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onPowerMove,this),this._touchZg.addEventListener(egret.TouchEvent.TOUCH_END,this.onPowerEnd,this),this._wire1=new egret.Shape,this.addChildAt(this._wire1,0),this._wire2=new egret.Shape,this.addChildAt(this._wire2,0),this._wire3=new egret.Shape,this.addChildAt(this._wire3,0),this._wire1.item=this,this._wire2.item=this,this._wire3.item=this,this.initPoster(),this._nodeArr.push(this._wire1,this._wire2,this._wire3),this._nodeData1={item:this,node:this._wire1},this._nodeData2={item:this,node:this._wire2},this._nodeData3={item:this,node:this._wire3},this.drawBaseLine(),this._wire1.color=ElectricsConst.COLOR_FIREWIRE,this._wire2.color=ElectricsConst.COLOR_FIREWIRE,this._wire3.color=ElectricsConst.COLOR_FIREWIRE,this._wire1.type="line",this._wire2.type="line",this._wire3.type="line",this._wire1.num=0,this._wire2.num=0,this._wire3.num=0},s.initPoster=function(){this.bposter0=new experimentalApparatus.Electricity.BindMC("bposter0",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("bposter1",this),this.bposter2=new experimentalApparatus.Electricity.BindMC("bposter2",this),this.bposter0.touchEnabled=!1,this.bposter1.touchEnabled=!1,this.bposter2.touchEnabled=!1,this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter2.name="bposter2",this.bposter0.color=ElectricsConst.COLOR_NULLWIRE,this.bposter1.color=ElectricsConst.COLOR_FIREWIRE,this.bposter2.color=ElectricsConst.COLOR_FIREWIRE,this.bposter0.item=this,this.bposter1.item=this,this.bposter2.item=this,this.bindPosterAry=[this.bposter0,this.bposter1,this.bposter2],this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,this.bar1_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar1_.name=this.name+"bar1_",this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0",this.bar1_),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1",this.bar1_),this.bar1_.set_bposter(this.bposter0,this.bposter1,this.Resistance),this.zuheCompArr.push(this.bar1_),this.bar2_=new experimentalApparatus.Electricity.BaseElecResistance(this),this.bar2_.name=this.name+"bar2_";var t=new experimentalApparatus.utils.DynamicSprite;t.bindinger=this.addBinPoster(t,"bposterX1",this.bar2_),this.bposter2.bindinger=this.addBinPoster(this.bposter2,"bposter2",this.bar2_),this.bar2_.set_bposter(t,this.bposter2,this.Resistance),this.zuheCompArr.push(this.bar2_);var e=new experimentalApparatus.Electricity.BaseElecWire;e.set_bindingers(this.bposter1,t),this.zuheCompArr.push(e),this.bar1_.isBreak=!1,this.bar2_.isBreak=!0,this.isZuHe=!0;var i=this;this.addLabel(this.name),this.txt_=new egret.TextField,i.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-this.txt_.width/2,this.txt_.y=this.bposter0.y-95,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,i.addChild(this.bposter0),i.addChild(this.bposter1),i.addChild(this.bposter2)},s.getBinders=function(){return[this._nodeData1,this._nodeData2,this._nodeData3]},s.drawBaseLine=function(){this._wire1.graphics.clear(),this._wire2.graphics.clear(),this._wire3.graphics.clear(),this._wire1.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._wire1.graphics.moveTo(this.spr.x-this.spr.height/4,this.spr.y-this.spr.height/2),this._wire1.graphics.lineTo(this.spr.x-this.spr.height/4,this.spr.y-this.spr.height/2-20),this._wire1.graphics.lineTo(this.spr.x-this.spr.height/4-20,this.spr.y-this.spr.height/2-35),this.bposter0.x=this.spr.x-this.spr.height/4-20,this.bposter0.y=this.spr.y-this.spr.height/2-35,this._wire2.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._wire2.graphics.moveTo(this.spr.x,this.spr.y-this.spr.height/2),this._wire2.graphics.lineTo(this.spr.x,this.spr.y-this.spr.height/2-50),this.bposter1.x=this.spr.x,this.bposter1.y=this.spr.y-this.spr.height/2-50,this._wire3.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._wire3.graphics.moveTo(this.spr.x+this.spr.width/4,this.spr.y-this.spr.height/2),this._wire3.graphics.lineTo(this.spr.x+this.spr.width/4,this.spr.y-this.spr.height/2-20),this._wire3.graphics.lineTo(this.spr.x+this.spr.width/4+20,this.spr.y-this.spr.height/2-35),this.bposter2.x=this.spr.x+this.spr.width/4+20,this.bposter2.y=this.spr.y-this.spr.height/2-35,this._wire1.gap=new egret.Point(-this.spr.width/2-20,-70),this._wire2.gap=new egret.Point(this.spr.width/2+20,-50),this._wire3.gap=new egret.Point(this.spr.width/2+20,-50),this.bposter0.gap=0,this.bposter1.gap=this.bposter1.x-this.bposter0.x,this.bposter2.gap=this.bposter2.x-this.bposter0.x},s.checkDraw=function(t,e){return this.bposter0.hitTestPoint(t,e)?this.bposter0:this.bposter1.hitTestPoint(t,e)?this.bposter1:this.bposter2.hitTestPoint(t,e)?this.bposter2:null},s.checkRectHittest=function(t){var e=t.getBounds(),i=this.bposter0.getBounds(),s=this.bposter1.getBounds(),n=this.bposter2.getBounds(),r=t.parent.localToGlobal(t.x,t.y),h=this.bposter0.parent.localToGlobal(this.bposter0.x,this.bposter0.y),o=this.bposter1.parent.localToGlobal(this.bposter1.x,this.bposter1.y),a=this.bposter1.parent.localToGlobal(this.bposter2.x,this.bposter2.y);return e.x=r.x,e.y=r.y,i.x=h.x,i.y=h.y,s.x=o.x,s.y=o.y,n.x=a.x,n.y=a.y,e.intersects(i)?this.bposter0:e.intersects(s)?this.bposter1:e.intersects(n)?this.bposter2:null},s.onPowerMove=function(t){this.isPowerMove=!0,this.ro=!1},s.onPowerEnd=function(t){this.ro=!0,this.isPowerMove||(t.stopPropagation(),this._isOpen=!this._isOpen,this.checkConnect()),this.isPowerMove=!1},s.checkConnect=function(){this._isOpen?(this._Power.gotoAndStop(1),this.bar1_.isBreak=!0,this.bar2_.isBreak=!1,this.diyChanged()):(this._Power.gotoAndStop(0),this.bar1_.isBreak=!1,this.bar2_.isBreak=!0),this.diyChanged()},s.getProObj=function(){return this.data.isOpen=this._isOpen,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,void 0!=t.isOpen&&(this._isOpen=t.isOpen),this.checkConnect()},s.dispose=function(){this._touchZg.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onPowerMove,this),this._touchZg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onPowerEnd,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(DoubleControlSwitch,"DoubleControlSwitch");var DoubleControlSwitchInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="双控开关",this._ratedWorkLab.text="",this._ratedVolLab.text="",this._volLab.text="",this._workLab.text=""},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(DoubleControlSwitchInfoPanel,"DoubleControlSwitchInfoPanel");var ElectricBrake=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s),this.zhaDao=null,this._touchZ=null,this._isOpen=!0,this._fun=null,this._funObj=null,this._startBY=0,e._instance=this}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){return e._instance},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_zhaspr"),this.spr.touchEnabled=!1,this.zhaDao=this.spr.getMovie("zha"),this.zhaDao.gotoAndStop(0),this._touchZ=this.zhaDao.getImage("touch"+this.zhaDao.getCurrentFrame()),this._touchZ.touchEnabled=!0,this._touchZ.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._openZhaBegin,this)},s._openZhaBegin=function(t){this._touchZ.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._openZhaBegin,this),this.ro=!0,this._touchZ.addEventListener(egret.TouchEvent.TOUCH_END,this._openZhaEnd,this),this._touchZ.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this._openZhaEnd,this),this._startBY=t.stageY},s._openZha=function(t){},s._openZhaEnd=function(t){if(this._isOpen&&this._startBY+10<=t.stageY){this.zhaDao.gotoAndStop(1),this._isOpen=!1;var e=HomeElectric.getInstance()._baoxian;HomeElectric.getInstance().setChildIndex(this,HomeElectric.getInstance().getChildIndex(e)),this.dispatchEventWith("zhaChange",!1,this._isOpen)}else if(!this._isOpen&&this._startBY-10>=t.stageY){this.zhaDao.gotoAndStop(0),this._isOpen=!0;var e=HomeElectric.getInstance()._baoxian;HomeElectric.getInstance().setChildIndex(e,HomeElectric.getInstance().getChildIndex(this)),this.dispatchEventWith("zhaChange",!1,this._isOpen)}this._touchZ=this.zhaDao.getImage("touch"+this.zhaDao.getCurrentFrame()),this._touchZ.touchEnabled=!0,this._touchZ.removeEventListener(egret.TouchEvent.TOUCH_END,this._openZhaEnd,this),this._touchZ.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this._openZhaEnd,this),this._touchZ.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._openZhaBegin,this),this._touchZ.addEventListener(egret.TouchEvent.TOUCH_END,this._openZhaEnd,this),this._touchZ.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this._openZhaEnd,this)},s.callFun=function(t,e){this._fun=t,this._funObj=e},s.dispose=function(){this._touchZ.removeEventListener(egret.TouchEvent.TOUCH_TAP,this._openZha,this),t.prototype.dispose.call(this)},e._instance=null,e}(HBaseItem);egret.registerClass(ElectricBrake,"ElectricBrake");var Electroprobe=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_electroprobe"),this.probeFire=this.spr.getImage("_fire"),this._dianbi=this.spr.getMovie("dianbi"),this._dianbi.gotoAndStop(0),this.dropItem=null,this.addEventListener("socketTwoRemoveFromParent",this.socketRemove,this),this.addEventListener("socketThreeRemoveFromParent",this.socketRemove,this)},s._onBegin=function(e){t.prototype._onBegin.call(this,e),this.parent.setChildIndex(this,this.parent.numChildren-1)},s.onMove=function(e){t.prototype.onMove.call(this,e),this.test()},s._onEnd=function(e){t.prototype._onEnd.call(this,e),this.test()},s.bringSelfFront=function(){var t=HomeElectricsView.getInstance().hitTestRectObjs(this,4013),e=HomeElectricsView.getInstance().hittestObjects(this,4012);(t||e)&&(t&&this.resetChildIndex(t),e&&this.resetChildIndex(e))},s.test=function(){this.bringSelfFront();var t=this.probeFire.parent.localToGlobal(this.probeFire.x,this.probeFire.y),e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.x,t.y),4013),i=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.x,t.y),4012);return e&&!e.currentAppliance?void this.testLineNode(e):i&&!i.currentAppliance?void this.testLineNode(i):void this.initDropItem()},s.testLineNode=function(t){var e=null;this.hitTestObjs(t.probFireL,this.probeFire)&&(e=t.bposter0),this.hitTestObjs(t.probFireR,this.probeFire)&&(e=t.bposter1);var i=this.getLineEnd(t,e);i&&"bposter0"==i.name?(this.getbool(!0),this.dropItem=t,t._prob=this):this.initDropItem()},s.initDropItem=function(){this.dropItem&&(this.dropItem._prob=null,this.dropItem=null),this.getbool(!1)},s.resetChildIndex=function(t){var e=this.parent.getChildIndex(this),i=this.parent.getChildIndex(t);this.parent.setChildIndex(this,e>i?e:i),this.parent.setChildIndex(t,i>e?e:i)},s.getbool=function(t){t&&this.dropItem?ElectricBrake.getInstance()._isOpen&&this._dianbi.gotoAndStop(1):this._dianbi.gotoAndStop(0)},s.socketRemove=function(){this._dianbi.gotoAndStop(0)},s.getProObj=function(){return t.prototype.getProObj.call(this),this.data},s.dispose=function(){this.removeEventListener("socketTwoRemoveFromParent",this.socketRemove,this),this.removeEventListener("socketThreeRemoveFromParent",this.socketRemove,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Electroprobe,"Electroprobe");var ElectroprobeInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="测电笔",this._workLab.text="",this._volLab.text="",this._ratedVolLab.text="",this._ratedWorkLab.text=""},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(ElectroprobeInfoPanel,"ElectroprobeInfoPanel");var Fan=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_Fan"),this.onAddbagin(null),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this.drawLine(),this._chaTou.addEventListener("twoRemoveFromParent",this.socketRemoveFromParent,this)},s.drawLine=function(){this.fengshan.anchorOffsetY=90;var t=this.getPosition(this.fengshan),e=new egret.Point(this._chaTou.x,this.fengshan.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onAddbagin=function(t){this.fengshan=this.spr.getMovie("Fan"),this._chaTou=this.spr.getMovie("plug"),this.fengshan.gotoAndStop(0),this._chaTou.gotoAndStop(0),this.fengshan.touchEnabled=!0,this._chaTou.touchEnabled=!0,this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this.fengshan.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this.fengshan.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this.fengshan.parent.localToGlobal(this.fengshan.x,this.fengshan.y,this.coords),"Fan"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("Fan"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this.fengshan.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this.fengshan.x=e.x,this.fengshan.y=e.y,this.itemTop.x=this.fengshan.x-120,this.itemTop.y=this.fengshan.y-240}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4013);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this.fengshan&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this.fengshan.x-120,this.itemTop.y=this.fengshan.y-240},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._chaTou.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&(1==this.fengshan.isPlay()?0:this.fengshan.gotoAndPlay(0))):this._chaTou.dropItem?this.fengshan.gotoAndStop(0):(this.fengshan.gotoAndStop(0),this._chaTou.gotoAndStop(0))},s.socketRemoveFromParent=function(){this.fengshan.gotoAndStop(0),this._chaTou.gotoAndStop(0),this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("twoRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Fan,"Fan");var FanInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="电风扇",this._ratedWorkLab.text="100W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(FanInfoPanel,"FanInfoPanel");var Fuse=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this.limitA=40,this._baoxian=null,this._infoPanel=null}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(t){void 0===t&&(t="tri_png"),this.spr=ElectricsConst.electricItem_swf.createSprite("spr_xs"),this.spr.touchEnabled=!0,this.addChild(this.spr),this._baoxian=this.spr.getMovie("baoxian"),this._baoxian.gotoAndStop(0);var e=new neoges.DoubleTapGesture(this);e.addEventListener(neoges.GestureEvent.ENDED,this.openProPanel,this)},s.setLimitA=function(t){this.limitA=t},s.openProPanel=function(){if(this._infoPanel)if(this._infoPanel.visible=!0,this._infoPanel.visible){var t=HomeElectricsView.getInstance()._currentInfoPanel;t&&t!=this._infoPanel&&(HomeElectricsView.getInstance()._currentInfoPanel.visible=!1),HomeElectricsView.getInstance()._currentInfoPanel=this._infoPanel}else HomeElectricsView.getInstance()._currentInfoPanel=null;else this._infoPanel||(this._infoPanel=this.getInfoPanel("fuseInfo"),HomeElectricsView.getInstance()._currentInfoPanel=this._infoPanel),this._infoPanel.visible=!0,this._infoPanel.setData(this)},s.getInfoPanel=function(t){for(var e,i=HomeElectricsView.getInstance().panelContainer,s=0;s<i.numChildren;s++)if(e=i.getChildAt(s),e.nameId==t)return e;var n=new FuseInfoPanel;return n.nameId="fuseInfo",n.x=MainView.mainRect[2]-n.width,n.y=MainView.mainRect[1],HomeElectricsView.getInstance().panelContainer.addChild(n),n},s.burned=function(){var t=HomeElectric.getInstance()._zha;HomeElectric.getInstance().setChildIndex(this,HomeElectric.getInstance().getChildIndex(t)),this._baoxian.gotoAndStop(1),this._infoPanel._btnRepair.visible=!0
},s.repair=function(){var t=HomeElectric.getInstance()._zha;HomeElectric.getInstance().setChildIndex(t,HomeElectric.getInstance().getChildIndex(this)),this._baoxian.gotoAndStop(0)},s.dispose=function(){t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Fuse,"Fuse");var FuseInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/FuseInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){this._btnRepair.addEventListener(egret.TouchEvent.TOUCH_TAP,this.repair,this),this._btnRepair.visible=!1,t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.panel.proName.text="保险丝",this._dropDownListAmm.setFun(this.setFocusA,this)},s.repair=function(){this._item.repair(),this._btnRepair.visible=!1},s.setFocusA=function(t){this._data.limitA=t,this._item.getProObj().limitA=t,this._item.setLimitA(t)},s.setData=function(e){t.prototype.setData.call(this,e);for(var i=[[20,"20A"],[30,"30A"],[40,"40A"]],s=2,n=0;n<i.length;n++){var r=i[n];r[0]==this._data.limitA&&(s=n)}this._dropDownListAmm.setData(i,s)},s.deleteItem=function(){this.visible=!1},e}(HInfoPanelBase);egret.registerClass(FuseInfoPanel,"FuseInfoPanel");var GroundWire=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_ground"),this.spr.touchEnabled=!1},e}(HBaseItem);egret.registerClass(GroundWire,"GroundWire");var HWireInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HWireInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.proName.text="导线",this._btnDelete0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteLine,this),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1},s.btnDelete=function(t){this.deleteItem()},s.deleteLine=function(){this.deleteItem(),this._item&&this._item.diyChanged(),HomeElectricsView.getInstance().deleteSelectedLine()},e}(HInfoPanelBase);egret.registerClass(HWireInfoPanel,"HWireInfoPanel");var HomeElectric=function(t){function e(i,s){void 0===i&&(i=null),void 0===s&&(s=null),t.call(this,i,s,2,"ElecPower"),this._drawShap=null,this._zha=null,this._baoxian=null,this._dianbiao=null,this._fireShape=null,this._nullShape=null,this._nodeData1=null,this._nodeData2=null,this._nodeData3=null,this._fun=null,this._funObj=null,this._isOpen=!0,this._fireY=0,this._boundryLX=0,this._boundryGap=0,this._nullY=0,this._groundY=0,this._bp0Point=null,this._bp1Point=null,this.name="电表",e._instance=this}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){return e._instance},s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=150,i.height=20,i.size=18,i.selectable=!1,i.x=i.width/2,i.y=this.bposter0.y,i.text=t,i.touchEnabled=!1,this.label=i},s.addInfoTxt=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.textColor=16711680,i.width=150,i.height=60,i.size=50,i.selectable=!1,i.x=this._zha.x-260,i.y=this._zha.y-15,i.text=t,i.touchEnabled=!1,this._infoTxt=i},s.setCopyData=function(t){this.data=t,this.diyChanged()},s.setWorkPower=function(t){this.txt_.text=t.toFixed(3)+" V\n"+(t/this.Resistance).toFixed(3)+" A",this._infoTxt.text=t.toFixed(1)},s.init=function(t){void 0===t&&(t="tri_png"),this.spr=ElectricsConst.electricItem_swf.createSprite("spr_homeE"),this.spr.touchEnabled=!1,this.addChild(this.spr),this._dianbiao=this.spr.getImage("dianbiao"),this._dianbiao.touchEnabled=!0,this._dianbiao.addEventListener(mouse.MouseEvent.ROLL_OVER,this.onMouseOver,this),this._dianbiao.addEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),this._drawShap=new egret.Shape,this.addChild(this._drawShap),this._fireShape=new egret.Shape,this.addChild(this._fireShape),this._nullShape=new egret.Shape,this.addChild(this._nullShape),this._zha=new ElectricBrake,this._zha.x=87,this._zha.y=-50,this._baoxian=new Fuse,this._baoxian.x=this._zha.x+15,this._baoxian.y=this._zha.y+105,this.addChild(this._zha),this.addChild(this._baoxian),this.addInfoTxt("0V"),this._infoTxt.visible=!1,this._zha.addEventListener("zhaChange",this.listenPowerState,this),this.drawLine(),e.BOUNDRY_LeftX=this._boundryLX+10,this.initPoster(),this._nodeData1={item:this,node:this.bposter0},this._nodeData2={item:this,node:this.bposter1},this._nodeArr.push(this.bposter0,this.bposter1)},s.initPoster=function(){this.bposter0=this.createPosterShape(this._boundryGap,20,16711935),this.bposter1=this.createPosterShape(this._boundryGap,20),this.bposter0.y=this._bp0Point.y,this.bposter0.x=this._bp0Point.x,this.bposter1.y=this._bp1Point.y,this.bposter1.x=this._bp1Point.x,this.bposter0.type="firepower",this.bposter1.type="nullpower",this.bposter0.posY=this.bposter0.y,this.bposter1.posY=this.bposter1.y,this.bposter0.color=ElectricsConst.COLOR_FIREWIRE,this.bposter1.color=ElectricsConst.COLOR_NULLWIRE,this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.item=this,this.bposter1.item=this,this.bposter0.bWidth=this._boundryGap,this.bposter1.bWidth=this._boundryGap,this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1"),this.bposter0.body=this.bposter1.body=this,this.Power=220;var t=this;this.addLabel("电表"),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=150,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.size=18,this.txt_.text="0V 0A",this.txt_.touchEnabled=!1,this.txt_.x=this.txt_.width/2,this.txt_.y=this.label.y+this.label.height+10,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,this.data.batteryRES=this.Resistance},s.getBinders=function(){return[this._nodeData1,this._nodeData2]},s.listenPowerState=function(t){this._isOpen=t.data,this.dispatchEventWith("zhaChange",!1,this._isOpen)},s.checkDraw=function(t,e){return this.bposter0.hitTestPoint(t,e)?this.bposter0:this.bposter1.hitTestPoint(t,e)?this.bposter1:null},s.checkRectHittest=function(t){var e=t.getBounds(),i=this.bposter0.getBounds(),s=this.bposter1.getBounds(),n=t.parent.localToGlobal(t.x,t.y),r=this.bposter0.parent.localToGlobal(this.bposter0.x,this.bposter0.y),h=this.bposter1.parent.localToGlobal(this.bposter1.x,this.bposter1.y);return e.x=n.x,e.y=n.y,i.x=r.x,i.y=r.y,s.x=h.x,s.y=h.y,e.intersects(i)?this.bposter0:e.intersects(s)?this.bposter1:null},s.drawLine=function(){var t=new egret.Point(-this.spr.width/2-55,0),e=new egret.Point(t.x,t.y+20);this._drawShap.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE);var i=t.x+40,s=t.x+115,n=t.y+100,r=t.y+55;this._drawShap.graphics.moveTo(t.x,t.y),this._drawShap.graphics.lineTo(i,t.y),this._drawShap.graphics.lineTo(i,n),this._drawShap.graphics.lineTo(s,n),this._drawShap.graphics.lineTo(s,r),this._drawShap.graphics.moveTo(s+23,r),this._drawShap.graphics.lineTo(s+23,n),this._drawShap.graphics.lineTo(s+130,n),this._drawShap.graphics.lineTo(s+130,n-200),this._drawShap.graphics.lineTo(s+237,n-200),this._drawShap.graphics.lineTo(s+237,n-170),this._drawShap.graphics.moveTo(s+239,n-80),this._drawShap.graphics.lineTo(s+239,n-75),this._drawShap.graphics.moveTo(s+239,n-10),this._drawShap.graphics.lineTo(s+239,n),this._drawShap.graphics.lineTo(s+369,n),this._drawShap.graphics.lineTo(s+369,n-210),this._drawShap.graphics.lineTo(s+400,n-210),this._fireShape.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._fireShape.graphics.moveTo(s+400,n-210),this._fireShape.graphics.lineTo(MainView.mainRect[2]-(s+400)-20,n-210),this._bp0Point=new egret.Point(s+400,n-210),this._fireY=n-210;var h=this._fireShape.parent.localToGlobal(s+400+15,0),o=this._fireShape.parent.localToGlobal(MainView.mainRect[2]-(s+400)-30,0);this._boundryLX=h.x,this._boundryGap=o.x-h.x;var a=e.x+20,l=e.x+160,c=e.y+100,d=e.y+35;this._drawShap.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_NULLWIRE),this._drawShap.graphics.moveTo(e.x,e.y),this._drawShap.graphics.lineTo(a,e.y),this._drawShap.graphics.lineTo(a,c),this._drawShap.graphics.lineTo(l,c),this._drawShap.graphics.lineTo(l,d),this._drawShap.graphics.moveTo(l+20,d),this._drawShap.graphics.lineTo(l+20,d+65),this._drawShap.graphics.lineTo(l+105,d+65),this._drawShap.graphics.lineTo(l+105,d-135),this._drawShap.graphics.lineTo(l+165,d-135),this._drawShap.graphics.lineTo(l+165,d-125),this._drawShap.graphics.moveTo(l+165,n-80),this._drawShap.graphics.lineTo(l+165,d+65),this._drawShap.graphics.lineTo(l+345,d+65),this._drawShap.graphics.lineTo(l+345,d-135),this._drawShap.graphics.lineTo(l+355,d-135),this._nullShape.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_NULLWIRE),this._nullShape.graphics.moveTo(l+355,d-135),this._nullShape.graphics.lineTo(MainView.mainRect[2]-(l+355)-20,d-135),this._nullY=d-135,this._bp1Point=new egret.Point(l+355,d-135)},s.callFun=function(t,e){this._fun=t,this._funObj=e},s.onMouseOver=function(t){this._infoTxt.visible||(this._infoTxt.visible=!0)},s.onMouseOut=function(t){this._infoTxt.visible&&(this._infoTxt.visible=!1)},e.BOUNDRY_LeftX=0,e._instance=null,e}(HBaseItem);egret.registerClass(HomeElectric,"HomeElectric");var Kettle=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._chaTou=null,this._shuiHu=null,this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_kettle"),this._chaTou=this.spr.getMovie("plug"),this._shuiHu=this.spr.getMovie("kettle"),this._chaTou.touchEnabled=!0,this._shuiHu.touchEnabled=!0,this._shuiHu.gotoAndStop(0),this._chaTou.gotoAndStop(0),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._shuiHu.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._shuiHu.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null,this._chaTou.addEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),this.drawLine()},s.drawLine=function(){1==this._chaTou.getCurrentFrame()?this._chaTou.anchorOffsetX=0:this._chaTou.anchorOffsetX=-5,this._shuiHu.anchorOffsetY=60;var t=this.getPosition(this._shuiHu),e=new egret.Point(this._chaTou.x,this._shuiHu.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this._shuiHu.parent.localToGlobal(this._shuiHu.x,this._shuiHu.y,this.coords),"kettle"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("kettle"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this._shuiHu.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._shuiHu.x=e.x,this._shuiHu.y=e.y,this.itemTop.x=this._shuiHu.x-130,this.itemTop.y=this._shuiHu.y-195}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){"kettle"!=t.target.name&&this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4012);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y+6,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this._shuiHu&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this._shuiHu.x-130,this.itemTop.y=this._shuiHu.y-195},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._chaTou.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&this._shuiHu.gotoAndStop(1),this._chaTou.anchorOffsetX=0):this._chaTou.dropItem?this._shuiHu.gotoAndStop(0):(this._chaTou.gotoAndStop(0),this._shuiHu.gotoAndStop(0),this._chaTou.anchorOffsetX=-5)},s.socketRemoveFromParent=function(){this._chaTou.gotoAndStop(0),this._shuiHu.gotoAndStop(0),this._chaTou.anchorOffsetX=-5,this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Kettle,"Kettle");var KettleInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="电水壶",this._ratedWorkLab.text="1000W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(KettleInfoPanel,"KettleInfoPanel");var LampHolder=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i,3),this.currentAppliance=null,this._fireLine=null,this._nullWire=null,this._fireWire=null,this._isInTouch=!1,this.name="灯座"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.setWorkPower=function(t){if(0>t&&(t=Math.abs(t)),HomeElectricsView.getInstance()._homeElectric._isOpen||(t=0),this.Power=t,1>t&&(this.Power=0),this.currentAppliance){var e=t>0?!0:!1;this.currentAppliance.dispatchEventWith("PowerChange",!1,e)}this.setTxtInfo(this.Power)},s.setTxtInfo=function(t){this.label.text=this.Resistance.toFixed(1)+"Ω "+this.name,this.txt_.text=t.toFixed(1)+"V "+(t/this.Resistance).toFixed(1)+"A"},s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=160,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-75,i.y=this.bposter0.y-70,i.text=t,i.touchEnabled=!1,this.label=i},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_lampholder"),this._fireWire=new egret.Shape,this.addChildAt(this._fireWire,0),this._fireLine=this.spr.getImage("lineFire"),this._nullWire=this.spr.getImage("lineNull"),this._fireWire.type="line",this._nullWire.type="line",this._touchImage=this.spr.getImage("touchZone"),this._nodeData1={item:this,node:this._fireWire},this._nodeData2={item:this,node:this._nullWire},this._fireWire.name="红线",this._nullWire.name="蓝线",this._fireWire.item=this,this._nullWire.item=this,this.initPoster(),this._nodeArr.push(this._fireWire,this._nullWire),this._fireWire.color=ElectricsConst.COLOR_FIREWIRE,this._nullWire.color=ElectricsConst.COLOR_NULLWIRE,this._fireWire.gap=new egret.Point(this._fireLine.x,this._fireLine.y-this._fireLine.height/2-20),this._nullWire.gap=new egret.Point(this._nullWire.x,this._nullWire.y-this._nullWire.height/2),this._fireWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._fireWire.graphics.moveTo(this._fireLine.x,this._fireLine.y-this._fireLine.height/2),this._fireWire.graphics.lineTo(this._fireLine.x,this._fireLine.y-this._fireLine.height/2-20),this.bposter0.x=this._fireLine.x,this.bposter0.y=this._fireLine.y-this._fireLine.height/2-20,this.bposter1.x=this._nullWire.x,this.bposter1.y=this._nullWire.y-this._nullWire.height/2,this.bposter0.gap=this.bposter0.x-this.bposter1.x,this.bposter1.gap=0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBEGIN,this),this._fireWire.touchEnabled=!0,this._nullWire.touchEnabled=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},s.initPoster=function(){this.bposter0=new experimentalApparatus.Electricity.BindMC("bposter0",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("bposter1",this),this.bposter0.touchEnabled=!1,this.bposter1.touchEnabled=!1,this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.color=ElectricsConst.COLOR_FIREWIRE,this.bposter1.color=ElectricsConst.COLOR_NULLWIRE,this.bposter0.item=this,this.bposter1.item=this,this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1");var t=this;this.addLabel(this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-this.txt_.width/2,this.txt_.y=this.bposter0.y-50,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,t.addChild(this.bposter0),t.addChild(this.bposter1)},s.getBinders=function(){return[this.bposter0,this.bposter1]},s.onTouchBegin=function(t){this.ro=!0,this.bposter0.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onTouchEnd=function(t){this.ro=!1,this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bposter0.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.bposter1.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},s.onBEGIN=function(t){this.parent.setChildIndex(this,1e3)},s._onBegin=function(e){this._isInTouch=!1,this._touchImage.hitTestPoint(e.stageX,e.stageY)&&(this._isInTouch=!0),t.prototype._onBegin.call(this,e)},s.onMove=function(e){if(this._isInTouch&&(t.prototype.onMove.call(this,e),this.currentAppliance)){var i=this.currentAppliance.parent.globalToLocal(this.x,this.y);this.currentAppliance.x=i.x,this.currentAppliance.y=i.y+140}},s.checkDraw=function(t,e){return this.bposter0.hitTestPoint(t,e)?this.bposter0:this.bposter1.hitTestPoint(t,e)?this.bposter1:null},s.checkRectHittest=function(t){var e=t.getBounds(),i=this.bposter0.getBounds(),s=this.bposter1.getBounds(),n=t.parent.localToGlobal(t.x,t.y),r=this.bposter0.parent.localToGlobal(this.bposter0.x,this.bposter0.y),h=this.bposter1.parent.localToGlobal(this.bposter1.x,this.bposter1.y);return e.x=n.x,e.y=n.y,i.x=r.x,i.y=r.y,s.x=h.x,s.y=h.y,e.intersects(i)?this.bposter0:e.intersects(s)?this.bposter1:null},s.getProObj=function(){return t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,this.diyChanged()},s.dispose=function(){this.bposter0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bposter1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBEGIN,this),this.currentAppliance&&this.currentAppliance.dispatchEventWith("LampHolderRemove",!1,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(LampHolder,"LampHolder");var LampHolderInfoPanel=function(t){function e(){t.call(this),this._scale=.7,this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="灯座",this._workLab.text="",this._volLab.text="",this._ratedVolLab.text="",this._ratedWorkLab.text=""},s.setData=function(e){t.prototype.setData.call(this,e)},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(LampHolderInfoPanel,"LampHolderInfoPanel");var Power=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i,3,"ElecSinglePloeSingleThrowSwitch"),this._isOpen=!1,this._fireWire=null,this._nullWire=null,this._nodeData1=null,this._nodeData2=null,this._touchImg=null,this.isPowerMove=!1,this.name="开关"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=160,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-80,i.y=this.bposter0.y-120,i.text=t,i.touchEnabled=!1},s.setWorkPower=function(t){HomeElectricsView.getInstance()._homeElectric._isOpen||(t=0),this.txt_.text=t.toFixed(1)+"V\n"+(t/this.Resistance).toFixed(1)+"A",console.log(t,"power----")},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_power"),this._Power=this.spr.getMovie("power"),this._Power.gotoAndStop(0),this._touchImg=this.spr.getImage("touchZone"),this._touchImg.touchEnabled=!0,this._touchImg.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onPowerMove,this),this._touchImg.addEventListener(egret.TouchEvent.TOUCH_END,this.onPowerEnd,this),this._fireWire=new egret.Shape,this.addChildAt(this._fireWire,0),this._nullWire=new egret.Shape,this.addChildAt(this._nullWire,0),this._fireWire.item=this,this._nullWire.item=this,this.initPoster(),this._nodeArr.push(this._fireWire,this._nullWire),this._fireWire.name="红线",this._nullWire.name="蓝线",this._nodeData1={item:this,node:this._fireWire},this._nodeData2={item:this,node:this._nullWire},this.drawBaseLine(),this._fireWire.color=ElectricsConst.COLOR_FIREWIRE,this._nullWire.color=ElectricsConst.COLOR_NULLWIRE,this._fireWire.type="line",this._nullWire.type="line",this._fireWire.num=0,this._nullWire.num=0},s.initPoster=function(){this.bposter0=new experimentalApparatus.Electricity.BindMC("bposter0",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("bposter1",this),this.bposter0.touchEnabled=!1,this.bposter1.touchEnabled=!1,this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.color=ElectricsConst.COLOR_NULLWIRE,this.bposter1.color=ElectricsConst.COLOR_FIREWIRE,this.bposter0.item=this,this.bposter1.item=this,this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1"),this.bindPosterAry=[this.bposter0,this.bposter1],this.isBreak=!0;var t=this;this.addLabel(this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-this.txt_.width/2,this.txt_.y=this.bposter0.y-95,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,t.addChild(this.bposter0),t.addChild(this.bposter1)},s.getBinders=function(){return[this._nodeData1,this._nodeData2]},s.drawBaseLine=function(){this._fireWire.graphics.clear(),this._nullWire.graphics.clear(),this._nullWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_NULLWIRE),this._nullWire.graphics.moveTo(this.spr.x-this.spr.width/2,this.spr.y),this._nullWire.graphics.lineTo(this.spr.x-this.spr.width/2-20,this.spr.y),this._nullWire.graphics.lineTo(this.spr.x-this.spr.width/2-20,this.spr.y-70),this.bposter0.x=this.spr.x-this.spr.width/2-20,this.bposter0.y=this.spr.y-70,this._fireWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._fireWire.graphics.moveTo(this.spr.x+this.spr.width/2,this.spr.y),this._fireWire.graphics.lineTo(this.spr.x+this.spr.width/2+20,this.spr.y),this._fireWire.graphics.lineTo(this.spr.x+this.spr.width/2+20,this.spr.y-50),this.bposter1.x=this.spr.x+this.spr.width/2+20,this.bposter1.y=this.spr.y-50,this._nullWire.gap=new egret.Point(-this.spr.width/2-20,-70),this._fireWire.gap=new egret.Point(this.spr.width/2+20,-50),this.bposter0.gap=0,this.bposter1.gap=this.bposter1.x-this.bposter0.x},s.checkDraw=function(t,e){return this.bposter0.hitTestPoint(t,e)?this.bposter0:this.bposter1.hitTestPoint(t,e)?this.bposter1:null},s.checkRectHittest=function(t){var e=t.getBounds(),i=this.bposter0.getBounds(),s=this.bposter1.getBounds(),n=t.parent.localToGlobal(t.x,t.y),r=this.bposter0.parent.localToGlobal(this.bposter0.x,this.bposter0.y),h=this.bposter1.parent.localToGlobal(this.bposter1.x,this.bposter1.y);return e.x=n.x,e.y=n.y,i.x=r.x,i.y=r.y,s.x=h.x,s.y=h.y,e.intersects(i)?this.bposter0:e.intersects(s)?this.bposter1:null},s.onPowerMove=function(t){this.ro=!1,this.isPowerMove=!0},s.onPowerEnd=function(t){this.ro=!0,this.isPowerMove||(t.stopPropagation(),this._isOpen=!this._isOpen,this.checkConnect()),this.isPowerMove=!1},s.checkConnect=function(){this._isOpen?(this._Power.gotoAndStop(1),this.isBreak=!0):(this._Power.gotoAndStop(0),this.isBreak=!1),this.diyChanged()},s.getProObj=function(){return this.data.isOpen=this._isOpen,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,void 0!=t.isOpen&&(this._isOpen=t.isOpen,t.isOpen?this._Power.gotoAndStop(1):this._Power.gotoAndStop(0)),this.checkConnect()},s.dispose=function(){this._touchImg.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onPowerMove,this),this._touchImg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onPowerEnd,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Power,"Power");var PowerInfoPanel=function(t){function e(){t.call(this),this._scale=.7,this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="开关",this._workLab.text="",this._volLab.text="",this._ratedVolLab.text="",this._ratedWorkLab.text=""},s.changeFocusRES=function(t){this._data.batteryRES=t},s.setData=function(e){t.prototype.setData.call(this,e)},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(PowerInfoPanel,"PowerInfoPanel");var Radiator=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._chaTou=null,this._nuanQi=null,this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_radiator"),this._chaTou=this.spr.getMovie("plug"),this._nuanQi=this.spr.getMovie("radiator"),this._chaTou.touchEnabled=!0,this._nuanQi.touchEnabled=!0,this._nuanQi.gotoAndStop(0),this._chaTou.gotoAndStop(0),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._nuanQi.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._nuanQi.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null,this._chaTou.addEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),this.drawLine()},s.drawLine=function(){1==this._chaTou.getCurrentFrame()?this._chaTou.anchorOffsetX=0:this._chaTou.anchorOffsetX=-5,this._nuanQi.anchorOffsetY=60;var t=this.getPosition(this._nuanQi),e=new egret.Point(this._chaTou.x,this._nuanQi.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this._nuanQi.parent.localToGlobal(this._nuanQi.x,this._nuanQi.y,this.coords),"radiator"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("radiator"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this._nuanQi.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._nuanQi.x=e.x,this._nuanQi.y=e.y,this.itemTop.x=this._nuanQi.x-120,this.itemTop.y=this._nuanQi.y-200}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){"radiator"!=t.target.name&&this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4012);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y+6,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this._nuanQi&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this._nuanQi.x-120,this.itemTop.y=this._nuanQi.y-200},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._chaTou.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&this._nuanQi.gotoAndStop(1),this._chaTou.anchorOffsetX=0):this._chaTou.dropItem?this._nuanQi.gotoAndStop(0):(this._chaTou.gotoAndStop(0),this._nuanQi.gotoAndStop(0),this._chaTou.anchorOffsetX=-5)},s.socketRemoveFromParent=function(){this._chaTou.gotoAndStop(0),this._nuanQi.gotoAndStop(0),this._chaTou.anchorOffsetX=-5,this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()
},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Radiator,"Radiator");var RadiatorInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="电暖气",this._ratedWorkLab.text="1000W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(RadiatorInfoPanel,"RadiatorInfoPanel");var Refrigerator=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._chaTou=null,this._bingXiang=null,this._touchZone=null,this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_refrigerator"),this._chaTou=this.spr.getMovie("plug"),this._bingXiang=this.spr.getMovie("refri"),this._touchZone=this.spr.getImage("touchZone"),this._bingXiang.gotoAndStop(0),this._chaTou.gotoAndStop(0),this._touchZone.x=this._bingXiang.x,this._touchZone.y=this._bingXiang.y-70,this._chaTou.touchEnabled=!0,this._bingXiang.touchEnabled=!0,this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._bingXiang.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._bingXiang.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null,this._chaTou.addEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),this.drawLine()},s.openRefrigerator=function(){var t=this._bingXiang.getChildAt(0);0==t.getCurrentFrame()?t.gotoAndStop(1):t.gotoAndStop(0)},s.drawLine=function(){1==this._chaTou.getCurrentFrame()?this._chaTou.anchorOffsetX=0:this._chaTou.anchorOffsetX=-5,this._bingXiang.anchorOffsetY=90;var t=this.getPosition(this._bingXiang),e=new egret.Point(this._chaTou.x,this._bingXiang.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this._bingXiang.parent.localToGlobal(this._bingXiang.x,this._bingXiang.y,this.coords),"refri"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("refri"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this._bingXiang.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._bingXiang.x=e.x,this._bingXiang.y=e.y,this.itemTop.x=this._bingXiang.x-120,this.itemTop.y=this._bingXiang.y-230,this._touchZone.x=this._bingXiang.x,this._touchZone.y=this._bingXiang.y-70}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){"refri"!=t.target.name&&this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4012);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y+6,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this._bingXiang&&(this.initChaTouDropItem(this),this.getbool(!1))},s._onEnd=function(e){t.prototype._onEnd.call(this,e),this._touchZone.hitTestPoint(e.stageX,e.stageY)&&this.openRefrigerator()},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this._bingXiang.x-120,this.itemTop.y=this._bingXiang.y-230},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._chaTou.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&this._bingXiang.gotoAndStop(1),this._chaTou.anchorOffsetX=0):this._chaTou.dropItem?this._bingXiang.gotoAndStop(0):(this._chaTou.gotoAndStop(0),this._bingXiang.gotoAndStop(0),this._chaTou.anchorOffsetX=-5)},s.socketRemoveFromParent=function(){this._chaTou.gotoAndStop(0),this._bingXiang.gotoAndStop(0),this._chaTou.anchorOffsetX=-5,this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),this._touchZone.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openRefrigerator,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Refrigerator,"Refrigerator");var RefrigeratorInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="冰箱",this._ratedWorkLab.text="150W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(RefrigeratorInfoPanel,"RefrigeratorInfoPanel");var Stove=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._chaTou=null,this._luZi=null,this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_stove"),this._chaTou=this.spr.getMovie("plug"),this._luZi=this.spr.getMovie("stove"),this._chaTou.touchEnabled=!0,this._luZi.touchEnabled=!0,this._chaTou.gotoAndStop(0),this._luZi.gotoAndStop(0),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._luZi.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._luZi.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null,this._chaTou.addEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),this.drawLine()},s.drawLine=function(){1==this._chaTou.getCurrentFrame()?this._chaTou.anchorOffsetX=0:this._chaTou.anchorOffsetX=-5,this._luZi.anchorOffsetY=30;var t=this.getPosition(this._luZi),e=new egret.Point(this._chaTou.x,this._luZi.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this._luZi.parent.localToGlobal(this._luZi.x,this._luZi.y,this.coords),"stove"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("stove"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this._luZi.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._luZi.x=e.x,this._luZi.y=e.y,this.itemTop.x=this._luZi.x-120,this.itemTop.y=this._luZi.y-170}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){"stove"!=t.target.name&&this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4012);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y+6,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this._luZi&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this._luZi.x-120,this.itemTop.y=this._luZi.y-170},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._chaTou.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&this._luZi.gotoAndStop(1),this._chaTou.anchorOffsetX=0):this._chaTou.dropItem?this._luZi.gotoAndStop(0):(this._chaTou.gotoAndStop(0),this._luZi.gotoAndStop(0),this._chaTou.anchorOffsetX=-5)},s.socketRemoveFromParent=function(){this._chaTou.gotoAndStop(0),this._luZi.gotoAndStop(0),this._chaTou.anchorOffsetX=-5,this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Stove,"Stove");var StoveInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="电炉子",this._ratedWorkLab.text="1000W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(StoveInfoPanel,"StoveInfoPanel");var Switch=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i,3,"ElecSinglePloeSingleThrowSwitch"),this._isOpen=!1,this._xian=null,this.isTouchLine=!1,this._fireWire=null,this._nullWire=null,this._nodeData1=null,this._nodeData2=null,this._sOffY=0,this._sStartY=0,this._xianPos=new egret.Point,this.name="开关A"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=160,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-80,i.y=this.bposter0.y-180,i.text=t,i.touchEnabled=!1},s.setWorkPower=function(t){HomeElectricsView.getInstance()._homeElectric._isOpen||(t=0),this.txt_.text=t.toFixed(1)+"V\n"+(t/this.Resistance).toFixed(1)+"A",console.log(t,"power----")},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_switch"),this._xian=this.spr.getImage("xian"),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._fireWire=new egret.Shape,this.addChildAt(this._fireWire,0),this._nullWire=new egret.Shape,this.addChildAt(this._nullWire,0),this._fireWire.item=this,this._nullWire.item=this,this.initPoster(),this._nodeArr.push(this._fireWire,this._nullWire),this._fireWire.name="红线",this._nullWire.name="蓝线",this.drawBaseLine(),this._fireWire.color=ElectricsConst.COLOR_FIREWIRE,this._nullWire.color=ElectricsConst.COLOR_NULLWIRE,this._fireWire.type="line",this._nullWire.type="line",this._fireWire.num=0,this._nullWire.num=0},s.initPoster=function(){this.bposter0=new experimentalApparatus.Electricity.BindMC("bposter0",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("bposter1",this),this.bposter0.touchEnabled=!1,this.bposter1.touchEnabled=!1,this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.color=ElectricsConst.COLOR_FIREWIRE,this.bposter1.color=ElectricsConst.COLOR_NULLWIRE,this.bposter0.item=this,this.bposter1.item=this,this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1"),this.bindPosterAry=[this.bposter0,this.bposter1],this.isBreak=!0;var t=this;this.addLabel(this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-this.txt_.width/2,this.txt_.y=this.bposter0.y-160,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,t.addChild(this.bposter0),t.addChild(this.bposter1)},s.getBinders=function(){return[this._nodeData1,this._nodeData2]},s.drawBaseLine=function(){this._fireWire.graphics.clear(),this._nullWire.graphics.clear(),this._fireWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._fireWire.graphics.moveTo(this.spr.x-this.spr.width/2,this.spr.y-70),this._fireWire.graphics.lineTo(this.spr.x-this.spr.width/2-20,this.spr.y-70),this._fireWire.graphics.lineTo(this.spr.x-this.spr.width/2-20,this.spr.y-140),this.bposter0.x=this.spr.x-this.spr.width/2-20,this.bposter0.y=this.spr.y-140,this._nullWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_NULLWIRE),this._nullWire.graphics.moveTo(this.spr.x+this.spr.width/2,this.spr.y-70),this._nullWire.graphics.lineTo(this.spr.x+this.spr.width/2+20,this.spr.y-70),this._nullWire.graphics.lineTo(this.spr.x+this.spr.width/2+20,this.spr.y-120),this.bposter1.x=this.spr.x+this.spr.width/2+20,this.bposter1.y=this.spr.y-120,this._fireWire.gap=new egret.Point(-this.spr.width/2-20,-140),this._nullWire.gap=new egret.Point(this.spr.width/2+20,-120),this.bposter0.gap=0,this.bposter1.gap=this.bposter1.x-this.bposter0.x},s.checkDraw=function(t,e){return this.bposter0.hitTestPoint(t,e)?this.bposter0:this.bposter1.hitTestPoint(t,e)?this.bposter1:null},s.checkRectHittest=function(t){var e=t.getBounds(),i=this.bposter0.getBounds(),s=this.bposter1.getBounds(),n=t.parent.localToGlobal(t.x,t.y),r=this.bposter0.parent.localToGlobal(this.bposter0.x,this.bposter0.y),h=this.bposter1.parent.localToGlobal(this.bposter1.x,this.bposter1.y);return e.x=n.x,e.y=n.y,i.x=r.x,i.y=r.y,s.x=h.x,s.y=h.y,e.intersects(i)?this.bposter0:e.intersects(s)?this.bposter1:null},s.onTouchBegin=function(t){this.ro=!0,ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.isTouchLine=this._xian.hitTestPoint(t.stageX,t.stageY,!0),this.isTouchLine||(this.ro=!1),this._sStartY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this._xian.x,this._xian.y,e);this._sOffY=this._sStartY-i.y,this._xianPos.x=this._xian.x,this._xianPos.y=this._xian.y},s.onTouchMove=function(t){this.isTouchLine&&(this._xian.y=t.stageY-this._sOffY,this._xian.y>26.5?this._xian.y=26.5:this._xian.y<this._xianPos.y&&(this._xian.y=this._xianPos.y))},s.onTouchEnd=function(t){this.ro=!1,this._xian.y>this._xianPos.y&&(this._isOpen=!this._isOpen,this.checkConnected()),this._xian.x=this._xianPos.x,this._xian.y=this._xianPos.y,ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},s.checkConnected=function(){1==this._isOpen?this.isBreak=!1:this.isBreak=!0,this.diyChanged(),this._isOpen?console.log("开关A--开启"):console.log("开关A--关闭")},s.getProObj=function(){return this.data.isOpen=this._isOpen,t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,void 0!=t.isOpen&&(this._isOpen=t.isOpen),this.checkConnected()},s.dispose=function(){ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Switch,"Switch");var SwitchInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="开关A",this._ratedWorkLab.text="",this._ratedVolLab.text="",this._volLab.text="",this._workLab.text=""},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(SwitchInfoPanel,"SwitchInfoPanel");var Television=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_television"),this._television=this.spr.getMovie("television"),this._television.gotoAndStop(0),this._plug=this.spr.getMovie("plug"),this._plug.gotoAndStop(0),this.onAddbagin(null),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this.drawLine(),this._chaTou.addEventListener("twoRemoveFromParent",this.socketRemoveFromParent,this)},s.drawLine=function(){this.dianshi.anchorOffsetY=70;var t=this.getPosition(this.dianshi),e=new egret.Point(this._chaTou.x,this.dianshi.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onAddbagin=function(t){this.dianshi=this.spr.getImage("television"),this._chaTou=this.spr.getImage("plug"),this.dianshi.touchEnabled=!0,this._chaTou.touchEnabled=!0,this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this.dianshi.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this.dianshi.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this.dianshi.parent.localToGlobal(this.dianshi.x,this.dianshi.y,this.coords),"television"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("television"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this.dianshi.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this.dianshi.x=e.x,this.dianshi.y=e.y,this.itemTop.x=this.dianshi.x-120,this.itemTop.y=this.dianshi.y-210}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4013);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this.dianshi&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this.dianshi.x-120,this.itemTop.y=this.dianshi.y-210},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._plug.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&(1==this._television.isPlay()?0:this._television.gotoAndStop(1))):this._chaTou.dropItem?this._television.gotoAndStop(0):(this._plug.gotoAndStop(0),this._television.gotoAndStop(0))},s.socketRemoveFromParent=function(){this._plug.gotoAndStop(0),this._television.gotoAndStop(0),this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("twoRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Television,"Television");var TelevisionInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="电视机",this._ratedWorkLab.text="120"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(TelevisionInfoPanel,"TelevisionInfoPanel");var ThreeSocket=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this.currentAppliance=null,this._grod=null,this._socket=null,this.probFireL=null,this.probFireR=null,this._fireWire=null,this._nullWire=null,this._groundWire=null,this._nodeData1=null,this._nodeData2=null,this._nodeData3=null,this._hasResetIndex=!1,this.name="三孔插座"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=160,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-70,i.y=this.bposter0.y-110,i.text=t,i.touchEnabled=!1},s.setWorkPower=function(t){if(0>t&&(t=Math.abs(t)),HomeElectricsView.getInstance()._homeElectric._isOpen||(t=0),this.Power=t,1>t&&(this.Power=0),console.log(t,"ThreePower====="),this.currentAppliance){var e=t>0?!0:!1;this.currentAppliance.dispatchEventWith("PowerChange",!1,e),this.setTxtInfo(this.Power)}},s.setTxtInfo=function(t){this.txt_.text=t.toFixed(1)+"V\n"+(t/this.Resistance).toFixed(1)+"A"},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_threesocket"),this._grod=this.spr.getImage("grop"),this._socket=this.spr.getImage("socket"),this.probFireL=this.spr.getImage("_fire1"),this.probFireR=this.spr.getImage("_fire2"),this._fireWire=new egret.Shape,this.addChildAt(this._fireWire,0),this._nullWire=new egret.Shape,this.addChildAt(this._nullWire,0),this._groundWire=new egret.Shape,this.addChildAt(this._groundWire,0),this.initPoster(),this.drawBaseLine(),this._fireWire.color=ElectricsConst.COLOR_FIREWIRE,this._nullWire.color=ElectricsConst.COLOR_NULLWIRE,this._nodeData1={item:this,node:this._fireWire},this._nodeData2={item:this,node:this._nullWire},this._fireWire.item=this,this._nullWire.item=this,this._fireWire.name="红线",this._nullWire.name="蓝线",this._nodeArr.push(this._fireWire,this._nullWire),this._fireWire.type="line",this._nullWire.type="line",this.topItem=null},s.initPoster=function(){this.bposter0=new experimentalApparatus.Electricity.BindMC("bposter0",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("bposter1",this),this.bposter0.touchEnabled=!1,this.bposter1.touchEnabled=!1,this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.color=ElectricsConst.COLOR_NULLWIRE,this.bposter1.color=ElectricsConst.COLOR_FIREWIRE,this.bposter0.item=this,this.bposter1.item=this,this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1");var t=this;this.addLabel(this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-this.txt_.width/2,this.txt_.y=this.bposter0.y-85,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,t.addChild(this.bposter0),t.addChild(this.bposter1)},s.getBinders=function(){return[this._nodeData1,this._nodeData2,this._nodeData3]},s.drawBaseLine=function(){this._nullWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_NULLWIRE),this._nullWire.graphics.moveTo(this._socket.x-this._socket.width/4,this._socket.y-this._socket.height/2),this._nullWire.graphics.lineTo(this._socket.x-this._socket.width/4,this._socket.y-this._socket.height/2-40),this._nullWire.graphics.lineTo(this._socket.x-this._socket.width/4-10,this._socket.y-this._socket.height/2-55),this.bposter0.x=this._socket.x-this._socket.width/4-10,this.bposter0.y=this._socket.y-this._socket.height/2-55,this._fireWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._fireWire.graphics.moveTo(this._socket.x+this._socket.width/4,this._socket.y-this._socket.height/2),this._fireWire.graphics.lineTo(this._socket.x+this._socket.width/4,this._socket.y-this._socket.height/2-30),this._fireWire.graphics.lineTo(this._socket.x+this._socket.width/4+10,this._socket.y-this._socket.height/2-45),this.bposter1.x=this._socket.x+this._socket.width/4+10,this.bposter1.y=this._socket.y-this._socket.height/2-45,this._groundWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_GROUNDWIRE),this._groundWire.graphics.moveTo(this._socket.x+this._socket.width/2,this._socket.y),this._groundWire.graphics.lineTo(this._grod.x,this._socket.y),this._groundWire.graphics.lineTo(this._grod.x,this._grod.y-this._grod.height/2),this._nullWire.gap=new egret.Point(-this.spr.width/2-20,-65),this._fireWire.gap=new egret.Point(this.spr.width/2+20,-50),this.bposter0.gap=0,this.bposter1.gap=this.bposter1.x-this.bposter0.x},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=-this.itemTop.width/2+10,this.itemTop.y=-this.measuredHeight/2-140},s.onMove=function(e){if(t.prototype.onMove.call(this,e),this.currentAppliance){var i=this.currentAppliance.parent.globalToLocal(this.x,this.y);this.currentAppliance.x=i.x,this.currentAppliance.y=i.y+6,this.currentAppliance.parent.parent.drawLine()}var s=HomeElectricsView.getInstance().hitTestRectObjs(this,4018);if(s&&!this._hasResetIndex){var n=this.parent.getChildIndex(this),r=this.parent.getChildIndex(s);this.parent.setChildIndex(this,n>r?r:n),this.parent.setChildIndex(s,r>n?r:n),this._hasResetIndex=!0}},s._onEnd=function(e){t.prototype._onEnd.call(this,e),this.test()},s.test=function(){var t=HomeElectricsView.getInstance().hitTestRectObjs(this,4018);if(!t)return void this.initTopItem();var e=null;this.hitTestObjs(this.probFireL,t.probeFire)&&(e=this.bposter0),this.hitTestObjs(this.probFireR,t.probeFire)&&(e=this.bposter1);var i=this.getLineEnd(this,e);t&&!this.currentAppliance&&i&&"红线"==i.name?(t.dropItem=this,t.getbool(!0),this.topItem=t):this.initTopItem(),this._hasResetIndex=!1},s.initTopItem=function(){this.topItem&&(this.topItem.dropItem=null,this.topItem.getbool(!1),this.topItem=null)},s.checkDraw=function(t,e){return this.bposter1.hitTestPoint(t,e)?this.bposter1:this.bposter0.hitTestPoint(t,e)?this.bposter0:void 0},s.checkRectHittest=function(t){var e=t.getBounds(),i=this.bposter0.getBounds(),s=this.bposter1.getBounds(),n=t.parent.localToGlobal(t.x,t.y),r=this.bposter0.parent.localToGlobal(this.bposter0.x,this.bposter0.y),h=this.bposter1.parent.localToGlobal(this.bposter1.x,this.bposter1.y);return e.x=n.x,e.y=n.y,i.x=r.x,i.y=r.y,s.x=h.x,s.y=h.y,e.intersects(i)?this.bposter0:e.intersects(s)?this.bposter1:null},s.getProObj=function(){return t.prototype.getProObj.call(this),this.data},s.dispose=function(){this.currentAppliance&&this.currentAppliance.dispatchEventWith("threeRemoveFromParent",!1,this),this.topItem&&this.topItem.dispatchEventWith("socketThreeRemoveFromParent",!1,this),this.topItem=null,this.currentAppliance=null,t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(ThreeSocket,"ThreeSocket");var ThreeSocketInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="三孔插座",this._workLab.text="",this._volLab.text="",this._ratedVolLab.text="",this._ratedWorkLab.text=""},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(ThreeSocketInfoPanel,"ThreeSocketInfoPanel");var TwoSocket=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i,3),this.currentAppliance=null,this._fireWire=null,this._nullWire=null,this._nodeData1=null,this._nodeData2=null,this.probFireL=null,this.probFireR=null,this._hasRestIndex=!1,this.name="双孔插座"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addLabel=function(t){var e=this,i=new egret.TextField;e.addChild(i),i.textAlign=egret.HorizontalAlign.CENTER,i.width=160,i.height=20,i.size=18,i.selectable=!1,i.x=this.bposter0.x-70,i.y=this.bposter0.y-110,i.text=t,i.touchEnabled=!1},s.setWorkPower=function(t){if(0>t&&(t=Math.abs(t)),HomeElectricsView.getInstance()._homeElectric._isOpen||(t=0),this.Power=t,console.log(t,"TwoPower====="),1>t&&(this.Power=0),this.currentAppliance){var e=t>0?!0:!1;this.currentAppliance.dispatchEventWith("PowerChange",!1,e),this.setTxtInfo(this.Power)}},s.setTxtInfo=function(t){this.txt_.text=t.toFixed(1)+"V\n"+(t/this.Resistance).toFixed(1)+"A"},s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_twosocket"),this.probFireL=this.spr.getImage("_fire1"),this.probFireR=this.spr.getImage("_fire2"),this._fireWire=new egret.Shape,this.addChildAt(this._fireWire,0),this._nullWire=new egret.Shape,this.addChildAt(this._nullWire,0),this._nodeData1={item:this,node:this._fireWire},this._nodeData2={item:this,node:this._nullWire},this._fireWire.item=this,this._nullWire.item=this,this._nodeArr.push(this._fireWire,this._nullWire),this._fireWire.name="红线",this._nullWire.name="蓝线",this.initPoster(),this.drawBaseLine(),this._fireWire.type="line",this._fireWire.color=ElectricsConst.COLOR_FIREWIRE,this._nullWire.type="line",this._nullWire.color=ElectricsConst.COLOR_NULLWIRE,this.topItem=null
},s.initPoster=function(){this.bposter0=new experimentalApparatus.Electricity.BindMC("bposter0",this),this.bposter1=new experimentalApparatus.Electricity.BindMC("bposter1",this),this.bposter0.touchEnabled=!1,this.bposter1.touchEnabled=!1,this.bposter0.name="bposter0",this.bposter1.name="bposter1",this.bposter0.color=ElectricsConst.COLOR_NULLWIRE,this.bposter1.color=ElectricsConst.COLOR_FIREWIRE,this.bposter0.item=this,this.bposter1.item=this,this.bposter0.bindinger=this.addBinPoster(this.bposter0,"bposter0"),this.bposter1.bindinger=this.addBinPoster(this.bposter1,"bposter1");var t=this;this.addLabel(this.name),this.txt_=new egret.TextField,t.addChild(this.txt_),this.txt_.textAlign=egret.HorizontalAlign.CENTER,this.txt_.width=70,this.txt_.height=30,this.txt_.selectable=!1,this.txt_.x=this.bposter0.x-this.txt_.width/2,this.txt_.y=this.bposter0.y-75,this.txt_.text="0V 0A",this.txt_.size=18,this.txt_.touchEnabled=!1,this.Resistance=experimentalApparatus.Electricity.ElecUtil.MIN_RESISTANCE,t.addChild(this.bposter0),t.addChild(this.bposter1)},s.getBinders=function(){return[this._nodeData1,this._nodeData2]},s.drawBaseLine=function(){this._fireWire.graphics.clear(),this._nullWire.graphics.clear(),this._nullWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_NULLWIRE),this._nullWire.graphics.moveTo(this.spr.x-this.spr.width/2,this.spr.y),this._nullWire.graphics.lineTo(this.spr.x-this.spr.width/2-20,this.spr.y),this._nullWire.graphics.lineTo(this.spr.x-this.spr.width/2-20,this.spr.y-70),this.bposter0.x=this.spr.x-this.spr.width/2-20,this.bposter0.y=this.spr.y-70,this._fireWire.graphics.lineStyle(ElectricsConst.WEIGHT_WIRE,ElectricsConst.COLOR_FIREWIRE),this._fireWire.graphics.moveTo(this.spr.x+this.spr.width/2,this.spr.y),this._fireWire.graphics.lineTo(this.spr.x+this.spr.width/2+20,this.spr.y),this._fireWire.graphics.lineTo(this.spr.x+this.spr.width/2+20,this.spr.y-50),this.bposter1.x=this.spr.x+this.spr.width/2+20,this.bposter1.y=this.spr.y-50,this._nullWire.gap=new egret.Point(-this.spr.width/2-20,-70),this._fireWire.gap=new egret.Point(this.spr.width/2+20,-50),this.bposter0.gap=0,this.bposter1.gap=this.bposter1.x-this.bposter0.x},s.onMove=function(e){if(t.prototype.onMove.call(this,e),this.currentAppliance){var i=this.currentAppliance.parent.globalToLocal(this.x,this.y);this.currentAppliance.x=i.x,this.currentAppliance.y=i.y,this.currentAppliance.parent.parent.drawLine()}var s=HomeElectricsView.getInstance().hitTestRectObjs(this,4018);if(s&&!this._hasRestIndex){var n=this.parent.getChildIndex(this),r=this.parent.getChildIndex(s);this.parent.setChildIndex(this,n>r?r:n),this.parent.setChildIndex(s,r>n?r:n),this._hasRestIndex=!0}},s._onEnd=function(e){t.prototype._onEnd.call(this,e),this.test()},s.test=function(){var t=HomeElectricsView.getInstance().hitTestRectObjs(this,4018);if(!t)return void this.initTopItem();var e=null;this.hitTestObjs(this.probFireL,t.probeFire)&&(e=this.bposter0),this.hitTestObjs(this.probFireR,t.probeFire)&&(e=this.bposter1);var i=this.getLineEnd(this,e);t&&!this.currentAppliance&&i&&"红线"==i.name?(t.dropItem=this,t.getbool(!0),this.topItem=t):this.initTopItem(),this._hasRestIndex=!1},s.initTopItem=function(){this.topItem&&(this.topItem.dropItem=null,this.topItem.getbool(!1),this.topItem=null)},s.checkDraw=function(t,e){return this.bposter0.hitTestPoint(t,e)?this.bposter0:this.bposter1.hitTestPoint(t,e)?this.bposter1:void 0},s.checkRectHittest=function(t){var e=t.getBounds(),i=this.bposter0.getBounds(),s=this.bposter1.getBounds(),n=t.parent.localToGlobal(t.x,t.y),r=this.bposter0.parent.localToGlobal(this.bposter0.x,this.bposter0.y),h=this.bposter1.parent.localToGlobal(this.bposter1.x,this.bposter1.y);return e.x=n.x,e.y=n.y,i.x=r.x,i.y=r.y,s.x=h.x,s.y=h.y,e.intersects(i)?this.bposter0:e.intersects(s)?this.bposter1:null},s.getProObj=function(){return t.prototype.getProObj.call(this),this.data},s.dispose=function(){this.currentAppliance&&this.currentAppliance.dispatchEventWith("twoRemoveFromParent",!1,this),this.topItem&&this.topItem.dispatchEventWith("socketTwoRemoveFromParent",!1,this),this.topItem=null,this.currentAppliance=null,t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(TwoSocket,"TwoSocket");var TwoSocketInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="双孔插座",this._workLab.text="",this._volLab.text="",this._ratedVolLab.text="",this._ratedWorkLab.text=""},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(TwoSocketInfoPanel,"TwoSocketInfoPanel");var Washer=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._chaTou=null,this._xiYiJi=null,this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.prePos=new egret.Point,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_washer"),this._chaTou=this.spr.getMovie("plug"),this._xiYiJi=this.spr.getMovie("washer"),this._chaTou.touchEnabled=!0,this._xiYiJi.touchEnabled=!0,this._xiYiJi.gotoAndStop(0),this._chaTou.gotoAndStop(0),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._xiYiJi.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._xiYiJi.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null,this._chaTou.addEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),this.drawLine()},s.drawLine=function(){1==this._chaTou.getCurrentFrame()?this._chaTou.anchorOffsetX=0:this._chaTou.anchorOffsetX=-5,this._xiYiJi.anchorOffsetY=70;var t=this.getPosition(this._xiYiJi),e=new egret.Point(this._chaTou.x,this._xiYiJi.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this._xiYiJi.parent.localToGlobal(this._xiYiJi.x,this._xiYiJi.y,this.coords),"washer"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("washer"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this._xiYiJi.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._xiYiJi.x=e.x,this._xiYiJi.y=e.y,this.itemTop.x=this._xiYiJi.x-120,this.itemTop.y=this._xiYiJi.y-210}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){"washer"!=t.target.name&&this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4012);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y+6,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this._xiYiJi&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this._xiYiJi.x-120,this.itemTop.y=this._xiYiJi.y-210},s.getbool=function(t){if("boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem){if(this._chaTou.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0){this._xiYiJi.gotoAndStop(1);var e=this._xiYiJi.getChildAt(0);1==e.isPlay()?0:e.gotoAndPlay(0)}this._chaTou.anchorOffsetX=0}else this._chaTou.dropItem?this._xiYiJi.gotoAndStop(0):(this._chaTou.gotoAndStop(0),this._xiYiJi.gotoAndStop(0),this._chaTou.anchorOffsetX=-5)},s.socketRemoveFromParent=function(){this._chaTou.gotoAndStop(0),this._xiYiJi.gotoAndStop(0),this._chaTou.anchorOffsetX=-5,this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Washer,"Washer");var WasherInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="洗衣机",this._ratedWorkLab.text="400W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(WasherInfoPanel,"WasherInfoPanel");var Wicroblog=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.call(this,e,i),this._wOffX=0,this._wOffY=0,this._touchBeginObj=null,this.coords=new egret.Point,this.coords1=new egret.Point}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),t.prototype.init.call(this,"spr_microwave"),this._Wicroblog=this.spr.getMovie("microwave"),this._Wicroblog.gotoAndStop(0),this._plug=this.spr.getMovie("plug"),this._plug.gotoAndStop(0),this.onAddbagin(null),this._jtLine=new egret.Shape,this.addChildAt(this._jtLine,0),this.drawLine(),this._chaTou.addEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this)},s.drawLine=function(){1==this._plug.getCurrentFrame()?this._chaTou.anchorOffsetX=0:this._chaTou.anchorOffsetX=-5,this.weibo.anchorOffsetY=30;var t=this.getPosition(this.weibo),e=new egret.Point(this._chaTou.x,this.weibo.y),i=this.getPosition(this._chaTou);this._jtLine.graphics.clear(),this._jtLine.graphics.lineStyle(5,16766720),this._jtLine.graphics.moveTo(t.x,t.y),this._jtLine.graphics.lineTo(e.x,e.y),this._jtLine.graphics.lineTo(i.x,i.y)},s.onAddbagin=function(t){this.weibo=this.spr.getImage("microwave"),this._chaTou=this.spr.getImage("plug"),this.weibo.touchEnabled=!0,this._chaTou.touchEnabled=!0,this._chaTou.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this.weibo.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTOUbagin,this),this._chaTou.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this.weibo.addEventListener(egret.TouchEvent.TOUCH_END,this.onTOUend,this),this._chaTou.dropItem=null},s.onTOUbagin=function(t){this.ro=!0,this.parent.setChildIndex(this,1e5),ElectricsConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this),this._chaTou.parent.localToGlobal(this._chaTou.x,this._chaTou.y,this.coords1),this.weibo.parent.localToGlobal(this.weibo.x,this.weibo.y,this.coords),"microwave"==t.target.name?(this._wOffX=t.stageX-this.coords.x,this._wOffY=t.stageY-this.coords.y):(this._wOffX=t.stageX-this.coords1.x,this._wOffY=t.stageY-this.coords1.y),this._touchBeginObj=t.target},s.onTOUmove=function(t){if("microwave"==this._touchBeginObj.name){var e=(t.stageX-this.coords.x,t.stageY-this.coords.y,this.weibo.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this.weibo.x=e.x,this.weibo.y=e.y,this.itemTop.x=this.weibo.x-120,this.itemTop.y=this.weibo.y-170}else{var i=(t.stageX-this.coords1.x,t.stageY-this.coords1.y,this._chaTou.parent.globalToLocal(t.stageX-this._wOffX,t.stageY-this._wOffY));this._chaTou.x=i.x,this._chaTou.y=i.y}this.drawLine()},s.onTOUend=function(t){"microwave"!=t.target.name&&this.diyChanged(),ElectricsConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTOUmove,this);var e=HomeElectricsView.getInstance().hittestObjects(new egret.Point(t.stageX,t.stageY),4012);if(e&&t.currentTarget==this._chaTou){if(e.currentAppliance&&e.currentAppliance!=this._chaTou)return;var i=this._chaTou.parent.globalToLocal(e.x,e.y);this._chaTou.x=i.x,this._chaTou.y=i.y+6,this.drawLine(),e.currentAppliance=this._chaTou,this._chaTou.dropItem=e,this._chaTou.addEventListener("PowerChange",this.getbool,this),this.getbool(!0)}else t.currentTarget!=this.weibo&&(this.initChaTouDropItem(this),this.getbool(!1))},s.openProPanel=function(){t.prototype.openProPanel.call(this),this.itemTop.x=this.weibo.x-120,this.itemTop.y=this.weibo.y-170},s.getbool=function(t){"boolean"!=typeof t&&(t=t.data),t&&this._chaTou.dropItem?(this._plug.gotoAndStop(1),ElectricBrake.getInstance()._isOpen&&this._chaTou.dropItem.Power>0&&(1==this._Wicroblog.isPlay()||0!=this._Wicroblog.getCurrentFrame()?0:this._Wicroblog.gotoAndPlay(1)),this._chaTou.anchorOffsetX=0):this._chaTou.dropItem?this._Wicroblog.gotoAndStop(0):(this._plug.gotoAndStop(0),this._Wicroblog.gotoAndStop(0),this._chaTou.anchorOffsetX=-5)},s.socketRemoveFromParent=function(){this._plug.gotoAndStop(0),this._Wicroblog.gotoAndStop(0),this._chaTou.anchorOffsetX=-5,this.initChaTouDropItem(this)},s.getProObj=function(){return this.data.chatouPos=this.getPosition(this._chaTou),t.prototype.getProObj.call(this),this.data},s.setCopyData=function(t){this.data=t,t.chatouPos&&this.setPosition(this._chaTou,t.chatouPos),this.drawLine()},s.dispose=function(){this.initChaTouDropItem(this),this._chaTou.removeEventListener("threeRemoveFromParent",this.socketRemoveFromParent,this),t.prototype.dispose.call(this)},e}(HBaseItem);egret.registerClass(Wicroblog,"Wicroblog");var WicroblogInfoPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/HElectronicInfo.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this._btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.deleteItem,this),this._proName.text="微波炉",this._ratedWorkLab.text="1000W"},s.deleteItem=function(){t.prototype.deleteItem.call(this)},e}(HInfoPanelBase);egret.registerClass(WicroblogInfoPanel,"WicroblogInfoPanel");var LightConst=function(){function t(){}var e=(__define,t);e.prototype;return t.getColor=function(e){var i="";switch(e){case t.COLOR_RED:i="红色";break;case t.COLOR_ORANGE:i="橙色";break;case t.COLOR_YELLOW:i="黄色";break;case t.COLOR_GREEN:i="绿色";break;case t.COLOR_NAVY:i="青色";break;case t.COLOR_BLUE:i="蓝色";break;case t.COLOR_PURPLE:i="紫色"}return i},t.getColorV=function(e){var i=0;switch(e){case t.COLOR_RED:i=.02;break;case t.COLOR_ORANGE:i=.04;break;case t.COLOR_YELLOW:i=.06;break;case t.COLOR_GREEN:i=.08;break;case t.COLOR_NAVY:i=.1;break;case t.COLOR_BLUE:i=.12;break;case t.COLOR_PURPLE:i=.14}return i},t.LIGHT_THICK=2,t.COLOR_RED=15073298,t.COLOR_ORANGE=15964160,t.COLOR_YELLOW=16773376,t.COLOR_GREEN=46409,t.COLOR_NAVY=48298,t.COLOR_BLUE=245503,t.COLOR_PURPLE=7741439,t.ITEMS_COLL=Math.pow(2,4),t.ITEMS_HIT=Math.pow(2,5),t.REFRA_1=1.5,t.REFRA_2=1.6,t.REFRA_3=1.7,t.REFRA_4=1.8,t.REFRA_5=1.9,t.REFRA_6=2,t}();egret.registerClass(LightConst,"LightConst");var LightItemType=function(){function t(){}var e=(__define,t);e.prototype;return t.Box=1001,t.Circle=1002,t.SemiCircle=1003,t.Tri=1004,t.AMirrItem=1005,t.VMirrItem=1006,t.CardItem=1007,t.MirrPItem=1008,t.MirrItem=1009,t.KongItem=1010,t.MagnItem=1011,t.MirrPItem2=1012,t.AMirrItem2=1013,t.VMirrItem2=1014,t.HighFieldItem=1015,t.ColorItem=1016,t.FibreItem=1017,t.WaterItem=1018,t.MiragesItem=1019,t.FishItem=1020,t.ColorItem2=1021,t.KuaiziItem=1022,t.EyeItem=1023,t.LasterLight=2001,t.WhiteLight=2003,t.ParalleLight=2002,t.CandleLight=2004,t}();egret.registerClass(LightItemType,"LightItemType");var LightUtils=function(){function t(){}var e=(__define,t);e.prototype;return t.getLightItem=function(e,i,s){var n=t.getLightConfig(e.type),r=egret.getDefinitionByName(n.cls),h=new r(i,s);return h.typeid=n.type,h.infoCls=n.infoCls,h.config=n,s.itemContainer.addChild(h),h.Position([e.x,e.y]),h.setCopy(e),h},t.saveOpera=function(){for(var e=MainView.getInstance().curView,i='{"'+MainView.getInstance().curLab+'":{',s=e.itemContainer.numChildren,n=0;s>n;n++){var r=e.itemContainer.getChildAt(n),h=r.getProObj();null!=h&&(i+='"'+n+'":'+JSON.stringify(h)+",")}i=0==s?i:i.substring(0,i.length-1),i+="}}";var o=JSON.parse(i);t.backArr.length>10&&t.backArr.shift(),t.backArr.push(o),t.curIndex=t.backArr.length-1},t.ctrlZ=function(){if(t.backArr.length>0)if(t.curIndex>0){t.curIndex--;var e=t.backArr[t.curIndex];t.reFreshView(e)}else t.curIndex=0},t.ctrlY=function(){if(t.curIndex<t.backArr.length-1){t.curIndex++;var e=t.backArr[t.curIndex];t.reFreshView(e)}},t.reFreshView=function(e){var i=Object.keys(e);t.showView(MainView.getInstance().curView,e[i[0]])},t.toSave=function(t,e,i){for(var s='{"'+e+'":{',n=t.itemContainer.numChildren,r=0;n>r;r++){var h=t.itemContainer.getChildAt(r),o=h.getProObj();null!=o&&(e!=LabType.HomeElectric&&(o.x=o.x/1920*1280,o.y=o.y/1440*960,o.drawData&&o.drawData.forEach(function(t){t.x=t.x/1920*1280,t.y=t.y/1440*960})),s+='"'+r+'":'+JSON.stringify(o)+",")}s=0==n?s:s.substring(0,s.length-1);var a=MainView.getInstance().exportPanel.getComStr(),l='"exportC":['+a+"]";s+="},"+l+"}",doSave(s,"application/json",i+".json")},t.showView=function(t,e){t.dispose(),t.itemContainer.removeChildren();for(var i in e)var s=this.getLightItem(e[i],t.world,t)},t.showElectView=function(t,e){t.dispose(),t.itemContainer.removeChildren()},t.isInRect=function(t){return t[0]>MainView.mainRect[0]&&t[0]<MainView.mainRect[2]&&t[1]>MainView.mainRect[1]&&t[1]<MainView.mainRect[3]?!0:!1},t.isColl=function(t,e){for(var i=e.bodies.length,s=0;i>s;s++){var n=e.bodies[s],r=n.shapes[0];if(r&&r!==t&&0!=(t.collisionGroup&r.collisionMask)&&0!=(r.collisionGroup&t.collisionMask))return!0}return!1},t.segmentsIntr=function(t,e,i,s){var n=(t.x-i.x)*(e.y-i.y)-(t.y-i.y)*(e.x-i.x),r=(t.x-s.x)*(e.y-s.y)-(t.y-s.y)*(e.x-s.x);if(n*r>=0)return!1;var h=(i.x-t.x)*(s.y-t.y)-(i.y-t.y)*(s.x-t.x),o=h+n-r;if(h*o>=0)return!1;var a=h/(r-n),l=a*(e.x-t.x),c=a*(e.y-t.y);return{x:t.x+l,y:t.y+c}},t.hasCandle=function(t){for(var e=t.numChildren,i=0;e>i;i++){var s=t.getChildAt(i);if(s instanceof CandleLight)return!0}return!1},t.drawDotLine=function(t,e,i,s){for(var n=Math.floor((i.x-e.x)/20),r=0;n>r;r++)r%2==0&&(t.graphics.moveTo(e.x+20*r,e.y+20*r/s),t.graphics.lineTo(e.x+20*(r+1),e.y+20*(r+1)/s))},t.drawDotLineXY=function(t,e,i,s,n,r){for(var h=10*Math.sin(Math.atan(r)),o=10*Math.cos(Math.atan(r)),a=0==h?100:Math.abs(Math.floor((s-e)/h)),l=0;a>l;l++){var c=l;l%2==0&&(t.graphics.moveTo(e+c*h,i+c*o),t.graphics.lineTo(e+(c+1)*h,i+(c+1)*o))}},t.drawDotLineXY2=function(t,e,i,s,n,r){var h=Math.floor((s-e)/10);if(h>0)for(var o=0;h>o;o++)o%2==0&&(t.graphics.moveTo(e+10*o,i+10*o/r),t.graphics.lineTo(e+10*(o+1),i+10*(o+1)/r));else if(0>h)for(var o=0;o>h;o--)o%2==0&&(t.graphics.moveTo(e+10*o,i+10*o/r),t.graphics.lineTo(e+10*(o-1),i+10*(o-1)/r));else for(var o=0;20>o;o++){var a=n>i?o:-o;o%2==0&&(t.graphics.moveTo(e,i+10*a),t.graphics.lineTo(e,i+10*(a+1)))}},t.drawDotLineXY3=function(t,e,i,s,n){for(var r=(n-i)/(s-e),h=10*Math.cos(Math.atan(r)),o=10*Math.sin(Math.atan(r)),a=Math.abs(Math.floor((s-e)/h)),l=0;a>l;l++){var c=l;l%2==0&&(t.graphics.moveTo(e+c*h,i+c*o),t.graphics.lineTo(e+(c+1)*h,i+(c+1)*o))}},t.drawDotBorder=function(t,e,i,s,n,r,h,o,a){this.drawDotLineXX(t,e,i,s,n),this.drawDotLineXX(t,o,a,r,h),this.drawDotLineYY(t,s,n,r,h),this.drawDotLineYY(t,e,i,o,a)},t.drawDotLineYY=function(t,e,i,s,n){for(var r=Math.abs(Math.ceil((n-i)/5)),h=0;r>h;h++){var o=h;h%2==0&&(t.graphics.moveTo(e,i+5*o),t.graphics.lineTo(e,i+5*(o+1)))}},t.drawDotLineXX=function(t,e,i,s,n){for(var r=Math.abs(Math.ceil((s-e)/5)),h=0;r>h;h++){var o=h;h%2==0&&(t.graphics.moveTo(e+5*o,i),t.graphics.lineTo(e+5*(o+1),i))}},t.getLightConfig=function(t){var e=RES.getRes("light_json");for(var i in e)if(e[i].type==t)return e[i];return null},t.rayCasting=function(t,e){for(var i=t.x,s=t.y,n=!1,r=0,h=e.length,o=h-1;h>r;o=r,r++){var a=e[r].x,l=e[r].y,c=e[o].x,d=e[o].y;if(a===i&&l===s||c===i&&d===s)return"on";if(s>l&&d>=s||l>=s&&s>d){var u=a+(s-l)*(c-a)/(d-l);if(u===i)return"on";u>i&&(n=!n)}}return n?"in":"out"},t.backArr=[],t}();egret.registerClass(LightUtils,"LightUtils");var LightView=function(t){function e(e){t.call(this,e),this.reflect=!1,this.angleVis=!1,this.showFigure=!1,this.showEye=!1,this.showX=!1,this._currentInfoPanel=null,this.result=new p2.RaycastResult,this.hitPoint=p2.vec2.create(),this.ray=new p2.Ray({mode:p2.Ray.CLOSEST}),this.stop=!1,this.fromPre=[],this.toPre=[],this.dirPre=[],this.a=new egret.Point,this.b=new egret.Point,this.c=new egret.Point,this.d=new egret.Point,this.airIndex=1,this.shapeIndex=1.5}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initUI=function(){t.prototype.initUI.call(this),this.lightArr=[],this.initItems(),MessageCenter.getInstance().addListener(ItemEventConst.ADD_ITEM,this.addItem,this),MessageCenter.getInstance().addListener(ItemEventConst.COPY_ITEM,this.copyItem,this),this.refLine=new egret.Sprite,this.refLine.graphics.lineStyle(LightConst.LIGHT_THICK,16776960,.7),this.addChild(this.refLine),this.normalLine=new egret.Sprite,this.normalLine.graphics.lineStyle(LightConst.LIGHT_THICK,16777215),this.addChild(this.normalLine),this.dotLine=new egret.Sprite,this.dotLine.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_YELLOW),this.addChild(this.dotLine),this.dotLine2=new egret.Sprite,this.dotLine2.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_YELLOW),this.addChild(this.dotLine2),this.figure=new egret.Bitmap,this.figure.visible=!1,this.figure.texture=RES.getRes("candle_png"),this.figure.anchorOffsetX=this.figure.width/2,this.addChild(this.figure),this.normalSatrt=new egret.Point,this.normalEnd=new egret.Point,this.txtSp=new egret.Sprite,this.addChild(this.txtSp),this.txtArr=[]},s.copyItem=function(t){var e=LightUtils.getLightItem(t,this.world,this);e.Position([t.x+100,t.y]),this.changeToX(this.showX)},s.addItem=function(t,e){if(LightUtils.isInRect(e)){var i=egret.getDefinitionByName(t.cls),s=new i(this.world,this);s.typeid=t.type,s.infoCls=t.infoCls,this.itemContainer.addChild(s),s.Position(e);var n=LightUtils.getLightConfig(t.type);s.config=n,this.changeToX(this.showX),LightUtils.saveOpera()}},s.initItems=function(){},s.setEyeVis=function(t){this.eye.setVis(t)},s.render=function(){this.lightArr.length=0;for(var t=0;t<this.itemContainer.numChildren;t++){var e=this.itemContainer.getChildAt(t);e instanceof BaseLight&&(this.lightArr=this.lightArr.concat(e.lineArr))}if(0!=this.lightArr.length){for(var t=0;t<this.lightArr.length;t++)this.lightArr[t].clear(),this.lightArr[t].visible=!this.showEye;this.refLine.graphics.clear(),this.normalLine.graphics.clear(),this.dotLine.graphics.clear(),this.dotLine2.graphics.clear(),this.figure.visible=!1,this.txtArr=[];for(var i=this.txtSp.numChildren,s=0;i>s;s++)this.txtSp.getChildAt(s).visible=!1,this.txtArr.push(this.txtSp.getChildAt(s));this.drawRays()}},s.drawRays=function(){this.fromPre=[],this.toPre=[];for(var t=this.lightArr.length,i=0;t>i;i++)if(this.stop=!1,this.ray.from[0]=this.lightArr[i].posX,this.ray.from[1]=this.lightArr[i].posY,this.lightArr[i].parent){if(this.lightArr[i].parent.parent instanceof CandleLight)var s=this.lightArr[i].rotation*Math.PI/180;else var s=this.lightArr[i].Rotation*Math.PI/180;this.ray.direction[0]=Math.cos(s),this.ray.direction[1]=Math.sin(s),this.ray.to[0]=this.ray.from[0]+100*this.ray.direction[0]*20,this.ray.to[1]=this.ray.from[1]+100*this.ray.direction[1]*20,this.ray.update(),this.lightArr[i].setStyle(this.lightArr[i].thicknes,this.lightArr[i].color);var n=0;for(this.hitDisplay=null;this.world.raycast(this.result,this.ray)&&n++<50;){if(this.result.getHitPoint(this.hitPoint,this.ray),this.result.body.displays&&(this.hitDisplay=this.result.body.displays[0]),-1==this.result.body.refrac){this.lightArr[i].move(this.ray.from,this.hitPoint,n),this.result.reset(),this.stop=!0;break}if(this.stop=!1,this.dotV=p2.vec2.dot(this.result.normal,this.ray.direction),16777215==this.lightArr[i].color){if(!(this.dotV>=.99&&this.dotV<=1||this.dotV>=-1&&this.dotV<=-.99)){this.lightArr[i].move(this.ray.from,this.hitPoint,n),this.result.reset(),this.stop=!0;break}this.lightArr[i].move(this.ray.from,this.hitPoint,n),this.stop=!1}else this.lightArr[i].move(this.ray.from,this.hitPoint,n),this.stop=!1;(this.reflect||e.showArrow)&&(this.currentTxt1=this.getTxt(),this.currentTxt2=this.getTxt(),this.currentTxt3=this.getTxt(),this.showRef(this.hitPoint,this.ray.direction,this.result.normal,this.currentTxt1,this.currentTxt2,this.currentTxt3)),this.reflect&&this.angleVis&&this.showAngle(this.hitPoint,this.ray.direction,this.result.normal,this.currentTxt1,this.currentTxt2),p2.vec2.copy(this.ray.from,this.hitPoint),this.ray.update(),0==this.result.body.refrac||-1==this.result.body.refrac?this.shapeIndex=this.result.body.refrac:this.shapeIndex=this.result.body.refrac+this.lightArr[i].lineV,n%2==0&&(this.result.body.displays[0]instanceof EyeItem||this.result.body.displays[0]instanceof AMirrItem||this.result.body.displays[0]instanceof VMirrItem)||this.refract(this.ray.direction,this.ray.direction,this.result.normal,this.airIndex,this.shapeIndex),this.reflect&&this.angleVis&&this.showAngle2(this.hitPoint,this.ray.direction,this.result.normal,this.currentTxt3),this.ray.from[0]+=.001*this.ray.direction[0],this.ray.from[1]+=.001*this.ray.direction[1],this.ray.to[0]=this.ray.from[0]+100*this.ray.direction[0]*20,this.ray.to[1]=this.ray.from[1]+100*this.ray.direction[1]*20,this.result.reset()}this.stop||(this.lightArr[i].move(this.ray.from,this.ray.to,n),this.showFigure&&LightUtils.hasCandle(this.itemContainer)&&0!=n&&this.lightArr[i].parent.parent instanceof CandleLight&&this.showJX(this.ray.from,this.ray.to,this.ray.direction,this.lightArr[i],this.hitDisplay),this.showEye&&this.showJX(this.ray.from,this.ray.to,this.ray.direction,this.lightArr[i],this.hitDisplay,"eye"))}},s.showRef=function(t,i,s,n,r,h){this.refLine.graphics.lineStyle(LightConst.LIGHT_THICK,16776960,.7),this.normalLine.graphics.lineStyle(LightConst.LIGHT_THICK,16711680);var o=[],a=[],l=[];a[0]=t[0],a[1]=t[1],p2.vec2.reflect(o,i,s),a[0]+=.001*o[0],a[1]+=.001*o[1],l[0]=a[0]+100*o[0],l[1]=a[1]+100*o[1],(this.reflect||!e.showArrow)&&(this.refLine.graphics.moveTo(a[0],a[1]),this.refLine.graphics.lineTo(l[0],l[1]));var c=[],d=[];c[0]=t[0],c[1]=t[1],c[0]-=100*s[0],c[1]-=100*s[1],d[0]=c[0]+200*s[0],d[1]=c[1]+200*s[1],LightUtils.drawDotLineXY2(this.normalLine,c[0],c[1],d[0],d[1],s[0]/s[1])},s.showAngle=function(t,e,i,s,n){s.visible=!0,n.visible=!0;var r=(p2.vec2.dot(i,e),p2.vec2.fromValues(i[0],i[1]));p2.vec2.rotate(r,r,-Math.PI/2);var h=p2.vec2.dot(r,e);s.text=Math.floor(Math.abs(180*Math.acos(h)/Math.PI-90))+"°",n.text=Math.floor(Math.abs(180*Math.acos(h)/Math.PI-90))+"°";var o=Math.abs(Math.acos(h)-Math.PI/2);if(e[0]>0&&e[1]>0)if(-1==i[1]||1==i[1])var a=Math.atan(i[1]/i[0]);else var a=Math.atan(i[1]/i[0])+Math.PI;else if(e[0]>0&&e[1]<0)var a=Math.atan(i[1]/i[0])+Math.PI;else if(e[0]<0&&e[1]<0)if(-1==i[1]||1==i[1])var a=Math.atan(i[1]/i[0])+Math.PI;else var a=Math.atan(i[1]/i[0]);else if(e[0]<0&&e[1]>0)var a=Math.atan(i[1]/i[0]);else if(-1==i[1]||1==i[1])var a=Math.atan(i[1]/i[0]);else var a=Math.atan(i[1]/i[0])+Math.PI;this.normalLine.graphics.drawArc(t[0],t[1],30,a,a+o),this.normalLine.graphics.drawArc(t[0],t[1],30,a-o,a),s.x=t[0]+60*Math.cos(a+3*o/4),s.y=t[1]+60*Math.sin(a+3*o/4),n.x=t[0]+60*Math.cos(a-3*o/4),n.y=t[1]+60*Math.sin(a-3*o/4)},s.showAngle2=function(t,e,i,s){s.visible=!0;var n=(p2.vec2.dot(i,e),p2.vec2.fromValues(i[0],i[1]));p2.vec2.rotate(n,n,-Math.PI/2);var r=p2.vec2.dot(n,e);s.text=Math.floor(Math.abs(90-180*Math.acos(r)/Math.PI))+"°";var h=Math.abs(Math.PI/2-Math.acos(r));if(e[0]>0&&e[1]>0)if(-1==i[1]||1==i[1])var o=Math.atan(i[1]/i[0]);else var o=Math.atan(i[1]/i[0])+Math.PI;else if(e[0]>0&&e[1]<0)var o=Math.atan(i[1]/i[0])+Math.PI;else if(e[0]<0&&e[1]<0)if(-1==i[1]||1==i[1])var o=Math.atan(i[1]/i[0])+Math.PI;else var o=Math.atan(i[1]/i[0]);else if(e[0]<0&&e[1]>0)var o=Math.atan(i[1]/i[0]);else if(-1==i[1]||1==i[1])var o=Math.atan(i[1]/i[0]);else var o=Math.atan(i[1]/i[0])+Math.PI;Math.PI/2-Math.acos(r)<0?(this.normalLine.graphics.drawArc(t[0],t[1],30,o-Math.PI,o-Math.PI+h),s.x=t[0]+60*Math.cos(o-Math.PI+3*h/4),s.y=t[1]+60*Math.sin(o-Math.PI+3*h/4)):(this.normalLine.graphics.drawArc(t[0],t[1],30,o-Math.PI-h,o-Math.PI),s.x=t[0]+60*Math.cos(o-Math.PI-3*h/4),s.y=t[1]+60*Math.sin(o-Math.PI-3*h/4))},s.showJX=function(t,e,i,s,n,r){if(void 0===r&&(r=""),s.index%2==1)this.fromPre[0]=t[0]-2e3*i[0],this.fromPre[1]=t[1]-2e3*i[1],this.toPre[0]=e[0],this.toPre[1]=e[1],this.dirPre[0]=i[0],this.dirPre[1]=i[1];else{this.a.x=this.fromPre[0],this.a.y=this.fromPre[1],this.b.x=this.toPre[0],this.b.y=this.toPre[1],this.c.x=t[0]-2e3*i[0],this.c.y=t[1]-2e3*i[1],this.d.x=e[0],this.d.y=e[1];var h=LightUtils.segmentsIntr(this.a,this.b,this.c,this.d);if(!h)return;if("eye"==r)return void this.eye.showEyeLine(h.x,h.y);2==s.index&&this.fromPre.length>0&&(this.dotLine.graphics.clear(),this.dotLine.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_YELLOW),LightUtils.drawDotLine(this.dotLine,this.a,this.b,this.dirPre[0]/this.dirPre[1]),LightUtils.drawDotLine(this.dotLine,this.c,this.d,i[0]/i[1]),this.dotLine.visible=h.x>n.x?!1:!0),4==s.index&&this.fromPre.length>0&&(this.dotLine2.graphics.clear(),this.dotLine2.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_YELLOW),LightUtils.drawDotLine(this.dotLine2,this.a,this.b,this.dirPre[0]/this.dirPre[1]),LightUtils.drawDotLine(this.dotLine2,this.c,this.d,i[0]/i[1]),this.dotLine2.visible=h.x>n.x?!1:!0),this.figure.visible=!0,this.figure.x=h.x,this.figure.y=h.y,this.figure.alpha=h.x>t[0]?1:.5}},s.disposeJX=function(){this.dotLine.graphics.clear(),this.dotLine2.graphics.clear()},s.refract=function(t,e,i,s,n){var r=p2.vec2.dot(i,e),h=p2.vec2.fromValues(i[0],i[1]);p2.vec2.rotate(h,h,-Math.PI/2);var o,a=p2.vec2.dot(h,e);if(0>r){this.inAngle=Math.acos(r),p2.vec2.scale(i,i,-1);var l=s/n*Math.sin(this.inAngle);1>=l?(o=Math.asin(l),p2.vec2.rotate(t,i,o*(0>a?-1:1))):p2.vec2.reflect(t,e,i)}else{r=p2.vec2.dot(i,e),this.inAngle=Math.acos(r);var l=n/s*Math.sin(this.inAngle);1>=l?(o=Math.asin(l),p2.vec2.rotate(t,i,o*(0>a?1:-1))):p2.vec2.reflect(t,e,i)}},s.getTxt=function(){var t=this.txtArr.pop();return null==t&&(t=new eui.Label,t.width=60,t.height=30,this.txtSp.addChild(t),t.anchorOffsetX=20,t.anchorOffsetY=20,t.verticalAlign="middle",t.textAlign="center",t.textColor=16711680),t},s.showInfoPanel=function(t,e){this._currentInfoPanel!=t?(this._currentInfoPanel&&(this._currentInfoPanel.visible=!1,this._currentInfoPanel=null),this._currentInfoPanel=t,this._currentInfoPanel.setData(e),this._currentInfoPanel.visible=!0):this._currentInfoPanel._item!=e?(this._currentInfoPanel.setData(e),this._currentInfoPanel.visible=!0):this._currentInfoPanel.visible=this._currentInfoPanel.visible?!1:!0},s.getInfoPanel=function(t,e){for(var i,s=0;s<this.panelContainer.numChildren;s++)if(i=this.getChildAt(s),i.typeid==t)return i;
if(""==e)return console.log("属性面板缺失"),null;var n=egret.getDefinitionByName(e);return i=new n,i.typeid=t,i.x=MainView.mainRect[2]-i.width,i.y=MainView.mainRect[1]+48,this.panelContainer.addChild(i),i},s.changeToX=function(t){for(var e=this.itemContainer.numChildren,i=0;e>i;i++){var s=this.itemContainer.getChildAt(i);s.hasX&&s.changeToX(t)}},s.dispose=function(){for(t.prototype.dispose.call(this);this.itemContainer.numChildren>0;)this.itemContainer.removeChildAt(0);for(;this.panelContainer.numChildren>0;)this.panelContainer.removeChildAt(0);this.reflect=!1,this.angleVis=!1,this.showFigure=!1,this.refLine.graphics.clear(),this.normalLine.graphics.clear(),this.dotLine.graphics.clear(),this.dotLine2.graphics.clear(),this.figure.visible=!1},s.removeEvents=function(){MessageCenter.getInstance().removeListener(ItemEventConst.ADD_ITEM,this.addItem,this),MessageCenter.getInstance().removeListener(ItemEventConst.COPY_ITEM,this.copyItem,this)},e.showArrow=!1,e}(BasePhyView);egret.registerClass(LightView,"LightView");var BaseItem=function(t){function e(e,i){t.call(this,e,i),this.infoPanel=null,this.typeid=-1,this.infoCls=null,this.bodyArr=[],this.tapView=i}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),this.bodyArr=[],this.bitMap=new egret.Bitmap,this.bitMap.texture=RES.getRes(e),this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.bitMap.touchEnabled=!0,this.addChild(this.bitMap),t.prototype.init.call(this),this.body=new p2.Body,this.body.type=p2.Body.AWAKE,this.body.displays=[],this.world.addBody(this.body),this.bodyArr.push(this.body)},s.openProPanel=function(e){if(this.openPro){if(t.prototype.openProPanel.call(this,e),!this.tapView)return;if(this.infoPanel||(this.infoPanel=this.tapView.getInfoPanel(this.typeid,this.infoCls)),null==this.infoPanel)return;this.tapView.showInfoPanel(this.infoPanel,this)}},s.onSpotBegin=function(e){t.prototype.onSpotBegin.call(this,e);var i=e.stageX-this.x,s=e.stageY-this.y;this.pressRbody=Math.atan2(s,i)},s.onStageMove=function(e){if(t.prototype.onStageMove.call(this,e),1==this.ro){var i=e.stageX-this.x,s=e.stageY-this.y,n=Math.atan2(s,i),r=n-this.pressRbody;this.pressRbody=n;for(var h=0;h<this.bodyArr.length;h++){var o=this.bodyArr[h];o.angle+=r}}},s.onMove=function(e){t.prototype.onMove.call(this,e);for(var i=0;i<this.bodyArr.length;i++){var s=this.bodyArr[i];s.position=[this.x,this.y]}null!=this.moveFun&&this.moveFun.apply(this)},s.Position=function(t){for(var e=0;e<this.bodyArr.length;e++){var i=this.bodyArr[e];i.position=t}this.x=t[0],this.y=t[1]},s.Scale=function(t){},s.setRaf=function(t){this.body.refrac=t},s.setRotation=function(t){for(var e=0;e<this.bodyArr.length;e++){var i=this.bodyArr[e];i.angle=-t*Math.PI/180}this.rotation=-t},s.getProObj=function(){return null},s.dispose=function(){t.prototype.dispose.call(this);for(var e=0;e<this.bodyArr.length;e++){var i=this.bodyArr[e];this.world.removeBody(i)}this.bodyArr=[]},e}(Item);egret.registerClass(BaseItem,"BaseItem");var AMirrItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"amir_png"),this.hasX=!0,this.body.mass=1,this.body.position=[800,800],this.body.displays=[this],this.body.refrac=2.9,this.mainLine=new egret.Bitmap,this.mainLine.texture=RES.getRes("mainlight_png"),this.mainLine.anchorOffsetX=this.mainLine.width/2,this.mainLine.anchorOffsetY=this.mainLine.height/2,this.addChild(this.mainLine),this.mainLine.visible=!1,this.mainPoint=new egret.Bitmap,this.mainPoint.texture=RES.getRes("gpoint_png"),this.mainPoint.anchorOffsetX=this.mainPoint.width/2,this.mainPoint.anchorOffsetY=this.mainPoint.height/4,this.addChild(this.mainPoint),this.sType=1,this.changeView(this.sType)},s.changeView=function(t){switch(this.sType=t,this.bitMap.texture=null,t){case 1:this.bitMap.texture=RES.getRes("amir_png"),this.body.removeShape(this.AShape),this.radius=390,this.angle=30;var e=Math.floor(this.angle/1);e=Math.abs(e);for(var i=[],s=[],n=e;n>=-e;n--){var r=-this.radius*Math.sin(1*n*Math.PI/180),h=this.radius*Math.cos(1*n*Math.PI/180);i.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r]),s.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r])}for(var n=s.length-2;n>=1;n--)i.push([-s[n][0],s[n][1]]);this.AShape=new p2.Convex({vertices:i}),this.body.addShape(this.AShape);break;case 2:this.bitMap.texture=RES.getRes("amir2_png"),this.body.removeShape(this.AShape),this.radius=this.bitMap.width/2+this.bitMap.height*this.bitMap.height/(8*this.bitMap.width),this.angle=Math.floor(180*Math.atan(this.bitMap.height/2/(this.radius-this.bitMap.width))/Math.PI);var e=Math.floor(this.angle/1);e=Math.abs(e);for(var i=[],n=-e;e>=n;n++){var r=-this.radius*Math.sin(1*n*Math.PI/180),h=this.radius*Math.cos(1*n*Math.PI/180);i.push([this.radius*Math.cos(this.angle*Math.PI/180)-h,r])}this.AShape=new p2.Convex({vertices:i}),this.body.addShape(this.AShape,[this.bitMap.width/2-10,0]);break;case 3:this.bitMap.texture=RES.getRes("amir3_png"),this.body.removeShape(this.AShape),this.radius=240,this.angle=90,this.angle1=70;var e=Math.floor(this.angle/10);e=Math.abs(e);for(var i=[],n=e+1;n>=-e;n--){var r=-this.radius*Math.sin(10*n*Math.PI/180),h=this.radius*Math.cos(10*n*Math.PI/180);i.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r])}var o=Math.floor(this.angle1/10);o=Math.abs(o);for(var n=-o-1;o>=n;n++){var r=-this.radius*Math.sin(10*n*Math.PI/180),h=this.radius*Math.cos(10*n*Math.PI/180);i.push([h-this.radius*Math.cos(this.angle1*Math.PI/180),r])}this.AShape=new p2.Convex({vertices:i}),this.body.addShape(this.AShape,[-20,15])}},s.setLineShow=function(t){this.mainLine.visible=t},s.setCopy=function(t){this.setRotation(t.rotation),this.setRaf(t.refrac),this.setLineShow(t.lineShow),this.changeView(t.sType)},s.changeToX=function(t){var e;1==this.sType&&(e="amir_png"),2==this.sType&&(e="amir2_png"),3==this.sType&&(e="amir3_png"),this.bitMap.texture=t?RES.getRes("xamir_png"):RES.getRes(e),this.mainPoint.visible=!t,this.bitMap.x=t?-12:0},s.getProObj=function(){return{type:LightItemType.AMirrItem,x:this.x,y:this.y,rotation:-this.rotation,refrac:this.body.refrac,lineShow:this.mainLine.visible,sType:this.sType}},e}(BaseItem);egret.registerClass(AMirrItem,"AMirrItem");var AMirrItem2=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"fsamirr_png"),this.hasX=!0,this.radius=500,this.angle=30;var e=Math.floor(this.angle/1);e=Math.abs(e);for(var i=[],s=[],n=e;n>=-e;n--){var r=-this.radius*Math.sin(1*n*Math.PI/180),h=this.radius*Math.cos(1*n*Math.PI/180);i.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r]),s.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r])}for(var n=s.length-1;n>=0;n--)i.push([s[n][0]-20,s[n][1]]);this.AShape=new p2.Convex({vertices:i}),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.AShape,[-10,0]),this.body.displays=[this],this.body.refrac=0,this.body2=new p2.Body,this.body2.mass=1,this.body2.refrac=-1,this.BShape=new p2.Convex({vertices:i}),this.body2.addShape(this.BShape,[-30,0]),this.body2.displays=[this],this.body2.type=p2.Body.AWAKE,this.world.addBody(this.body2),this.bodyArr.push(this.body2),this.setRotation(180)},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.setCopy=function(t){this.setRotation(t.rotation)},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xfsamirr_png"):RES.getRes("fsamirr_png"),this.bitMap.x=t?30:0},s.getProObj=function(){return{type:LightItemType.AMirrItem2,x:this.x,y:this.y,rotation:-this.rotation}},e}(BaseItem);egret.registerClass(AMirrItem2,"AMirrItem2");var AMirrProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/AMirrProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.panel2.setH(this.group2.height),this.panel.panel2.proGroup.addChild(this.group2),this.group2.x=0,this.group2.y=0,this.dropDownList.setFun(this.changeRaf,this),this.dropDownList2.setFun(this.changeRotation,this),this.showBtn.addEventListener(egret.Event.CHANGE,this.onShow,this),this.showBtn.selected=!1,this.typeBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn1.selected=!0,this.typeBtn1.indexID=1,this.typeBtn2.indexID=2,this.typeBtn3.indexID=3},s.onType=function(t){this._item.changeView(t.currentTarget.indexID)},s.setData=function(e){t.prototype.setData.call(this,e);var i=[[LightConst.REFRA_5,"10"],[LightConst.REFRA_3,"15"],[LightConst.REFRA_1,"20"]];this.dropDownList.setData(i,0);var s=[[0,"0°"],[45,"45°"],[90,"90°"]];if(this.dropDownList2.setData(s,0),this.setRotaLabel(Math.floor(Math.abs(this._item.rotation))),this.refreshData){this.dropDownList2.setCurLabel(Math.floor(this.refreshData.rotation)+"°");for(var n=i[0][1],r=0;r<i.length;r++)i[r][0]==this.refreshData.refrac&&(n=i[r][1]);this.dropDownList.setCurLabel(n),this.showBtn.selected=this.refreshData.lineShow,this.refreshData=null}if(this._data&&!this.refreshData){for(var n=i[0][1],r=0;r<i.length;r++)i[r][0]==this._data.refrac&&(n=i[r][1]);this.typeBtn1.selected=!1,this.typeBtn2.selected=!1,this.typeBtn3.selected=!1,this.dropDownList.setCurLabel(n),this.showBtn.selected=this._data.lineShow,this["typeBtn"+this._data.sType].selected="true"}this.panel.proName.text=this._item.config.name},s.changeRaf=function(t){this._item.setRaf(t)},s.changeRotation=function(t){this._item.setRotation(t)},s.setRotaLabel=function(t){this.dropDownList2.setCurLabel(Math.floor(t)+"°")},s.changeAng=function(t){this._item.setAngle(t)},s.onShow=function(t){this._item.setLineShow(this.showBtn.selected)},s.dispose=function(){},s.refresh=function(t){this.refreshData=t},e}(InfoPanelBase);egret.registerClass(AMirrProPanel,"AMirrProPanel");var BoxItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"rect_png"),this.hasX=!0,this.boxShape=new p2.Box({width:this.bitMap.width,height:this.bitMap.height}),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.boxShape),this.body.displays=[this],this.body.refrac=1.6,this.preHeight=this.bitMap.height,this.preWidth=this.bitMap.width,this.curHeight=0,this.curWidth=0},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xrect_png"):RES.getRes("rect_png")},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.setHeight=function(t){var e=this.preHeight+10*t;this.boxShape.height=e,this.bitMap.height=e,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.body.removeShape(this.boxShape),this.boxShape=new p2.Box({width:this.bitMap.width,height:this.bitMap.height}),this.body.addShape(this.boxShape),this.curHeight=t},s.setWidth=function(t){var e=this.preWidth+10*t;this.boxShape.width=e,this.bitMap.width=e,this.bitMap.anchorOffsetX=this.bitMap.width/2,this.body.removeShape(this.boxShape),this.boxShape=new p2.Box({width:this.bitMap.width,height:this.bitMap.height}),this.body.addShape(this.boxShape),this.curWidth=t},s.setCopy=function(t){this.setRotation(t.rotation),this.setWidth(t.widthV),this.setHeight(t.heightV),this.setRaf(t.refrac)},s.getProObj=function(){return{type:LightItemType.Box,x:this.x,y:this.y,rotation:-this.rotation,refrac:this.body.refrac,widthV:this.curWidth,heightV:this.curHeight}},e}(BaseItem);egret.registerClass(BoxItem,"BoxItem");var BoxProPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/light/BoxProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.heightRoll.addEventListener(egret.Event.CHANGE,this.changHeight,this),this.heightRoll.value=0,this.widthRoll.addEventListener(egret.Event.CHANGE,this.changWidth,this),this.widthRoll.value=0,this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.dropDownList.setFun(this.changeRaf,this),this.dropDownList1.setFun(this.changeRotation,this)},s.setData=function(e){t.prototype.setData.call(this,e);var i=[[LightConst.REFRA_1,LightConst.REFRA_1],[LightConst.REFRA_2,LightConst.REFRA_2],[LightConst.REFRA_3,LightConst.REFRA_3],[LightConst.REFRA_4,LightConst.REFRA_4],[LightConst.REFRA_5,LightConst.REFRA_5],[LightConst.REFRA_6,LightConst.REFRA_6]];this.dropDownList.setData(i,0);var s=[[0,"0°"],[30,"30°"],[45,"45°"],[60,"60°"],[90,"90°"]];this.dropDownList1.setData(s,0),this.setRotaLabel(Math.floor(Math.abs(this._item.rotation))),this._data&&!this.refreshData&&(this.widthRoll.value=this._data.widthV,this.heightRoll.value=this._data.heightV,this.dropDownList.setCurLabel(this._data.refrac)),this.refreshData&&(this.widthRoll.value=this.refreshData.widthV,this.heightRoll.value=this.refreshData.heightV,this.dropDownList.setCurLabel(this.refreshData.refrac),this.refreshData=null),this.panel.proName.text=this._item.config.name},s.setRotaLabel=function(t){this.dropDownList1.setCurLabel(Math.floor(t)+"°")},s.changeRotation=function(t){this._item.setRotation(t)},s.changHeight=function(t){this._item.setHeight(t.currentTarget.value)},s.changWidth=function(t){this._item.setWidth(t.currentTarget.value)},s.changeRaf=function(t){this._item.setRaf(t)},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){var e=this._item.getProObj();MessageCenter.getInstance().dispatch(ItemEventConst.COPY_ITEM,e)},s.dispose=function(){},s.refresh=function(t){this.refreshData=t},e}(InfoPanelBase);egret.registerClass(BoxProPanel,"BoxProPanel");var CardItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"card0_png"),this.click=0,this.boxShape=new p2.Box({width:this.bitMap.width/2,height:this.bitMap.height}),this.body.mass=1,this.body.position=[600,400],this.body.displays=[this],this.body.refrac=1,this.bodyArr.push(this.body),this.preHeight=this.bitMap.height,this.preWidth=this.bitMap.width,this.bitMap.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onCard,this),this.parent.setChildIndex(this,0),this.mirrBit=new egret.Bitmap,this.mirrBit.texture=RES.getRes("mirrp_png"),this.mirrBit.x=-320,this.addChildAt(this.mirrBit,0);var e=[[-220,150],[200,150],[200,155],[-220,155]];this.boxShape2=new p2.Convex(e),this.body2=new p2.Body,this.body2.mass=1,this.body2.position=[600,400],this.body2.addShape(this.boxShape2),this.body2.displays=[this],this.body2.refrac=0,this.world.addBody(this.body2),this.bodyArr.push(this.body2),this.bitMap.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.mirrBit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.mirrBit.touchEnabled=!0},s.checkHasHitMirrPItem=function(){for(var t=[],e=0;e<this.parent.numChildren;e++){var i=this.parent.getChildAt(e);i.typeid&&"1008"==i.typeid&&t.push(i)}console.log(t.length),this.mirrSp&&(this.mirrSp.cardItem=null,this.mirrSp=null);for(var s=0;s<t.length;s++){var n=t[s];if(!n.cardItem&&this.body.position[0]>=n.body.position[0]-n.bitMap.width/2-this.bitMap.width/2&&this.body.position[0]<=n.body.position[0]+n.bitMap.width/2+this.bitMap.width/2&&this.body.position[1]>=n.body.position[1]-n.bitMap.height/2-this.bitMap.height/2&&this.body.position[1]<=n.body.position[1]+n.bitMap.height/2+this.bitMap.height/2){n.cardItem=this,this.mirrSp=n,this.parent.setChildIndex(this,n.parent.getChildIndex(n)+1),this.x=n.x,this.y=n.y-150,this.body.position=[this.x,this.y];break}}},s.Position=function(e){t.prototype.Position.call(this,e),this.checkHasHitMirrPItem()},s.onEnd=function(e){t.prototype.onEnd.call(this,e),this.checkHasHitMirrPItem()},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.onCard=function(t){t.stopPropagation(),this.body.removeShape(this.boxShape),this.click++,this.click%3==0?(this.bitMap.texture=RES.getRes("card0_png"),this.body.refrac=1,this.bitMap.y=0):this.click%3==1?(this.bitMap.texture=RES.getRes("card1_png"),this.body.addShape(this.boxShape,[this.bitMap.width/4+10,0]),this.bitMap.y=-30,this.body.refrac=-1):this.click%3==2&&(this.bitMap.texture=RES.getRes("card2_png"),this.body.addShape(this.boxShape,[this.bitMap.width/4+10,0]),this.body.refrac=-1,this.bitMap.y=0)},s.setCopy=function(t){this.click=t.click,this.setRotation(t.rotation),this.setCard(t.click)},s.setCard=function(t){0==t?(this.bitMap.texture=RES.getRes("card0_png"),this.body.refrac=1,this.bitMap.y=0):1==t?(this.bitMap.texture=RES.getRes("card1_png"),this.body.addShape(this.boxShape,[this.bitMap.width/4+10,0]),this.bitMap.y=-30,this.body.refrac=-1):2==t&&(this.bitMap.texture=RES.getRes("card2_png"),this.body.addShape(this.boxShape,[this.bitMap.width/4+10,0]),this.body.refrac=-1,this.bitMap.y=0)},s.getProObj=function(){return{type:LightItemType.CardItem,x:this.x,y:this.y,rotation:-this.rotation,click:this.click%3,refrac:this.body.refrac}},e}(BaseItem);egret.registerClass(CardItem,"CardItem");var CircleItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"bicircle_png"),this.circleShape=new p2.Circle({radius:10}),this.body.mass=1,this.body.position=[800,400],this.body.addShape(this.circleShape),this.body.displays=[this.bitMap],this.body.refrac=-1,this.radius=this.circleShape.radius,this.bitMap.scaleX=.2,this.bitMap.scaleY=.2,this.line1=new egret.Sprite,this.line1.graphics.lineStyle(2,65535),this.addChild(this.line1),this.line2=new egret.Sprite,this.line2.graphics.lineStyle(2,65535),this.addChild(this.line2),this.p=new egret.Point,this.Position([800,400]),this.setVis(!1)},s.Scale=function(e){t.prototype.Scale.call(this,e),this.circleShape.radius=e*this.radius},s.setVis=function(t){t?(this.visible=!0,this.world.addBody(this.body)):(this.visible=!1,this.world.removeBody(this.body))},s.showEyeLine=function(t,e){this.line1.graphics.clear(),this.line2.graphics.clear();var i=this.globalToLocal(t,e,this.p);this.line1.graphics.lineStyle(2,65535),this.line1.graphics.moveTo(0,-10),this.line1.graphics.lineTo(i.x,i.y),this.line2.graphics.lineStyle(2,65535),this.line2.graphics.moveTo(0,10),this.line2.graphics.lineTo(i.x,i.y)},e}(BaseItem);egret.registerClass(CircleItem,"CircleItem");var ColorItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"element_box_normal_png"),this.bitMap.visible=!1,this.roSpot.touchEnabled=!1,this.red=new egret.Sprite,this.red.graphics.beginFill(16711680),this.red.graphics.drawCircle(0,0,100),this.red.graphics.endFill(),this.addChild(this.red),this.red.touchEnabled=!0,this.red.blendMode=egret.BlendMode.ADD,this.red.anchorOffsetX=this.red.width/2,this.red.anchorOffsetY=this.red.height/2,this.yellow=new egret.Sprite,this.yellow.graphics.beginFill(65280),this.yellow.graphics.drawCircle(-50,100,100),this.yellow.graphics.endFill(),this.addChild(this.yellow),this.yellow.touchEnabled=!0,this.yellow.blendMode=egret.BlendMode.ADD,this.yellow.anchorOffsetX=this.yellow.width/2,this.yellow.anchorOffsetY=this.yellow.height/2,this.blue=new egret.Sprite,this.blue.graphics.beginFill(255),this.blue.graphics.drawCircle(50,100,100),this.blue.graphics.endFill(),this.addChild(this.blue),this.blue.touchEnabled=!0,this.blue.blendMode=egret.BlendMode.ADD,this.blue.anchorOffsetX=this.blue.width/2,this.blue.anchorOffsetY=this.blue.height/2,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onColBegin,this)},s.onColBegin=function(t){this.current=t.target,this.startColX=t.stageX,this.startColY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.current.x,this.current.y,e);this.colOffX=this.startColX-i.x,this.colOffY=this.startColY-i.y,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onColMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onColEnd,this)},s.onColMove=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.current&&(this.current.x=t.stageX-this.colOffX,this.current.y=t.stageY-this.colOffY)},s.onColEnd=function(t){this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onColMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onColEnd,this)},s.setCopy=function(t){},s.getProObj=function(){return{type:LightItemType.ColorItem,x:this.x,y:this.y}},e}(BaseItem);egret.registerClass(ColorItem,"ColorItem");var ColorItem2=function(t){function e(e,i){t.call(this,e,i),this.colorCenter={},this.radius=100,this.r_y_blendCor=15794183,this.r_b_blendCor=66177,this.b_y_blendCor=110336}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"element_box_normal_png"),this.bitMap.visible=!1,this.roSpot.touchEnabled=!1,this.red=new egret.Sprite,this.red.graphics.beginFill(15663244),this.red.graphics.drawCircle(0,0,this.radius),this.colorCenter.red=new egret.Point(0,0),this.red.graphics.endFill(),this.addChild(this.red),this.red.touchEnabled=!0,this.red.blendMode=egret.BlendMode.ADD,this.yellow=new egret.Sprite,this.yellow.graphics.beginFill(16708096),this.yellow.graphics.drawCircle(-50,100,this.radius),this.colorCenter.yellow=new egret.Point(-50,100),this.yellow.graphics.endFill(),this.addChild(this.yellow),this.yellow.touchEnabled=!0,this.yellow.blendMode=egret.BlendMode.ADD,this.blue=new egret.Sprite,this.blue.graphics.beginFill(44527),this.blue.graphics.drawCircle(50,100,this.radius),this.colorCenter.blue=new egret.Point(50,100),this.blue.graphics.endFill(),this.addChild(this.blue),this.blue.touchEnabled=!0,this.blue.blendMode=egret.BlendMode.ADD,this.spriteCanvas=new egret.Sprite,this.spriteCanvas.touchEnabled=!1,this.addChild(this.spriteCanvas),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onColBegin,this),this.calFocus()},s.drawFocus=function(t,e){this.spriteCanvas.graphics.beginFill(e);for(var i=0,s=t.length;s>i;i++)this.spriteCanvas.graphics.drawCircle(t[i].x,t[i].y,20);this.spriteCanvas.graphics.endFill()},s.calFocus=function(){var t=new egret.Point(this.red.x+this.colorCenter.red.x,this.red.y+this.colorCenter.red.y),e=new egret.Point(this.yellow.x+this.colorCenter.yellow.x,this.yellow.y+this.colorCenter.yellow.y),i=new egret.Point(this.blue.x+this.colorCenter.blue.x,this.blue.y+this.colorCenter.blue.y),s=this.calculateFocus(t,e);s.length>1&&this.drawArc(this.r_y_blendCor,t,e,s);var n=this.calculateFocus(t,i);n.length>1&&this.drawArc(this.r_b_blendCor,t,i,n);var r=this.calculateFocus(i,e);r.length>1&&this.drawArc(this.b_y_blendCor,i,e,r);for(var h=n.concat(s,r),o=[],a=[],l=[],c=[],d=0,u=h.length;u>d;d++){var p=Math.sqrt(this.doubleDis(h[d],t)),g=Math.sqrt(this.doubleDis(h[d],e)),_=Math.sqrt(this.doubleDis(h[d],i));(this.double_equals(_,this.radius)||_<this.radius)&&(this.double_equals(g,this.radius)||g<this.radius)&&(this.double_equals(p,this.radius)||p<this.radius)&&(this.double_equals(p,this.radius)&&o.push(h[d]),this.double_equals(_,this.radius)&&a.push(h[d]),this.double_equals(g,this.radius)&&l.push(h[d]),c.push(h[d]))}if(this.spriteCanvas.graphics.beginFill(0),o.length>1&&this.drawShare(t,o),a.length>1&&this.drawShare(i,a),l.length>1&&this.drawShare(e,l),c.length>1){this.spriteCanvas.graphics.moveTo(c[0].x,c[0].y);for(var d=1,u=c.length;u>d;d++)this.spriteCanvas.graphics.lineTo(c[d].x,c[d].y);this.spriteCanvas.graphics.moveTo(c[0].x,c[0].y)}this.spriteCanvas.graphics.endFill()},s.doubleDis=function(t,e){return Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)},s.drawShare=function(t,e){var i,s,n,r;i=this.calculatePosition(t,e[0]),s=this.calculatePosition(t,e[1]),i>s?(n=s,r=i):(n=i,r=s);var h=Math.abs(i-s)>Math.PI?!0:!1;this.spriteCanvas.graphics.drawArc(t.x,t.y,this.radius,n,r,h)},s.drawArc=function(t,e,i,s){if(s[0].x==s[1].x&&s[0].y==s[1].y)this.spriteCanvas.graphics.beginFill(t),this.spriteCanvas.graphics.drawArc(e.x,e.y,this.radius,0,2*Math.PI,!1),this.spriteCanvas.graphics.endFill();else{this.spriteCanvas.graphics.beginFill(t);var n,r,h,o;n=this.calculatePosition(e,s[0]),r=this.calculatePosition(e,s[1]),n>r?(h=r,o=n):(h=n,o=r);var a=Math.abs(n-r)>Math.PI?!0:!1;this.spriteCanvas.graphics.drawArc(e.x,e.y,this.radius,h,o,a),n=this.calculatePosition(i,s[0]),r=this.calculatePosition(i,s[1]),n>r?(h=r,o=n):(h=n,o=r),a=Math.abs(n-r)>Math.PI?!0:!1,this.spriteCanvas.graphics.drawArc(i.x,i.y,this.radius,h,o,a),this.spriteCanvas.graphics.endFill()}},s.calculatePosition=function(t,e){var i;return e.x>t.x&&e.y>t.y?i=Math.acos((e.x-t.x)/this.radius):e.x>t.x&&e.y<t.y?i=2*Math.PI-Math.acos((e.x-t.x)/this.radius):e.x<t.x&&e.y<t.y?i=2*Math.PI-Math.acos((e.x-t.x)/this.radius):e.x<t.x&&e.y>t.y&&(i=Math.acos((e.x-t.x)/this.radius)),i},s.calculateFocus=function(t,e){var i=2*this.radius*(t.x-e.x),s=2*this.radius*(t.y-e.y),n=-((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),r=i*i+s*s,h=-2*i*n,o=[],a=[],l=[],c=this.isIntersected(t,e);if(0==c)console.log("没有交点");else if(3==c)l[0]=new egret.Point(t.x,t.y),l[1]=new egret.Point(t.x,t.y);else if(1==c)o[0]=-h/r/2,a[0]=Math.sqrt(1-o[0]*o[0]),l[0]=new egret.Point(this.radius*o[0]+t.x,this.radius*a[0]+t.y),this.double_equals((l[0].x-e.x)*(l[0].x-e.x)+(l[0].y-e.y)*(l[0].y-e.y),this.radius*this.radius)||(l[0].y=t.y-this.radius*a[0]);else{var d=n*n-s*s;o[0]=(Math.sqrt(h*h-4*r*d)-h)/r/2,o[1]=(-Math.sqrt(h*h-4*r*d)-h)/r/2,a[0]=Math.sqrt(1-o[0]*o[0]),a[1]=Math.sqrt(1-o[1]*o[1]),l[0]=new egret.Point(this.radius*o[0]+t.x,this.radius*a[0]+t.y),l[1]=new egret.Point(this.radius*o[1]+t.x,this.radius*a[1]+t.y),this.double_equals((l[0].x-e.x)*(l[0].x-e.x)+(l[0].y-e.y)*(l[0].y-e.y),this.radius*this.radius)||(l[0].y=t.y-this.radius*a[0]),this.double_equals((l[1].x-e.x)*(l[1].x-e.x)+(l[1].y-e.y)*(l[1].y-e.y),this.radius*this.radius)||(l[1].y=t.y-this.radius*a[1]),l[0].y==l[1].y&&l[0].x==l[1].x&&(l[1].y>0?l[0].y=t.y+e.y-l[1].y:l[1].y=t.y+e.y-l[0].y)}return l},s.double_equals=function(t,e){var i=1e-9;return Math.abs(t-e)<i},s.isIntersected=function(t,e){var i=0,s=Math.pow(2*this.radius,2),n=Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2);return this.double_equals(1e-9,n)?i=3:this.double_equals(s,n)?i=1:!this.double_equals(s,n)&&s>n?i=2:!this.double_equals(s,n)&&n>s&&(i=0),i},s.onColBegin=function(t){t.stopImmediatePropagation(),this.current=t.target,this.startColX=t.stageX,this.startColY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.current.x,this.current.y,e);this.colOffX=this.startColX-i.x,this.colOffY=this.startColY-i.y,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onColMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onColEnd,this)},s.onColMove=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.current&&(this.current.x=t.stageX-this.colOffX,this.current.y=t.stageY-this.colOffY,this.spriteCanvas.graphics.clear(),this.calFocus())},s.onColEnd=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onColMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onColEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.spriteCanvas.graphics.clear(),this.calFocus()},s.setCopy=function(t){},s.getProObj=function(){return{type:LightItemType.ColorItem2,x:this.x,y:this.y}},e}(BaseItem);egret.registerClass(ColorItem2,"ColorItem2");var EyeItem=function(t){function e(e,i){t.call(this,e,i),this.eyeType=!1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.bgBit=new egret.Bitmap,this.bgBit.texture=RES.getRes("eyeout_png"),this.addChild(this.bgBit),this.bgBit.width=500,this.bgBit.height=500,this.bgBit.anchorOffsetX=this.bgBit.width/2-100,this.bgBit.anchorOffsetY=this.bgBit.height/2,t.prototype.init.call(this,"eyein_png"),this.bitMap.width=70,this.bitMap.height=300,this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.radius=390,this.angle=26,this.body.refrac=5;var e=Math.floor(this.angle/1);e=Math.abs(e);for(var i=[],s=[],n=e;n>=-e;n--){var r=-this.radius*Math.sin(1*n*Math.PI/180),h=this.radius*Math.cos(1*n*Math.PI/180);i.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r]),s.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r])}for(var n=s.length-2;n>=1;n--)i.push([-s[n][0],s[n][1]]);this.AShape=new p2.Convex({vertices:i}),this.body.mass=1,this.body.position=[800,800],this.body.addShape(this.AShape),this.body.displays=[this],this.roSpot.y=-this.bitMap.height/2-80,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this)},s.setEyeType=function(t){this.eyeType=t,this.body.removeShape(this.AShape),t?(this.radius=300,this.angle=32,this.body.refrac=6,this.bitMap.width=100,this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2):(this.radius=390,this.angle=26,this.body.refrac=5,this.bitMap.width=70,this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2);var e=Math.floor(this.angle/1);e=Math.abs(e);for(var i=[],s=[],n=e;n>=-e;n--){var r=-this.radius*Math.sin(1*n*Math.PI/180),h=this.radius*Math.cos(1*n*Math.PI/180);i.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r]),s.push([h-this.radius*Math.cos(this.angle*Math.PI/180),r])}for(var n=s.length-2;n>=1;n--)i.push([-s[n][0],s[n][1]]);this.AShape=new p2.Convex({vertices:i}),this.body.addShape(this.AShape)},s.setCopy=function(t){this.setRotation(t.rotation),this.setRaf(t.refrac),this.setEyeType(t.eyeType)},s.getProObj=function(){return{type:LightItemType.EyeItem,x:this.x,y:this.y,rotation:-this.rotation,eyeType:this.eyeType,refrac:this.body.refrac}},e}(BaseItem);egret.registerClass(EyeItem,"EyeItem");var EyeItemPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/light/EyeItemPanelSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.showBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.disBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.disBtn.selected=!0},s.onType=function(t){t.currentTarget==this.showBtn?this.showLight(!0):this.showLight(!1)},s.showLight=function(t){this._item.setEyeType(t)},s.setData=function(e){t.prototype.setData.call(this,e),this._data&&(this.disBtn.selected=!1,this.showBtn.selected=!1,this._data.eyeType?this.showBtn.selected=!0:this.disBtn.selected=!0),this.panel.proName.text=this._item.config.name},s.dispose=function(){},s.refresh=function(t){this.refreshData=t},e}(InfoPanelBase);egret.registerClass(EyeItemPanel,"EyeItemPanel");var FibreItem=function(t){function e(e,i){t.call(this,e,i),this.shapeType=1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"fibre2_png"),this.radius=200,this.bitMap.y=0,this.bitMap.alpha=.5;for(var e=[],i=160;i>=20;i--){var s=-this.radius*Math.sin(1*i*Math.PI/180),n=this.radius*Math.cos(1*i*Math.PI/180);e.push([n,s])}for(var i=20;160>=i;i++){var s=-(this.radius-2)*Math.sin(1*i*Math.PI/180),n=(this.radius-2)*Math.cos(1*i*Math.PI/180);e.push([n,s])}this.AShape=new p2.Convex({vertices:e}),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.AShape,[0,125]),this.body.displays=[this],this.body.refrac=20;
for(var e=[],i=160;i>=20;i--){var s=-(this.radius-50)*Math.sin(1*i*Math.PI/180),n=(this.radius-50)*Math.cos(1*i*Math.PI/180);e.push([n,s])}for(var i=20;160>=i;i++){var s=-(this.radius-52)*Math.sin(1*i*Math.PI/180),n=(this.radius-52)*Math.cos(1*i*Math.PI/180);e.push([n,s])}this.body2=new p2.Body,this.AShape2=new p2.Convex({vertices:e}),this.body2.mass=1,this.body2.position=[600,400],this.body2.addShape(this.AShape2,[0,125]),this.body2.displays=[this],this.body2.refrac=20,this.body2.type=p2.Body.AWAKE,this.world.addBody(this.body2),this.bodyArr.push(this.body2),this.BShape=new p2.Box({width:300,height:2}),this.BShape2=new p2.Box({width:300,height:2}),this.BShape3=new p2.Box({width:300,height:60});for(var e=[],i=160;i>=20;i--){var s=-(this.radius-1)*Math.sin(1*i*Math.PI/180),n=(this.radius-1)*Math.cos(1*i*Math.PI/180);e.push([n,s])}for(var i=20;160>=i;i++){var s=-(this.radius-51)*Math.sin(1*i*Math.PI/180),n=(this.radius-51)*Math.cos(1*i*Math.PI/180);e.push([n,s])}this.body3=new p2.Body,this.AShape3=new p2.Convex({vertices:e}),this.body3.mass=1,this.body3.position=[600,400],this.body3.addShape(this.AShape3,[0,125]),this.body3.displays=[this],this.body3.refrac=1.2,this.body3.type=p2.Body.AWAKE,this.world.addBody(this.body3),this.bodyArr.push(this.body3)},s.showCircle=function(){this.body.removeShape(this.AShape),this.body2.removeShape(this.AShape2),this.body3.removeShape(this.AShape3),this.body.removeShape(this.BShape),this.body2.removeShape(this.BShape2),this.body3.removeShape(this.BShape3),this.body.addShape(this.AShape,[0,125]),this.body2.addShape(this.AShape2,[0,125]),this.body3.addShape(this.AShape3,[0,125]),this.bitMap.texture=RES.getRes("fibre2_png"),this.bitMap.scaleX=1,this.bitMap.scaleY=1,this.bitMap.x=0,this.bitMap.y=0},s.showLine=function(){this.body.removeShape(this.AShape),this.body2.removeShape(this.AShape2),this.body3.removeShape(this.AShape3),this.body.removeShape(this.BShape),this.body2.removeShape(this.BShape2),this.body3.removeShape(this.BShape3),this.body.addShape(this.BShape),this.body2.addShape(this.BShape2,[0,60]),this.body3.addShape(this.BShape3,[0,30]),this.bitMap.texture=RES.getRes("fibre1_png"),this.bitMap.scaleX=.57,this.bitMap.scaleY=.57,this.bitMap.x=-45,this.bitMap.y=40},s.setShape=function(t){1==t?this.showCircle():this.showLine(),this.shapeType=t},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.setCopy=function(t){this.setRotation(t.rotation),this.setShape(t.shape)},s.getProObj=function(){return{type:LightItemType.FibreItem,x:this.x,y:this.y,rotation:-this.rotation,shape:this.shapeType}},e}(BaseItem);egret.registerClass(FibreItem,"FibreItem");var FibreProPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/light/FibreProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.type1Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.type1Btn.selected=!0,this.type2Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this)},s.onType=function(t){t.currentTarget==this.type1Btn?this._item.setShape(1):this._item.setShape(2)},s.setData=function(e){t.prototype.setData.call(this,e),this._data&&(this.type1Btn.selected=!1,this.type2Btn.selected=!1,this["type"+this._data.shape+"Btn"].selected="true"),this.panel.proName.text=this._item.config.name},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){var e=this._item.getProObj();MessageCenter.getInstance().dispatch(ItemEventConst.COPY_ITEM,e)},s.dispose=function(){},s.refresh=function(t){this.refreshData=t},e}(InfoPanelBase);egret.registerClass(FibreProPanel,"FibreProPanel");var FishItem=function(t){function e(e,i){t.call(this,e,i),this.waterRef=1.33,this.airRef=1,this.infoPanel=null,this.typeid=-1,this.infoCls=null,this.seeType=1,this.skinName="resource/skins/light/FishItemSkin.exml",this.tapView=i}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),this.bitMap=this.waterImg,t.prototype.init.call(this),this.roSpot.x=390,this.roSpot.y=-80,this.a=new egret.Point,this.b=new egret.Point,this.c=new egret.Point,this.d=new egret.Point,this.eyePoint=new egret.Point,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.yu.anchorOffsetX=20,this.yu.anchorOffsetY=40,this.yu2.anchorOffsetX=20,this.yu2.anchorOffsetY=40,this.eyeVirtual.anchorOffsetX=68,this.eyeVirtual.anchorOffsetY=60,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginC,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveC,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndC,this),this.line1=new egret.Sprite,this.addChild(this.line1),this.line1Dot=new egret.Sprite,this.addChild(this.line1Dot),this.line2=new egret.Sprite,this.addChild(this.line2),this.line2Dot=new egret.Sprite,this.addChild(this.line2Dot),this.pointX1=this.waterImg.width/2,this.pointX2=this.waterImg.width/2+50,this.bit1=new egret.Bitmap,this.bit1.texture=RES.getRes("arrow_png"),this.bit1.anchorOffsetX=this.bit1.width/2,this.bit1.anchorOffsetY=this.bit1.height/2,this.addChild(this.bit1),this.bit2=new egret.Bitmap,this.bit2.texture=RES.getRes("arrow_png"),this.bit2.anchorOffsetX=this.bit2.width/2,this.bit2.anchorOffsetY=this.bit2.height/2,this.addChild(this.bit2),this.bit3=new egret.Bitmap,this.bit3.texture=RES.getRes("arrow_png"),this.bit3.anchorOffsetX=this.bit3.width/2,this.bit3.anchorOffsetY=this.bit3.height/2,this.addChild(this.bit3),this.bit4=new egret.Bitmap,this.bit4.texture=RES.getRes("arrow_png"),this.bit4.anchorOffsetX=this.bit4.width/2,this.bit4.anchorOffsetY=this.bit4.height/2,this.addChild(this.bit4),this.getLinePoint(),this.drawLine()},s.getLinePoint=function(){var t=[this.eye.x-100,this.eye.y],e=[this.eye.x+50,this.eye.y],i=([this.yu2.x,this.yu2.y],LightUtils.segmentsIntr(new egret.Point(this.yu2.x,this.yu2.y),new egret.Point(t[0],t[1]),new egret.Point(0,0),new egret.Point(this.width,0)));i&&(this.sinA=Math.sin(Math.atan(Math.abs((t[0]-i.x)/t[1]))),this.pointX1=i.x+(this.yu2.x>this.eye.x?40*this.sinA:-40*this.sinA),this.tanA=Math.abs((t[0]-this.pointX1)/t[1]));var s=LightUtils.segmentsIntr(new egret.Point(this.yu2.x,this.yu2.y),new egret.Point(e[0],e[1]),new egret.Point(0,0),new egret.Point(this.width,0));s&&(this.sinB=Math.sin(Math.atan(Math.abs((e[0]-s.x)/e[1]))),this.pointX2=s.x+(this.yu2.x>this.eye.x?40*this.sinB:-40*this.sinB),this.tanB=Math.abs((e[0]-this.pointX2)/e[1]));var n=[this.yu2.x-10,this.yu2.y],r=[this.yu2.x+40,this.yu2.y],h=[this.eye.x-68,this.eye.y+60],o=LightUtils.segmentsIntr(new egret.Point(n[0],n[1]),new egret.Point(h[0],h[1]),new egret.Point(0,0),new egret.Point(this.width,0));o&&(this.sinC=Math.sin(Math.atan(Math.abs((h[0]-o.x)/h[1]))),this.pointX3=o.x+(n[0]>this.eye.x?40*this.sinC:-40*this.sinC),this.tanC=Math.abs((this.pointX3-n[0])/n[1]));var a=LightUtils.segmentsIntr(new egret.Point(r[0],r[1]),new egret.Point(h[0],h[1]),new egret.Point(0,0),new egret.Point(this.width,0));a&&(this.sinD=Math.sin(Math.atan(Math.abs((h[0]-a.x)/h[1]))),this.pointX4=a.x+(r[0]>this.eye.x?40*this.sinD:-40*this.sinD),this.tanD=Math.abs((this.pointX4-r[0])/r[1]))},s.drawLine=function(){if(1==this.seeType){this.boardArr=[],this.line1.graphics.clear(),this.line1.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.line1.graphics.moveTo(this.yu2.x,this.yu2.y),this.line1.graphics.lineTo(this.pointX1,0),this.line1.graphics.lineTo(this.eye.x-100,this.eye.y),this.line1Dot.graphics.clear(),this.line1Dot.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.a.x=this.eye.x-100,this.a.y=this.eye.y,this.b.x=this.yu2.x>this.pointX1?this.waterImg.width:0,this.b.y=this.yu2.x>this.pointX1?this.waterImg.width-this.pointX1/this.tanA:this.pointX1/this.tanA,this.bit1.x=this.pointX1+(this.a.x-this.pointX1)/2,this.bit1.y=this.a.y/2,this.bit2.x=this.yu2.x+(this.pointX1-this.yu2.x)/2,this.bit2.y=this.yu2.y/2;var t=180*Math.atan((0-this.eye.y)/(this.pointX1-(this.eye.x-100)))/Math.PI,e=180*Math.atan((this.yu2.y-0)/(this.yu2.x-this.pointX1))/Math.PI;this.bit1.rotation=t>0?-t:t,this.bit2.rotation=e>0?-e:t,this.line2.graphics.clear(),this.line2.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.line2.graphics.moveTo(this.yu2.x,this.yu2.y),this.line2.graphics.lineTo(this.pointX2,0),this.line2.graphics.lineTo(this.eye.x+50,this.eye.y),this.line2Dot.graphics.clear(),this.line2Dot.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.c.x=this.eye.x+50,this.c.y=this.eye.y,this.d.x=this.yu2.x>this.pointX1?this.waterImg.width:0,this.d.y=this.yu2.x>this.pointX1?this.waterImg.width-this.pointX2/this.tanB:this.pointX2/this.tanB,this.bit3.x=this.pointX2+(this.c.x-this.pointX2)/2,this.bit3.y=this.c.y/2,this.bit4.x=this.yu2.x+(this.pointX2-this.yu2.x)/2,this.bit4.y=this.yu2.y/2;var t=180*Math.atan((0-this.eye.y)/(this.pointX2-(this.eye.x+50)))/Math.PI,e=180*Math.atan((this.yu2.y-0)/(this.yu2.x-this.pointX2))/Math.PI;this.bit3.rotation=t,this.bit4.rotation=e;var i=LightUtils.segmentsIntr(this.a,this.b,this.c,this.d);i?(this.yu.x=i.x,this.yu.y=i.y,LightUtils.drawDotLineXY(this.line1Dot,this.eye.x-100,this.eye.y,i.x,i.y,-this.tanA),LightUtils.drawDotLineXY(this.line2Dot,this.eye.x+50,this.eye.y,i.x,i.y,-this.tanB),this.yu.visible=!0):(this.yu.x=this.yu2.x,this.yu.y=this.yu2.y,this.line1Dot.graphics.clear(),this.line2Dot.graphics.clear(),this.yu.visible=!1)}if(0==this.seeType){this.boardArr=[],this.line1.graphics.clear(),this.line1.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.line1.graphics.moveTo(this.yu2.x-10,this.yu2.y),this.line1.graphics.lineTo(this.pointX3,0),this.line1.graphics.lineTo(this.eye.x-68,this.eye.y+60),this.line1Dot.graphics.clear(),this.line1Dot.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.a.x=this.yu2.x-10,this.a.y=this.yu2.y,this.b.x=this.yu2.x>this.pointX3?0:2*this.waterImg.width,this.b.y=this.yu2.x>this.pointX3?-this.pointX3/this.tanC:-(2*this.waterImg.width-this.pointX3)/this.tanC,this.bit1.x=this.yu2.x-10+(this.pointX3-this.yu2.x+10)/2,this.bit1.y=this.yu2.y/2,this.bit2.x=this.yu2.x+30+(this.pointX4-this.yu2.x-30)/2,this.bit2.y=this.yu2.y/2;var t=180*Math.atan((0-this.yu2.y)/(this.pointX3-(this.yu2.x-20)))/Math.PI;this.bit1.rotation=t>0?-t:t;var e=180*Math.atan((0-this.yu2.y)/(this.pointX4-(this.yu2.x+30)))/Math.PI;this.bit2.rotation=e>0?-e:e,this.line2.graphics.clear(),this.line2.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.line2.graphics.moveTo(this.yu2.x+40,this.yu2.y),this.line2.graphics.lineTo(this.pointX4,0),this.line2.graphics.lineTo(this.eye.x-68,this.eye.y+60),this.line2Dot.graphics.clear(),this.line2Dot.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.c.x=this.yu2.x+40,this.c.y=this.yu2.y,this.d.x=this.yu2.x>this.pointX4?0:2*this.waterImg.width,this.d.y=this.yu2.x>this.pointX4?-this.pointX4/this.tanD:-(2*this.waterImg.width-this.pointX2)/this.tanD,this.bit3.x=this.pointX3+(this.eye.x-68-this.pointX3)/2,this.bit3.y=(this.eye.y+60)/2,this.bit4.x=this.pointX4+(this.eye.x-68-this.pointX4)/2,this.bit4.y=(this.eye.y+60)/2;var t=180*Math.atan((this.eye.y+60)/(this.eye.x-68-this.pointX3))/Math.PI;this.bit3.rotation=t>0?-t:t;var e=180*Math.atan((this.eye.y+60)/(this.eye.x-68-this.pointX4))/Math.PI;this.bit4.rotation=e>0?-e:e;var i=LightUtils.segmentsIntr(this.a,this.b,this.c,this.d);i?(this.eyeVirtual.x=i.x,this.eyeVirtual.y=i.y,LightUtils.drawDotLineXY(this.line1Dot,i.x,i.y,this.pointX3,0,-this.tanC),LightUtils.drawDotLineXY(this.line2Dot,i.x,i.y,this.pointX4,0,-this.tanD),this.eyeVirtual.visible=!0,(Math.abs(Math.abs(this.bit1.rotation)-90)<1.5||Math.abs(Math.abs(this.bit2.rotation)-90)<1.5||Math.abs(Math.abs(this.bit3.rotation)-90)<1.5||Math.abs(Math.abs(this.bit4.rotation)-90)<1.5)&&(this.line1Dot.graphics.clear(),this.line2Dot.graphics.clear(),this.eyeVirtual.visible=!1)):(this.eyeVirtual.x=this.eye.x,this.eyeVirtual.y=this.eye.y,this.line1Dot.graphics.clear(),this.line2Dot.graphics.clear(),this.eyeVirtual.visible=!1)}},s.openProPanel=function(e){t.prototype.openProPanel.call(this,e),this.tapView&&(this.infoPanel||(this.infoPanel=this.tapView.getInfoPanel(this.typeid,this.infoCls)),null!=this.infoPanel&&this.tapView.showInfoPanel(this.infoPanel,this))},s.onBeginC=function(t){if(this.dragItem=null,t.target===this.yu2&&(this.dragItem=this.yu2),t.target===this.eye&&(this.dragItem=this.eye),this.dragItem){t.stopPropagation(),this.startColX=t.stageX,this.startColY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.dragItem.x,this.dragItem.y,e);this.colOffX=this.startColX-i.x,this.colOffY=this.startColY-i.y}},s.onMoveC=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.dragItem&&(this.dragItem.x=t.stageX-this.colOffX,this.dragItem.y=t.stageY-this.colOffY,this.dragItem==this.yu2&&(this.dragItem.x=Math.min(this.dragItem.x,575),this.dragItem.x=Math.max(this.dragItem.x,239),this.dragItem.y=Math.min(this.dragItem.y,356),this.dragItem.y=Math.max(this.dragItem.y,214)),this.dragItem==this.eye&&(this.dragItem.x=Math.min(this.dragItem.x,800),this.dragItem.x=Math.max(this.dragItem.x,630),this.dragItem.y=Math.min(this.dragItem.y,-138),this.dragItem.y=Math.max(this.dragItem.y,-300)),this.getLinePoint(),this.drawLine())},s.onEndC=function(t){this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this)},s.setRotation=function(t){},s.getProObj=function(){return{type:LightItemType.FishItem,x:this.x,y:this.y,sType:this.seeType}},s.setArrow=function(t){this.seeType=t,this.drawLine()},s.setCopy=function(t){this.setArrow(t.sType)},s.Position=function(t){this.x=t[0],this.y=t[1]},e}(Item);egret.registerClass(FishItem,"FishItem");var FishItemPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/light/FishProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.type1Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.type2Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.type1Btn.selected=!1,this.type2Btn.selected=!0},s.onType=function(t){t.currentTarget==this.type1Btn?this._item.setArrow(0):this._item.setArrow(1)},s.setData=function(e){if(t.prototype.setData.call(this,e),this._data){var i=this._data.sType+1;this.type2Btn.selected=!1,this.type1Btn.selected=!1,this["type"+i+"Btn"].selected=!0}this.panel.proName.text=this._item.config.name},e}(InfoPanelBase);egret.registerClass(FishItemPanel,"FishItemPanel");var HighFieldItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"fsman_png");for(var e=[],i=200,s=0;i>s;s++)s>=80&&100>=s?e.push(15*Math.sin(s/i*Math.PI*10)):e.push(10*Math.sin(s/i*Math.PI*8));var n=new p2.Heightfield({heights:e,elementWidth:500/i});this.body.angle=Math.PI,this.body.addShape(n,[-250,40]),this.body.displays=[this],this.body.refrac=0},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.setCopy=function(t){this.setRotation(t.rotation)},s.getProObj=function(){return{type:LightItemType.HighFieldItem,x:this.x,y:this.y,rotation:-this.rotation}},e}(BaseItem);egret.registerClass(HighFieldItem,"HighFieldItem");var KongItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"gjz1_png"),this.candle=new egret.Bitmap,this.candle.texture=RES.getRes("candler_png"),this.addChild(this.candle),this.candle.y=-200,this.candle.x=-230,this.candle.touchEnabled=!0,this.candle.name="candle",this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginC,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveC,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndC,this),this.screen=new egret.Bitmap,this.screen.texture=RES.getRes("gp2_png"),this.addChild(this.screen),this.screen.y=-250,this.screen.x=230,this.screen.touchEnabled=!0,this.screen.name="screen",this.kong=new egret.Bitmap,this.kong.texture=RES.getRes("kong2_png"),this.addChild(this.kong),this.kong.y=-250,this.kong.x=0,this.kong.touchEnabled=!1,this.fire=new egret.Bitmap,this.fire.texture=RES.getRes("fire_png"),this.fire.anchorOffsetX=this.fire.width/2,this.fire.anchorOffsetY=this.fire.height,this.fire.scaleY=-1,this.addChild(this.fire),this.maskF=new egret.Sprite,this.maskF.graphics.lineStyle(1,16777215),this.maskF.graphics.beginFill(16777215),this.maskF.graphics.moveTo(0,0),this.maskF.graphics.lineTo(63,35),this.maskF.graphics.lineTo(63,173),this.maskF.graphics.lineTo(0,138),this.maskF.graphics.lineTo(0,0),this.maskF.graphics.endFill(),this.addChild(this.maskF),this.maskF.anchorOffsetX=this.maskF.width/2,this.maskF.anchorOffsetY=this.maskF.height/2,this.maskF.x=this.screen.x+45,this.maskF.y=this.screen.y+90,this.boxShape=new p2.Box({width:0,height:0}),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.boxShape,[this.bitMap.width/4,0]),this.body.displays=[this],this.body.refrac=-1,this.line1=new egret.Sprite,this.line1.graphics.beginFill(16711680),this.line1.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line1.graphics.moveTo(this.candle.x+40,this.candle.y),this.line1.graphics.lineTo(this.kong.x+40,this.kong.y+90),this.line1.graphics.endFill(),this.addChild(this.line1),this.line2=new egret.Sprite,this.line2.graphics.beginFill(16711680),this.line2.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line2.graphics.moveTo(this.candle.x+40,this.candle.y+60),this.line2.graphics.lineTo(this.kong.x+40,this.kong.y+90),this.line2.graphics.endFill(),this.addChild(this.line2),this.kong2=new egret.Bitmap,this.kong2.texture=RES.getRes("kong20_png"),this.addChild(this.kong2),this.kong2.x=43,this.kong2.y=-234,this.kong2.touchEnabled=!0,this.kong2.name="kong";var e=this.screen.x-this.kong.x,i=(this.kong.x+40-(this.candle.x+40))/(this.kong.y+90-this.candle.y);this.line1.graphics.lineTo(this.kong.x+40+e,this.kong.y+90+e/i);var s=(this.kong.x+40-(this.candle.x+40))/(this.kong.y+90-(this.candle.y+60));this.line2.graphics.lineTo(this.kong.x+40+e,this.kong.y+90+e/s),this.fire.x=this.kong.x+40+e,this.fire.y=this.kong.y+90+e/s,this.scale=(e/i-e/s)/this.fire.height,this.fire.height=e/i-e/s,this.fire.width=this.fire.width*this.scale,this.fire.anchorOffsetY=this.fire.height,this.fire.anchorOffsetX=this.fire.width/2,this.fire.mask=this.maskF,this.line1.visible=!1,this.line2.visible=!1,this.showLine=!1,this.kongType=2},s.onBeginC=function(t){switch(this.dragItem=null,t.target.name){case"candle":this.dragItem=this.candle;break;case"screen":this.dragItem=this.screen;break;case"kong":this.dragItem=this.kong2}if(this.dragItem){t.stopPropagation(),this.startColX=t.stageX,this.startColY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.dragItem.x,this.dragItem.y,e);this.colOffX=this.startColX-i.x,this.colOffY=this.startColY-i.y}},s.onMoveC=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.dragItem&&(this.dragItem.x=t.stageX-this.colOffX,this.dragItem.x=Math.min(this.dragItem.x,440),this.dragItem.x=Math.max(this.dragItem.x,-500),"candle"==this.dragItem.name?(this.dragItem.x=Math.min(this.dragItem.x,this.kong.x-50),this.dragItem.x=Math.max(this.dragItem.x,-500)):"kong"==this.dragItem.name?(this.dragItem.x=Math.min(this.dragItem.x,this.screen.x-50),this.dragItem.x=Math.max(this.dragItem.x,this.candle.x+100),this.kong.x=this.dragItem.x-43,this.kong.y=this.dragItem.y-16):"screen"==this.dragItem.name&&(this.dragItem.x=Math.min(this.dragItem.x,440),this.dragItem.x=Math.max(this.dragItem.x,this.kong2.x+50)),this.countPos())},s.onEndC=function(t){this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this)},s.setLineShow=function(t){this.line1.visible=t,this.line2.visible=t,this.showLine=t},s.changeKong=function(t){this.kong.texture=RES.getRes("kong"+t+"_png"),this.kong2.texture=RES.getRes("kong"+t+"0_png"),this.kongType=t},s.setPos=function(t){this.candle.x=t.candlePos[0],this.candle.y=t.candlePos[1],this.screen.x=t.screenPos[0],this.screen.y=t.screenPos[1],this.kong.x=t.kongPos[0],this.kong.y=t.kongPos[1],this.kong2.x=t.kong2Pos[0],this.kong2.y=t.kong2Pos[1],this.countPos()},s.setCopy=function(t){this.setRotation(t.rotation),this.changeKong(t.kongType),this.setLineShow(t.showLine),this.setPos(t)},s.countPos=function(){var t=this.screen.x-this.kong.x;this.line1.graphics.clear(),this.line1.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line1.graphics.moveTo(this.candle.x+40,this.candle.y),this.line1.graphics.lineTo(this.kong.x+40,this.kong.y+90);var e=(this.kong.x+40-(this.candle.x+40))/(this.kong.y+90-this.candle.y);this.line1.graphics.lineTo(this.kong.x+40+t,this.kong.y+90+t/e),this.line1.graphics.endFill(),this.line2.graphics.clear(),this.line2.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line2.graphics.moveTo(this.candle.x+40,this.candle.y+60),this.line2.graphics.lineTo(this.kong.x+40,this.kong.y+90);var i=(this.kong.x+40-(this.candle.x+40))/(this.kong.y+90-(this.candle.y+60));this.line2.graphics.lineTo(this.kong.x+40+t,this.kong.y+90+t/i),this.line2.graphics.endFill(),this.fire.x=this.kong.x+40+t,this.fire.y=this.kong.y+90+t/i,this.scale=(t/e-t/i)/this.fire.height,this.fire.height=t/e-t/i,this.fire.width=this.fire.width*this.scale,this.fire.anchorOffsetY=this.fire.height,this.fire.anchorOffsetX=this.fire.width/2,this.maskF.x=this.screen.x+45,this.maskF.y=this.screen.y+90},s.getProObj=function(){return{type:LightItemType.KongItem,x:this.x,y:this.y,rotation:-this.rotation,candlePos:[this.candle.x,this.candle.y],screenPos:[this.screen.x,this.screen.y],kongPos:[this.kong.x,this.kong.y],kong2Pos:[this.kong2.x,this.kong2.y],showLine:this.showLine,kongType:this.kongType}},e}(BaseItem);egret.registerClass(KongItem,"KongItem");var KongProPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/light/KongProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.showBtn.addEventListener(egret.Event.CHANGE,this.onShow,this),this.showBtn.selected=!1,this.typeBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn2.selected=!0,this.typeBtn1.indexID=1,this.typeBtn2.indexID=2,this.typeBtn3.indexID=3},s.onType=function(t){this._item.changeKong(t.currentTarget.indexID)},s.onShow=function(t){this._item.setLineShow(this.showBtn.selected)},s.setData=function(e){t.prototype.setData.call(this,e),this._data&&(this.typeBtn1.selected=!1,this.typeBtn2.selected=!1,this.typeBtn3.selected=!1,this["typeBtn"+this._data.kongType].selected=!0,this.showBtn.selected=this._data.showLine),this.panel.proName.text=this._item.config.name},s.dispose=function(){},e}(InfoPanelBase);egret.registerClass(KongProPanel,"KongProPanel");var KuaiItemPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/light/KuaiItemPanelSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.showBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.disBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.disBtn.selected=!0},s.onType=function(t){t.currentTarget==this.showBtn?this.showLight(!0):this.showLight(!1)},s.showLight=function(t){this._item.isShowLight(t)},s.setData=function(e){t.prototype.setData.call(this,e),this._data&&(this.disBtn.selected=!1,this.showBtn.selected=!1,this._data.showLine?this.showBtn.selected=!0:this.disBtn.selected=!0),this.panel.proName.text=this._item.config.name},s.dispose=function(){},s.refresh=function(t){this.refreshData=t},e}(InfoPanelBase);egret.registerClass(KuaiItemPanel,"KuaiItemPanel");var KuaiziItem=function(t){function e(e,i){t.call(this,e,i),this.infoPanel=null,this.typeid=-1,this.infoCls=null,this.seeType=0,this.xRotation=15,this.ro=!1,this.coords=new egret.Point,this.skinName="resource/skins/light/KuaiziSkin.exml",this.tapView=i}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e){void 0===e&&(e="tri_png"),this.bitMap=this.waterImg,t.prototype.init.call(this),this.kzImg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginR,this),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.roSpot.x=450,this.roSpot.y=90,this.lineSp=new egret.Sprite,this.addChild(this.lineSp),this.line1=new egret.Sprite,this.lineSp.addChild(this.line1),this.line1Dot=new egret.Sprite,this.lineSp.addChild(this.line1Dot),this.line2=new egret.Sprite,this.lineSp.addChild(this.line2),this.line2Dot=new egret.Sprite,this.lineSp.addChild(this.line2Dot),this.lineSp.visible=!1,this.start2=this.point2.x,this.start0=this.point0.x,this.kzImg.mask=this.maskZ,this.drawLine()},s.onBeginR=function(t){t.stopPropagation(),this.ro=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onRMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onREnd,this),this.rGp.parent.localToGlobal(this.rGp.x,this.rGp.y,this.coords);var e=t.stageX-this.coords.x,i=t.stageY-this.coords.y;this.pressRadian=Math.atan2(i,e)},s.onRMove=function(t){if(1==this.ro){this.rGp.parent.localToGlobal(this.rGp.x,this.rGp.y,this.coords);var e=t.stageX-this.coords.x,i=t.stageY-this.coords.y,s=Math.atan2(i,e),n=s-this.pressRadian;this.pressRadian=s,this.rGp.rotation+=180*n/Math.PI,this.kziX.rotation=this.xRotation/42*this.rGp.rotation,this.rGp.rotation<-42&&(this.rGp.rotation=-42),this.rGp.rotation>0&&(this.rGp.rotation=0)}else this.stage&&(this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onRMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onREnd,this));this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.drawLine()},s.onREnd=function(t){this.ro=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onREnd,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this)},s.drawLine=function(){this.R=300;var t=180*-Math.atan(this.rGp.height/this.rGp.width)/Math.PI+this.rGp.rotation-6;this.point1.x=this.rGp.x+this.R/2*Math.cos(t*Math.PI/180),this.point1.y=this.rGp.y+this.R/2*Math.sin(t*Math.PI/180);var e=297+(this.R-30)*Math.cos((t+(this.xRotation+this.kziX.rotation+5))*Math.PI/180),i=442+(this.R-30)*Math.sin((t+(this.xRotation+this.kziX.rotation+6))*Math.PI/180);this.point3.x=2*this.point1.x-e,this.point3.y=2*this.point1.y-i,this.line1Dot.graphics.clear(),this.line1Dot.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.line1Dot.graphics.moveTo(this.point3.x,this.point3.y);var s=Math.abs((this.point2.y-this.point3.y)/(this.point2.x-this.point3.x)),t=Math.atan((this.point2.y-this.point3.y)/(this.point2.x-this.point3.x)),n=0,r=this.point2.x+this.point2.y/s;LightUtils.drawDotLineXY3(this.line1Dot,this.point3.x,this.point3.y,r,n),this.line1.graphics.clear(),this.line1.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.line1.graphics.moveTo(this.point4.x,this.point4.y),this.line1.graphics.lineTo(this.point2.x,this.point2.y),this.line1.graphics.lineTo(r,n),this.line2Dot.graphics.clear(),this.line2Dot.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.line2Dot.graphics.moveTo(this.point3.x,this.point3.y);var s=Math.abs((this.point0.y-this.point3.y)/(this.point0.x-this.point3.x)),n=0,r=this.point0.x+this.point0.y/s;LightUtils.drawDotLineXY3(this.line2Dot,this.point3.x,this.point3.y,r,n),this.line2.graphics.clear(),this.line2.graphics.lineStyle(LightConst.LIGHT_THICK,LightConst.COLOR_RED),this.line2.graphics.moveTo(this.point4.x,this.point4.y),this.line2.graphics.lineTo(this.point0.x,this.point0.y),this.line2.graphics.lineTo(r,n)},s.openProPanel=function(e){t.prototype.openProPanel.call(this,e),this.tapView&&(this.infoPanel||(this.infoPanel=this.tapView.getInfoPanel(this.typeid,this.infoCls)),null!=this.infoPanel&&this.tapView.showInfoPanel(this.infoPanel,this))},s.setRotation=function(t){},s.getProObj=function(){return{type:LightItemType.KuaiziItem,x:this.x,y:this.y,showLine:this.lineSp.visible}},s.isShowLight=function(t){this.lineSp.visible=t,t?this.kzImg.mask=null:this.kzImg.mask=this.maskZ},s.setCopy=function(t){this.isShowLight(t.showLine)},s.Position=function(t){this.x=t[0],this.y=t[1]},e}(Item);egret.registerClass(KuaiziItem,"KuaiziItem");var MagnItem=function(t){function e(e,i){t.call(this,e,i),this.lineShow=!1,this.shadow=!1}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"gjz1_png"),this.a=new egret.Point,this.b=new egret.Point,this.c=new egret.Point,this.d=new egret.Point,this.focus=e.FOCUS,this.candle=new egret.Bitmap,this.candle.texture=RES.getRes("candler_png"),this.addChild(this.candle),this.candle.y=-200,this.candle.x=-305,this.candle.touchEnabled=!0,this.candle.name="candle",this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginC,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveC,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndC,this),this.screen=new egret.Bitmap,this.screen.texture=RES.getRes("gp2_png"),this.addChild(this.screen),this.screen.y=-250,this.screen.x=230,this.screen.touchEnabled=!0,this.screen.name="screen",this.kong=new egret.Bitmap,this.kong.texture=RES.getRes("magn1_png"),this.addChild(this.kong),this.kong.y=-215,this.kong.x=-141,this.kong.touchEnabled=!1,this.mainLineY=this.kong.y+50,this.mainLineX=this.kong.x+40,this.fire=new egret.Bitmap,this.fire.texture=RES.getRes("fire_png"),this.fire.width=30,this.fire.height=60,this.fire.anchorOffsetX=this.fire.width/2,this.fire.anchorOffsetY=0,this.fire.scaleY=-1,this.addChild(this.fire),this.fire.x=270,this.fire.y=-100,this.maskF=new egret.Sprite,this.maskF.graphics.lineStyle(1,16777215),this.maskF.graphics.beginFill(16777215),this.maskF.graphics.moveTo(0,0),this.maskF.graphics.lineTo(63,35),this.maskF.graphics.lineTo(63,173),this.maskF.graphics.lineTo(0,138),this.maskF.graphics.lineTo(0,0),this.maskF.graphics.endFill(),this.addChild(this.maskF),this.maskF.anchorOffsetX=this.maskF.width/2,this.maskF.anchorOffsetY=this.maskF.height/2,this.boxShape=new p2.Box({width:0,height:0}),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.boxShape,[this.bitMap.width/4,0]),this.body.displays=[this],this.body.refrac=-1,this.line1=new egret.Sprite,this.addChild(this.line1),this.line2=new egret.Sprite,this.addChild(this.line2),this.kong2=new egret.Bitmap,this.kong2.texture=RES.getRes("magn10_png"),this.kong2.x=-100,this.kong2.y=-215,this.kong2.touchEnabled=!0,this.kong2.name="kong",this.line1.visible=!1,this.line2.visible=!1,this.line1Dot=new egret.Sprite,this.line1Dot.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.addChild(this.line1Dot),this.line2Dot=new egret.Sprite,this.line2Dot.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.addChild(this.line2Dot),this.line1Dot.visible=!1,this.line2Dot.visible=!1,this.addChild(this.kong2),this.showLine=!1,this.lineCount()
},s.lineCount=function(){this.line1Dot.visible=this.lineShow,this.line2Dot.visible=this.lineShow,this.line1.visible=this.lineShow,this.line2.visible=this.lineShow,this.line1.graphics.clear(),this.line1.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line1.graphics.moveTo(this.candle.x+40,this.candle.y),this.line1.graphics.lineTo(this.mainLineX,this.candle.y),this.line1.graphics.lineTo(this.mainLineX+this.focus,this.mainLineY);var t=this.screen.x-(this.kong.x+this.focus),e=this.focus/(this.mainLineY-this.candle.y);this.line1.graphics.lineTo(this.mainLineX+this.focus+t,this.mainLineY+t/e),this.line1.graphics.endFill(),this.line2.graphics.clear(),this.line2.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line2.graphics.moveTo(this.candle.x+40,this.candle.y),this.line2.graphics.lineTo(this.mainLineX,this.mainLineY);var i=this.screen.x-this.kong.x,s=(this.mainLineX-(this.candle.x+40))/(this.mainLineY-this.candle.y);this.line2.graphics.lineTo(this.mainLineX+i,this.mainLineY+i/s),this.line2.graphics.endFill(),this.maskF.x=this.screen.x+45,this.maskF.y=this.screen.y+90,this.a.x=-2e3,this.a.y=this.candle.y-(this.mainLineX-this.a.x)/e,this.b.x=this.mainLineX+this.focus+t,this.b.y=this.mainLineY+t/e,this.c.x=-2e3,this.c.y=this.mainLineY-(this.mainLineX-this.c.x)/s,this.d.x=this.mainLineX+i,this.d.y=this.mainLineY+i/s,this.line1Dot.graphics.clear(),this.line1Dot.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),LightUtils.drawDotLine(this.line1Dot,this.a,this.b,e),this.line2Dot.graphics.clear(),this.line2Dot.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),LightUtils.drawDotLine(this.line2Dot,this.c,this.d,s),this.b.x=this.b.x+1e3,this.b.y=this.b.y+1e3/e,this.d.x=this.d.x+1e3,this.d.y=this.d.y+1e3/s;var n=LightUtils.segmentsIntr(this.a,this.b,this.c,this.d);this.fire.visible=!1,n&&(this.fire.visible=!0,this.fire.alpha=Math.abs(this.screen.x-n.x)/this.focus>=1?0:1-Math.abs(this.screen.x+.5*this.screen.width-n.x)/this.focus,n.x>this.kong.x?(this.fire.alpha=Math.abs(this.screen.x-n.x)/this.focus>=1?0:1-Math.abs(this.screen.x+.5*this.screen.width-n.x)/this.focus,this.fire.scaleY=-1,this.fire.x=this.screen.x+40,this.fire.y=n.y,this.fire.mask=this.maskF):(this.fire.alpha=.4,this.fire.scaleY=1,this.fire.x=n.x,this.fire.y=n.y,this.fire.mask=null))},s.onBeginC=function(t){switch(this.dragItem=null,t.target.name){case"candle":this.dragItem=this.candle;break;case"screen":this.dragItem=this.screen;break;case"kong":this.dragItem=this.kong2}if(this.dragItem){this.startColX=t.stageX,this.startColY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.dragItem.x,this.dragItem.y,e);this.colOffX=this.startColX-i.x,this.colOffY=this.startColY-i.y}},s.onMoveC=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this),this.dragItem&&(this.dragItem.x=t.stageX-this.colOffX,this.dragItem.x=Math.min(this.dragItem.x,440),this.dragItem.x=Math.max(this.dragItem.x,-500),"candle"==this.dragItem.name?(this.dragItem.x=Math.min(this.dragItem.x,this.kong.x-50),this.dragItem.x=Math.max(this.dragItem.x,-500)):"kong"==this.dragItem.name?(this.dragItem.x=Math.min(this.dragItem.x,this.screen.x-50),this.dragItem.x=Math.max(this.dragItem.x,this.candle.x+100),this.kong.x=this.dragItem.x-41,this.kong.y=this.dragItem.y):"screen"==this.dragItem.name&&(this.dragItem.x=Math.min(this.dragItem.x,440),this.dragItem.x=Math.max(this.dragItem.x,this.kong2.x+50)),this.mainLineY=this.kong.y+50,this.mainLineX=this.kong.x+40,this.shadow?(this.line1.graphics.clear(),this.line1.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line1.graphics.moveTo(this.candle.x+40,this.candle.y),this.line1.graphics.lineTo(this.mainLineX,this.candle.y),this.line1.graphics.endFill(),this.line2.graphics.clear(),this.line2.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line2.graphics.moveTo(this.candle.x+40,this.candle.y),this.line2.graphics.lineTo(this.mainLineX,this.mainLineY),this.line2.graphics.endFill()):this.lineCount())},s.onEndC=function(t){this.addEventListener(egret.TouchEvent.TOUCH_END,this.openProPanel,this)},s.setLineShow=function(t){this.lineShow=t,this.line1.visible=t,this.line2.visible=t,this.line1Dot.visible=t,this.line2Dot.visible=t,this.showLine=t},s.shadeMagn=function(t){this.shadow=t,t?(this.line1.graphics.clear(),this.line1.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line1.graphics.moveTo(this.candle.x+40,this.candle.y),this.line1.graphics.lineTo(this.mainLineX,this.candle.y),this.line1.graphics.endFill(),this.line2.graphics.clear(),this.line2.graphics.lineStyle(LightConst.LIGHT_THICK,16711680),this.line2.graphics.moveTo(this.candle.x+40,this.candle.y),this.line2.graphics.lineTo(this.mainLineX,this.mainLineY),this.line2.graphics.endFill(),this.line1Dot.visible=!1,this.line2Dot.visible=!1,this.fire.visible=!1):this.lineCount()},s.setFocus=function(t){this.focus=e.FOCUS*t/10,this.lineCount()},s.setPos=function(t){this.candle.x=t.candlePos[0],this.candle.y=t.candlePos[1],this.screen.x=t.screenPos[0],this.screen.y=t.screenPos[1],this.kong.x=t.kongPos[0],this.kong.y=t.kongPos[1],this.kong2.x=t.kong2Pos[0],this.kong2.y=t.kong2Pos[1],this.mainLineY=this.kong.y+50,this.mainLineX=this.kong.x+40,this.lineCount()},s.setCopy=function(t){this.focus=t.focus,this.shadow=t.shadow,this.setLineShow(t.showLine),this.setRotation(t.rotation),this.setPos(t),this.shadeMagn(t.shadow)},s.getProObj=function(){return{type:LightItemType.MagnItem,x:this.x,y:this.y,rotation:-this.rotation,candlePos:[this.candle.x,this.candle.y],screenPos:[this.screen.x,this.screen.y],kongPos:[this.kong.x,this.kong.y],kong2Pos:[this.kong2.x,this.kong2.y],focus:this.focus,showLine:this.showLine,shadow:this.shadow}},e.FOCUS=112,e}(BaseItem);egret.registerClass(MagnItem,"MagnItem");var MagnProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/MagnProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.proName.text="透镜成像",this.showBtn.addEventListener(egret.Event.CHANGE,this.onShow,this),this.showBtn.selected=!1,this.shadeBtn.addEventListener(egret.Event.CHANGE,this.onShade,this),this.shadeBtn.selected=!1,this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.dropDownList.setFun(this.changeFocus,this)},s.onShow=function(t){this._item.setLineShow(this.showBtn.selected)},s.onShade=function(t){this._item.shadeMagn(this.shadeBtn.selected)},s.setData=function(e){t.prototype.setData.call(this,e);var i=[[10,"10"],[15,"15"],[20,"20"]];if(this.dropDownList.setData(i,0),this._data){for(var s=i[0][1],n=this._data.focus/MagnItem.FOCUS*10,r=0;r<i.length;r++)i[r][0]==n&&(s=i[r][1]);this.dropDownList.setCurLabel(s),this.showBtn.selected=!1,this.shadeBtn.selected=!1,this.showBtn.selected=this._data.showLine,this.shadeBtn.selected=this._data.shadow}},s.changeFocus=function(t){this._item.setFocus(t)},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){},s.dispose=function(){},e}(InfoPanelBase);egret.registerClass(MagnProPanel,"MagnProPanel");var MiragesItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"hair_png"),this.bitMap.alpha=0,this.mirUI=new MiragesUI,this.addChild(this.mirUI),this.mirUI.width=1422,this.mirUI.height=348,this.mirUI.anchorOffsetX=this.mirUI.width/2,this.mirUI.anchorOffsetY=this.mirUI.height/2,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginM,this)},s.onBeginM=function(t){this.starX=t.stageX,this.starY=t.stageY;var e=new egret.Point,i=this.parent.localToGlobal(this.x,this.y,e);this.ofX=this.starX-i.x,this.ofY=this.starY-i.y,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveM,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onEndM,this)},s.onMoveM=function(t){return this.ro?(this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveM,this),void this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndM,this)):(this.x=t.stageX-this.ofX,void(this.y=t.stageY-this.ofY))},s.onEndM=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMoveM,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEndM,this)},s.setCopy=function(t){},s.getProObj=function(){return{type:LightItemType.MiragesItem,x:this.x,y:this.y}},e}(BaseItem);egret.registerClass(MiragesItem,"MiragesItem");var MiragesUI=function(t){function e(){t.call(this,null),this.skinName="resource/skins/light/MirageSkin.exml"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.initUI=function(){t.prototype.initUI.call(this),this.showBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onShow,this),this.xian.mask=this.maskF,this.xian2.mask=this.maskT,this.maskF.anchorOffsetX=this.maskF.width,this.maskT.anchorOffsetX=this.maskT.width},s.onShow=function(t){t.stopPropagation(),this.maskF.x=1936,this.maskT.x=700,egret.Tween.get(this.maskF).to({x:1250},1e3).call(this.showT,this)},s.showT=function(){egret.Tween.get(this.maskT).to({x:1250},1e3)},e}(BaseEuiView);egret.registerClass(MiragesUI,"MiragesUI");var MirrItem=function(t){function e(e,i){t.call(this,e,i),this.angle=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){this.di=new egret.Bitmap,this.di.texture=RES.getRes("di0_png"),this.addChild(this.di),this.di.anchorOffsetX=this.di.width/2,this.di.touchEnabled=!1,this.click=0,t.prototype.init.call(this,"mirr_png"),this.AShape=new p2.Box({width:0,height:0}),this.body.mass=1,this.body.position=[400,400],this.body.addShape(this.AShape),this.body.displays=[this],this.body.refrac=1.9,this.moveFun=this.movehandler,this.floor=new egret.Sprite,this.addChild(this.floor),this.floor.graphics.beginFill(16773120,.5),this.floor.graphics.moveTo(0,0),this.floor.graphics.lineTo(this.bitMap.width,0),this.floor.graphics.lineTo(this.bitMap.width,200),this.floor.graphics.lineTo(0,200),this.floor.graphics.endFill(),this.floor.x=-this.bitMap.width/2,this.floor.y=this.bitMap.height/2,this.floor.visible=!1,this.bitCopy=new egret.Bitmap,this.bitCopy.texture=RES.getRes("candle_png"),this.bitCopy.anchorOffsetX=this.bitCopy.width/2,this.bitCopy.anchorOffsetY=this.bitCopy.height/2,this.bitCopy.alpha=.5,this.addChild(this.bitCopy),this.bitCopy.visible=!1,this.maskC=new egret.Sprite,this.maskC.graphics.beginFill(16711680),this.maskC.graphics.drawRect(0,0,this.bitMap.width,this.bitMap.height),this.maskC.graphics.endFill(),this.maskC.anchorOffsetX=this.bitMap.width/2,this.maskC.anchorOffsetY=this.bitMap.height/2,this.addChild(this.maskC),this.bitCopy.mask=this.maskC,this.bitMap.alpha=.5;var e=new eui.Button;e.x=300,e.label="旋转",this.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_END,this.onBtn,this),MessageCenter.getInstance().addListener(ItemEventConst.CANDLE_LIGHT,this.candleLight,this)},s.candleLight=function(t){t?(this.bitCopy.texture=RES.getRes("candle_png"),this.bitCopy.anchorOffsetY=this.bitCopy.height/2):(this.bitCopy.texture=RES.getRes("candle0_png"),this.bitCopy.anchorOffsetY=this.bitCopy.height/2-26)},s.onBtn=function(t){t.stopPropagation();200-this.bitMap.height/2;if(this.click++,this.click%4==0){var e=Math.cos(0),i=Math.sin(0);this.di.texture=RES.getRes("di0_png"),this.bitMap.touchEnabled=!0,this.candle&&(this.bitCopy.visible=!0,this.candle.bitMap.touchEnabled=!0,this.candle.movePos([this.x+2,this.y+143])),this.bitMap.matrix=new egret.Matrix(e,i/2,0,1,0,0),this.maskC.matrix=new egret.Matrix(e,i/2,0,1,0,0),this.bitCopy.matrix=new egret.Matrix(e,i/2,0,1,5,-42.5)}else if(this.click%4==1){var e=Math.cos(Math.PI/6),i=Math.sin(Math.PI/6);this.di.texture=RES.getRes("di30_png"),this.bitMap.touchEnabled=!1,this.candle&&(this.bitCopy.visible=!0,this.candle.bitMap.touchEnabled=!1,this.candle.movePos([this.x-82,this.y+118])),this.bitMap.matrix=new egret.Matrix(e,i/2,0,1,100,20),this.maskC.matrix=new egret.Matrix(e,i/2,0,1,100,20),this.bitCopy.matrix=new egret.Matrix(e,i/2,0,1,140,0)}else if(this.click%4==2){var e=Math.cos(Math.PI/3+.2),i=Math.sin(Math.PI/3+.2);this.di.texture=RES.getRes("di60_png"),this.bitMap.touchEnabled=!1,this.candle&&(this.bitCopy.visible=!0,this.candle.bitMap.touchEnabled=!1,this.candle.movePos([this.x-180,this.y+31])),this.bitMap.matrix=new egret.Matrix(e,i/2,0,1,0,0),this.maskC.matrix=new egret.Matrix(e,i/2,0,1,0,0),this.bitCopy.matrix=new egret.Matrix(e,i/2,0,1,this.bitCopy.x,this.bitCopy.y)}else if(this.click%4==3){var e=Math.cos(Math.PI/2+.02),i=Math.sin(Math.PI/2+.02);this.di.texture=RES.getRes("di90_png"),this.bitMap.touchEnabled=!1,this.candle&&(this.bitCopy.visible=!0,this.candle.bitMap.touchEnabled=!1,this.candle.movePos([this.x-72,this.y+13])),this.bitMap.matrix=new egret.Matrix(e,i/2,0,1,100,0),this.maskC.matrix=new egret.Matrix(e,i/2,0,1,100,0),this.bitCopy.matrix=new egret.Matrix(e,i/2,0,1,this.bitCopy.x,this.bitCopy.y)}},s.movehandler=function(){if(this.candleX&&this.candleY){var t=new egret.Point,e=this.floor.localToGlobal(0,0,t),i=new egret.Point,s=this.floor.localToGlobal(this.floor.width,this.floor.height,i);this.candleX>=e.x&&this.candleX<=s.x&&this.candleY>=e.y&&this.candleY<=s.y?this.showMirr(this.candleX,this.candleY):this.clearMirr()}},s.isIn=function(t,e,i){this.candle=i,this.candleX=t,this.candleY=e;var s=new egret.Point,n=this.floor.localToGlobal(0,0,s),r=new egret.Point,h=this.floor.localToGlobal(this.floor.width,this.floor.height,r);return this.candleX>=n.x&&this.candleX<=h.x&&this.candleY>=n.y&&this.candleY<=h.y?!0:!1},s.showMirr=function(t,e){this.bitCopy.visible=!0,this.bitCopy.x=t-this.x;var i=new egret.Point,s=this.floor.localToGlobal(this.floor.width/2,this.floor.height/2,i);this.bitCopy.y=s.y-e-40},s.clearMirr=function(){this.bitCopy.visible=!1},s.setCopy=function(t){},s.getProObj=function(){return{type:LightItemType.MirrItem,x:this.x,y:this.y}},e}(BaseItem);egret.registerClass(MirrItem,"MirrItem");var MirrPItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"mirrp_png");var e=[[-220,0],[200,0],[200,5],[-220,5]];this.boxShape=new p2.Convex(e),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.boxShape),this.body.displays=[this],this.body.refrac=0,this.preHeight=this.bitMap.height,this.preWidth=this.bitMap.width,this.parent.addChildAt(this,0)},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.onBegin=function(e){t.prototype.onBegin.call(this,e),this.cardItem&&this.cardItem.onBegin(e)},s.setCopy=function(t){this.setRotation(t.rotation)},s.getProObj=function(){return{type:LightItemType.MirrPItem,x:this.x,y:this.y,rotation:-this.rotation,refrac:this.body.refrac}},e}(BaseItem);egret.registerClass(MirrPItem,"MirrPItem");var MirrPItem2=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"fspmirr_png"),this.hasX=!0,this.boxShape=new p2.Box({width:10,height:this.bitMap.height}),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.boxShape,[10,0]),this.body.displays=[this],this.body.refrac=0,this.body.angle=-Math.PI/2,this.rotation=-90,this.body2=new p2.Body,this.body2.mass=1,this.body2.refrac=-1,this.body2.angle=-Math.PI/2,this.boxShape2=new p2.Box({width:20,height:this.bitMap.height}),this.body2.addShape(this.boxShape2,[-5,0]),this.body2.displays=[this],this.body2.type=p2.Body.AWAKE,this.world.addBody(this.body2),this.bodyArr.push(this.body2),this.preHeight=this.bitMap.height,this.preWidth=this.bitMap.width},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.setHeight=function(t){var e=this.preHeight+10*t;this.boxShape.height=e,this.bitMap.height=e,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.body.removeShape(this.boxShape),this.boxShape=new p2.Box({width:this.bitMap.width,height:this.bitMap.height}),this.body.addShape(this.boxShape)},s.setWidth=function(t){var e=this.preWidth+10*t;this.boxShape.width=e,this.bitMap.width=e,this.bitMap.anchorOffsetX=this.bitMap.width/2,this.body.removeShape(this.boxShape),this.boxShape=new p2.Box({width:this.bitMap.width,height:this.bitMap.height}),this.body.addShape(this.boxShape)},s.setCopy=function(t){this.setRotation(t.rotation)},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xfspmirr_png"):RES.getRes("fspmirr_png"),this.bitMap.x=t?10:0},s.getProObj=function(){return{type:LightItemType.MirrPItem2,x:this.x,y:this.y,rotation:-this.rotation}},e}(BaseItem);egret.registerClass(MirrPItem2,"MirrPItem2");var SemiCircleItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"bicircle_png"),this.hasX=!0,this.radius=this.bitMap.width/2;for(var e=[],i=180;i>=0;i--){var s=-this.radius*Math.sin(1*i*Math.PI/180),n=this.radius*Math.cos(1*i*Math.PI/180);e.push([n,s])}this.semShape=new p2.Convex({vertices:e}),this.body.mass=1,this.body.position=[800,800],this.body.addShape(this.semShape,[0,this.bitMap.height/2]),this.body.displays=[this],this.body.refrac=1.4,this.radiusV=0,this.mainPoint=new egret.Bitmap,this.mainPoint.texture=RES.getRes("gpoint_png"),this.mainPoint.anchorOffsetX=this.mainPoint.width/2,this.mainPoint.anchorOffsetY=this.mainPoint.height/2,this.mainPoint.y=this.radius/2,this.addChild(this.mainPoint)},s.Scale=function(e){t.prototype.Scale.call(this,e);for(var i=[],s=180;s>=0;s--){var n=-this.radius*Math.sin(1*s*Math.PI/180),r=this.radius*Math.cos(1*s*Math.PI/180);i.push([r,n])}this.semShape.vertices=i},s.setRadius=function(t){var e=this.radius+10*t;this.body.removeShape(this.semShape),this.bitMap.width=2*e,this.bitMap.height=e,this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2;for(var i=[],s=180;s>=0;s--){var n=-e*Math.sin(1*s*Math.PI/180),r=e*Math.cos(1*s*Math.PI/180);i.push([r,n])}this.semShape=new p2.Convex({vertices:i}),this.body.addShape(this.semShape,[0,this.bitMap.height/2]),this.radiusV=t,this.mainPoint.y=e/2},s.setCopy=function(t){this.setRotation(t.rotation),this.setRadius(t.radiusV),this.setRaf(t.refrac)},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xbicircle_png"):RES.getRes("bicircle_png")},s.getProObj=function(){return{type:LightItemType.SemiCircle,x:this.x,y:this.y,rotation:-this.rotation,refrac:this.body.refrac,radiusV:this.radiusV}},e}(BaseItem);egret.registerClass(SemiCircleItem,"SemiCircleItem");var SemiProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/SemiProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.radiusRoll.addEventListener(egret.Event.CHANGE,this.changRadius,this),this.radiusRoll.value=0,this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.dropDownList.setFun(this.changeRaf,this)},s.setData=function(e){t.prototype.setData.call(this,e);var i=[[LightConst.REFRA_1,LightConst.REFRA_1],[LightConst.REFRA_2,LightConst.REFRA_2],[LightConst.REFRA_3,LightConst.REFRA_3],[LightConst.REFRA_4,LightConst.REFRA_4],[LightConst.REFRA_5,LightConst.REFRA_5],[LightConst.REFRA_6,LightConst.REFRA_6]];this.dropDownList.setData(i,0),this._data&&!this.refreshData&&(this.radiusRoll.value=this._data.radiusV,this.dropDownList.setCurLabel(this._data.refrac)),this.refreshData&&(this.radiusRoll.value=this.refreshData.radiusV,this.dropDownList.setCurLabel(this.refreshData.refrac),this.refreshData=null),this.radius=this._item.bitMap.width/2,this.panel.proName.text=this._item.config.name},s.changRadius=function(t){this._item.setRadius(t.currentTarget.value)},s.changeRaf=function(t){this._item.setRaf(t)},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){var e=this._item.getProObj();MessageCenter.getInstance().dispatch(ItemEventConst.COPY_ITEM,e)},s.dispose=function(){},s.refresh=function(t){this.refreshData=t},e}(InfoPanelBase);egret.registerClass(SemiProPanel,"SemiProPanel");var TriItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"tri_png"),this.hasX=!0;var e=[[this.bitMap.width/2,this.bitMap.height/2],[-this.bitMap.width/2,this.bitMap.height/2],[0,-this.bitMap.height/2]];this.triShape=new p2.Convex({vertices:e}),this.body.mass=1,this.body.position=[400,800],this.body.addShape(this.triShape),this.body.displays=[this],this.body.refrac=1.2,this.bitWidth=this.bitMap.width,this.bitHeight=this.bitMap.height,this.curWidth=this.bitMap.width,this.curHeight=this.bitMap.height,this.angle=60},s.Scale=function(t){},s.setAngle=function(t){if(t!=this.angle){var e;e=90==t?this.curWidth*Math.sqrt(3):this.curWidth,this.bitMap.width=e,this.bitMap.anchorOffsetX=this.bitMap.width/2,this.body.removeShape(this.triShape);var i=[[this.bitMap.width/2,this.bitMap.height/2],[-this.bitMap.width/2,this.bitMap.height/2],[0,-this.bitMap.height/2]];this.triShape=new p2.Convex({vertices:i}),this.body.addShape(this.triShape),this.bitWidth=this.bitMap.width,this.angle=t}},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xtri_png"):RES.getRes("tri_png")},s.setCopy=function(t){this.setRotation(t.rotation),this.setAngle(t.angV),this.setRaf(t.refrac)},s.getProObj=function(){return{type:LightItemType.Tri,x:this.x,y:this.y,rotation:-this.rotation,refrac:this.body.refrac,angV:this.angle}},e}(BaseItem);egret.registerClass(TriItem,"TriItem");var TriProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/TriProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.scaleRoll.addEventListener(egret.Event.CHANGE,this.changScale,this),this.scaleRoll.value=5,this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.dropDownList.setFun(this.changeRaf,this),this.dropDownList2.setFun(this.changeRotation,this),this.dropDownList3.setFun(this.changeAng,this)},s.setData=function(e){t.prototype.setData.call(this,e);var i=[[LightConst.REFRA_1,LightConst.REFRA_1],[LightConst.REFRA_2,LightConst.REFRA_2],[LightConst.REFRA_3,LightConst.REFRA_3],[LightConst.REFRA_4,LightConst.REFRA_4],[LightConst.REFRA_5,LightConst.REFRA_5],[LightConst.REFRA_6,LightConst.REFRA_6]];this.dropDownList.setData(i,0);var s=[[0,"0°"],[30,"30°"],[45,"45°"],[60,"60°"],[90,"90°"]];this.dropDownList2.setData(s,0),this.setRotaLabel(Math.floor(Math.abs(this._item.rotation)));var n=[[60,"60°"],[90,"90°"]];this.dropDownList3.setData(n,0),this.panel.proName.text=this._item.config.name,this._data&&(this.dropDownList.setCurLabel(this._data.refrac),this.dropDownList3.setCurLabel(this._data.angV+"°"))},s.changScale=function(t){var e=t.currentTarget.value/10+.5;this._item.Scale(e)},s.changeRaf=function(t){this._item.setRaf(t)},s.changeRotation=function(t){this._item.setRotation(t)},s.setRotaLabel=function(t){this.dropDownList2.setCurLabel(Math.floor(t)+"°")},s.changeAng=function(t){this._item.setAngle(t)},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){},s.dispose=function(){},e}(InfoPanelBase);egret.registerClass(TriProPanel,"TriProPanel");var VMirrItem=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"vmir_png"),this.hasX=!0,this.radius=(this.bitMap.width*this.bitMap.width+4*this.bitMap.height*this.bitMap.height)/(8*this.bitMap.width),this.angle=Math.floor(180*Math.atan(this.bitMap.height/2/(this.radius-this.bitMap.width/2))/Math.PI),this.radiusM=this.radius,this.angleM=this.angle;var e=Math.floor(this.angle);e=Math.abs(e);for(var i=[],s=[],n=-e;e>=n;n++){var r=-this.radius*Math.sin(1*n*Math.PI/180),h=this.radius*Math.cos(1*n*Math.PI/180),o=this.bitMap.width/2-(h-this.radius*Math.cos(this.angle*Math.PI/180));i.push([-o,r]),s.push([-o,r])}for(var n=s.length-1;n>=0;n--)i.push([-s[n][0],s[n][1]]);this.AShape=new p2.Convex({vertices:i}),this.body.mass=1,this.body.position=[800,800],this.body.addShape(this.AShape),this.body.displays=[this],this.body.refrac=6.5,this.mainLine=new egret.Bitmap,this.mainLine.texture=RES.getRes("mainlight_png"),this.mainLine.anchorOffsetX=this.mainLine.width/2,this.mainLine.anchorOffsetY=this.mainLine.height/4,this.addChild(this.mainLine),this.mainLine.visible=!1,this.mainPoint=new egret.Bitmap,this.mainPoint.texture=RES.getRes("gpoint_png"),this.mainPoint.anchorOffsetX=this.mainPoint.width/2,this.mainPoint.anchorOffsetY=this.mainPoint.height/2,this.addChild(this.mainPoint),this.sType=1},s.changeView=function(t){switch(this.sType=t,this.bitMap.texture=null,this.body.removeShape(this.AShape),t){case 1:this.bitMap.texture=RES.getRes("vmir_png"),this.radius=this.radiusM,this.angle=this.angleM;break;case 2:this.bitMap.texture=RES.getRes("vmir4_png"),this.radius=this.radiusM-20,this.angle=this.angleM+4;break;case 3:this.bitMap.texture=RES.getRes("vmir3_png"),this.radius=this.radiusM,this.angle=this.angleM}var e=Math.floor(this.angle);e=Math.abs(e);for(var i=[],s=[],n=-e;e>=n;n++){var r=-this.radius*Math.sin(1*n*Math.PI/180),h=this.radius*Math.cos(1*n*Math.PI/180),o=this.bitMap.width/2-(h-this.radius*Math.cos(this.angle*Math.PI/180));i.push([-o,r]),s.push([-o,r])}for(var n=s.length-1;n>=0;n--)i.push([-s[n][0],s[n][1]]);this.AShape=new p2.Convex({vertices:i}),this.body.addShape(this.AShape)},s.setLineShow=function(t){this.mainLine.visible=t},s.setCopy=function(t){this.setRotation(t.rotation),this.setRaf(t.refrac),this.setLineShow(t.lineShow),this.changeView(t.sType)},s.getProObj=function(){return{type:LightItemType.VMirrItem,x:this.x,y:this.y,rotation:-this.rotation,refrac:this.body.refrac,lineShow:this.mainLine.visible,sType:this.sType}},s.changeToX=function(t){var e;1==this.sType&&(e="vmir_png"),2==this.sType&&(e="vmir2_png"),3==this.sType&&(e="vmir3_png"),this.bitMap.texture=t?RES.getRes("xvmir_png"):RES.getRes(e),this.mainPoint.visible=!t},e}(BaseItem);egret.registerClass(VMirrItem,"VMirrItem");var VMirrItem2=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"fsvmirr_png"),this.hasX=!0,this.radius=500,this.angle=30;var e=Math.floor(this.angle/1);e=Math.abs(e);for(var i=[],s=[],n=e;n>=-e;n--){var r=-this.radius*Math.sin(1*n*Math.PI/180),h=this.radius*Math.cos(1*n*Math.PI/180);i.push([100-h+this.radius*Math.cos(this.angle*Math.PI/180),r]),s.push([100-h+this.radius*Math.cos(this.angle*Math.PI/180),r])}for(var n=s.length-1;n>=0;n--)i.push([s[n][0]-20,s[n][1]]);this.AShape=new p2.Convex({vertices:i}),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.AShape,[-50,0]),this.body.displays=[this],this.body.refrac=0,this.body2=new p2.Body,this.body2.mass=1,this.body2.refrac=-1,this.BShape=new p2.Convex({vertices:i}),this.body2.addShape(this.BShape,[-70,0]),this.body2.displays=[this],this.body2.type=p2.Body.AWAKE,this.world.addBody(this.body2),this.bodyArr.push(this.body2),this.setRotation(180)},s.Scale=function(e){t.prototype.Scale.call(this,e)},s.setCopy=function(t){this.setRotation(t.rotation)},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xfsvmirr_png"):RES.getRes("fsvmirr_png")},s.getProObj=function(){return{type:LightItemType.VMirrItem2,x:this.x,y:this.y,rotation:-this.rotation}},e}(BaseItem);egret.registerClass(VMirrItem2,"VMirrItem2");var VMirrProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/AMirrProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.panel2.setH(this.group2.height),this.panel.panel2.proGroup.addChild(this.group2),this.group2.x=0,this.group2.y=0,this.dropDownList.setFun(this.changeRaf,this),this.dropDownList2.setFun(this.changeRotation,this),this.showBtn.addEventListener(egret.Event.CHANGE,this.onShow,this),this.showBtn.selected=!1,this.typeBtn1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.typeBtn1.selected=!0,this.typeBtn1.indexID=1,this.typeBtn2.indexID=2,this.typeBtn3.indexID=3},s.onType=function(t){this._item.changeView(t.currentTarget.indexID)},s.setData=function(e){t.prototype.setData.call(this,e);var i=[[LightConst.REFRA_5,"10"],[LightConst.REFRA_3,"15"],[LightConst.REFRA_1,"20"]];this.dropDownList.setData(i,0);var s=[[0,"0°"],[45,"45°"],[90,"90°"]];if(this.dropDownList2.setData(s,0),this.setRotaLabel(Math.floor(Math.abs(this._item.rotation))),this.refreshData){this.dropDownList2.setCurLabel(Math.floor(this.refreshData.rotation)+"°");for(var n=i[0][1],r=0;r<i.length;r++)i[r][0]==this.refreshData.refrac&&(n=i[r][1]);this.dropDownList.setCurLabel(n),this.showBtn.selected=this.refreshData.lineShow,this.refreshData=null}if(this._data&&!this.refreshData){for(var n=i[0][1],r=0;r<i.length;r++)i[r][0]==this._data.refrac&&(n=i[r][1]);this.typeBtn1.selected=!1,this.typeBtn2.selected=!1,this.typeBtn3.selected=!1,this.dropDownList.setCurLabel(n),this.showBtn.selected=this._data.lineShow,this["typeBtn"+this._data.sType].selected="true"}this.panel.proName.text=this._item.config.name},s.changeRaf=function(t){this._item.setRaf(t)},s.changeRotation=function(t){this._item.setRotation(t)},s.setRotaLabel=function(t){this.dropDownList2.setCurLabel(Math.floor(t)+"°")},s.changeAng=function(t){this._item.setAngle(t)},s.onShow=function(t){this._item.setLineShow(this.showBtn.selected)},s.dispose=function(){},s.refresh=function(t){this.refreshData=t},e}(InfoPanelBase);egret.registerClass(VMirrProPanel,"VMirrProPanel");var WaterItem=function(t){function e(e,i){t.call(this,e,i),this.heightV=0}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"water_png"),this.boxShape=new p2.Box({width:this.bitMap.width,height:this.bitMap.height}),this.body.mass=1,this.body.position=[600,400],this.body.addShape(this.boxShape),this.body.displays=[this],this.body.refrac=1.6,this.preHeight=this.bitMap.height,this.preWidth=this.bitMap.width,this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("waterbool_png"),this.bg.height=500,this.bg.anchorOffsetX=this.bg.width/2,this.bg.anchorOffsetY=this.bg.height/2,this.bg.y=-165,this.addChild(this.bg),this.body2=new p2.Body,this.body2.mass=1,this.body2.refrac=-1,this.shape2=new p2.Box({width:3,height:this.bg.height}),this.body2.addShape(this.shape2,[-this.bg.width/2+2,-165]),this.body2.displays=[this],this.body2.type=p2.Body.AWAKE,this.world.addBody(this.body2),this.body3=new p2.Body,this.body3.mass=1,this.body3.refrac=-1,this.shape3=new p2.Box({width:3,height:this.bg.height}),this.body3.addShape(this.shape3,[this.bg.width/2-2,-165]),this.body3.displays=[this],this.body3.type=p2.Body.AWAKE,this.world.addBody(this.body3),this.body4=new p2.Body,this.body4.mass=1,this.body4.refrac=-1,this.shape4=new p2.Box({width:this.bg.width,height:3}),this.body4.addShape(this.shape4,[0,this.preHeight/2]),this.body4.displays=[this],this.body4.type=p2.Body.AWAKE,this.world.addBody(this.body4),this.bodyArr.push(this.body2),this.bodyArr.push(this.body3),this.bodyArr.push(this.body4)},s.Scale=function(e){t.prototype.Scale.call(this,e)
},s.setHeight=function(t){var e=this.preHeight+50*t;e=Math.max(0,e),e>=214&&250>=e&&(e=250),e>=450&&(e=490),this.boxShape.height=e,this.bitMap.height=e,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.bitMap.y=-(e-this.preHeight)/2,this.body.removeShape(this.boxShape),this.boxShape=new p2.Box({width:this.bitMap.width,height:this.bitMap.height}),this.body.addShape(this.boxShape,[0,-(e-this.preHeight)/2]),this.heightV=t},s.setWidth=function(t){},s.setCopy=function(t){this.setRotation(t.rotation),this.setHeight(t.heightV),this.setRaf(t.refrac)},s.getProObj=function(){return{type:LightItemType.WaterItem,x:this.x,y:this.y,rotation:-this.rotation,refrac:this.body.refrac,heightV:this.heightV}},e}(BaseItem);egret.registerClass(WaterItem,"WaterItem");var WaterProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/WaterProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.heightRoll.addEventListener(egret.Event.CHANGE,this.changHeight,this),this.heightRoll.value=0,this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.dropDownList.setFun(this.changeRaf,this)},s.setData=function(e){t.prototype.setData.call(this,e);var i=[[LightConst.REFRA_1,LightConst.REFRA_1],[LightConst.REFRA_2,LightConst.REFRA_2],[LightConst.REFRA_3,LightConst.REFRA_3],[LightConst.REFRA_4,LightConst.REFRA_4],[LightConst.REFRA_5,LightConst.REFRA_5],[LightConst.REFRA_6,LightConst.REFRA_6]];this.dropDownList.setData(i,0),this.refreshData&&(this.heightRoll.value=this.refreshData.heightV,this.dropDownList.setCurLabel(this.refreshData.refrac),this.refreshData=null),this.panel.proName.text=this._item.config.name,this.heightRoll.value=Math.ceil(this._item.preHeight/50),this.preValue=this.heightRoll.value,this._data&&!this.refreshData&&(this.dropDownList.setCurLabel(this._data.refrac),this.heightRoll.value=this._data.heightV+this.preValue)},s.changHeight=function(t){this._item.setHeight(t.currentTarget.value-this.preValue)},s.changeRaf=function(t){this._item.setRaf(t)},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){var e=this._item.getProObj();MessageCenter.getInstance().dispatch(ItemEventConst.COPY_ITEM,e)},s.dispose=function(){},s.refresh=function(t){this.refreshData=t},e}(InfoPanelBase);egret.registerClass(WaterProPanel,"WaterProPanel");var BaseLight=function(t){function e(e,i){t.call(this,e,i),this.infoPanel=null,this.typeid=-1,this.infoCls=null,this.showLight=!0,this.tapView=i}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(e,i){void 0===e&&(e="jiguangbi_png"),void 0===i&&(i=!0),this.bitMap=new egret.Bitmap,this.bitMap.texture=RES.getRes(e),this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.bitMap.touchEnabled=!0,this.addChild(this.bitMap),t.prototype.init.call(this),this.lineArr=[],this.lineSp=new egret.Sprite,this.addChild(this.lineSp),this.offOnBtn=new eui.Button,this.offOnBtn.x=-50,this.offOnBtn.y=-50,this.offOnBtn.width=this.offOnBtn.height=50,this.addChild(this.offOnBtn),this.offOnBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onOff,this),this.offOnBtn.alpha=.01,this.body=new p2.Body,this.body.type=p2.Body.AWAKE,this.world.addBody(this.body),this.boxShape=new p2.Box({width:this.bitMap.width-10,height:this.bitMap.height}),this.body.mass=1,i&&this.body.addShape(this.boxShape,[-5,0]),this.body.displays=null,this.body.refrac=-1},s.openProPanel=function(e){t.prototype.openProPanel.call(this,e),this.tapView&&(this.infoPanel||(this.infoPanel=this.tapView.getInfoPanel(this.typeid,this.infoCls)),null!=this.infoPanel&&this.tapView.showInfoPanel(this.infoPanel,this))},s.onOff=function(t){t.stopPropagation(),this.showLight=!this.showLight,this.lineSp.visible=this.showLight},s.onSpotBegin=function(e){t.prototype.onSpotBegin.call(this,e);var i=e.stageX-this.x,s=e.stageY-this.y;this.pressRbody=Math.atan2(s,i)},s.onStageMove=function(e){if(t.prototype.onStageMove.call(this,e),1==this.ro){var i=e.stageX-this.x,s=e.stageY-this.y,n=Math.atan2(s,i),r=n-this.pressRbody;this.pressRbody=n,this.body.angle+=r}},s.onMove=function(e){t.prototype.onMove.call(this,e),this.body.position=[this.x,this.y],null!=this.moveFun&&this.moveFun.apply(this)},s.Position=function(t){this.x=t[0],this.y=t[1],this.body.position=t},s.setLineThick=function(t){for(var e=0;e<this.lineArr.length;e++){var i=this.lineArr[e];i.Thickness=t}},s.setColor=function(t){for(var e=0;e<this.lineArr.length;e++){var i=this.lineArr[e];i.Color=t}},s.setRotation=function(t){this.body.angle=-t*Math.PI/180,this.rotation=-t},s.getProObj=function(){return null},s.dispose=function(){t.prototype.dispose.call(this),this.world.removeBody(this.body)},e}(Item);egret.registerClass(BaseLight,"BaseLight");var CandleLight=function(t){function e(e,i){t.call(this,e,i),this.open=!0,this.world1=e}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"candle_png",!1),this.hasX=!0,this.moveFun=this.moveHandler,this.roSpot.touchEnabled=!1;for(var e=0;2>e;e++)this.line=new LightLine,this.line.rotation=10*e,this.line.index=e+1,this.lineSp.addChild(this.line),this.lineArr.push(this.line),this.line.x=this.bitMap.width/2,this.line.y=-80;this.lineSp.visible=!1,this.offOnBtn.touchEnabled=!1},s.Position=function(e){t.prototype.Position.call(this,e),this.moveHandler()},s.moveHandler=function(){for(var t=this.world1.bodies.length,e=0;t>e;e++){var i=this.world1.bodies[e];if(i.displays&&i.displays[0]instanceof MirrItem){var s=i.displays[0];s.isIn(this.x,this.y+80,this)?s.showMirr(this.x,this.y+80):s.clearMirr()}}},s.onOff=function(){this.open=!this.open,this.open?(this.bitMap.texture=RES.getRes("candle_png"),this.bitMap.y=0,this.lineSp.visible=!0):(this.bitMap.texture=RES.getRes("candle0_png"),this.bitMap.y=52,this.lineSp.visible=!1),MessageCenter.getInstance().dispatch(ItemEventConst.CANDLE_LIGHT,this.open)},s.isShowLight=function(t){this.lineSp.visible=t},s.movePos=function(e){t.prototype.Position.call(this,e)},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xcandle_png"):RES.getRes("candle_png"),this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.bitMap.y=t?-80:0},s.getProObj=function(){return{type:LightItemType.CandleLight,x:this.x,y:this.y,rotation:-this.rotation,lineShow:this.lineSp.visible}},s.setCopy=function(t){this.setRotation(t.rotation),this.setLineShow(t.lineShow)},s.setLineShow=function(t){this.lineSp.visible=t},e}(BaseLight);egret.registerClass(CandleLight,"CandleLight");var CandleProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/CandleProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.showBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.disBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this),this.disBtn.selected=!0},s.onType=function(t){t.currentTarget==this.showBtn?this.showLight(!0):this.showLight(!1)},s.isOpen=function(t){this.showBtn.selected=t,this.disBtn.selected=!t},s.showLight=function(t){this._item.isShowLight(t)},s.setData=function(e){t.prototype.setData.call(this,e),this._data&&(this.disBtn.selected=!1,this.showBtn.selected=!1,this._data.lineShow?this.showBtn.selected=!0:this.disBtn.selected=!0)},s.dispose=function(){},e}(InfoPanelBase);egret.registerClass(CandleProPanel,"CandleProPanel");var LasterLight=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this),this.hasX=!0,this.line=new LightLine,this.lineSp.addChild(this.line),this.lineArr.push(this.line),this.line.x=this.bitMap.width/2,this.switchSign=new egret.Bitmap,this.switchSign.texture=RES.getRes("jiguangbi_on_btn_png"),this.switchSign.anchorOffsetX=this.bitMap.width/2,this.switchSign.anchorOffsetY=this.bitMap.height/2,this.switchSign.touchEnabled=!1,this.switchSign.x=108,this.switchSign.y=-5,this.addChildAt(this.switchSign,0)},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xcandle_png"):RES.getRes("jiguangbi_png"),this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.bitMap.x=t?150:0,this.switchSign.visible=!t},s.onOff=function(e){t.prototype.onOff.call(this,e),this.lineSp.visible?(this.switchSign.texture=RES.getRes("jiguangbi_on_btn_png"),this.switchSign.y=-5):(this.switchSign.texture=RES.getRes("jiguangbi_off_btn_png"),this.switchSign.y=-10)},s.getProObj=function(){return{type:LightItemType.LasterLight,x:this.x,y:this.y,rotation:-this.rotation,thick:this.lineArr[0].thicknes,color:this.lineArr[0].color}},s.setCopy=function(t){this.setColor(t.color),this.setRotation(t.rotation),this.setLineThick(t.thick)},e}(BaseLight);egret.registerClass(LasterLight,"LasterLight");var LasterProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/LasterProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.numRoll.addEventListener(egret.Event.CHANGE,this.changThick,this),this.numRoll.value=LightConst.LIGHT_THICK,this.dropDownList.setFun(this.changeColor,this),this.dropDownList2.setFun(this.changeRotation,this)},s.setData=function(e){t.prototype.setData.call(this,e);for(var i,s=[[LightConst.COLOR_RED,"红色"],[LightConst.COLOR_ORANGE,"橙色"],[LightConst.COLOR_YELLOW,"黄色"],[LightConst.COLOR_GREEN,"绿色"],[LightConst.COLOR_NAVY,"青色"],[LightConst.COLOR_BLUE,"蓝色"],[LightConst.COLOR_PURPLE,"紫色"]],n=0;n<this._item.lineArr.length;n++){var r=this._item.lineArr[n];i=r}var h;for(n=0;n<s.length;n++)s[n][0]==i.color&&(h=n);this.dropDownList.setData(s,h),this.numRoll.value=i.thicknes;var o=[[0,"0°"],[30,"30°"],[45,"45°"],[60,"60°"],[90,"90°"]];this.dropDownList2.setData(o,0),this.setRotaLabel(Math.floor(Math.abs(this._item.rotation))),this.panel.proName.text=this._item.config.name},s.changThick=function(t){this._item.setLineThick(t.currentTarget.value)},s.changeColor=function(t){this._item.setColor(t)},s.changeRotation=function(t){this._item.setRotation(t)},s.setRotaLabel=function(t){this.dropDownList2.setCurLabel(Math.floor(t)+"°")},s.dispose=function(){t.prototype.dispose.call(this)},e}(InfoPanelBase);egret.registerClass(LasterProPanel,"LasterProPanel");var LightLine=function(t){function e(){t.call(this),this.lineV=.06,this.color=LightConst.COLOR_YELLOW,this.thicknes=LightConst.LIGHT_THICK,this.init()}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.init=function(){this.sprite=new egret.Sprite,this.addChild(this.sprite),this.sprite.graphics.lineStyle(LightConst.LIGHT_THICK,this.color),this.bitArr=[]},n.clear=function(){this.sprite.graphics.clear();for(var t=this.sprite.numChildren,e=0;t>e;e++){var i=this.sprite.getChildAt(e);i instanceof egret.Bitmap&&(i.visible=!1,this.bitArr.push(i))}},n.setStyle=function(t,e){this.sprite.graphics.lineStyle(t,e)},i(n,"Thickness",void 0,function(t){this.thicknes=Math.max(1,t)}),i(n,"Color",void 0,function(t){this.color=t,this.lineV=LightConst.getColorV(t)}),n.move=function(t,e,i){void 0===i&&(i=0),this.sprite.rotation=-this.Rotation;var s=t[0]-this.posX,n=t[1]-this.posY,r=e[0]-this.posX,h=e[1]-this.posY;if(this.sprite.graphics.lineStyle(this.thicknes,this.color),this.sprite.graphics.moveTo(s,n),this.sprite.graphics.lineTo(r,h),LightView.showArrow){if(Math.sqrt((r-s)*(r-s)+(h-n)*(h-n))<100)return;this.arrow=this.getBit(),this.arrow.visible=!0;var o=Math.atan((r-s)/(h-n));this.arrow.rotation=180*Math.atan((h-n)/(r-s))/Math.PI,(r-s)/(h-n)>=0?0>r-s?(this.arrow.x=s-100*Math.sin(o),this.arrow.y=n-100*Math.cos(o),this.arrow.rotation=180+this.arrow.rotation):(this.arrow.x=s+100*Math.sin(o),this.arrow.y=n+100*Math.cos(o)):0>r-s?(this.arrow.x=s+100*Math.sin(o),this.arrow.y=n+100*Math.cos(o),this.arrow.rotation=180+this.arrow.rotation):(this.arrow.x=s-100*Math.sin(o),this.arrow.y=n-100*Math.cos(o))}},n.getBit=function(){var t=this.bitArr.pop();return null==t&&(t=new egret.Bitmap,t.texture=RES.getRes("arrow_png"),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,this.sprite.addChild(t)),t},i(n,"posX",function(){var t=new egret.Point,e=this.localToGlobal(0,0,t);return e.x}),i(n,"posY",function(){var t=new egret.Point,e=this.localToGlobal(0,0,t);return e.y}),i(n,"Rotation",function(){return 0!=this.rotation?this.rotation:this.parent.parent.rotation}),e}(egret.DisplayObjectContainer);egret.registerClass(LightLine,"LightLine");var ParalleLight=function(t){function e(e,i){t.call(this,e,i),this.LineNums=5,this.changeColor=LightConst.COLOR_YELLOW}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this,"parall_png"),this.hasX=!0;var e=new LightLine;this.lineSp.addChild(e),this.lineArr.push(e);var i=new LightLine;this.lineSp.addChild(i),this.lineArr.push(i),i.y=60;var s=new LightLine;this.lineSp.addChild(s),this.lineArr.push(s),s.y=-60;var n=new LightLine;this.lineSp.addChild(n),this.lineArr.push(n),n.y=120;var r=new LightLine;this.lineSp.addChild(r),this.lineArr.push(r),r.y=-120,this.lineSp.y=18,e.x=this.bitMap.width/2,i.x=this.bitMap.width/2,s.x=this.bitMap.width/2,n.x=this.bitMap.width/2,r.x=this.bitMap.width/2,this.switchSign=new egret.Bitmap,this.switchSign.texture=RES.getRes("parall4_png"),this.switchSign.touchEnabled=!1,this.switchSign.x=-25,this.switchSign.y=-150,this.offOnBtn.x=-25,this.offOnBtn.y=-150,this.addChild(this.switchSign),this.isLightArr=[];for(var h=0;4>h;h++){var o=new egret.Bitmap;o.texture=RES.getRes("parall2_png"),this.addChild(o),o.x=-18,o.y=-80+20*h,this.isLightArr.push(o)}this.setLineNums(2)},s.onOff=function(e){t.prototype.onOff.call(this,e),this.lineSp.visible?this.switchSign.texture=RES.getRes("parall4_png"):this.switchSign.texture=RES.getRes("parall3_png");for(var i=0;i<this.isLightArr.length;i++){var s=this.isLightArr[i];s.texture=this.lineSp.visible?RES.getRes("parall2_png"):RES.getRes("parall1_png")}},s.setLineNums=function(t){switch(this.lineSp.removeChildren(),t){case 1:this.lineSp.addChild(this.lineArr[0]);break;case 2:this.lineSp.addChild(this.lineArr[1]),this.lineSp.addChild(this.lineArr[2]);break;case 3:this.lineSp.addChild(this.lineArr[0]),this.lineSp.addChild(this.lineArr[3]),this.lineSp.addChild(this.lineArr[4]);break;case 4:this.lineSp.addChild(this.lineArr[1]),this.lineSp.addChild(this.lineArr[2]),this.lineSp.addChild(this.lineArr[4]),this.lineSp.addChild(this.lineArr[0]);break;case 5:this.lineSp.addChild(this.lineArr[0]),this.lineSp.addChild(this.lineArr[1]),this.lineSp.addChild(this.lineArr[2]),this.lineSp.addChild(this.lineArr[3]),this.lineSp.addChild(this.lineArr[4])}this.LineNums=t},s.setColor=function(e){t.prototype.setColor.call(this,e),this.changeColor=e},s.changeToX=function(t){this.bitMap.texture=t?RES.getRes("xparall_png"):RES.getRes("parall_png"),this.bitMap.anchorOffsetX=this.bitMap.width/2,this.bitMap.anchorOffsetY=this.bitMap.height/2,this.bitMap.x=t?45:0,this.switchSign.visible=!t;for(var e=0;e<this.isLightArr.length;e++){var i=this.isLightArr[e];i.visible=!t}},s.getProObj=function(){return{type:LightItemType.ParalleLight,x:this.x,y:this.y,rotation:-this.rotation,color:this.lineArr[0].color,nums:this.LineNums}},s.setCopy=function(t){this.setColor(t.color),this.setRotation(t.rotation),this.setLineNums(t.nums)},e}(BaseLight);egret.registerClass(ParalleLight,"ParalleLight");var ParalleProPanel=function(t){function e(e){t.call(this),this.skinName="resource/skins/light/ParalleProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.line2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeNum,this),this.line2.num=2,this.line3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeNum,this),this.line3.num=3,this.line4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeNum,this),this.line4.num=4,this.line5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeNum,this),this.line5.num=5,this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.dropDownList.setFun(this.changeColor,this),this.dropDownList2.setFun(this.changeRotation,this)},s.setData=function(e){t.prototype.setData.call(this,e);for(var i,s=[[LightConst.COLOR_RED,"红色"],[LightConst.COLOR_ORANGE,"橙色"],[LightConst.COLOR_YELLOW,"黄色"],[LightConst.COLOR_GREEN,"绿色"],[LightConst.COLOR_NAVY,"青色"],[LightConst.COLOR_BLUE,"蓝色"],[LightConst.COLOR_PURPLE,"紫色"]],n=0;n<this._item.lineArr.length;n++){var r=this._item.lineArr[n];i=r}var h;for(n=0;n<s.length;n++)s[n][0]==i.color&&(h=n);this.dropDownList.setData(s,h),this._data&&(this["line"+this._data.nums].selected="true");var o=[[0,"0°"],[30,"30°"],[45,"45°"],[60,"60°"],[90,"90°"]];this.dropDownList2.setData(o,0),this.setRotaLabel(Math.floor(Math.abs(this._item.rotation))),this.panel.proName.text=this._item.config.name},s.changeNum=function(t){var e=t.currentTarget.num;this._item.setLineNums(e)},s.changeRotation=function(t){this._item.setRotation(t)},s.changeColor=function(t){this._item.setColor(t)},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){var e=this._item.getProObj();MessageCenter.getInstance().dispatch(ItemEventConst.COPY_ITEM,e)},s.setRotaLabel=function(t){this.dropDownList2.setCurLabel(Math.floor(t)+"°")},s.dispose=function(){},e}(InfoPanelBase);egret.registerClass(ParalleProPanel,"ParalleProPanel");var WhiteLight=function(t){function e(e,i){t.call(this,e,i)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.init=function(){t.prototype.init.call(this);var e=new LightLine;this.lineSp.addChild(e),e.lineV=.02,e.color=LightConst.COLOR_RED,this.lineArr.push(e),e.x=this.bitMap.width/2,e.alpha=.01;var i=new LightLine;i.lineV=.04,i.color=LightConst.COLOR_ORANGE,this.lineSp.addChild(i),this.lineArr.push(i),i.x=this.bitMap.width/2,i.alpha=.01;var s=new LightLine;s.lineV=.06,s.color=LightConst.COLOR_YELLOW,this.lineSp.addChild(s),this.lineArr.push(s),s.x=this.bitMap.width/2,s.alpha=.01;var n=new LightLine;n.color=LightConst.COLOR_GREEN,n.lineV=.08,this.lineSp.addChild(n),this.lineArr.push(n),n.x=this.bitMap.width/2,n.alpha=.01;var r=new LightLine;r.color=LightConst.COLOR_NAVY,r.lineV=.1,this.lineSp.addChild(r),this.lineArr.push(r),r.x=this.bitMap.width/2,r.alpha=.01;var h=new LightLine;h.color=LightConst.COLOR_BLUE,h.lineV=.12,this.lineSp.addChild(h),this.lineArr.push(h),h.x=this.bitMap.width/2,h.alpha=.01;var o=new LightLine;o.color=LightConst.COLOR_PURPLE,o.lineV=.14,this.lineSp.addChild(o),this.lineArr.push(o),o.x=this.bitMap.width/2,o.alpha=.01,this.colorArr=[this.rgbToHex(168,18,18),this.rgbToHex(170,29,17),this.rgbToHex(174,74,11),this.rgbToHex(176,103,8),this.rgbToHex(180,129,7),this.rgbToHex(182,146,7),this.rgbToHex(184,163,7),this.rgbToHex(185,176,7),this.rgbToHex(176,174,10),this.rgbToHex(151,167,17),this.rgbToHex(109,157,29),this.rgbToHex(77,150,38),this.rgbToHex(53,145,45),this.rgbToHex(31,140,51),this.rgbToHex(7,134,58),this.rgbToHex(7,135,74),this.rgbToHex(7,136,85),this.rgbToHex(7,137,102),this.rgbToHex(7,138,115),this.rgbToHex(7,139,130),this.rgbToHex(7,139,142),this.rgbToHex(8,140,156),this.rgbToHex(8,140,166),this.rgbToHex(8,140,179),this.rgbToHex(14,134,186),this.rgbToHex(21,125,186),this.rgbToHex(26,117,186),this.rgbToHex(35,104,186),this.rgbToHex(53,79,186),this.rgbToHex(66,62,186),this.rgbToHex(70,55,186),this.rgbToHex(80,43,186),this.rgbToHex(86,35,186)];for(var a=0;66>a;a++){var l=new LightLine;l.color=this.colorArr[Math.floor(a/2)],l.lineV=.02+.0015*a,this.lineSp.addChild(l),this.lineArr.push(l),l.x=this.bitMap.width/2}var c=new LightLine;c.color=16777215,c.lineV=.16,this.lineSp.addChild(c),this.lineArr.push(c),c.x=this.bitMap.width/2,this.setLineThick(4),this.lineSp.alpha=1,this.switchSign=new egret.Bitmap,this.switchSign.texture=RES.getRes("jiguangbi_on_btn_png"),this.switchSign.anchorOffsetX=this.bitMap.width/2,this.switchSign.anchorOffsetY=this.bitMap.height/2,this.switchSign.touchEnabled=!1,this.switchSign.x=108,this.switchSign.y=-5,this.addChildAt(this.switchSign,0)},s.rgbToHex=function(t,e,i){return t<<16|e<<8|i},s.onOff=function(e){t.prototype.onOff.call(this,e),this.lineSp.visible?(this.switchSign.texture=RES.getRes("jiguangbi_on_btn_png"),this.switchSign.y=-5):(this.switchSign.texture=RES.getRes("jiguangbi_off_btn_png"),this.switchSign.y=-10)},s.getProObj=function(){return{type:LightItemType.WhiteLight,x:this.x,y:this.y,rotation:-this.rotation,thick:this.lineArr[0].thicknes}},s.setCopy=function(t){this.setRotation(t.rotation),this.setLineThick(t.thick)},e}(BaseLight);egret.registerClass(WhiteLight,"WhiteLight");var WhiteProPanel=function(t){function e(){t.call(this),this.skinName="resource/skins/light/WhiteProSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(e){t.prototype.createCompleteEvent.call(this,e),this.numRoll.addEventListener(egret.Event.CHANGE,this.changeNum,this),this.numRoll.value=LightConst.LIGHT_THICK,this.panel.panel1.setH(this.group1.height),this.panel.panel1.proGroup.addChild(this.group1),this.group1.x=0,this.group1.y=0,this.panel.hasOthers=!1,this.dropDownList2.setFun(this.changeRotation,this)},s.setData=function(e){t.prototype.setData.call(this,e);for(var i,s=0;s<this._item.lineArr.length;s++){var n=this._item.lineArr[s];i=n}this.numRoll.value=Math.floor(i.thicknes);var r=[[0,"0°"],[30,"30°"],[45,"45°"],[60,"60°"],[90,"90°"]];this.dropDownList2.setData(r,0),this.setRotaLabel(Math.floor(Math.abs(this._item.rotation))),this.panel.proName.text=this._item.config.name},s.changeNum=function(t){this._item.setLineThick(t.currentTarget.value)},s.changeRotation=function(t){this._item.setRotation(t)},s.del=function(t){this._item.dispose(),this.parent.removeChild(this)},s.copy=function(t){var e=this._item.getProObj();MessageCenter.getInstance().dispatch(ItemEventConst.COPY_ITEM,e)},s.setRotaLabel=function(t){this.dropDownList2.setCurLabel(Math.floor(t)+"°")},s.dispose=function(){},e}(InfoPanelBase);egret.registerClass(WhiteProPanel,"WhiteProPanel");var starlingswf;!function(t){var e=function(){function e(i,s,n){void 0===n&&(n=24),this._swfData=i,this._assetManager=s,this._createDisplayFuns=new Object,this._createDisplayFuns[e.dataKey_Sprite]=this.createSprite,this._createDisplayFuns[e.dataKey_MovieClip]=this.createMovie,this._createDisplayFuns[e.dataKey_Image]=this.createImage,this._createDisplayFuns[e.dataKey_Scale9]=this.createS9Image,this._createDisplayFuns[e.dataKey_ShapeImg]=this.createShapeImage,this._createDisplayFuns[e.dataKey_TextField]=this.createTextField,this.swfUpdateManager=t.SwfUpdateManager.createSwfUpdateManager(n)}var i=(__define,e),s=i.prototype;return s.createSprite=function(i,s,n){void 0===s&&(s=null),void 0===n&&(n=null),null==n&&(n=this._swfData[e.dataKey_Sprite][i]);for(var r,h,o,a=new t.SwfSprite,l=n.length,c=0;l>c;c++)r=n[c],o=this._createDisplayFuns[r[1]],null!=o&&(h=o.apply(this,[r[0],r]),h.name=r[9],h.x=r[2],h.y=r[3],r[1]!=e.dataKey_Scale9&&r[1]!=e.dataKey_ShapeImg&&(h.scaleX=r[4],h.scaleY=r[5]),h.skewX=r[6],h.skewY=r[7],h.alpha=r[8],a.addChild(h));return null!=s&&t.SwfBlendMode.setBlendMode(a,s[11]),a},s.createMovie=function(i,s){void 0===s&&(s=null);var n,r,h,o,a,l=this._swfData[e.dataKey_MovieClip][i],c=l.objCount,d={};for(a in c){r=c[a][0],h=c[a][1],n=null==d[a]?[]:d[a];for(var u=0;h>u;u++)o=this._createDisplayFuns[r],null!=o&&n.push(o.apply(this,[a,null]));d[a]=n}var p=new t.SwfMovieClip(l.frames,l.labels,d,this,l.frameEvents);return p.loop=l.loop,null!=s&&t.SwfBlendMode.setBlendMode(p,s[11]),p},s.createImage=function(i,s){void 0===s&&(s=null);var n=this._swfData[e.dataKey_Image][i],r=this._assetManager.createBitmap(i);return r.anchorOffsetX=n[0],r.anchorOffsetY=n[1],null!=s&&t.SwfBlendMode.setBlendMode(r,s[11]),r},s.createS9Image=function(i,s){void 0===s&&(s=null);var n=this._swfData[e.dataKey_Scale9][i],r=this._assetManager.createBitmap(i);return r.scale9Grid=new egret.Rectangle(n[0],n[1],n[2],n[3]),null!=s&&(r.width=s[10],r.height=s[11],t.SwfBlendMode.setBlendMode(r,s[13])),r},s.createShapeImage=function(e,i){void 0===i&&(i=null);var s=this._assetManager.createBitmap(e);return s.fillMode=egret.BitmapFillMode.REPEAT,null!=i&&(s.width=i[10],s.height=i[11],t.SwfBlendMode.setBlendMode(s,i[13])),s},s.createTextField=function(e,i){void 0===i&&(i=null);var s=new egret.TextField;return null!=i&&(s.width=i[10],s.height=i[11],s.fontFamily=i[12],s.textColor=i[13],s.size=i[14],s.textAlign=i[15],s.text=i[18],t.SwfBlendMode.setBlendMode(s,i[20])),s},e.dataKey_Sprite="spr",e.dataKey_Image="img",e.dataKey_MovieClip="mc",e.dataKey_TextField="text",e.dataKey_Button="btn",e.dataKey_Scale9="s9",e.dataKey_ShapeImg="shapeImg",e.dataKey_Component="comp",e.dataKey_Particle="particle",e}();t.Swf=e,egret.registerClass(e,"starlingswf.Swf")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(){function t(){this._sheets={},this._textures={}}var e=(__define,t),i=e.prototype;return i.addSpriteSheet=function(t,e){this._sheets[t]=e},i.addTexture=function(t,e){this._textures[t]=e},i.createBitmap=function(t){var e,i,s,n;for(n in this._sheets)if(e=this._sheets[n],s=e.getTexture(t),null!=s)break;return null==s&&(s=this._textures[t]),null==s?null:(i=new egret.Bitmap,i.texture=s,i)},t}();t.SwfAssetManager=e,egret.registerClass(e,"starlingswf.SwfAssetManager")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(){function t(){}var e=(__define,t),i=e.prototype;return t.createSwfUpdateManager=function(e){var i=new t;return i._animations=[],i._addQueue=[],i._removeQueue=[],i._currentTime=0,i.setFps(e),egret.Ticker.getInstance().register(i.update,i),i},i.setFps=function(t){this._fps=t,this._fpsTime=1e3/t},i.addSwfAnimation=function(t){this._addQueue.push(t)},i.removeSwfAnimation=function(t){this._removeQueue.push(t)},i.updateAdd=function(){for(var t,e,i=this._addQueue.length,s=0;i>s;s++)e=this._addQueue.pop(),t=this._animations.indexOf(e),-1==t&&this._animations.push(e)},i.updateRemove=function(){for(var t,e,i=this._removeQueue.length,s=0;i>s;s++)e=this._removeQueue.pop(),t=this._animations.indexOf(e),-1!=t&&this._animations.splice(t,1)},i.update=function(t){if(this._currentTime+=t,!(this._currentTime<this._fpsTime)){this._currentTime-=this._fpsTime,this._currentTime>this._fpsTime&&(this._currentTime=0),this.updateRemove(),this.updateAdd();for(var e=this._animations.length,i=0;e>i;i++)this._animations[i].update()}},t}();t.SwfUpdateManager=e,egret.registerClass(e,"starlingswf.SwfUpdateManager")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(){function t(){}var e=(__define,t);e.prototype;return t.setBlendMode=function(e,i){t.modes[i]&&(e.blendMode=i)},t.modes={normal:!0,add:!0},t}();t.SwfBlendMode=e,egret.registerClass(e,"starlingswf.SwfBlendMode")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.getTextField=function(t){return this.getChildByName(t)},s.getMovie=function(t){return this.getChildByName(t)},s.getSprite=function(t){return this.getChildByName(t)},s.getImage=function(t){return this.getChildByName(t)},e}(egret.DisplayObjectContainer);t.SwfSprite=e,egret.registerClass(e,"starlingswf.SwfSprite")}(starlingswf||(starlingswf={}));var starlingswf;!function(t){var e=function(e){function i(t,i,s,n,r){void 0===r&&(r=null),e.call(this),this._isPlay=!1,this.loop=!0,this._completeFunction=null,this._hasCompleteListener=!1,this._frames=t,this._labels=i,this._displayObjects=s,this._frameEvents=r,this._startFrame=0,this._endFrame=this._frames.length-1,this._ownerSwf=n,this.setCurrentFrame(0),this.play()}__extends(i,e);var s=(__define,i),n=s.prototype;return n.update=function(){if(this._isPlay)if(this._currentFrame>this._endFrame){var t=!1;if(this.loop&&this._startFrame!=this._endFrame||(this._ownerSwf&&this.stop(!1),t=!0),this._hasCompleteListener&&this.dispatchEventWith(egret.Event.COMPLETE),t)return;this.setCurrentFrame(this._startFrame)}else this.setCurrentFrame(this._currentFrame),this._currentFrame+=1},n.setCurrentFrame=function(e){this.removeChildren(),this._currentFrame=e,this.__frameInfos=this._frames[this._currentFrame];for(var i,s,n,r,h=this.__frameInfos.length,o=0;h>o;o++){switch(i=this.__frameInfos[o],r=i[10],s=this._displayObjects[i[0]][r],s.skewX=i[6],s.skewY=i[7],s.alpha=i[8],s.name=i[9],s.x=i[2],s.y=i[3],i[1]){case t.Swf.dataKey_Scale9:s.width=i[11],s.height=i[12],t.SwfBlendMode.setBlendMode(s,i[13]);break;case t.Swf.dataKey_ShapeImg:s.width=i[11],s.height=i[12],t.SwfBlendMode.setBlendMode(s,i[13]);break;case t.Swf.dataKey_TextField:n=s,n.width=i[11],n.height=i[12],n.fontFamily=i[13],n.textColor=i[14],n.size=i[15],n.textAlign=i[16],i[19]&&"\r"!=i[19]&&""!=i[19]&&(n.text=i[19]),t.SwfBlendMode.setBlendMode(n,i[20]);break;default:s.scaleX=i[4],s.scaleY=i[5],t.SwfBlendMode.setBlendMode(s,i[11])}this.addChild(s)}null!=this._frameEvents&&null!=this._frameEvents[this._currentFrame]&&this.dispatchEventWith(this._frameEvents[this._currentFrame])},n.getCurrentFrame=function(){return this._currentFrame},n.play=function(){this._isPlay=!0,this._ownerSwf.swfUpdateManager.addSwfAnimation(this);var e,i,s;for(e in this._displayObjects)if(0==e.indexOf(t.Swf.dataKey_MovieClip)){i=this._displayObjects[e],s=i.length;for(var n=0;s>n;n++)i[n].play()}},n.stop=function(e){if(void 0===e&&(e=!0),this._isPlay=!1,this._ownerSwf.swfUpdateManager.removeSwfAnimation(this),e){var i,s,n;for(i in this._displayObjects)if(0==i.indexOf(t.Swf.dataKey_MovieClip)){s=this._displayObjects[i],n=s.length;for(var r=0;n>r;r++)s[r].stop(e)}}},n.gotoAndStop=function(t,e){void 0===e&&(e=!0),this.goTo(t),this.stop(e)},n.gotoAndPlay=function(t){this.goTo(t),this.play()},n.goTo=function(t){if("string"==typeof t){var e=this.getLabelData(t);this._currentLabel=e[0],this._currentFrame=this._startFrame=e[1],this._endFrame=e[2]}else"number"==typeof t&&(this._currentFrame=this._startFrame=t,this._endFrame=this._frames.length-1);this.setCurrentFrame(this._currentFrame)},n.getLabelData=function(t){for(var e,i=this._labels.length,s=0;i>s;s++)if(e=this._labels[s],e[0]==t)return e;return null},n.isPlay=function(){return this._isPlay},n.totalFrames=function(){return this._frames.length},n.currentLabel=function(){return this._currentLabel},n.labels=function(){for(var t=this._labels.length,e=[],i=0;t>i;i++)e.push(this._labels[i][0]);return e},n.hasLabel=function(t){var e=this.labels();return!(-1==e.indexOf(t))},n.addEventListener=function(t,i,s,n,r){void 0===n&&(n=!1),void 0===r&&(r=0),e.prototype.addEventListener.call(this,t,i,s,n,r),this._hasCompleteListener=this.hasEventListener(egret.Event.COMPLETE)},n.removeEventListener=function(t,i,s,n){void 0===n&&(n=!1),e.prototype.removeEventListener.call(this,t,i,s,n),this._hasCompleteListener=this.hasEventListener(egret.Event.COMPLETE)},i}(t.SwfSprite);t.SwfMovieClip=e,egret.registerClass(e,"starlingswf.SwfMovieClip",["starlingswf.ISwfAnimation"])}(starlingswf||(starlingswf={}));
var DropDownList=function(t){function e(e,i){t.call(this),this.isShow=!1,this.itemWidth=100,this.itemsHeight=200,this.cusRoNum=0,this.skinName="resource/skins/DropDownListSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this),this.fun=e,this.funObj=i}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(){this.btnLabel.touchEnabled=!1,this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeListType,this),this.buttonSkin='<e:Skin class="skins.ButtonSkin" states="up,down,disabled" minHeight="50" minWidth="100" xmlns:e="http://ns.egret.com/eui" width="94" height="36">\n                <e:Image width="94" height="36" scale9Grid="10,10,11,11" alpha.disabled="0.5"\n                         source.down="pop_up_select_png" source=""/>\n                <e:Label id="labelDisplay"  width="94" height="36"\n                         textColor="0x000000" verticalAlign="middle" textAlign="center" text="红色" size="24"/>\n                <e:Image id="iconDisplay" horizontalCenter="0" verticalCenter="0"/>\n            </e:Skin>'},s.changeListType=function(){this.isShow?(egret.Tween.get(this.scroller).to({y:this.posScrollerClose},10),this.isShow=!1):(egret.Tween.get(this.scroller).to({y:this.btn.height},10),this.isShow=!0)},s.setData=function(t,e){for(this.btnArr=[];this.btnGp.numElements>1;){var i=this.btnGp.getChildAt(0);i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),i.removeEventListener(mouse.MouseEvent.ROLL_OVER,this.onMouseOver,this),i.removeEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),this.btnGp.removeChildAt(0)}for(var s=0,n=0;n<t.length;n++){var r=new eui.Button;r.width=this.itemWidth,r.label=t[n][1]+"",r.data=t[n][0],r.y=36*n,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),this.btnGp.addChild(r),r.skinName=this.buttonSkin,s=r.y,r.addEventListener(mouse.MouseEvent.ROLL_OVER,this.onMouseOver,this),r.addEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),this.btnArr.push(r)}this.btnLabel.text=t[e][1],this.itemsHeight=s+36,this.scroller.height=this.itemsHeight,null==this.spMask&&(this.spMask=new egret.Shape),this.spMask.graphics.beginFill(0),this.spMask.graphics.drawRect(0,0,this.itemWidth,this.itemsHeight),this.spMask.graphics.endFill(),this.spMask.y=this.btn.height,this.addChild(this.spMask),this.spMask.y=this.btn.height,this.spMask.height=this.itemsHeight,this.scroller.mask=this.spMask,this.posScrollerClose=this.scroller.y-this.scroller.height,this.scroller.y=this.posScrollerClose},s.onItem=function(t){this.changeListType(),this.btnLabel.text=t.currentTarget.label,console.log("onItem.data",t.currentTarget.data),this.fun.call(this.funObj,t.currentTarget.data),LightUtils.saveOpera()},s.setCurLabel=function(t){this.btnLabel.text=t+""},s.setFun=function(t,e){this.fun=t,this.funObj=e},s.onMouseOver=function(t){for(var e=0;e<this.btnArr.length;e++){var i=this.btnArr[e];i.getChildAt(0).source=null}t.currentTarget.getChildAt(0).source=RES.getRes("pop_up_select_png")},s.onMouseOut=function(t){t.currentTarget.getChildAt(0).source=null},s.RotationCustomize=function(){this.rotationInput=new egret.TextField,this.rotationInput.type=egret.TextFieldType.INPUT,this.rotationInput.textAlign=egret.HorizontalAlign.CENTER,this.rotationInput.verticalAlign=egret.VerticalAlign.MIDDLE,this.rotationInput.width=72,this.rotationInput.height=32,this.rotationInput.x=2,this.rotationInput.y=2,this.rotationInput.textColor=16777215,this.rotationInput.size=25,this.rotationInput.maxChars=3,this.addChild(this.rotationInput),this.rotationInput.addEventListener(egret.FocusEvent.FOCUS_IN,this.inputEventIn,this),this.rotationInput.addEventListener(egret.FocusEvent.FOCUS_OUT,this.inputEventOut,this)},s.inputEventIn=function(){this.rotationInput.text=this.cusRoNum+"",this.btnLabel.visible=!1},s.inputEventOut=function(){""==this.rotationInput.text?this.cusRoNum=0:(this.cusRoNum=parseInt(this.rotationInput.text),this.btnLabel.text=this.rotationInput.text+"°"),this.btnLabel.text=this.cusRoNum+"°",this.rotationInput.text="",this.btnLabel.visible=!0,this.fun.call(this.funObj,this.cusRoNum),LightUtils.saveOpera()},e}(eui.Component);egret.registerClass(DropDownList,"DropDownList");var ElectromagneticSetBox=function(t){function e(){t.call(this),this.skinName="resource/skins/ElectromagneticSetBoxSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(){for(var t=this.magSetGp.numChildren,e=0;t>e;e++){this.magSetGp.getChildAt(e).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);this.magSetGp.getChildAt(e)}},s.setFun=function(t){this.curView=t},s.onTouch=function(t){console.log(t.target.name)},e}(eui.Component);egret.registerClass(ElectromagneticSetBox,"ElectromagneticSetBox");var EuiHSlider=function(t){function e(){t.call(this),this.touchEnabled=!0,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.addEventListener(egret.Event.CHANGE,this.changValue,this)},s.changValue=function(t){LightUtils.saveOpera()},e}(eui.HSlider);egret.registerClass(EuiHSlider,"EuiHSlider");var EuiRadioButton=function(t){function e(){t.call(this),this.touchEnabled=!0,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onType,this)},s.onType=function(t){LightUtils.saveOpera()},e}(eui.RadioButton);egret.registerClass(EuiRadioButton,"EuiRadioButton");var ExportPanel=function(t){function e(){t.call(this),this.itemArr=[],this.skinName="resource/skins/ExportPanelSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this),this.name="ExportPanel"}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.dragBit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.this_downHandle,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),MessageCenter.getInstance().addListener(ItemEventConst.EXPORT_ITEM,this.onAdd,this),this.itemArr=[this.item_0,this.item_1,this.item_2,this.item_3,this.item_4,this.item_5]},s.this_downHandle=function(t){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),flashUtils.startDrag(this)},s.stage_upHandle=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),flashUtils.stopDrag(this)},s.onAdd=function(t){for(var e=0;e<this.itemArr.length;e++)if(this.itemArr[e].data&&this.itemArr[e].data.name==t.name)return;for(var i=-1,e=0;e<this.itemArr.length;e++)if(null==this.itemArr[e].data){i=e;break}-1!=i&&this["item_"+i].initData(t)},s.setData=function(t,e){for(var i=0;i<this.itemArr.length;i++)this.itemArr[i].clear();for(var i=0;i<e.length;i++){var s=this.getConfig(t)[e[i]];this["item_"+i].initData(s),this["item_"+i].delBtn.visible=!1}},s.getConfig=function(t){var e;switch(t){case LabType.LightLab:e=RES.getRes("light_json");break;case LabType.ElectricsLab:e=RES.getRes("electric_json")}return e},s.getComStr=function(){for(var t=[],e=0;e<this.itemArr.length;e++)null!=this.itemArr[e].data&&t.push(this.itemArr[e].data.id);return t.toString()},s.onClose=function(t){MainView.getInstance().showExport=!1,this.visible=!1},e}(eui.Component);egret.registerClass(ExportPanel,"ExportPanel");var ItemScroller=function(t){function e(){t.call(this),this.itemList=[],this.skinName="resource/skins/ScrollViewSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.initUI(),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},s.initUI=function(){this.initEvents()},s.initEvents=function(){this.arrow_left_png.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLeftArrow,this),this.arrow_right_png.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRightArrow,this),this.preH=this.scroller.viewport.scrollH},s.onLeftArrow=function(t){var e=this;this.scroller.viewport.scrollH>0&&(egret.Tween.get(this.scroller.viewport).to({scrollH:this.preH-1824},300).call(function(){e.preH=e.preH-1824}),this.scroller.viewport.scrollH<0&&(this.scroller.viewport.scrollH=0))},s.onRightArrow=function(t){var e=this;this.scroller.viewport.scrollH<this.scroller.viewport.contentWidth-this.scroller.width&&(egret.Tween.get(this.scroller.viewport).to({scrollH:this.preH+1824},300).call(function(){e.preH=e.preH+1824}),this.scroller.viewport.scrollH>this.scroller.viewport.contentWidth-this.scroller.width&&(this.scroller.viewport.scrollH=this.scroller.viewport.contentWidth-this.scroller.width))},s.setData=function(t){var e,i=[];switch(t){case LabType.LightLab:e=RES.getRes("light_json");break;case LabType.ElectricsLab:e=RES.getRes("electric_json");break;case LabType.HomeElectric:e=RES.getRes("homeElectric_json");break;case LabType.ElectricField:e=RES.getRes("electricField_json");break;case LabType.ElectromagLab:e=RES.getRes("electromag_json")}this.scroller.viewport.scrollH=0;for(var s in e)i.push(e[s]);this.upDataItemList(i)},s.upDataItemList=function(t){ObjectPool.recoverPool(this.itemList);for(var e=0;e<this.itemList.length;e++){var i=this.itemList[e];i.parent.removeChild(i)}this.itemList=[];for(var s=0,e=0;e<t.length;e++){var i=ObjectPool.pop("SItem");i.initData(t[e]),i.x=152*e,s=i.x+152,this.itemGroup.addChild(i),this.itemList.push(i)}this.hRect.width=s},s.onClose=function(t){MessageCenter.getInstance().dispatch(ItemEventConst.CLOSE_SCROLLER)},e}(eui.Component);egret.registerClass(ItemScroller,"ItemScroller");var ItemSearch=function(t){function e(){t.call(this),this.skinName="resource/skins/ItemSearch.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.initUI()},s.initUI=function(){this.initEvents(),this.cancelBtn.visible=!1},s.initEvents=function(){this.searchBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSearchBtn,this),this.showScrollBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShowScrollBtn,this),this.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancelBtn,this),this.searchT.addEventListener(egret.FocusEvent.FOCUS_IN,this.onFocusIn,this),this.searchT.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onFocusOut,this)},s.setData=function(t){this.dataArr=[];var e;switch(t){case LabType.LightLab:e=RES.getRes("light_json");break;case LabType.ElectricsLab:e=RES.getRes("electric_json");break;case LabType.HomeElectric:e=RES.getRes("homeElectric_json")}for(var i in e)this.dataArr.push(e[i])},s.onSearchBtn=function(t){for(var e=this.dataArr,i=this.searchT.text,s=0;s<i.length;s++){for(var n=i.charAt(s),r=[],h=0;h<e.length;h++)if(e[h].name){var o=e[h].name;-1!=o.indexOf(n)&&r.push(e[h])}e=r}if(0==e.length)return void console.log("没有查找到结果！！");for(this.removeAllItems(),s=0;s<e.length;s++){var a=ObjectPool.pop("SItem");a.changeSearchItem(),a.initData(e[s]),a.changeSearchItem(),a.x=210*s,this.itemGroup.addChild(a),this.itemList.push(a)}this.showScrollBtn.visible=!1,this.cancelBtn.visible=!0},s.onCancelBtn=function(t){this.removeAllItems(),this.searchT.text="元件搜索",this.cancelBtn.visible=!1,this.showScrollBtn.visible=!0},s.onFocusIn=function(t){"元件搜索"==this.searchT.text&&(this.searchT.text="")},s.onFocusOut=function(t){""==this.searchT.text&&(this.searchT.text="元件搜索")},s.removeAllItems=function(){if(this.itemList)for(var t=0;t<this.itemList.length;t++){var e=this.itemList[t];e.parent.removeChild(e)}this.itemList=[]},s.onShowScrollBtn=function(t){MessageCenter.getInstance().dispatch(ItemEventConst.SHOW_SCROLLER)},e}(eui.Component);egret.registerClass(ItemSearch,"ItemSearch");var LightSetBox=function(t){function e(){t.call(this),this.skinName="resource/skins/LightSetBoxSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(){for(var t=this.lightSetGp.numChildren,e=0;t>e;e++){this.lightSetGp.getChildAt(e).addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this);var i=this.lightSetGp.getChildAt(e);i.getChildAt(1).visible=!1,i.getChildAt(2).visible=!0,i.getChildAt(0).touchEnabled=!1,i.getChildAt(1).touchEnabled=!1,i.getChildAt(2).touchEnabled=!1}this.light_guangluGp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGuangLu,this),this.light_fansheGp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showFanShe,this),this.light_jiaoduGp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showAngle,this),this.light_chengxiangGp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFigure,this),this.light_guangxianGp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onXian,this)},s.setFun=function(t){this.curView=t},s.onTouch=function(t){var e=t.target;e.getChildAt(1).visible=!e.getChildAt(1).visible,e.getChildAt(2).visible=!e.getChildAt(2).visible},s.onGuangLu=function(t){LightView.showArrow=!LightView.showArrow},s.showFanShe=function(t){this.curView.reflect=!this.curView.reflect},s.showAngle=function(t){this.curView.angleVis=!this.curView.angleVis},s.onFigure=function(t){this.curView.showFigure=!this.curView.showFigure},s.onXian=function(t){this.curView.showX=!this.curView.showX,this.curView.changeToX(this.curView.showX)},e}(eui.Component);egret.registerClass(LightSetBox,"LightSetBox");var MainView=function(t){function e(i){t.call(this,i),this.showExport=!1,this.skinName="resource/skins/StageViewSkin.exml",e.mainRect=[0,92,i.stageWidth,i.stageHeight],e._instance=this}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getInstance=function(){return e._instance},s.initUI=function(){t.prototype.initUI.call(this),this.btnArr=[this.newBtn,this.openBtn,this.saveBtn,this.exportBtn,this.preViewBtn,this.zBtn,this.yBtn,this.groupBtn,this.partBtn,this.sideBtn,this.dataBtn,this.styleBtn,this.setBtn],this.btnNameArr=new Array;for(var e=0;e<this.btnArr.length;e++){var i=this.btnArr[e].getChildAt(0),s=i._source;this.btnNameArr.push(s)}this.viewContainer=new egret.Sprite,this.addChildAt(this.viewContainer,0),this.scroller=new ItemScroller,this.scroller.bottom=0,this.addChild(this.scroller),this.scroller.visible=!1,this.searchItem=new ItemSearch,this.searchItem.bottom=0,this.addChild(this.searchItem),this.setBox.visible=!0,this.setBox.y=90,this.tipGp.visible=!0,this.topGp.visible=!0,this.switchBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.switchBtn.type=LabType.LightLab,this.elecBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.elecBtn.type=LabType.ElectricsLab,this.homeElecBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSwitch,this),this.homeElecBtn.type=LabType.HomeElectric,this.openBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOpen,this),this.saveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSave,this),this.newBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNew,this),this.setBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSet,this),this.sideBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSide,this),this.styleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickDianlutuBtn,this),this.dataBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickDataRecordBtn,this),this.zBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCtrlZ,this),this.yBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCtrlY,this),MessageCenter.getInstance().addListener(ItemEventConst.CLOSE_SCROLLER,this.closeScroll,this),MessageCenter.getInstance().addListener(ItemEventConst.ADD_ITEM,this.addItem,this),this.onYuanJ(null),MessageCenter.getInstance().addListener(ItemEventConst.SHOW_SCROLLER,this.showScroller,this),this.setCourse();var n=LocationProperty.getPara("labsName"),r=LocationProperty.getPara("labsUrl");r=null==r||""==r?"/mylabs/":r,null==n||""==n?this.switchView(LabType.LightLab):RES.getResByUrl(r+n+".json",this.compFunc,this,RES.ResourceItem.TYPE_JSON);var h=LocationProperty.getPara("isBack");null!=h?this.BACKBTN.visible=!0:this.BACKBTN.visible=!1,this.BACKBTN.x=1780,this.BACKBTN.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBACK,this)},s.onBACK=function(t){window.history.back(-1)},s.addItem=function(){this.tipGp.visible&&(this.tipGp.visible=!1)},s.onSide=function(t){this.showExport=!this.showExport,this.exportPanel.visible=this.showExport},s.onGuangLu=function(t){LightView.showArrow=!LightView.showArrow},s.onXian=function(t){this.curView.showX=!this.curView.showX,this.curView.changeToX(this.curView.showX)},s.onSee=function(t){},s.onFigure=function(t){this.curView.showFigure=!this.curView.showFigure},s.showFanShe=function(t){this.curView.reflect=!this.curView.reflect},s.showAngle=function(t){this.curView.angleVis=!this.curView.angleVis},s.onClickDataRecordBtn=function(t){if(this.curLab==LabType.ElectricsLab){var e=this.curView;e.showDataRecordPanel(),this.tipGp.visible=!1}},s.onClickDianlutuBtn=function(t){if(this.curLab==LabType.ElectricsLab){var e=this.curView;e.showDianlutu(),this.tipGp.visible=!1}},s.onSwitch=function(t){this.switchView(t.currentTarget.type)},s.switchView=function(t){void 0===t&&(t=1001);for(var e=this.viewContainer.numChildren,i=0;e>i;i++){var s=this.viewContainer.getChildAt(i);s.dispose(),s.removeEvents()}this.viewContainer.removeChildren(),this.tipGp.visible=!0;var n="";switch(t){case LabType.LightLab:this.curView=new LightView(this.stage),this.scroller.setData(LabType.LightLab),this.curLab=LabType.LightLab,n="光学";break;case LabType.ElectricsLab:this.curView=new ElectricsView(this.stage),this.scroller.setData(LabType.ElectricsLab),this.curLab=LabType.ElectricsLab,n="电路";break;case LabType.HomeElectric:this.curView=new HomeElectricsView(this.stage),this.scroller.setData(LabType.HomeElectric),this.curLab=LabType.HomeElectric,n="家庭电路";break;case LabType.ElectricField:this.curView=new ChargesAndFieldsScreenView(this.stage),this.scroller.setData(LabType.ElectricField),this.curLab=LabType.ElectricField,n="电磁";break;case LabType.ElectromagLab:console.log("切换到电磁学"),this.curView=new ElectromagView(this.stage),this.scroller.setData(LabType.ElectromagLab),this.curLab=LabType.ElectromagLab,n="电磁学"}this.searchItem.setData(t),this.showScroller(),this.courseLabel.text=n,this.viewContainer.addChild(this.curView),this.setGroup(this.curLab),LightUtils.saveOpera()},s.setGroup=function(t){switch(this.setGp.removeChildren(),this.setBox.visible=!1,t){case LabType.LightLab:this.setBox.visible=!0;var e=new LightSetBox;e.setFun(this.curView),this.setGp.addChild(e)}},s.onSet=function(t){this.setBox.visible=!this.setBox.visible},s.onOpen=function(t){selectFile(this.selectedHandler,this)},s.selectedHandler=function(t,e,i){RES.getResByUrl(e,t.compFunc,t,RES.ResourceItem.TYPE_JSON)},s.compFunc=function(t){var i=Object.keys(t);parseInt(i[0])!=LabType.HomeElectric?(e.mainRect=[0,0,1280,960],this.stage.setContentSize(1280,960),this.BACKBTN.x=1140):this.BACKBTN.x=1780,this.switchView(parseInt(i[0])),this.curLab==LabType.LightLab?LightUtils.showView(this.curView,t[i[0]]):this.curLab==LabType.ElectricsLab?ElectricsView.showElectView(this.curView,t[i[0]]):this.curLab==LabType.HomeElectric&&HomeElectricsView.showElectView(this.curView,t[i[0]]),this.tipGp.visible=!1,this.scroller.visible=!1,this.searchItem.visible=!1,this.topGp.visible=!1,this.setGp.numElements>0?(this.setBox.visible=!0,this.setBox.y=0):this.setBox.visible=!1,t[i[1]].length>0?(this.exportPanel.visible=!0,this.exportPanel.closeBtn.visible=!1,this.exportPanel.setData(this.curLab,t[i[1]])):this.exportPanel.visible=!1},s.onSave=function(t){this.savePop=new SavePop(this.saveFun,this),this.addChild(this.savePop)},s.saveFun=function(t){switch(this.curLab){case LabType.LightLab:LightUtils.toSave(this.curView,this.curLab,t);break;case LabType.ElectricsLab:LightUtils.toSave(this.curView,this.curLab,t);break;case LabType.HomeElectric:LightUtils.toSave(this.curView,this.curLab,t)}},s.onSavePng=function(t){var e=new egret.RenderTexture;e.drawToTexture(this.curView.itemContainer,new egret.Rectangle(0,0,1920,1440),1/1.875),e.toDataURL("image/png"),e.saveToFile("image/png",t+".png")},s.onCtrlZ=function(t){LightUtils.ctrlZ()},s.onCtrlY=function(t){LightUtils.ctrlY()},s.onNew=function(t){this.curView&&(this.curView.itemContainer.removeChildren(),this.curView.dispose(),this.curView.panelContainer.removeChildren(),this.curView.initItemView&&this.curView.initItemView()),this.tipGp.visible=!0},s.onYuanJ=function(t){egret.Tween.get(this.scroller).to({bottom:0},300).call(function(){})},s.closeScroll=function(){egret.Tween.get(this.scroller).to({bottom:-200},300).call(function(){}),this.searchItem.visible=!0},s.showScroller=function(){this.scroller.visible=!0,this.searchItem.visible=!1,egret.Tween.get(this.scroller).to({bottom:0},300).call(function(){})},s.setCourse=function(){this.courseTree.setFun(this.switchView,this);var t={1:{name:"光学",data:LabType.LightLab},2:{name:"电学",data:{1:{name:"电路",data:LabType.ElectricsLab},2:{name:"家庭电路",data:LabType.HomeElectric}}},3:{name:"电磁学",data:LabType.ElectromagLab}};this.courseTree.setData(t)},s.setCourseGroup=function(t){if(this.courseGp.removeChildren(),this.courseArr=[],t instanceof Object)for(var e=Object.keys(t),i=50,s=50,n=0;n<e.length;n++){var r=new eui.Image;r.source="button_style_up_png",r.width=i,r.height=s,r.x=n*(i+20)+30,r.y=10,this.courseGp.addChild(r),r.touchEnabled=!0;var h=new eui.Label;h.width=18*t[e[n]].name.length,h.height=18,h.anchorOffsetX=.5*h.width,h.x=r.x+.5*i,h.y=65,h.text=t[e[n]].name,h.textColor=12500670,h.size=18,this.courseGp.addChild(h),h.touchEnabled=!1;var o=[];o.push(r),o.push(r.source),this.courseArr.push(o),r.data=t[e[n]].data,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCourseItem,this),r.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onCourseMouseOver,this),r.addEventListener(mouse.MouseEvent.MOUSE_OUT,this.onCourseMouseOut,this)}},s.onCourseItem=function(t){this.switchView(t.currentTarget.data)},s.onCourseMouseOver=function(t){for(var e=0;e<this.courseArr.length;e++)t.target==this.courseArr[e][0]&&(t.target.source=RES.getRes(this.courseArr[e][1].replace("up","over")))},s.onCourseMouseOut=function(t){for(var e=0;e<this.courseArr.length;e++)this.courseArr[e][0].source=RES.getRes(this.courseArr[e][1])},e.MainColor=1579032,e._instance=null,e}(BaseEuiView);egret.registerClass(MainView,"MainView");var PanelBase=function(t){function e(){t.call(this),this.skinName="resource/skins/PanelTemple.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.createCompleteEvent=function(t){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.panel1.tite.text="常用设置",this.dragBit.touchEnabled=!0,this.dragBit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.proPanel=this.parent,this.panel1.setFun(this.setPanel2Y,this)},n.setPanel2Y=function(){this.panel2.y=this.panel1.height},n.onClose=function(t){this.parent.visible=!1,this.parent._item&&this.parent._item.itemTop&&(this.parent._item.itemTop.visible=!1,this.parent._item.roSpot&&(this.parent._item.roSpot.visible=!1))},n.onBegin=function(t){this.startX=t.stageX,this.startY=t.stageY;var e=new egret.Point,i=this.proPanel.parent.localToGlobal(this.proPanel.x,this.proPanel.y,e);this.offX=this.startX-i.x,this.offY=this.startY-i.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)},n.onMove=function(t){this.proPanel.x=t.stageX-this.offX,this.proPanel.y=t.stageY-this.offY},n.onEnd=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)},i(n,"hasOthers",void 0,function(t){this.panel2.visible=t}),e}(eui.Component);egret.registerClass(PanelBase,"PanelBase");var PanelPart=function(t){function e(){t.call(this),this.skinName="resource/skins/PanelPartSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.togBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTog,this),this.GroupHeight=this.proGroup.height},s.onTog=function(t){this.togBtn.selected?(this.proGroup.height=0,this.proGroup.visible=!1):(this.proGroup.height=this.GroupHeight,this.proGroup.visible=!0),this.fun&&this.fun.call(this.funObj)},s.setH=function(t){this.GroupHeight=t,this.proGroup.height=this.GroupHeight,this.fun&&this.fun.call(this.funObj)},s.setFun=function(t,e){this.fun=t,this.funObj=e},e}(eui.Component);egret.registerClass(PanelPart,"PanelPart");var SItem=function(t){function e(){t.call(this),this.drag=!1,this.skinName="resource/skins/SItemSkin.exml",this.bitMap.touchEnabled=!1,this.touchEnabled=!0,this.dragBitmap=new egret.Bitmap,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onSpotBegin,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onSpotBegin=function(t){t.stopImmediatePropagation(),this.drag=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this),this.dragBitmap.texture=RES.getRes(this.data.img),null!=this.dragBitmap.texture&&(this.scale1=100/this.dragBitmap.texture.textureWidth,this.scale2=70/this.dragBitmap.texture.textureHeight,this.dragBitmap.height=this.dragBitmap.texture.textureHeight*Math.min(this.scale1,this.scale2),this.dragBitmap.width=this.dragBitmap.texture.textureWidth*Math.min(this.scale1,this.scale2)),this.dragBitmap.x=t.stageX-this.dragBitmap.width/2,this.dragBitmap.y=t.stageY-this.dragBitmap.height/2,this.dragBitmap.visible=!1,this.preX=t.stageX,this.preY=t.stageY},s.onStageMove=function(t){return Math.abs(t.stageY-this.preY)/Math.abs(t.stageX-this.preX)<.6?(this.dragBitmap.texture=null,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageMove,this),void this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this)):void(1==this.drag?(this.dragBitmap.visible=!0,this.dragBitmap.x=t.stageX-this.dragBitmap.width/2,this.dragBitmap.y=t.stageY-this.dragBitmap.height/2,this.stage.addChild(this.dragBitmap)):(this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this)))},s.onStagEnd=function(t){if(this.drag=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this),this.preX==t.stageX&&this.preY==t.stageY)return void MessageCenter.getInstance().dispatch(ItemEventConst.ADD_ITEM,this.data,[StageUtils.getInstance().getWidth()/2,StageUtils.getInstance().getHeight()/2]);var e=DisplayUtil.getParenFromNameDis(t.target,"ExportPanel");e?(this.dragBitmap&&(this.dragBitmap.texture=null),MessageCenter.getInstance().dispatch(ItemEventConst.EXPORT_ITEM,this.data)):this.dragBitmap&&(this.dragBitmap.texture=null,MessageCenter.getInstance().dispatch(ItemEventConst.ADD_ITEM,this.data,[t.stageX,t.stageY]))},s.initData=function(t){this.data=t,this.bitMap.texture=RES.getRes(t.img),null!=this.bitMap.texture&&(this.scale1=100/this.bitMap.texture.textureWidth,this.scale2=70/this.bitMap.texture.textureHeight,this.bitMap.height=this.bitMap.texture.textureHeight*Math.min(this.scale1,this.scale2),this.bitMap.width=this.bitMap.texture.textureWidth*Math.min(this.scale1,this.scale2),this.bitMap.x=(142-this.bitMap.width)/2,this.bitMap.y=(82-this.bitMap.height)/2),this.txt.text=t.name},s.changeSearchItem=function(){this.txt.x=142,this.txt.y=32,this.txt.textAlign="left",this.bitMap.x=(142-this.bitMap.width)/2,this.bitMap.y=(82-this.bitMap.height)/2,this.txt.textColor=16767536},e}(eui.Component);egret.registerClass(SItem,"SItem");var SItem2=function(t){function e(){t.call(this),this.drag=!1,this.skinName="resource/skins/SItem2Skin.exml",this.bitMap.touchEnabled=!1,this.touchEnabled=!0,this.dragBitmap=new egret.Bitmap,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onSpotBegin,this),this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(){this.delBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.del,this),this.delBtn.visible=!1},s.del=function(t){t.stopImmediatePropagation(),this.clear()},s.onSpotBegin=function(t){this.data&&(t.stopImmediatePropagation(),this.drag=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageMove,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this),this.dragBitmap.texture=RES.getRes(this.data.img),null!=this.dragBitmap.texture&&(this.scale1=100/this.dragBitmap.texture.textureWidth,this.scale2=70/this.dragBitmap.texture.textureHeight,this.dragBitmap.height=this.dragBitmap.texture.textureHeight*Math.min(this.scale1,this.scale2),this.dragBitmap.width=this.dragBitmap.texture.textureWidth*Math.min(this.scale1,this.scale2)),this.dragBitmap.x=t.stageX-this.dragBitmap.width/2,this.dragBitmap.y=t.stageY-this.dragBitmap.height/2,this.dragBitmap.visible=!1,this.preX=t.stageX,this.preY=t.stageY)},s.onStageMove=function(t){1==this.drag?(this.dragBitmap.visible=!0,this.dragBitmap.x=t.stageX-this.dragBitmap.width/2,this.dragBitmap.y=t.stageY-this.dragBitmap.height/2,this.stage.addChild(this.dragBitmap)):(this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this))},s.onStagEnd=function(t){return this.drag=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onStagEnd,this),this.preX==t.stageX&&this.preY==t.stageY?void MessageCenter.getInstance().dispatch(ItemEventConst.ADD_ITEM,this.data,[StageUtils.getInstance().getWidth()/2,StageUtils.getInstance().getHeight()/2]):void(this.dragBitmap&&(this.dragBitmap.texture=null,MessageCenter.getInstance().dispatch(ItemEventConst.ADD_ITEM,this.data,[t.stageX,t.stageY])))},s.initData=function(t){this.data=t,this.bitMap.texture=RES.getRes(t.img),null!=this.bitMap.texture&&(this.scale1=100/this.bitMap.texture.textureWidth,this.scale2=70/this.bitMap.texture.textureHeight,this.bitMap.height=this.bitMap.texture.textureHeight*Math.min(this.scale1,this.scale2),this.bitMap.width=this.bitMap.texture.textureWidth*Math.min(this.scale1,this.scale2),this.bitMap.x=(142-this.bitMap.width)/2,this.bitMap.y=(82-this.bitMap.height)/2),this.txt.text=t.name,this.delBtn.visible=!0},s.clear=function(){this.data=null,this.txt.text="",this.bitMap.texture=null,this.delBtn.visible=!1},e}(eui.Component);egret.registerClass(SItem2,"SItem2");var SavePop=function(t){function e(e,i){t.call(this),this.skinName="resource/skins/SavePopSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this),this.fun=e,this.funObj=i}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.dragBit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.this_downHandle,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOK,this),this.x=260,this.y=220},s.this_downHandle=function(t){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),flashUtils.startDrag(this)},s.stage_upHandle=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.stage_upHandle,this),flashUtils.stopDrag(this)
},s.onOK=function(t){""!=this.nameTxt.text&&this.fun&&(this.fun.call(this.funObj,this.nameTxt.text),this.onClose())},s.onClose=function(){this.parent.removeChild(this)},e}(eui.Component);egret.registerClass(SavePop,"SavePop");var SelectRadioButton=function(t){function e(){t.call(this),this.skinName="resource/skins/selectRadioSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.img1.visible=!0,this.img2.visible=!1},s.setFun=function(t,e,i){this.fun=e,this.funObj=i,this.labelDisplay.text=t},s.onTouch=function(t){this.img1.visible=!this.img1.visible,this.img2.visible=!this.img2.visible,this.fun&&this.funObj&&this.fun.apply(this.funObj)},e}(eui.Component);egret.registerClass(SelectRadioButton,"SelectRadioButton");var TreeGroup=function(t){function e(e,i){t.call(this),this.skinName="resource/skins/TreeGroupSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(){this.buttonSkin='<e:Skin class="skins.ButtonSkin" states="up,down,disabled" minHeight="50" minWidth="135" xmlns:e="http://ns.egret.com/eui" width="135" height="36">\n                <e:Image width="100%" height="36" scale9Grid="10,10,11,11" alpha.disabled="0.5"\n                         source.down="pop_up_select_png" source=""/>\n                <e:Label id="labelDisplay" x="0" width="135" height="36"\n                         textColor="0x333333" verticalAlign="middle" textAlign="center" text="��ɫ" size="16"/>\n                <e:Image id="iconDisplay" horizontalCenter="0" verticalCenter="0"/>\n            </e:Skin>'},s.setFun=function(t,e){this.fun=t,this.funObj=e},s.setData=function(t){this.btnGp.removeChildren();var e=Object.keys(t);this.btnArr=[];for(var i=0;i<e.length;i++){var s=new eui.Button;s.label=t[e[i]].name+"",s.data=t[e[i]].data,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),this.btnGp.addChild(s),s.skinName=this.buttonSkin,s.addEventListener(mouse.MouseEvent.ROLL_OVER,this.onMouseOver,this),s.addEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),this.btnArr.push(s)}},s.onItem=function(t){this.fun.call(this.funObj,t.currentTarget.data),this.parent.changeListType()},s.onMouseOver=function(t){for(var e=0;e<this.btnArr.length;e++){var i=this.btnArr[e];i.getChildAt(0).source=null}t.currentTarget.getChildAt(0).source=RES.getRes("pop_up_select_png")},s.onMouseOut=function(t){t.currentTarget.getChildAt(0).source=null},e}(eui.Component);egret.registerClass(TreeGroup,"TreeGroup");var TreeItem=function(t){function e(e,i){t.call(this),this.isShow=!1,this.itemWidth=195,this.itemsHeight=200,this.arr=[],this.skinName="resource/skins/TreeItemSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(){this.btnLabel.touchEnabled=!1,this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeListType,this),this.buttonSkin='<e:Skin class="skins.ButtonSkin" states="up,down,disabled" minHeight="50" minWidth="195" xmlns:e="http://ns.egret.com/eui" width="195" height="52">\n                <e:Image width="100%" height="52" scale9Grid="10,10,11,11" alpha.disabled="0.5"\n                         source.down="pop_up_select_png" source=""/>\n                <e:Label id="labelDisplay" x="0" width="195" height="52"\n                         textColor="0x333333" verticalAlign="middle" textAlign="center" text="???" size="16"/>\n                <e:Image id="iconDisplay" width="10" height="20" verticalCenter="0" right="5" source="pop_up_select_png"/>\n                <e:Image id="iconA" verticalCenter="0" left="15" source="icon_light_png"/>\n            </e:Skin>'},s.changeListType=function(){this.isShow?(egret.Tween.get(this.scroller).to({y:this.posScrollerClose},10),this.isShow=!1):(egret.Tween.get(this.scroller).to({y:this.btn.height},10),this.isShow=!0),this.group1.visible=!1},s.setData=function(t){for(this.btnArr=[];this.btnGp.numElements>1;){var e=this.btnGp.getChildAt(0);e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),e.removeEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),e.removeEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),this.btnGp.removeChildAt(0)}this.showButtons(t);var i=Object.keys(t);this.itemsHeight=52*i.length,this.scroller.height=this.itemsHeight,null==this.spMask&&(this.spMask=new egret.Shape),this.spMask.graphics.beginFill(0),this.spMask.graphics.drawRect(0,0,this.itemWidth,this.itemsHeight),this.spMask.graphics.endFill(),this.spMask.y=this.btn.height,this.addChild(this.spMask),this.spMask.y=this.btn.height,this.spMask.height=this.itemsHeight,this.scroller.mask=this.spMask,this.posScrollerClose=this.scroller.y-this.scroller.height,this.scroller.y=this.posScrollerClose},s.showButtons=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++){var s=new eui.Button;s.width=this.itemWidth,s.label=t[e[i]].name+"",s.y=52*i,s.x=0,s.data=t[e[i]].data,s.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseOver,this),s.addEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),this.btnGp.addChild(s),s.skinName=this.buttonSkin,s.data instanceof Object?s.iconDisplay.source=RES.getRes("arrow_collapse2_png"):s.iconDisplay.source=null,s.iconA.source=this.getIconA(t[e[i]].name),this.btnArr.push(s)}},s.onItem=function(t){var e,i=t.currentTarget.data;if(i instanceof Object){var s=Object.keys(i);e=i[s[0]].data}else e=i;this.changeListType(),this.fun.call(this.funObj,e),MainView.getInstance().setCourseGroup(i)},s.setCurLabel=function(t){this.btnLabel.text=t+""},s.setFun=function(t,e){this.fun=t,this.funObj=e,this.group1.setFun(this.fun,this.funObj)},s.onMouseOver=function(t){for(var e=(t.currentTarget.data,t.currentTarget.label),i=0;i<this.btnArr.length;i++){var s=this.btnArr[i];s.getChildAt(0).source=null,t.currentTarget.getChildAt(3).source=this.getIconA(e)}t.currentTarget.getChildAt(0).source=RES.getRes("pop_up_select_png"),t.currentTarget.getChildAt(3).source=this.getIconA(e,"over_")},s.onMouseOut=function(t){var e=t.currentTarget.label;t.currentTarget.getChildAt(0).source=null,t.currentTarget.getChildAt(3).source=this.getIconA(e)},s.getIconA=function(t,e){void 0===e&&(e="");var i;switch(t){case"光学":i=RES.getRes("icon_light_"+e+"png");break;case"电学":i=RES.getRes("icon_electric_"+e+"png");break;case LabType.HomeElectric:break;case"电磁学":console.warn("设置电磁学图标"),i=RES.getRes("icon_electric_"+e+"png")}return i},e}(eui.Component);egret.registerClass(TreeItem,"TreeItem");var DataListUI=function(t){function e(){t.call(this),this.itemList=[],this._groupManagerArr=[],this._dataArr=[],this.isShow=!1,this.itemWidth=114,this.itemsHeight=80,this.arr=[],this.skinName="resource/skins/electrics/DataListSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.changeListType=function(t){if(this.scroller1.y=40,t){this._currentHeaderCell=t;var e=t.parent.localToGlobal(t.x,t.y),i=this.globalToLocal(e.x,e.y);this.scroller1.x=i.x,this.spMask.x=this.scroller1.x,this.scroller1.visible=!0}else this.scroller1.visible=!1;this.group1.visible=!1},s.setData=function(t){for(this.btnArr=[];this.btnGp.numElements>1;){var e=this.btnGp.getChildAt(0);e.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),e.removeEventListener(mouse.MouseEvent.ROLL_OVER,this.onMouseOver,this),e.removeEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),this.btnGp.removeChildAt(0)}this.showButtons(t);var i=Object.keys(t);this.itemsHeight=40*i.length,this.scroller1.height=this.itemsHeight,null==this.spMask&&(this.spMask=new egret.Shape),this.spMask.graphics.beginFill(0),this.spMask.graphics.drawRect(0,0,this.itemWidth,this.itemsHeight),this.spMask.graphics.endFill(),this.spMask.y=40,this.addChild(this.spMask),this.spMask.height=this.itemsHeight,this.scroller1.mask=this.spMask,this.posScrollerClose=this.scroller1.y-this.scroller1.height,this.scroller1.y=this.posScrollerClose},s.selectItem=function(t){this.changeListType(null),this._currentHeaderCell.setTitle(t)},s.showButtons=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++){var s=new eui.Button;s.touchEnabled=!0,s.width=this.itemWidth,s.label=t[e[i]].name+"",s.y=40*i,s.x=0,s.data=t[e[i]].data,this.btnGp.addChild(s),s.addEventListener(mouse.MouseEvent.ROLL_OVER,this.onMouseOver,this),s.addEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),s.skinName=this.buttonSkin,s.data instanceof Object?s.iconDisplay.source=RES.getRes("arrow_collapse2_png"):s.iconDisplay.source=null,this.btnArr.push(s)}},s.onItem=function(t){var e=t.currentTarget.data;e instanceof Object||this.changeListType(this._currentHeaderCell)},s.setFun=function(t,e){this.fun=t,this.funObj=e,this.group1.setFun(this.fun,this.funObj)},s.onMouseOver=function(t){for(var e=t.currentTarget.data,i=(t.currentTarget.label,0);i<this.btnArr.length;i++){var s=this.btnArr[i];s.getChildAt(0).source=null}t.currentTarget.getChildAt(0).source=RES.getRes("pop_up_select_png"),e instanceof Object&&this.scroller1.visible?(this.group1.visible=!0,this.group1.setData(e),this.group1.x=this.scroller1.x+this.itemWidth,this.group1.y=t.currentTarget.y+40):this.group1.visible=!1},s.onMouseOut=function(t){t.currentTarget.label;t.currentTarget.getChildAt(0).source=null},s.setCourse=function(){var t={1:{name:"电流I",data:{1:{name:"A",data:"电流I(A)"},2:{name:"mA",data:"电流I(mA)"},3:{name:"μA",data:"电流I(μA)"}}},2:{name:"电压V",data:{1:{name:"V",data:"电压V(V)"},2:{name:"mV",data:"电压V(mV)"},3:{name:"μV",data:"电压V(μV)"}}}};this.setData(t)},s.createCompleteEvent=function(t){this._scroller.addEventListener(eui.UIEvent.CHANGE,this.scrollerChange,this),this._scroller.addEventListener(eui.UIEvent.CHANGE_END,this.scrollerEnd,this),this.buttonSkin='<e:Skin class="skins.ButtonSkin" states="up,down,disabled" minHeight="40" minWidth="128" xmlns:e="http://ns.egret.com/eui" width="128" height="40">\n                <e:Image width="100%" height="40" scale9Grid="10,10,11,11" alpha.disabled="0.5"\n                         source.down="pop_up_select_png" source=""/>\n                <e:Label id="labelDisplay" x="0" width="114" height="40"\n                         textColor="0x333333" verticalAlign="middle" textAlign="center" text="��ɫ" size="16"/>\n                <e:Image id="iconDisplay" horizontalCenter="0" verticalCenter="0"/>\n            </e:Skin>',this.group1.visible=!1,this.setCourse()},s.initList=function(){for(var t=(this.getGroup(-1,"实验次数"),0);4>t;t++)this.getGroup(DataSheetHeader.getAutoGID(),"");for(var t=0;4>t;t++)this.addNewExpData([]);this.changeListType(null)},s.addNewExpData=function(t){this._dataArr.push(t);var e=this.getGroup(-1,"实验次数");if(e){var i=ObjectPool.pop("DataTableCell1");i.setLabelText(this._dataArr.length.toString()),e.addChild(i),this.itemList.push(i)}for(var s,n,r,h=t.concat(),o=0;o<this._groupManagerArr.length;o++)s=this._groupManagerArr[o],-1!=s.gid&&(n=this.isExistGroup(s,h),n?(r=ObjectPool.pop("DataTableCell2"),4==n.iElecInter?r.setEditableText(n.v):5==n.iElecInter&&r.setEditableText(n.a),s.addChildAt(r,1),r.touchEnabled=!0,this.itemList.push(r)):(r=ObjectPool.pop("DataTableCell2"),r.setEditableText(""),s.addChildAt(r,1),this.itemList.push(r)));var a=0;for(o=0;o<h.length;o++)n=h[o],s=this.getGroup(n.uid,n.name),a=e.numElements-s.numElements,a>1&&this.addEmptyCellItem(s,a-1),r.touchEnabled=!0,r=ObjectPool.pop("DataTableCell2"),4==n.iElecInter?r.setEditableText(n.v):5==n.iElecInter&&r.setEditableText(n.a),s.addChildAt(r,1)},s.isExistGroup=function(t,e){for(var i,s=0;s<e.length;s++)if(i=e[s],t.gid==i.uid)return e.splice(e.indexOf(i),1),i;return null},s.addEmptyCellItem=function(t,e){for(var i,s=0;e>s;s++)i=ObjectPool.pop("DataTableCell2"),i.setEditableText(""),t.addChildAt(i,1)},s.createCellGroup=function(t,e){var i=new eui.Group;i.gid=t;var s=new eui.VerticalLayout;s.gap=0,i.layout=s,this._groupManagerArr.push(i);var n;return 0>t?-1==t?(this._allGroupContainer.addChildAt(i,0),n=ObjectPool.pop("DataTableCell1"),n.setLabelText(e)):(this._allGroupContainer.addChildAt(i,1),n=ObjectPool.pop("DataSheetHeader"),n.groupList=this,n.gid=t):(this._allGroupContainer.addChildAt(i,1),n=ObjectPool.pop("DataSheetHeader"),n.groupList=this,n.setTitle(e),n.gid=t),n.touchEnabled=!0,this.itemList.push(n),i.addChildAt(n,0),i},s.getGraphicArr=function(t,e){for(var i,s,n,r=this.getDataGroupElements(t),h=this.getDataGroupElements(e),o=[],a=0;a<r.length;a++)i=r[a],s=h[a],n={x:i.getEditableText(),y:s.getEditableText()},o.push(n);return o},s.getDataGroupElements=function(t){for(var e,i=this.getExsitGroup(t),s=[],n=0;n<i.numElements;n++)e=i.getElementAt(n),e instanceof DataTableCell2&&s.push(e);return s},s.getExsitGroup=function(t){for(var e,i=0;i<this._groupManagerArr.length;i++)if(e=this._groupManagerArr[i],e.gid==t)return e;return null},s.getGroup=function(t,e){var i=this.getExsitGroup(t);return i?i:this.createCellGroup(t,e)},s.scrollerChange=function(t){this._scroller.viewport.scrollV<=0&&(this._scroller.viewport.scrollV=0),this._scroller.viewport.scrollH<=0&&(this._scroller.viewport.scrollH=0)},s.scrollerEnd=function(t){},s.clearAll=function(){ObjectPool.recoverPool(this.itemList);for(var t=0;t<this.itemList.length;t++){var e=this.itemList[t];e.parent.removeChild(e)}for(;this._allGroupContainer.numElements>0;)this._allGroupContainer.removeChildAt(0);this._dataArr=[],this._groupManagerArr=[],this.itemList=[]},e}(eui.Component);egret.registerClass(DataListUI,"DataListUI");var DataRecordSheet=function(t){function e(){t.call(this),this._cellArr=[],this._titleArr=[],this._testArr=[],this._lastTitleMaxX=0,this._lastGroupMaxY=0,this._lastCellMaxX=0,this._testIdx=0,this._testDataArr=[],this._testInfo=[],this._groupIndex=0,this._titleIndex=0,this._dataGroupNum=0,this._dataCellNum=0,this._itemsHeight=40,this._itemWidth=128,this._cellObjs={},this.skinName="resource/skins/electrics/DataRecordSheetSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this._titleGroup.touchEnabled=!1,this._itemGroup.touchEnabled=!1,this.initItemGroup(),this.initTitleLabel(),this._scrollerRect.width=5*this._itemWidth,this._scrollerRect.height=6*this._itemsHeight,this._scroller.addEventListener(eui.UIEvent.CHANGE,this.scrollerChange,this),this._scroller.addEventListener(eui.UIEvent.CHANGE_END,this.scrollerEnd,this)},s.setData=function(t){console.log(t);for(var e=3,i=0;i<t.length;i++){var s=t[i];this._dataGroupNum=t.length;for(var n=0;n<s.length;n++){this._dataCellNum=s.length;var r=s[n],h=this.getTitleLab(r.uid);if(h){h.setTitle(r.name),h.uid=r.uid,h.setTouchEnable(!1);var o=h.titleIndex;console.log(i+""+o);var a=this._cellObjs[i+""+o];r.name.match(/电压表/g)&&a.setEditableText(r.v.toFixed(e)),r.name.match(/电流表/g)&&a.setEditableText(r.a.toFixed(e))}}}},s.getTitleLab=function(t){this._dataCellNum>this._titleArr.length-1&&(this._scroller.viewport.scrollH+=(this._dataCellNum-this._titleArr.length+1)*this._itemWidth,this.initTitleLabel(),this.initItemGroup());for(var e=null,i=0;i<this._titleArr.length;i++){var s=this._titleArr[i];if("meter"==s.hType&&(""!=s.getTitleLabText()||e||(e=s),s.uid==t))return s}return e},s.scrollerChange=function(t){this.initItemGroup(),this.initTitleLabel(),this._scroller.viewport.scrollV<=0&&(this._scroller.viewport.scrollV=0),this._scroller.viewport.scrollH<=0&&(this._scroller.viewport.scrollH=0),this._scrollerRect.width=this._lastTitleMaxX+this._itemWidth,this._scrollerRect.height=this._lastGroupMaxY+this._itemsHeight},s.scrollerEnd=function(t){},s.initItemGroup=function(){for(var t=this._scroller.height+this._scroller.viewport.scrollV,e=Math.ceil(t/this._itemsHeight),i=0;e>i&&t>=this._lastGroupMaxY;i++){var s=new eui.Group;s.rightMaxX=this._itemWidth,s.testIndex=this._groupIndex+"",s.cellIndex=1,this._groupIndex++,s.x=0,s.y=this._lastGroupMaxY,this._itemGroup.addChild(s),this._testArr.push(s),this._lastGroupMaxY=s.y+this._itemsHeight}this.initCell()},s.initCell=function(){for(var t=0;t<this._testArr.length;t++){var e=this._testArr[t],i=this._scroller.width+this._scroller.viewport.scrollH;if(this._scroller.viewport.scrollH<0)return;for(var s=Math.ceil(i/this._itemWidth),n=0;s>n&&i>=e.rightMaxX;n++)if(0==n){var r=new DataTableCell1;r.x=0,r.testIndex=e.testIndex+""+n,r.setLabelText(parseInt(e.testIndex)+1),e.addChild(r),this._cellArr.push(r)}else{var h=new DataTableCell2;h.x=e.rightMaxX,h.testIndex=e.testIndex+""+e.cellIndex,e.cellIndex++,e.addChild(h),this._cellArr.push(h),this._cellObjs[h.testIndex]=h,e.rightMaxX=h.x+this._itemWidth}}},s.initTitleLabel=function(){var t=this._scroller.width+this._scroller.viewport.scrollH;if(!(this._scroller.viewport.scrollH<0))for(var e=Math.ceil(t/this._itemWidth),i=0;e>i&&t>=this._lastTitleMaxX;i++){var s=new DataSheetHeader;s.x=this._lastTitleMaxX,s.titleIndex=this._titleIndex,this._titleIndex++,s.hType="meter",this._titleGroup.addChild(s),this._titleGroup.touchEnabled=!1,0!=i||this._titleArr[0]||(s.hType="title",s.setTitle("实验次数"),s.setTouchEnable(!1)),this._titleArr.push(s),this._lastTitleMaxX=s.x+this._itemWidth}},s.onClose=function(t){this.parent.visible=!1},e}(eui.Component);egret.registerClass(DataRecordSheet,"DataRecordSheet");var DataSheetHeader=function(t){function e(){t.call(this),this._myTitle=null,this.gid=123,this._preState="down",this.skinName="resource/skins/electrics/DataSheetHeaderSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return e.getAutoGID=function(){return this.autoGID--},s.createCompleteEvent=function(t){this._titleLabel.touchEnabled=!0,this._titleLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeListType,this),this._sbtn.addEventListener(egret.Event.CHANGE,this._onselectChanged,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveHandler,this),this._myTitle?this._titleLabel.text=this._myTitle:this._titleLabel.text="",this._titleLabel.size=16,this._titleLabel.textColor=12500670},s.onRemoveHandler=function(t){this._myTitle="",this._sbtn.selected=!1,this._titleLabel.text=""},s._onselectChanged=function(t){1==this._sbtn.selected?DataRecordInfoPanel.dataHeaderArr.length>=2?this._sbtn.selected=!1:-1==DataRecordInfoPanel.dataHeaderArr.indexOf(this)&&DataRecordInfoPanel.dataHeaderArr.push(this):DataRecordInfoPanel.dataHeaderArr.indexOf(this)>-1&&DataRecordInfoPanel.dataHeaderArr.splice(DataRecordInfoPanel.dataHeaderArr.indexOf(this),1),this._preState=this._sbtn.currentState},s.setTitle=function(t){this._titleLabel.text=t,this._myTitle=t},s.getTitleLabText=function(){return this._titleLabel.text},s.setTouchEnable=function(t){this._titleLabel.touchEnabled=t},s.changeListType=function(){this.groupList.changeListType(this)},s.setCurLabel=function(t){this._titleLabel.text=t+""},e.autoGID=-1e3,e}(eui.Component);egret.registerClass(DataSheetHeader,"DataSheetHeader");var DataTableCell1=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/DataTabelCellSkin1.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){this.touchEnabled=!0},s.setLabelText=function(t){this._testIndexLab.text=t+""},e}(eui.Component);egret.registerClass(DataTableCell1,"DataTableCell1");var DataTableCell2=function(t){function e(){t.call(this),this.skinName="resource/skins/electrics/DataTableCellSkin2.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(t){},s.getEditableText=function(){var t=parseFloat(this._editText.text);return isNaN(t)&&(t=0),t},s.setEditableText=function(t){this._editText.text=t+""},e}(eui.Component);egret.registerClass(DataTableCell2,"DataTableCell2");var DataTitleGroup=function(t){function e(e,i){t.call(this),this.skinName="resource/skins/electrics/DataTitleGroupSkin.exml",this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createCompleteEvent=function(){this.buttonSkin='<e:Skin class="skins.ButtonSkin" states="up,down,disabled" minHeight="60" minWidth="80" xmlns:e="http://ns.egret.com/eui" width="80" height="40">\n                <e:Image width="100%" height="40" scale9Grid="10,10,11,11" alpha.disabled="0.5"\n                         source.down="pop_up_select_png" source="pop_up_bg_png"/>\n                <e:Label id="labelDisplay" x="0" width="80" height="40"\n                         textColor="0x333333" verticalAlign="middle" textAlign="center" text="��ɫ" size="16"/>\n                <e:Image id="iconDisplay" horizontalCenter="0" verticalCenter="0"/>\n            </e:Skin>'},s.setFun=function(t,e){this.fun=t,this.funObj=e},s.setData=function(t){this.btnGp.removeChildren();var e=Object.keys(t);this.btnArr=[];for(var i=0;i<e.length;i++){var s=new eui.Button;s.label=t[e[i]].name+"",s.data=t[e[i]].data,this.btnGp.addChild(s),s.skinName=this.buttonSkin,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onItem,this),s.addEventListener(mouse.MouseEvent.ROLL_OVER,this.onMouseOver,this),s.addEventListener(mouse.MouseEvent.ROLL_OUT,this.onMouseOut,this),this.btnArr.push(s)}},s.onItem=function(t){this.parent.selectItem(t.currentTarget.data)},s.onMouseOver=function(t){for(var e=0;e<this.btnArr.length;e++){var i=this.btnArr[e];i.getChildAt(0).source="pop_up_bg_png"}t.currentTarget.getChildAt(0).source=RES.getRes("pop_up_select_png")},s.onMouseOut=function(t){t.currentTarget.getChildAt(0).source="pop_up_bg_png"},e}(eui.Component);egret.registerClass(DataTitleGroup,"DataTitleGroup");var DragHelper=function(t){function e(e,i,s){t.call(this),this.pickPrecision=5,this.Contact=!1,this.stage=e,this.world=s,this.sceneCtn=i,this.nullBody=new p2.Body,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageTouchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouchEnd,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onStageTouchBegin=function(t){var e=new egret.Point;this.sceneCtn.globalToLocal(t.stageX,t.stageY,e);for(var i,s=[e.x,e.y],n=this.world.hitTest(s,this.world.bodies,this.pickPrecision);n.length>0;)if(i=n.shift(),-1==i.refrac)return;if(i){var r=p2.vec2.create();i.toLocalFrame(r,s),this.world.addBody(this.nullBody),this.mouseConstraint=new p2.RevoluteConstraint(this.nullBody,i,{localPivotA:s,localPivotB:r}),this.world.addConstraint(this.mouseConstraint);var h=this.mouseConstraint.bodyB.shapes[0];h.sensor=!0;for(var o=this.world.bodies.length,a=0;o>a;a++){var l=this.world.bodies[a],c=l.shapes[0];c&&c!==h&&(c.sensor=!1)}this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageTouchMove,this),this.Contact=!1,this.world.on("beginContact",function(t){this.Contact=!0},this),this.world.on("endContact",function(t){this.Contact=!1},this)}},s.onStageTouchMove=function(t){var e=new egret.Point;this.sceneCtn.globalToLocal(t.stageX,t.stageY,e);var i=[e.x,e.y];LightUtils.isInRect(i)&&!this.Contact&&(this.mouseConstraint?(this.mouseConstraint.bodyB.position=i,null!=this.mouseConstraint.bodyB.moveFun&&this.mouseConstraint.bodyB.moveFun.apply(this.mouseConstraint.bodyB.displays[0])):this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageTouchMove,this))},s.onStageTouchEnd=function(t){this.world.removeConstraint(this.mouseConstraint),this.mouseConstraint=null,this.world.removeBody(this.nullBody),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageTouchMove,this)},e}(egret.EventDispatcher);egret.registerClass(DragHelper,"DragHelper");var LocationProperty=function(){function t(){}var e=(__define,t);e.prototype;return t.getPara=function(t,e){var i=e||location.href;if(-1!=i.indexOf("?")){var s="&"+i.split("?")[1],n=new RegExp("&"+t+"=.*?(?:&|$)"),r=n.exec(s);if(r){var h=r[0];return h.split("&")[1].split("=")[1]}}return null},t.setProperty=function(t,e,i){var s=i||location.href,n="&"+s.split("?")[1];if(-1==s.indexOf("?"))return s+="?"+t+"="+e;var n=s.split("?")[1];if(""==n)return s+=t+"="+e;var r=new RegExp("(?:^|&)"+t+"=.*?(?:&|$)"),h=r.exec(n);if(h&&""!=h[0]){var o=h[0],a=new RegExp("=.*$"),l=o.replace(a,"="+e);return s.replace(o,l)}return s+="&"+t+"="+e},t.hasProperty=function(t,e){var i="&"+e.split("?")[1];return-1!=i.indexOf("&"+t+"=")},t}();egret.registerClass(LocationProperty,"LocationProperty");var ObjectPool=function(){function t(){this._objs=new Array}var e=(__define,t),i=e.prototype;return i.pushObj=function(t){this._objs.push(t)},i.popObj=function(){return this._objs.length>0?this._objs.pop():null},i.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];t._content[e]||(t._content[e]=[]);var n=t._content[e];if(n.length)return n.pop();var r,h=egret.getDefinitionByName(e),o=i.length;return 0==o?r=new h:1==o?r=new h(i[0]):2==o?r=new h(i[0],i[1]):3==o?r=new h(i[0],i[1],i[2]):4==o?r=new h(i[0],i[1],i[2],i[3]):5==o&&(r=new h(i[0],i[1],i[2],i[3],i[4])),r.ObjectPoolKey=e,r},t.popWithExtraKey=function(e,i){t._content[e]||(t._content[e]=[]);var s,n=t._content[e];if(n.length)for(var r=0;r<n.length;r++)if(n[r].extraKey==i){s=n[r],n.splice(r,1);break}if(!s){var h=egret.getDefinitionByName(e);s=new h(i),s.extraKey=i,s.ObjectPoolKey=e}return s},t.push=function(e){if(null==e)return!1;var i=e.ObjectPoolKey;return t._content[i]?(t._content[i].push(e),!0):!1},t.clear=function(){t._content={}},t.clearClass=function(e,i){void 0===i&&(i=null);for(var s=t._content[e];s&&s.length;){var n=s.pop();i&&n[i](),n=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,i){var s=t._content[e];if(null!=s){var n=0,r=s.length;for(n;r>n;n++)s[n][i]()}},t.recoverPool=function(e){for(var i=0;i<e.length;i++)t.push(e[i])},t._content={},t}();egret.registerClass(ObjectPool,"ObjectPool");var ResourceUtils=function(t){function e(){t.call(this),this._groupIndex=0,this._configs=new Array,this._groups={},RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addConfig=function(t,e){this._configs.push([t,e])},s.loadConfig=function(t,e){this._onConfigComplete=t,this._onConfigCompleteTarget=e,this.loadNextConfig()},s.loadNextConfig=function(){if(0==this._configs.length)return this._onConfigComplete.call(this._onConfigCompleteTarget),this._onConfigComplete=null,void(this._onConfigCompleteTarget=null);var t=this._configs.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(t[0],t[1])},s.onConfigCompleteHandle=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},s.loadGroup=function(t,e,i,s){this._groups[t]=[e,i,s],RES.loadGroup(t)},s.loadGroups=function(t,e,i,s,n){RES.createGroup(t,e,!0),this.loadGroup(t,i,s,n)},s.pilfererLoadGroup=function(t){RES.loadGroup("pilferer_"+t,-1)},s.onResourceLoadComplete=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][0],s=this._groups[e][2];null!=i&&i.call(s),this._groups[e]=null,delete this._groups[e]}},s.onResourceProgress=function(t){var e=t.groupName;if(this._groups[e]){var i=this._groups[e][1],s=this._groups[e][2];null!=i&&i.call(s,t.itemsLoaded,t.itemsTotal)}},s.loadResource=function(t,e,i,s,n){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null);var r=t.concat(e),h="loadGroup"+this._groupIndex++;RES.createGroup(h,r,!0),this._groups[h]=[i,s,n],RES.loadGroup(h)},s.CreateResourceConfigForImage=function(t,e,i){return RES.hasRes(t+"_"+e)?!1:(RES.configInstance.keyMap[t+"_"+e]={name:t+"_"+e,type:"image",url:i},!0)},e}(BaseClass);egret.registerClass(ResourceUtils,"ResourceUtils");var StageUtils=function(t){function e(){t.call(this),null==e._uiStage&&(e._uiStage=new eui.Group,e._uiStage.percentHeight=100,e._uiStage.percentWidth=100,this.getStage().addChild(e._uiStage))}__extends(e,t);var i=(__define,e),s=i.prototype;return e.lock=function(){e._uiStage.touchChildren=e._uiStage.touchEnabled=!1},e.unlock=function(){e._uiStage.touchChildren=e._uiStage.touchEnabled=!0},s.getHeight=function(){return this.getStage().stageHeight},s.getWidth=function(){return this.getStage().stageWidth},s.setTouchChildren=function(t){this.getStage().touchChildren=t},s.setTouchEnabled=function(t){this.getStage().touchEnabled=t},s.setMaxTouches=function(t){this.getStage().maxTouches=t},s.setFrameRate=function(t){this.getStage().frameRate=t},s.getStage=function(){return egret.MainContext.instance.stage},s.getUIStage=function(){return e._uiStage},e}(BaseClass);egret.registerClass(StageUtils,"StageUtils");var Utils=function(){function t(){}var e=(__define,t);e.prototype;return t.HitTestObject=function(e,i,s){var n=e.localToGlobal(e.x,e.y),r=i.localToGlobal(i.x,i.y),h=t.isCollsionWithRect(n.x,n.y,e.width,e.height,r.x,r.y,i.width,i.height);if(h&&1==s){var o=new egret.RenderTexture;o.drawToTexture(e);var a=0,l=0,c=0;for(l=0;l<o._bitmapWidth;l++)for(c=0;c<o._bitmapHeight;c++)0!=o.getPixel32(l,c)[3]&&a++;o.dispose();var d=new egret.RenderTexture;d.drawToTexture(i);var u=0;for(l=0;l<d._bitmapWidth;l++)for(c=0;c<d._bitmapHeight;c++)0!=d.getPixel32(l,c)[3]&&u++;d.dispose();var p=new egret.RenderTexture,g=new egret.Sprite,_=e.parent,f=_.getChildIndex(e),v=e.x,m=e.y,E=i.parent,b=E.getChildIndex(i),y=i.x,C=i.y;e.x=n.x,e.y=n.y,i.x=r.x,i.y=r.y,g.addChild(e),g.addChild(i),p.drawToTexture(g),e.x=v,e.y=m,i.x=y,i.y=C,_.addChildAt(e,f),E.addChildAt(i,b);var T=0;for(l=0;l<p._bitmapWidth;l++)for(c=0;c<p._bitmapHeight;c++)0!=p.getPixel32(l,c)[3]&&T++;return p.dispose(),a+u!=T}return h},t.hitTestExit=function(e,i,s){var n=e.localToGlobal(e.x,e.y),r=i.localToGlobal(i.x,i.y),h=t.isCollsionWithRect(n.x,n.y,e.width,e.height,r.x,r.y,i.width,i.height);if(h&&1==s){var o=new egret.RenderTexture;o.drawToTexture(i);var a=0,l=0;for(a=0;a<o._bitmapWidth;a+=5)for(l=0;l<o._bitmapHeight;l+=5)if(0!=o.getPixel32(a,l)[3]){r.x+a,r.y+l;if(h)return h}}return h},t.isCollsionWithRect=function(t,e,i,s,n,r,h,o){return t>=n&&t>=n+h?!1:n>=t&&n>=t+i?!1:e>=r&&e>=r+o?!1:r>=e&&r>=e+s?!1:!0},t}();egret.registerClass(Utils,"Utils");var p2DebugDraw=function(){function t(t){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=10329589,this.COLOR_S=8381823,this.lineWidth=1,this.world=t}var e=(__define,t),i=e.prototype;return i.setSprite=function(t){this.sprite=t},i.setLineWidth=function(t){this.lineWidth=t},i.drawDebug=function(){this.sprite.graphics.clear();for(var t=this.world.bodies.length,e=0;t>e;e++)for(var i=this.world.bodies[e],s=0;s<i.shapes.length;s++){var n=i.shapes[s];n instanceof p2.Box?this.drawBox(n,i):n instanceof p2.Convex?this.drawConvex(n,i):n instanceof p2.Circle?this.drawCircle(n,i):n instanceof p2.Line?this.drawLine(n,i):n instanceof p2.Particle?this.drawParticle(n,i):n instanceof p2.Plane?this.drawPlane(n,i):n instanceof p2.Capsule?this.drawCapsule(n,i):n instanceof p2.Heightfield&&this.drawHeightfield(n,i)}},i.drawRay=function(t,e,i){var s=this.sprite.graphics;s.lineStyle(this.lineWidth,i),s.moveTo(t[0],t[1]),s.lineTo(e[0],e[1]),s.endFill()},i.drawBox=function(t,e){this.drawConvex(t,e)},i.drawCircle=function(t,e){var i=this.getColor(e),s=this.sprite.graphics;s.lineStyle(this.lineWidth,i),s.beginFill(i,.5);var n=t.position[0],r=t.position[1],h=[];
e.toWorldFrame(h,[n,r]),s.drawCircle(h[0],h[1],t.radius);var o=n+t.radius,a=r+0,l=new Array;e.toWorldFrame(l,[o,a]),s.moveTo(h[0],h[1]),s.lineTo(l[0],l[1]),s.endFill()},i.drawCapsule=function(t,e){var i=this.getColor(e),s=t.position[0],n=t.position[1],r=t.angle,h=t.length,o=t.radius,a=new Array,l=new Array,c=new Array,d=new Array,u=new Array,p=new Array;p2.vec2.rotate(a,[-h/2,-o],r),p2.vec2.rotate(l,[h/2,-o],r),p2.vec2.rotate(c,[h/2,o],r),p2.vec2.rotate(d,[-h/2,o],r),p2.vec2.rotate(u,[h/2,0],r),p2.vec2.rotate(p,[-h/2,0],r);var g=new Array,_=new Array,f=new Array,v=new Array,m=new Array,E=new Array;e.toWorldFrame(g,[s+a[0],n+a[1]]),e.toWorldFrame(_,[s+l[0],n+l[1]]),e.toWorldFrame(f,[s+c[0],n+c[1]]),e.toWorldFrame(v,[s+d[0],n+d[1]]),e.toWorldFrame(m,[s+u[0],n+u[1]]),e.toWorldFrame(E,[s+p[0],n+p[1]]);var b=this.sprite.graphics;b.lineStyle(this.lineWidth,i),b.beginFill(i,.5),b.drawCircle(m[0],m[1],o),b.endFill(),b.lineStyle(this.lineWidth,i),b.beginFill(i,.5),b.drawCircle(E[0],E[1],o),b.endFill(),b.lineStyle(this.lineWidth,i),b.beginFill(i,.5),b.moveTo(g[0],g[1]),b.lineTo(_[0],_[1]),b.lineTo(f[0],f[1]),b.lineTo(v[0],v[1]),b.endFill()},i.drawLine=function(t,e){var i=this.getColor(e),s=t.position[0],n=t.position[1],r=t.angle,h=t.length,o=new Array,a=new Array;p2.vec2.rotate(o,[-h/2,0],r),p2.vec2.rotate(a,[h/2,0],r);var l=[],c=[];e.toWorldFrame(l,[s+o[0],n+o[1]]),e.toWorldFrame(c,[s+a[0],n+a[1]]);var d=this.sprite.graphics;d.lineStyle(this.lineWidth,i),d.moveTo(l[0],l[1]),d.lineTo(c[0],c[1]),d.endFill()},i.drawHeightfield=function(t,e){var i=this.getColor(e),s=t.heights,n=s.length,r=t.elementWidth;if(n>0){var h=t.position[0],o=t.position[1],a=[],l=[],c=0,d=this.sprite.graphics;d.lineStyle(this.lineWidth,i),d.beginFill(i,.5),e.toWorldFrame(l,[h+c,o-100]),d.moveTo(l[0],l[1]);for(var u=0;n>u;u++){var p=s[u];e.toWorldFrame(a,[h+c+u*r,o+p]),d.lineTo(a[0],a[1])}e.toWorldFrame(a,[h+c+n*r,o-100]),d.lineTo(a[0],a[1]),d.endFill()}},i.drawParticle=function(t,e){var i=this.getColor(e),s=this.sprite.graphics;s.lineStyle(this.lineWidth,i),s.beginFill(i,.5);var n=t.position[0],r=t.position[1],h=e.position[0]+n,o=e.position[1]+r;s.drawCircle(h,o,this.lineWidth),s.endFill(),s.lineStyle(this.lineWidth,i),s.drawCircle(h,o,5*this.lineWidth),s.endFill()},i.drawConvex=function(t,e){var i=this.getColor(e),s=t.vertices.length,n=this.sprite.graphics;n.lineStyle(this.lineWidth,i),n.beginFill(i,.5);var r=t.position[0],h=t.position[1],o=new Array;e.toWorldFrame(o,[r,h]);var a=t.vertices[0],l=[r+a[0],h+a[1]],c=new Array;e.toWorldFrame(c,l),n.moveTo(o[0],o[1]),n.lineTo(c[0],c[1]);for(var d=1;s>=d;d++)a=t.vertices[d%s],l=[r+a[0],h+a[1]],e.toWorldFrame(c,l),n.lineTo(c[0],c[1]);n.endFill()},i.drawPlane=function(t,e){var i=this.COLOR_D_SLEEP,s=this.sprite.graphics;s.lineStyle(this.lineWidth,i),s.beginFill(i,1);var n=t.position[0],r=t.position[1],h=t.angle,o=new Array,a=new Array,l=[],c=[];p2.vec2.rotate(o,[-1e3,0],h),e.toWorldFrame(l,[n+o[0],r+o[1]]),s.moveTo(l[0],l[1]),p2.vec2.rotate(a,[1e3,0],h),e.toWorldFrame(c,[n+a[0],r+a[1]]),s.lineTo(c[0],c[1]),p2.vec2.rotate(a,[1e3,-1e3],h),e.toWorldFrame(c,[n+a[0],r+a[1]]),s.lineTo(c[0],c[1]),p2.vec2.rotate(a,[-1e3,-1e3],h),e.toWorldFrame(c,[n+a[0],r+a[1]]),s.lineTo(c[0],c[1]),p2.vec2.rotate(a,[-1e3,-0],h),e.toWorldFrame(c,[n+a[0],r+a[1]]),s.lineTo(c[0],c[1]),s.endFill()},i.getColor=function(t){var e=this.COLOR_D_SLEEP;return t.type==p2.Body.KINEMATIC?e=this.COLOR_K:t.type==p2.Body.STATIC?e=this.COLOR_S:t.sleepState==p2.Body.AWAKE&&(e=this.COLOR_D_WAKE),e},t}();egret.registerClass(p2DebugDraw,"p2DebugDraw");
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Learning Stream in Node.js</title>
    <meta name="description" content="">
    <!--<link rel="stylesheet" href="/assets/css/bootstrap.min.css">-->
    <!--<link rel="stylesheet" href="/assets/css/font-awesome.min.css">-->
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/syntax-highlight.css">
    
    <link rel="stylesheet" href="/assets/css/proj-layout.css">
    <script src="/assets/js/swiftype.js"></script>
    <!--<script src="/assets/js/jquery.js"></script>-->
    <!--<script src="/assets/js/modernizr.min.js"></script>-->
    <!--<script src="/assets/js/bootstrap.min.js"></script>-->
</head>

<body>
    <header>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <p class="site-name"><a class="navbar-brand" href="/" title="twolun">双轮行</a></p>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">HOME</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/project.html">Projects</a></li>
                    <li><a href="/list.html">Posts</a></li>
                    <li><a href="http://wwsun.lofter.com/" target="_blank">Lofter</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- .site-navigation -->
</header>
    <div id="post-content" class="container">
        <br>
        <div class="well">
            <header class="page-header">
                <h1>Learning Stream in Node.js</h1>
                <p class="post-meta">Oct 23, 2015</p>
            </header>
            <article><p>流是Node.js中一个非常重要的概念，也是Node.js之所以适用于数据密集型场景的重要原因之一。
本文将用尽可能简单的方式为你介绍Node中流的概念。</p>

<!--more-->

<h2 id="stream">流 Stream</h2>

<blockquote>
  <p>事实上，流通常用于将程序连接在一起。流可以被读和写。被流连接在一起的程序通常很小，并且只专注于做一件事。</p>
</blockquote>

<p>你可能经常在项目中使用Gulp来做项目的代码构建，那么在使用过程中，你很可能碰到过类似下面的错误。
错误大概是这样个的：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>stream.js:94
	throw er; // Unhandled stream error in pipe.
</code></pre>
</div>

<p>不得不承认，当我第一次碰到这个错误的时候。我对流的概念毫无头绪。我像很多程序员一样，
首先借助Google去了解这个概念。例如你可以在谷歌搜索<code class="highlighter-rouge">node stream</code>这样的关键词。</p>

<p>第一个结果是来自Reddit的，它建议我去安装Nodeschool程序，然后完成<code class="highlighter-rouge">stream-adventure</code>系列的练习。</p>

<p>在安装Stream Adventure之前，我首先阅读了Node.js的官方文档，它是这么写的：</p>

<blockquote>
  <p>流是一个抽象接口，在Node.js中它借助于多种对象实现。例如，一个对HTTP服务器的请求是一个流，
可以是stdout。流是可读的，可写的，或两者兼备。所有的流都是<code class="highlighter-rouge">EventEmitter</code>的实例。</p>
</blockquote>

<p>本质上，流允许你讲其他对象或程序连接在一起。你将某些输入，然后让它经过流，
将它传递到另一个程序中。我比较喜欢拿水管来做类比。将一组小型的管道（程序）连接在一起，
用于完成一些特定的任务。</p>

<p>管道（pipe）的概念很早就存在于Unix系统中，你可以通过这篇文章了解更多：<a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)">Unix Pipelines</a></p>

<h2 id="section">流的特点</h2>

<p>流可以是：可读的、可写的，或者两者兼备</p>

<ul>
  <li>可读的：读一个文件（输入）</li>
  <li>可写的：写一个文件（输出）</li>
  <li>可读可写：读和写一个文件（输入/输出）</li>
</ul>

<p>现在，我们来写个程序用来读取输入，然后将结果打印在控制台上。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>process.stdin.pipe(process.stdout);
</code></pre>
</div>

<p><code class="highlighter-rouge">process</code>对象会获取输入，然后将其作为输出结果打印出来。上面的代码来自于Hack Reactor的视频。
如果运行和这个文件，运行结果如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ node output.js
test
test
echo
echo
me
me
hello world
hello world
</code></pre>
</div>

<h2 id="section-1">实践</h2>

<p>让我们来看一些更高级的内容，谈谈<code class="highlighter-rouge">fs</code>文件系统模块。<code class="highlighter-rouge">fs</code>模块允许你读、写、甚至是改变闻俊或目录的权限等级。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>fs.createReadStream(path[, options])
</code></pre>
</div>

<p>我们现在准备些一个程序用于读取<code class="highlighter-rouge">hello.txt</code>中的内容，其中包括的内容如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hello world
</code></pre>
</div>

<p>示例程序如下：用来读取文件，执行的时候将其吐到控制台上</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// 获取Node的文件系统模块
var fs = require('fs');

// 指定读取流，指向目标文件，编码格式为utf-8
var file = fs.createReadStream('hello.txt', {encoding: 'utf-8'});

// 流是EventEmitter的实例，我们可以为其添加事件
// 当打开文件时触发open事件
file.on('open', function () {
	
	// 使用管道，将文件内容输出到屏幕上
	// process对象也是一个EventEmitter实例
	this.pipe(process.stdout);
});
</code></pre>
</div>

<p>程序非常的简单直观。正如上面的代码所示，我们使用<code class="highlighter-rouge">pipe()</code>方法将文件系统中的内容传递进了<code class="highlighter-rouge">process</code>对象。
然后<code class="highlighter-rouge">process</code>对象将它打印到屏幕上。</p>

<p>为了能够进一步的了解Node流的概念，我推荐你也去完成Nodeschool的Stream。</p>

<h2 id="references">References</h2>

<ol>
  <li><a href="http://www.sitepoint.com/introduction-to-streams/">Introduction to streams</a></li>
  <li><a href="https://www.youtube.com/watch?v=OeqnIuTMod4">Hack Reactor’s Video About Node Streams</a></li>
  <li><a href="https://nodejs.org/api/stream.html">Stream (Node.js)</a></li>
  <li><a href="https://nodejs.org/api/fs.html">File System (Node.js)</a></li>
  <li><a href="http://maxogden.com/node-streams.html">Node Streams Article by Max Ogden</a></li>
</ol>
</article>
        </div>
    </div><!--#post-content-->

    <div id="ds-comment" class="container">
        <div class="ds-thread" data-thread-key="/posts/learning-node-stream.html" data-title="Learning Stream in Node.js"></div>
        <script>
            var duoshuoQuery = {short_name:"wwsun"};  
            (function() {  
                var ds = document.createElement('script');  
                ds.type = 'text/javascript';
                ds.async = true;  
                ds.src = 'http://static.duoshuo.com/embed.js';  
                ds.charset = 'UTF-8';  
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);  
            })();
        </script>
    </div><!--#ds-comment-->

    <footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info container">
        <div class="row">
            <nav id="menu-social" class="social-icons">
                <ul id="menu-social-items" class="social-menu">
                    <li><a href="https://github.com/wwsun" title="Github" class="rss" target="_blank"><i class="social_icon fa fa-github"><span>Github</span></i></a></li>
                    <li><a href="http://weibo.com/234170023" title="Weibo" class="youtube" target="_blank"><i class="social_icon fa fa-weibo"><span>Weibo</span></i></a></li>
                    <li><a href="https://twitter.com/wsun38" title="Twitter" class="twitter" target="_blank"><i class="social_icon fa fa-twitter"><span>Twitter</span></i></a></li>
                    <li><a href="https://plus.google.com/u/0/101153267739962807712/posts" title="Google+" class="googleplus" target="_blank"><i class="social_icon fa fa-googleplus"><span>GooglePlus</span></i></a></li>
                    <li><a href="/about.html#wechatQr" title="Wechat" class="facebook" target="_blank"><i class="fa fa-weixin"><span>Wechat</span></i></a></li>
                </ul>
            </nav>
            <nav role="navigation" class="col-md-6">
                <ul id="menu-flat-footer" class="nav footer-nav clearfix">
                    <li><a href="http://weibo.com/swwol">Weibo</a></li>
                    <li><a href="https://github.com/wwsun">Github</a></li>
                    <li><a href="http://www.zhihu.com/people/wwsun">Zhihu</a></li>
                    <li><a href="http://www.youtube.com/user/bootstrapbayofficial">Lofter</a></li>
                    <li><a href="http://wwsun.github.io/">Blog</a></li>
                </ul>
            </nav>
            <div class="copyright col-md-6">
                <a href="http://wwsun.github.io/" title="Sparkling">Weiwei SUN</a> All rights reserved. Theme by 
                <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by
                <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
            </div>
        </div>
    </div>
    <!-- .site-info -->
    <div class="scroll-to-top"><i class="fa fa-angle-up"></i></div>
    <!-- .scroll-to-top -->
</footer><!-- #colophon -->

<!-- Google Tag Manager -->
<noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-KJHNXB" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>

<script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KJHNXB');
</script>
<!-- End Google Tag Manager -->

</body>

</html>
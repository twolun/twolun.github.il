<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>call()、apply()、bind()的用法</title>
    <meta name="description" content="">
    <!--<link rel="stylesheet" href="/assets/css/bootstrap.min.css">-->
    <!--<link rel="stylesheet" href="/assets/css/font-awesome.min.css">-->
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/syntax-highlight.css">
    
    <link rel="stylesheet" href="/assets/css/proj-layout.css">
    <script src="/assets/js/swiftype.js"></script>
    <!--<script src="/assets/js/jquery.js"></script>-->
    <!--<script src="/assets/js/modernizr.min.js"></script>-->
    <!--<script src="/assets/js/bootstrap.min.js"></script>-->
</head>

<body>
    <header>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <p class="site-name"><a class="navbar-brand" href="/" title="twolun">双轮行</a></p>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">HOME</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/project.html">Projects</a></li>
                    <li><a href="/list.html">Posts</a></li>
                    <li><a href="http://wwsun.lofter.com/" target="_blank">Lofter</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- .site-navigation -->
</header>
    <div id="post-content" class="container">
        <br>
        <div class="well">
            <header class="page-header">
                <h1>call()、apply()、bind()的用法</h1>
                <p class="post-meta">Feb 18, 2016</p>
            </header>
            <article><p>JavaScript中的函数不仅是一种类似于Java中方法的语言功能，它还可以作为对象而存在。
本文将要探讨JavaScript中函数的一些特殊用法，包括<code class="highlighter-rouge">call</code>、<code class="highlighter-rouge">apply</code>、<code class="highlighter-rouge">bind</code>三个原型方法。</p>

<!--more-->

<h2 id="statement">Statement</h2>

<ul>
  <li><strong>作者：</strong> <a href="http://wwsun.github.com">景庄</a>，Web开发者，主要关注JavaScript、Node.js、React、Docker等。</li>
</ul>

<h2 id="section">函数基础</h2>

<p>JavaScript中的函数是一种类似于Java中方法的语言功能，不过它可以独立于类进行定义。</p>

<blockquote>
  <p><strong>函数式编程：</strong> 由于JavaScript支持匿名函数，因此可以将函数作为对象来使用，
所以JavaScript不仅支持过程式编程（面向对象也是过程式编程的一种），还支持函数式编程。</p>
</blockquote>

<h3 id="section-1">上下文</h3>

<p>函数的每次<strong>调用</strong>都会拥有一个特殊值——本次调用的上下文（context）——这就是<code class="highlighter-rouge">this</code>关键字的值。
如果函数挂载在一个对象上，作为对象的一个属性，就称它为对象的方法。当通过这个对象来调用函数时，该对象就是此次调用的上下文，
也就是该函数的<code class="highlighter-rouge">this</code>的值。</p>

<p>需要注意，<code class="highlighter-rouge">this</code>是一个关键字，不是变量，也不是属性名。JavaScript的语法不允许给<code class="highlighter-rouge">this</code>赋值。</p>

<h3 id="section-2">函数是一种对象</h3>

<p>JavaScript中的函数和Java中的方法或C语言中的函数最大不同在于，JavaScript中的函数也是一种对象。
但这并不意味着，所有的对象都是函数。函数是一种包含了可执行代码，并能够被其他代码调用的特殊的对象。</p>

<p>和变量不同，关键字<code class="highlighter-rouge">this</code>没有作用域的限制，嵌套的函数不会从调用它的函数中继承<code class="highlighter-rouge">this</code>。
- 如果嵌套函数作为方法调用，其<code class="highlighter-rouge">this</code>的值指向调用它的对象。
- 如果嵌套函数作为函数调用，其<code class="highlighter-rouge">this</code>的值不是全局对象（非严格模式下）就是<code class="highlighter-rouge">undefined</code>（严格模式下）。</p>

<p>很多人误以为调用嵌套函数时<code class="highlighter-rouge">this</code>会指向掉i用外层函数的上下文。如果你想访问这个外部函数的<code class="highlighter-rouge">this</code>值，
需要将<code class="highlighter-rouge">this</code>的值保存都在一个变量中，这个变量和内部函数都同在一个作用域内。例如：</p>

<p>```javascript
var o = {
  m: function() {
    var self = this;
    console.log(this==o); // true
    f();</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function f() {
  console.log(this === o); // false，this的值是全局对象或undefined
  console.log(self === o); // true
}   } } ```
</code></pre>
</div>

<h3 id="section-3">闭包</h3>

<p>JavaScript的函数可以嵌套在其他函数中定义，这样它们就可以访问它们被定义时所处的作用域中的任何变量。
这意味着JavaScript函数构成了一个闭包（closure），它给JavaScript带来了非常强劲的编程能力。</p>

<h2 id="section-4">作为值的函数</h2>

<p>在JavaScript中，函数不仅是一种语法，也是值，也就是说，可以将函数赋值给变量，存储在对象的属性或数组的元素中，
作为参数传入另外一个函数等。</p>

<h2 id="bindcallapply">bind、call、apply</h2>

<p>每一个函数都包含一个<code class="highlighter-rouge">prototype</code>属性，这个属性是指向一个对象的引用，这个对象称作“原型对象”。
每一个函数都包含不同的原型对象。当将函数用作构造函数的时候，新创建的对象会从原型对象上继承属性。</p>

<h3 id="functionprototypecallfunctionprototypeapply"><code class="highlighter-rouge">Function.prototype.call()</code>和<code class="highlighter-rouge">Function.prototype.apply()</code></h3>

<p><code class="highlighter-rouge">call()</code>和<code class="highlighter-rouge">apply()</code>可以看作为某个对象的方法，通过调用方法的形式来间接调用函数。
它们的第一个参数是要调用函数的母对象，它是调用上下文，在函数体内通过<code class="highlighter-rouge">this</code>来获得对它的引用。
<code class="highlighter-rouge">apply()</code>方法和<code class="highlighter-rouge">call()</code>方法的作用相同，只不过函数传递的方式不一样，它的实参都放入在一个数组中。</p>

<p>举个例子，<strong>以对象o的方法的形式调用函数f()，并传入两个参数</strong>，可以使用这样的代码：</p>

<p>```javascript</p>

<p>var o = {};</p>

<p>function f(a, b) {
  return a + b;
}</p>

<p>f.call(o, 1, 2);        // 将函数f作为o的方法，实际上就是重新设置函数f的上下文
f.apply(o, [1, 2]);
```</p>

<p>再举一个来自MDN的<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call">例子</a>，
<strong>使用call方法调用匿名函数</strong>：</p>

<p>在下例中的for循环体内，我们创建了一个匿名函数，然后通过调用该函数的call方法，将每个数组元素作为指定的this值执行了那个匿名函数。
这个匿名函数的主要目的是给每个数组元素对象添加一个print方法，这个print方法可以打印出各元素在数组中的正确索引号。
当然，这里不是必须得让数组元素作为this值传入那个匿名函数（普通参数就可以），目的是为了演示call的用法。</p>

<p>```javascript
var animals = [
  {species: ‘Lion’, name: ‘King’},
  {species: ‘Whale’, name: ‘Fail’}
];</p>

<p>for (var i = 0; i &lt; animals.length; i++) {
  (function (i) { 
    this.print = function () { 
      console.log(‘#’ + i  + ‘ ‘ + this.species + ‘: ‘ + this.name); 
    } 
    this.print();
  }).call(animals[i], i);
}
```</p>

<h3 id="functionprototypebind"><code class="highlighter-rouge">Function.prototype.bind()</code></h3>

<p><code class="highlighter-rouge">bind()</code>是在ES5中新增的方法，从名字可以看出，这个方法的主要作用就是将函数绑定到某个对象。
当在函数<code class="highlighter-rouge">f()</code>上调用<code class="highlighter-rouge">bind()</code>方法并后窜入一个对象<code class="highlighter-rouge">o</code>作为参数，这个方法将返回一个新函数：
（以函数调用的方式）调用新的函数将会把原始的函数<code class="highlighter-rouge">f()</code>作为<code class="highlighter-rouge">o</code>的方法来调用。例如：</p>

<p>```javascript
function f(y) {
  return this.x + y;
}</p>

<p>var o = {
  x: 1
};</p>

<p>var g = f.bind(o);  // 通过调用 g(x) 来调用 o.f(x)
g(2); // 3
```</p>

<p>其实我们可以轻松的实现<code class="highlighter-rouge">bind()</code>方法：</p>

<p>```javascript
// 返回一个函数，通过调用它来调用o中的方法f()，传递它所有的实参
function bind(f, o) {
  if (f.bind) return f.bind(o); // 如果bind()方法存在，使用bind()方法
  else return function () {
    return f.apply(o, arguments);
  }
}</p>

<p>```</p>

<h2 id="section-5">函数式编程</h2>

<p>JavaScript并非函数式编程语言，但在JavaScript中可以像操控对象一样操控函数，也就是说可以在JavaScript中应用函数式编程技术。</p>

<h3 id="section-6">使用函数处理数组</h3>

<p>假设有一个数组，数组元素都是数字，我们想要计算这些元素的平均值和标准差。</p>

<p>```javascript
var data = [1, 1, 3, 5, 5];
var sum = function(x, y) {
  return x + y;
};
var square = function(x) {
  return x * x;
};</p>

<p>var mean = data.reduce(sum)/data.length;
var deviations = data.map(x =&gt; x - mean);
var stddev = Math.sqrt(deviations.map(square).reduce(sum)/(data.length - 1));
```</p>

<h3 id="section-7">高阶函数</h3>

<p>高阶函数就是操作函数的函数，它接收一个或多个函数作为参数，并返回一个新函数。举个例子：</p>

<p>```javascript
function not(f) {
  return function () {
    var result = f.apply(this, arguments);
    return !result;
  };
}</p>

<p>// 判断x是否为偶数的函数
var even = function(x) {
  return x % 2 === 0;
};</p>

<p>var odd = not(even);            // 一个新函数，所做的事情和even()相反
[1, 1, 3, 5, 5].every(odd);     // true，每个函数都是奇数</p>

<p>```</p>

<p>函数<code class="highlighter-rouge">not()</code>是个高阶函数，因为它返回一个新的函数，这个新函数将它的实参传入<code class="highlighter-rouge">f()</code>，并返回<code class="highlighter-rouge">f</code>的返回值的逻辑非。</p>

<h2 id="references">References</h2>

<ol>
  <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call">Function.prototype.call()</a></li>
</ol>
</article>
        </div>
    </div><!--#post-content-->

    <div id="ds-comment" class="container">
        <div class="ds-thread" data-thread-key="/posts/javascript-functions.html" data-title="call()、apply()、bind()的用法"></div>
        <script>
            var duoshuoQuery = {short_name:"wwsun"};  
            (function() {  
                var ds = document.createElement('script');  
                ds.type = 'text/javascript';
                ds.async = true;  
                ds.src = 'http://static.duoshuo.com/embed.js';  
                ds.charset = 'UTF-8';  
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);  
            })();
        </script>
    </div><!--#ds-comment-->

    <footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info container">
        <div class="row">
            <nav id="menu-social" class="social-icons">
                <ul id="menu-social-items" class="social-menu">
                    <li><a href="https://github.com/wwsun" title="Github" class="rss" target="_blank"><i class="social_icon fa fa-github"><span>Github</span></i></a></li>
                    <li><a href="http://weibo.com/234170023" title="Weibo" class="youtube" target="_blank"><i class="social_icon fa fa-weibo"><span>Weibo</span></i></a></li>
                    <li><a href="https://twitter.com/wsun38" title="Twitter" class="twitter" target="_blank"><i class="social_icon fa fa-twitter"><span>Twitter</span></i></a></li>
                    <li><a href="https://plus.google.com/u/0/101153267739962807712/posts" title="Google+" class="googleplus" target="_blank"><i class="social_icon fa fa-googleplus"><span>GooglePlus</span></i></a></li>
                    <li><a href="/about.html#wechatQr" title="Wechat" class="facebook" target="_blank"><i class="fa fa-weixin"><span>Wechat</span></i></a></li>
                </ul>
            </nav>
            <nav role="navigation" class="col-md-6">
                <ul id="menu-flat-footer" class="nav footer-nav clearfix">
                    <li><a href="http://weibo.com/swwol">Weibo</a></li>
                    <li><a href="https://github.com/wwsun">Github</a></li>
                    <li><a href="http://www.zhihu.com/people/wwsun">Zhihu</a></li>
                    <li><a href="http://www.youtube.com/user/bootstrapbayofficial">Lofter</a></li>
                    <li><a href="http://wwsun.github.io/">Blog</a></li>
                </ul>
            </nav>
            <div class="copyright col-md-6">
                <a href="http://wwsun.github.io/" title="Sparkling">Weiwei SUN</a> All rights reserved. Theme by 
                <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by
                <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
            </div>
        </div>
    </div>
    <!-- .site-info -->
    <div class="scroll-to-top"><i class="fa fa-angle-up"></i></div>
    <!-- .scroll-to-top -->
</footer><!-- #colophon -->

<!-- Google Tag Manager -->
<noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-KJHNXB" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>

<script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KJHNXB');
</script>
<!-- End Google Tag Manager -->

</body>

</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>使用ES6编写React应用（1）：简介及环境配置</title>
    <meta name="description" content="">
    <!--<link rel="stylesheet" href="/assets/css/bootstrap.min.css">-->
    <!--<link rel="stylesheet" href="/assets/css/font-awesome.min.css">-->
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/syntax-highlight.css">
    
    <link rel="stylesheet" href="/assets/css/proj-layout.css">
    <script src="/assets/js/swiftype.js"></script>
    <!--<script src="/assets/js/jquery.js"></script>-->
    <!--<script src="/assets/js/modernizr.min.js"></script>-->
    <!--<script src="/assets/js/bootstrap.min.js"></script>-->
</head>

<body>
    <header>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <p class="site-name"><a class="navbar-brand" href="/" title="twolun">朱子</a></p>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">首页</a></li>
                    <li><a href="/project.html">项目总结</a></li>
                    <li><a href="/list.html">学习笔记</a></li>
                    <li><a href="/about.html">关于我</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- .site-navigation -->
</header>
    <div id="post-content" class="container">
        <br>
        <div class="well">
            <header class="page-header">
                <h1>使用ES6编写React应用（1）：简介及环境配置</h1>
                <p class="post-meta">Feb 3, 2016</p>
            </header>
            <article><p>React是一个能够实现简单优雅的组件化方案的库。借助React能够快速的构建组件化前端应用，并且将关注的重点集中在视图层。
此外，React拥抱ES6，本文将会介绍如何使用ES6来编写React应用。作为本系列的第一篇文章，本文将主要讲诉相关的开发环境配置。</p>

<!--more-->

<h2 id="statement">Statement</h2>

<ul>
  <li><strong>作者：</strong> <a href="http://wwsun.github.com">景庄</a>，Web开发者，主要关注JavaScript、Node.js、React、Docker等。</li>
</ul>

<p>在<a href="http://wwsun.github.io/posts/react-getting-started.html">之前的文章</a>中，我们曾经讨论过React开发的基础知识，
如果你对React还不是很了解，可以参考该篇博文。另一方面，ES6已经在去年的年中正式被标准化，并且React拥抱ES6，对于开发者而言，
应该尽可能的使用ES6来编写React应用。因此，以本文为开端，大致的介绍如何使用ES6来编写React应用。</p>

<h2 id="section">源代码</h2>

<p>阅读本系列文章时可以参考<a href="https://github.com/wwsun/react-es6-tutorial">Github仓库</a>中的代码。</p>

<h2 id="section-1">工具说明</h2>

<p>本文所使用的各项技术均为最新版本，具体的版本信息参考如下：</p>

<ul>
  <li>Babel v6</li>
  <li>Node v4</li>
  <li>Koa v1</li>
  <li>React v0.14 (<code class="highlighter-rouge">react</code> and <code class="highlighter-rouge">react-dom</code>)</li>
  <li>Webpack v1.12</li>
</ul>

<p>Babel是一个通用的多用途JavaScript编译器，借助Babel你可以将ES6甚至ES7代码转译为绝大部分浏览器都能执行的ES5代码，
此外Babel也能够用于转译React代码，并且这也是React官方所推荐的。
更多内容请参考<a href="https://github.com/thejameskyle/babel-handbook/blob/master/translations/zh-Hans/user-handbook.md#babel-register">Babel用户手册</a>。</p>

<p>Webpack 非常容易操作，它是一个模块合并的工具，本质就是一个能够把各种组件（HTML，CSS，JS）构建成项目。
最方便的是你只需要初始化配置一次，Webpack 会替你做那些繁琐的事情，同时也保证了让你可以在项目中混合使用各种技术而不头疼。</p>

<p>Webpack能够通过配置取出代码中的依赖，然后通过加载器将代码兼容地输出为浏览器兼容的静态资源。
更多内容请参考<a href="https://github.com/petehunt/webpack-howto/blob/master/README-zh.md">Webpack How-To</a>。</p>

<h2 id="section-2">项目结构</h2>

<p>本文所使用的项目结构如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>+ build     客户端代码的构建结果目录
+ config    配置信息目录
+ lib       服务端库文件
    - render.js 渲染脚本
+ src       客户端源代码存放目录
+ test      测试文件目录
+ views     视图文件目录
- index.js  服务器脚本
</code></pre>
</div>

<h2 id="section-3">准备开发环境</h2>

<h3 id="koa">构建一个简单的Koa服务器</h3>

<p>为了能够让我们所构建的应用正常的运行和调试，首先需要做的是构建一个基本的Web容器，幸运的是，
我们可以基于Node.js快速的构建一个简单的并且满足需求的Web服务器。为了简单起见，我们选择使用Koa进行构建。</p>

<ol>
  <li>使用<code class="highlighter-rouge">npm init --yes</code>快速的生成项目的初始文件。</li>
  <li>安装服务器端的相关依赖，如下：
    <ul>
      <li>koa</li>
      <li>koa-logger</li>
      <li>koa-route</li>
      <li>koa-static</li>
      <li>co-views</li>
      <li>swig</li>
    </ul>
  </li>
  <li>由于我们也想用ES6开发服务端代码，因此我们打算使用Babel动态编译代码，安装相关依赖：
    <ul>
      <li>babel-cli</li>
      <li>babel-preset-es2015-node5</li>
    </ul>
  </li>
  <li>
    <p>在<code class="highlighter-rouge">package.json</code>中增加<code class="highlighter-rouge">babel</code>和<code class="highlighter-rouge">scripts</code>配置项：</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> "babel": {
     "presets": [
     "es2015-node5"
     ]
 },
 "scripts": {
     "start": "babel-node index.js"
 }
</code></pre>
    </div>
  </li>
</ol>

<p>服务器端代码的相关依赖和配置信息都已经完成了，现在只需要用ES6来开发一个简单的koa服务器即可：</p>

<p>```javascript
// index.js
‘use strict’;</p>

<p>import path from ‘path’;
import koa from ‘koa’;
import logger from ‘koa-logger’;
import serve from ‘koa-static’;
import route from ‘koa-route’;</p>

<p>import render from ‘./lib/render’;</p>

<p>var app = koa();</p>

<p>app.use(logger());
app.use(route.get(‘/’, home));</p>

<p>function *home() {
  this.body = yield render(‘home’, {});
}</p>

<p>app.use(serve(path.join(__dirname, ‘build’)));</p>

<p>app.listen(3000);
console.log(‘listening on port 3000’);
```</p>

<p>由于服务器需要渲染基本的视图文件，因此我们可以借助<code class="highlighter-rouge">co-views</code>和<code class="highlighter-rouge">swig</code>编写一个简单的服务器端渲染脚本：</p>

<p>```javascript
// lib/render.js
‘use strict’;</p>

<p>import path from ‘path’;
import views from ‘co-views’;</p>

<p>export default views(path.join(__dirname, ‘../views/’), {
  map: {html: ‘swig’}
});
```</p>

<p>创建视图文件<code class="highlighter-rouge">views/home.html</code>：</p>

<p>```html
&lt;!DOCTYPE html&gt;</p>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>React.js with ES6</title>
</head>
<body>

<div id="react-app"></div>

<!--<script src="bundle.js"></script>-->
<script src="http://localhost:8080/bundle.js"></script>
</body>
</html>
<p>```</p>

<h3 id="webpack">配置Webpack</h3>

<p>由于我们需要使用ES6来编写React应用，因此我们需要将React代码编译为普通的JS代码，幸运的是，
我们可以借助Webpack和Babel来完成这项任务。</p>

<p>我们建议你不要全局安装Webpack，而是将<code class="highlighter-rouge">webpack</code>作为项目的开发依赖（<code class="highlighter-rouge">devDependencies</code>），
这样你就可以在<code class="highlighter-rouge">package.json</code>的<code class="highlighter-rouge">scripts</code>配置项中直接使用<code class="highlighter-rouge">webpack</code>命令，而无需在新的环境中全局安装Webpack。</p>

<p>Webpack的配置步骤如下：</p>

<ol>
  <li>使用<code class="highlighter-rouge">npm i PACK_NAME --save-dev</code>安装Webpack，包括如下开发依赖：
    <ul>
      <li>webpack</li>
      <li>webpack-dev-server</li>
    </ul>
  </li>
  <li>安装Babel相关依赖，用于编译React代码：
    <ul>
      <li>babel-loader</li>
      <li>babel-preset-es2015</li>
      <li>bebel-preset-react</li>
    </ul>
  </li>
  <li>创建Webpack配置文件：<code class="highlighter-rouge">config/webpack.config.js</code></li>
  <li>
    <p>在<code class="highlighter-rouge">package.json</code>文件中添加编译React代码相关的<code class="highlighter-rouge">scripts</code>脚本：</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> "scripts": {
     "start": "babel-node index.js",
     "build": "webpack --config config/webpack.config.js",
     "watch": "webpack-dev-server --config config/webpack.config.js --hot --inline --progress"
 },
</code></pre>
    </div>
  </li>
</ol>

<blockquote>
  <p><code class="highlighter-rouge">npm</code>是一个非常好用的用来编译指令，通过<code class="highlighter-rouge">npm</code>你可以不用去担心项目中使用了什么技术，你只要调用这个指令就可以了，
你只需要在<code class="highlighter-rouge">package.json</code>中设置<code class="highlighter-rouge">scripts</code>的值就可以了。例如，上面的例子中，
我们可以通过<code class="highlighter-rouge">npm run build</code>来运行webpack执行构建工作。</p>
</blockquote>

<p>如果每次源代码发生了变化，就执行<code class="highlighter-rouge">npm run build</code>来重新编译的话，的确是一件非常无聊的事情，幸运的是，
我们可以让他安静的运行，这就是我们为什么要引入<a href="http://webpack.github.io/docs/webpack-dev-server.html">webpack-dev-server</a>的原因。
简单解释一下可能会涉及到的相关命令：</p>

<ul>
  <li><code class="highlighter-rouge">webpack-dev-server</code> - 在<code class="highlighter-rouge">http://localhost:8080</code>建立一个Web服务器，用来存放每次编译后的静态资源包</li>
  <li><code class="highlighter-rouge">--hot</code> - 模块热加载，建议与<code class="highlighter-rouge">--inline</code>一起使用。</li>
  <li><code class="highlighter-rouge">--inline</code> - 将webpack-dev-server的运行时（Runtime）嵌入到bundle中</li>
  <li><code class="highlighter-rouge">--devtool eval</code> - 为你的代码创建源地址。当有任何报错的时候你可以更加精确的定位到文件和行号</li>
  <li><code class="highlighter-rouge">--progress</code> - 显示合并代码的进度</li>
  <li><code class="highlighter-rouge">--colors</code> - 命令行中显示颜色</li>
  <li><code class="highlighter-rouge">--content-base OUTPUT_FOLDER_NAME</code> - 指向设置的输出目录</li>
</ul>

<p>Webpack的配置文件如下：</p>

<p>```javascript
// config/webpack.config.js
var path = require(‘path’);
var webpack = require(‘webpack’);
var node_modules = path.resolve(__dirname, ‘../node_modules’);</p>

<p>var dir_src = path.resolve(__dirname, ‘../src’);
var dir_build = path.resolve(__dirname, ‘../build’);</p>

<p>module.exports = {
  entry: path.resolve(dir_src, ‘main.jsx’),
  output: {
    path: dir_build, // for standalone building
    filename: ‘bundle.js’
  },
  // webpack-dev-server默认配置项，建议使用
  devServer: {
    contentBase: dir_build
  },
  module: {
    loaders: [
      {test: /src(\|\/).+.jsx?$/, exclude: /node_modules/, loader: ‘babel’, query: {presets: [‘es2015’, ‘react’]}}
    ]
  },
  plugins: [
    // Avoid publishing files when compilation fails
    new webpack.NoErrorsPlugin()
  ],
  stats: {
    colors: true // Nice colored output
  },
  // Create Sourcemaps for the bundle
  devtool: ‘source-map’
};
```</p>

<p>该文件是一个标准的Node.js模块，并暴露出一个配置信息的对象。主要包括如下选项：</p>

<ul>
  <li><code class="highlighter-rouge">entry</code>：Webpack解析模块的入口文件（即以该文件如入口，深度遍历项目的所有的依赖项，从而执行模块构建任务）</li>
  <li><code class="highlighter-rouge">output</code>: webpack将入口文件和它的所有依赖项进行打包，命名为<code class="highlighter-rouge">bundle.js</code>输出到目标目录中</li>
  <li><code class="highlighter-rouge">module.loaders</code>: 导入文件的预处理器</li>
  <li><code class="highlighter-rouge">plugins</code>: 用于扩展webpack的插件</li>
  <li><code class="highlighter-rouge">devtool</code>: 开启devtool，并配置输出代码的source map</li>
  <li><code class="highlighter-rouge">devServer</code>: 告诉webpack-dev-server需要服务的文件</li>
</ul>

<p>通过上面的配置，我们已经可以编写ES6代码了。</p>

<h2 id="react">编写React应用</h2>

<p>为了能够使用React来编写应用，我们需要安装React的相关依赖，从0.14开始，React被拆分为了两个包（react和react-dom），
因此你首先需要安装这两个依赖：<code class="highlighter-rouge">npm install react react-dom --save-dev</code>。安装好依赖包后，便可以借助React来编写应用了：</p>

<h3 id="rootjsx">根组件： <code class="highlighter-rouge">root.jsx</code></h3>

<p>React应用组件树的根文件：</p>

<p>```javascript
// src/components/root.jsx
import React from ‘react’;</p>

<p>class Root extends React.Component {
  render() {
    return &lt;h1&gt;Hello from {this.props.phrase}!&lt;/h1&gt;;
  }
}</p>

<p>export default Root;
```</p>

<h3 id="mainjsx">入口： <code class="highlighter-rouge">main.jsx</code></h3>

<p>然后我们需要编写React应用的入口文件，通常命名为<code class="highlighter-rouge">main.jsx</code>：</p>

<p>```javascript
// src/main.jsx
import React from ‘react’;
import ReactDOM from ‘react-dom’;
import Root from ‘./components/root.jsx’;</p>

<p>let attachElement = document.getElementById(‘react-app’);</p>

<p>ReactDOM.render(<root phrase="ES6"></root>, attachElement); // 实例化根组件，并启动应用
```</p>

<ul>
  <li><code class="highlighter-rouge">ReactDOM.render()</code> 实例化根组件，启动框架，并且将标记注入原始的DOM元素中（参数2）。</li>
  <li><code class="highlighter-rouge">ReactDOM</code>模块主要暴露了和DOM相关的方法。</li>
</ul>

<h3 id="section-4">组件的命名规则</h3>

<p>这里我建议使用JavaScript的常用命名规则，即：</p>

<ul>
  <li>对于文件名，多个单词使用<code class="highlighter-rouge">-</code>分隔，单词均使用小写，例如<code class="highlighter-rouge">hello-world.jsx</code>。</li>
  <li>对于组件名，名称与文件名相同，但使用Java的大驼峰的类名规则，例如<code class="highlighter-rouge">HelloWorld</code>。</li>
</ul>

<h2 id="section-5">测试及启动</h2>

<ol>
  <li>使用<code class="highlighter-rouge">npm run watch</code>启动<code class="highlighter-rouge">webpack-dev-server</code></li>
  <li>使用<code class="highlighter-rouge">npm start</code>启动服务器</li>
  <li>打开浏览器访问<code class="highlighter-rouge">http://localhost:3000</code>查看结果</li>
</ol>

<h2 id="section-6">小结</h2>

<p>本文简要介绍了如何使用ES6来进行React应用的开发，涉及到具体的开发环境的配置，包括借助webpack进行项目的模块打包构建，
以及使用Babel进行ES6代码的转译。在后续的文章中，将进一步的介绍React应用开发的高级技术，包括状态管理、路由等。</p>

<h2 id="section-7">参考文件</h2>

<ol>
  <li><a href="http://egorsmirnov.me/2015/05/22/react-and-es6-part1.html">React and ES6, Part 1</a></li>
  <li><a href="https://fakefish.github.io/react-webpack-cookbook/index.html">React and Webpack Cookbook</a></li>
  <li><a href="https://facebook.github.io/react/docs/getting-started.html">React - Getting Started</a></li>
  <li><a href="http://babeljs.io/blog/2015/10/31/setting-up-babel-6/">Setting Up Babel 6</a></li>
  <li>E-book: <a href="https://leanpub.com/exploring-es6/">Exploring ES6</a></li>
  <li><a href="https://facebook.github.io/react/docs/jsx-in-depth.html">JSX in Depth</a></li>
  <li><a href="https://github.com/thejameskyle/babel-handbook/blob/master/translations/zh-Hans/user-handbook.md">Babel Handbook</a></li>
  <li><a href="https://github.com/petehunt/webpack-howto/blob/master/README-zh.md">Webpack How-to</a></li>
</ol>
</article>
        </div>
    </div><!--#post-content-->

    <div id="ds-comment" class="container">
        <div class="ds-thread" data-thread-key="/posts/react-with-es6-part-1.html" data-title="使用ES6编写React应用（1）：简介及环境配置"></div>
        <script>
            var duoshuoQuery = {short_name:"wwsun"};  
            (function() {  
                var ds = document.createElement('script');  
                ds.type = 'text/javascript';
                ds.async = true;  
                ds.src = 'http://static.duoshuo.com/embed.js';  
                ds.charset = 'UTF-8';  
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);  
            })();
        </script>
    </div><!--#ds-comment-->

    <footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info container">
        <div class="row">
            <nav id="menu-social" class="social-icons">
                <ul id="menu-social-items" class="social-menu">
                    <li><a href="https://github.com/twolun" title="Github" class="rss" target="_blank"><i class="social_icon fa fa-github"><span>Github</span></i></a></li>
                    <li><a href="/about.html#wechatQr" title="Wechat" class="facebook" target="_blank"><i class="fa fa-weixin"><span>Wechat</span></i></a></li>
                </ul>
            </nav>
            <nav role="navigation" class="col-md-6">
                <ul id="menu-flat-footer" class="nav footer-nav clearfix">
                    <li><a href="https://github.com/twolun">Github</a></li>
                    <li><a href="http://twolun.github.io/">Blog</a></li>
                </ul>
            </nav>
            <div class="copyright col-md-6">
                <a href="http://twolun.github.io/" title="Sparkling">朱了</a> All rights reserved. Theme by 
                <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
            </div>
        </div>
    </div>
    <!-- .site-info -->
    <div class="scroll-to-top"><i class="fa fa-angle-up"></i></div>
    <!-- .scroll-to-top -->
</footer><!-- #colophon -->



</body>

</html>
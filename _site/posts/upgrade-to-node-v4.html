<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>关于Node v4你必须知道几个ES6特性</title>
    <meta name="description" content="">
    <!--<link rel="stylesheet" href="/assets/css/bootstrap.min.css">-->
    <!--<link rel="stylesheet" href="/assets/css/font-awesome.min.css">-->
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/syntax-highlight.css">
    
    <link rel="stylesheet" href="/assets/css/proj-layout.css">
    <script src="/assets/js/swiftype.js"></script>
    <!--<script src="/assets/js/jquery.js"></script>-->
    <!--<script src="/assets/js/modernizr.min.js"></script>-->
    <!--<script src="/assets/js/bootstrap.min.js"></script>-->
</head>

<body>
    <header>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <p class="site-name"><a class="navbar-brand" href="/" title="twolun">双轮行</a></p>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">HOME</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/project.html">Projects</a></li>
                    <li><a href="/list.html">Posts</a></li>
                    <li><a href="http://wwsun.lofter.com/" target="_blank">Lofter</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- .site-navigation -->
</header>
    <div id="post-content" class="container">
        <br>
        <div class="well">
            <header class="page-header">
                <h1>关于Node v4你必须知道几个ES6特性</h1>
                <p class="post-meta">Oct 9, 2015</p>
            </header>
            <article><p>Node v4在9月9号正式发布了。这个版本是Node和iojs合并后发布的首个稳定版本，并且为开发者带来
了大量的ES6语言扩展。通过<a href="https://nodejs.org/en/docs/es6/">这边文章</a>你可以大致了解
Node.js中包括的ES6语言扩展。本文将会为你介绍如何使用这些新特性。</p>

<!--more-->

<h2 id="section">模板字符串</h2>

<p>如果你想要在JavaScript中创建一个多行字符串，你可能曾经写过下面这样的代码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var message = [
	'The quick brown fox',
	'jumps over',
	'the lazy dog'
].join('\n');
</code></pre>
</div>

<p>也许这种方法对于比较少的文本还是比较合适，但如果对于多行的长句子问题可能就变得一团糟了。
于是某个程序员写了个叫<a href="https://github.com/sindresorhus/multiline">multiline</a>的库，
使用hack的方法来解决这个问题：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var multiline = require('multiline');
var message = multiline(function () {/*
		the quick brown fox
		jumps over
		the lazy dog
	*/});
</code></pre>
</div>

<p>幸运的是，我们现在可以使用ES6的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings">模板字符串</a>
来解决这个问题:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var message = `
	The quick brown fox
	jumps over
	the lazy dog
`;
</code></pre>
</div>

<p>此外，它还为我们带来了字符串插值（string interpolation）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var name = 'Weiwei';

// 不需要这样做了 ...
var message = 'Hello ' + name + ', how is your cat?';
var message = ['Hello ', name, ', how is your cat?'].join('');
var message = require('util').format('Hello %s, how is your cat?', name);

// 使用新的方式 ...
var message = `Hello ${name}, how is your cat?`;	
</code></pre>
</div>

<h2 id="section-1">类</h2>

<p>在ES5中定义类总会让人感觉到奇怪，并且需要足够的时间去适应这种写法。例如：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var Pet = function (name) {
	this._name = name;
};

Pet.prototype.sayHello = function () {
	console.log('*scratch*');
};

Object.defineProperty(Pet.prototype, 'name', {
get: function () {
	return this._name;
}
});


var Cat = function (name) {
	Pet.call(this, name);
};

require('util').inherits(Cat, Pet);

Cat.prototype.sayHello = function () {
	Pet.prototype.sayHello.call(this);
	console.log('miaaaauw');
};
</code></pre>
</div>

<p>幸运的是，如今我们在Node中可以使用ES6的类语法了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class Pet {
	
	constructor(name) {
		this._name = name;	
	}	
	sayHello() {
		console.log('*scratch*');	
	}
	get name() {
		return this._name;	
	}
}


class Cat extends Pet {
	constructor(name) {
		super(name);	
	}	
	sayHello() {
		super.sayHello();
		console.log('miaaaauw');	
	}
}
</code></pre>
</div>

<p>使用<code class="highlighter-rouge">extends</code>来实现类的继承，使用<code class="highlighter-rouge">constructor()</code>方法作为构造器方法，通过这样的方式来实现
子类对父类的继承。是不是很棒？还有更多的内容，可以参考<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes">MDM</a>。</p>

<h2 id="section-2">箭头函数</h2>

<p>函数调用中的<code class="highlighter-rouge">this</code>关键字的动态绑定总是会让人感到困惑，为此，开发人员也试图用不同的方法来解决
这个问题：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Cat.prototype.notifyListeners = function () {
	var self = this;
	this._listeners.forEach(function(listener) {
		self.notifyListener(listener);	
	});	
};
</code></pre>
</div>

<p>或者</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Cat.prototype.notifyListeners = function () {
	this._listeners.forEach(function(listener) {
		self.notifyListener(listener);	
	}.bind(this));	
};
</code></pre>
</div>

<p>而如今，在Node中你可以直接使用箭头函数了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Cat.prototype.notifyListeners = function () {
	this._listeners.forEach((listener) =&gt; {
		this.notifyListener(listener);	
	});
}
</code></pre>
</div>

<p>点击链接查看关于<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">箭头函数</a>
的更多内容。</p>

<h2 id="section-3">对象字面量</h2>

<blockquote>
  <p>字面量（或字面值）是源代码中用来描述固定值的记号（token），可能是一个数、
或者是一个字符串。</p>
</blockquote>

<p>当你要使用对象字面量的时候，现在有一种更优雅简洁的方式了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var age = 10, name = 'Petsy', size = 32;

// instead of this ...
var cat = {
	age: age,
	name: name,
	size: size
};

// ... do this ...
var cat = {
	age,
	name,
	size
};
</code></pre>
</div>

<p>并且你也可以轻松的在你的<a href="https://github.com/lukehoban/es6features#enhanced-object-literals">对象字面量里加入函数</a>了。</p>

<h2 id="promises">Promises</h2>

<p>现在，你不再需要像<code class="highlighter-rouge">bluebird</code>或者<code class="highlighter-rouge">Q</code>这样的第三方promise库了，你可以使用原生的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a>。
原生Promise主要暴露了一下的API：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var p1 = new Promise(function (resolve, reject) {});
var p2 = Promise.resolve(20);
var p3 = Promise.reject(new Error());
var p4 = Promise.all(p1, p2);
var p5 = Promise.race(p1, p2);
</code></pre>
</div>

<p>并且可以配合箭头函数像下面这样写代码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>p1.then(() =&gt; {}).catch(() =&gt; {});
</code></pre>
</div>

<h2 id="section-4">字符串方法</h2>

<p>字符串方法也得到了增强，你现在可以使用新的字符串工具方法了：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// replace `indexOf()` in a number of cases
name.startsWith('a')
name.endsWith('c');
name.includes('b');

// repeat the string three times
name.repeat(3);
</code></pre>
</div>

<p>并且，现在字符串也能<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/New_in_JavaScript/ECMAScript_6_support_in_Mozilla#Additions_to_the_String_object">更好的处理unicode的问题</a>了。</p>

<h2 id="letconst"><code class="highlighter-rouge">let</code>和<code class="highlighter-rouge">const</code></h2>

<p>猜猜以下函数调用的返回值：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var x = 20;
(function () {
	if (x === 20) {
		var x = 30;
	}
	return x;
}()); // -&gt; undefined
</code></pre>
</div>

<p>什么？<code class="highlighter-rouge">undefined</code>。使用<code class="highlighter-rouge">let</code>来替换<code class="highlighter-rouge">var</code>，你将会得到你想要的结果：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>let x = 20;
(function () {
	if (x === 20) {
		let x = 30;
	}
	return x;
}()); // -&gt; 20
</code></pre>
</div>

<p>解释一下原因：<code class="highlighter-rouge">var</code>是函数范围的，而<code class="highlighter-rouge">let</code>是代码块范围的（这也是大部分人期待的那样）。正因为此，你可以认为
<code class="highlighter-rouge">let</code>是一个新的<code class="highlighter-rouge">var</code>，用于取代<code class="highlighter-rouge">var</code>的缺陷。你可以从<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let">MDN</a>
获取关于let更多的内容。</p>

<p>福利：node现在也支持<code class="highlighter-rouge">const</code>关键字了，用于定义常量，避免你给一个常量赋予不同的值。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var MY_CONST = 42; // no, no
const MY_CONST = 42; // yes, yes

MY_CONST = 10 // with const, this is no longer possible
</code></pre>
</div>

<h2 id="section-5">总结</h2>

<p>Node v4带来了相当多的ES6特性，我希望上面的7个理由能够激发你去升级和使用最新的Node版本。</p>

<p>当然，还有更多的语言特性（例如，maps/sets, symbols和generators等）。所以，我强烈建议你阅读一下
<a href="https://nodejs.org/en/docs/es6/">overview of ES6 additions to Node v4</a>。快去升级吧。</p>

<h2 id="section-6">参考资料</h2>

<ol>
  <li><a href="https://nodejs.org/en/docs/es6/">ES6 on Node.js</a></li>
  <li><a href="https://nodejs.org/api/">Node.js v4.0.0 Documentation</a></li>
  <li><a href="https://github.com/nodejs/node/wiki/API-changes-between-v0.10-and-v4">API changes between v0.10 and v4</a></li>
</ol>
</article>
        </div>
    </div><!--#post-content-->

    <div id="ds-comment" class="container">
        <div class="ds-thread" data-thread-key="/posts/upgrade-to-node-v4.html" data-title="关于Node v4你必须知道几个ES6特性"></div>
        <script>
            var duoshuoQuery = {short_name:"wwsun"};  
            (function() {  
                var ds = document.createElement('script');  
                ds.type = 'text/javascript';
                ds.async = true;  
                ds.src = 'http://static.duoshuo.com/embed.js';  
                ds.charset = 'UTF-8';  
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);  
            })();
        </script>
    </div><!--#ds-comment-->

    <footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info container">
        <div class="row">
            <nav id="menu-social" class="social-icons">
                <ul id="menu-social-items" class="social-menu">
                    <li><a href="https://github.com/wwsun" title="Github" class="rss" target="_blank"><i class="social_icon fa fa-github"><span>Github</span></i></a></li>
                    <li><a href="http://weibo.com/234170023" title="Weibo" class="youtube" target="_blank"><i class="social_icon fa fa-weibo"><span>Weibo</span></i></a></li>
                    <li><a href="https://twitter.com/wsun38" title="Twitter" class="twitter" target="_blank"><i class="social_icon fa fa-twitter"><span>Twitter</span></i></a></li>
                    <li><a href="https://plus.google.com/u/0/101153267739962807712/posts" title="Google+" class="googleplus" target="_blank"><i class="social_icon fa fa-googleplus"><span>GooglePlus</span></i></a></li>
                    <li><a href="/about.html#wechatQr" title="Wechat" class="facebook" target="_blank"><i class="fa fa-weixin"><span>Wechat</span></i></a></li>
                </ul>
            </nav>
            <nav role="navigation" class="col-md-6">
                <ul id="menu-flat-footer" class="nav footer-nav clearfix">
                    <li><a href="http://weibo.com/swwol">Weibo</a></li>
                    <li><a href="https://github.com/wwsun">Github</a></li>
                    <li><a href="http://www.zhihu.com/people/wwsun">Zhihu</a></li>
                    <li><a href="http://www.youtube.com/user/bootstrapbayofficial">Lofter</a></li>
                    <li><a href="http://wwsun.github.io/">Blog</a></li>
                </ul>
            </nav>
            <div class="copyright col-md-6">
                <a href="http://wwsun.github.io/" title="Sparkling">Weiwei SUN</a> All rights reserved. Theme by 
                <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by
                <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
            </div>
        </div>
    </div>
    <!-- .site-info -->
    <div class="scroll-to-top"><i class="fa fa-angle-up"></i></div>
    <!-- .scroll-to-top -->
</footer><!-- #colophon -->



</body>

</html>
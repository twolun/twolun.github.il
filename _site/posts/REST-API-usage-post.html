<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>REST API使用指南</title>
    <meta name="description" content="">
    <!--<link rel="stylesheet" href="/assets/css/bootstrap.min.css">-->
    <!--<link rel="stylesheet" href="/assets/css/font-awesome.min.css">-->
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/syntax-highlight.css">
    
    <link rel="stylesheet" href="/assets/css/proj-layout.css">
    <script src="/assets/js/swiftype.js"></script>
    <!--<script src="/assets/js/jquery.js"></script>-->
    <!--<script src="/assets/js/modernizr.min.js"></script>-->
    <!--<script src="/assets/js/bootstrap.min.js"></script>-->
</head>

<body>
    <header>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <p class="site-name"><a class="navbar-brand" href="/" title="twolun">朱子</a></p>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">首页</a></li>
                    <li><a href="/project.html">项目总结</a></li>
                    <li><a href="/list.html">学习笔记</a></li>
                    <li><a href="/about.html">关于我</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- .site-navigation -->
</header>
    <div id="post-content" class="container">
        <br>
        <div class="well">
            <header class="page-header">
                <h1>REST API使用指南</h1>
                <p class="post-meta">Aug 7, 2014</p>
            </header>
            <article><p>我们了解了什么是REST, 并且知道大部分的网络服务都提供了REST API，国内的诸如微博、土豆等，国外的诸如google, twitter等。但是我们如何来具体的使用REST API呢，本文将介绍如何使用Java语言使用第三方REST API。
<!--more-->
###1. 基于Streaming的方式
这种方法比较传统，也是最为直观的开发方式，利用HttpURLConnection建立指向特定URL的连接请求，从而获取JSON字符串。Java API对HttpURLConnection的解释是：
&gt; 每个HttpURLConnection实例都可用于生成单个请求，但是其他实例可以透明地共享连接到HTTP服务器的基础网络。请求后在 HttpURLConnection 的 InputStream 或 OutputStream 上调用 close() 方法可以释放与此实例关联的网络资源，但对共享的持久连接没有任何影响。如果在调用 disconnect() 时持久连接空闲，则可能关闭基础套接字。</p>

<p>因此，我们可以使用如下的方法建立指向特定URL的HTTP连接：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>URL url = new URL("YOUR URL INSERT HERE");
HttpURLConnection conn = (HttpURLConnection) url.openConnection();
conn.setRequestMethod("GET");
conn.setRequestProperty("Accept", "application/json");
br = new BufferedReader(new InputStreamReader(conn.getInputStream()));
</code></pre>
</div>

<p>通过以上方法我们可以获得指向该URL的流对象。通过读取该流，我们自然可以获得该URL指向的web资源，即json字符串。流的读取非常简单，我们的想法是逐行读取该流对象，将其加入到一个StringBuffer对象中，最后输出整个StringBuffer字符串即可。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>String output;
StringBuffer sb = new StringBuffer();
while ((output = br.readLine()) != null) {
	sb.append(output);
}
String jsonString = sb.toString();//the final result
</code></pre>
</div>

<p>通过上面的方法我们便得到了该json字符串。既然是json字符串，我们就可以解析该json字符串，从而获取我们想要的数据。对Java而言，我们可以使用第三方的json-lib库，从字符串构造json对象，然后解析json对象。</p>

<p>这种方法，<strong><em>还有一种简单的写法</em></strong>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>URL url = new URL("REST_URL_HERE");
InputStream is = url.openStream();
ByteArrayOutputStream os = new ByteArrayOutputStream();
int retVal;
while ((retVal = is.read()) != -1) {
    os.write(retVal);
}
final String tweetsString = os.toString();
</code></pre>
</div>

<h3 id="jersey">2. 使用Jersey</h3>
<p>前面的博客我们简单的介绍了Jersey，Jersey是JSR 311的参考实现，可以用于构造和解析REST API。Jersey的引入可以使问题变的更简单。在使用之前，我们需要引入Jersey库及相关的依赖。</p>

<p>构造Jersey Client, 通过如下的方法建立指定URL的HTTP连接：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>javax.ws.rs.client.Client client = javax.ws.rs.client.ClientBuilder.newClient();
javax.ws.rs.client.WebRarget webTarget = client.target("YOUR_URI").path("CHILD_URI");
</code></pre>
</div>

<p>通常我们可以将其放在构造的Jersey Client的构造函数中，这样连接的建立工作可以直接在初始化时完成。下面我们只要构造对指向URI的读写方法，可以通过如下的代码完成：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public &lt;T&gt; T find_JSON_REST(Class&lt;T&gt; responseType, String text) throws ClientErrorException {
    WebTarget resource = webTarget;
    resource = resource.queryParam("parameter 1", "parameter value");//set param/value
    resource = resource.queryParam("parameter 2", "parameter value");//set param/value
    return resource.request(javax.ws.rs.core.MediaType.APPLICATION_JSON).get(responseType);
}
</code></pre>
</div>

<p>完成以上工作后，我们基本就完成了任务。最后，我们可以编写如下的测试代码。这段代码指定了响应类型为String, 并且传入了一个自定义参数。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>/**
 * 
 * @param responseType
 * @param text your self-defined parameter
 * @return
 */
public static void main(String[] args) {
    TestJerseyClient movieClient = new TestJerseyClient();
    JSONObject jo = JSONObject.fromObject(movieClient.find_JSON_REST(String.class, "YOUR_SELF_DEFINED_PARAMETER"));
    System.out.println(jo.toString());
}
</code></pre>
</div>
</article>
        </div>
    </div><!--#post-content-->

    <div id="ds-comment" class="container">
        <div class="ds-thread" data-thread-key="/posts/REST-API-usage-post.html" data-title="REST API使用指南"></div>
        <script>
            var duoshuoQuery = {short_name:"wwsun"};  
            (function() {  
                var ds = document.createElement('script');  
                ds.type = 'text/javascript';
                ds.async = true;  
                ds.src = 'http://static.duoshuo.com/embed.js';  
                ds.charset = 'UTF-8';  
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);  
            })();
        </script>
    </div><!--#ds-comment-->

    <footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info container">
        <div class="row">
            <nav id="menu-social" class="social-icons">
                <ul id="menu-social-items" class="social-menu">
                    <li><a href="https://github.com/twolun" title="Github" class="rss" target="_blank"><i class="social_icon fa fa-github"><span>Github</span></i></a></li>
                    <li><a href="/about.html#wechatQr" title="Wechat" class="facebook" target="_blank"><i class="fa fa-weixin"><span>Wechat</span></i></a></li>
                </ul>
            </nav>
            <nav role="navigation" class="col-md-6">
                <ul id="menu-flat-footer" class="nav footer-nav clearfix">
                    <li><a href="https://github.com/twolun">Github</a></li>
                    <li><a href="http://twolun.github.io/">Blog</a></li>
                </ul>
            </nav>
            <div class="copyright col-md-6">
                <a href="http://twolun.github.io/" title="Sparkling">朱了</a> All rights reserved. Theme by 
                <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
            </div>
        </div>
    </div>
    <!-- .site-info -->
    <div class="scroll-to-top"><i class="fa fa-angle-up"></i></div>
    <!-- .scroll-to-top -->
</footer><!-- #colophon -->



</body>

</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Lodash中十个常用的工具函数</title>
    <meta name="description" content="">
    <!--<link rel="stylesheet" href="/assets/css/bootstrap.min.css">-->
    <!--<link rel="stylesheet" href="/assets/css/font-awesome.min.css">-->
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/syntax-highlight.css">
    
    <link rel="stylesheet" href="/assets/css/proj-layout.css">
    <script src="/assets/js/swiftype.js"></script>
    <!--<script src="/assets/js/jquery.js"></script>-->
    <!--<script src="/assets/js/modernizr.min.js"></script>-->
    <!--<script src="/assets/js/bootstrap.min.js"></script>-->
</head>

<body>
    <header>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <p class="site-name"><a class="navbar-brand" href="/" title="twolun">双轮行</a></p>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">HOME</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/project.html">Projects</a></li>
                    <li><a href="/list.html">Posts</a></li>
                    <li><a href="http://wwsun.lofter.com/" target="_blank">Lofter</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- .site-navigation -->
</header>
    <div id="post-content" class="container">
        <br>
        <div class="well">
            <header class="page-header">
                <h1>Lodash中十个常用的工具函数</h1>
                <p class="post-meta">Nov 2, 2015</p>
            </header>
            <article><p>当你使用JavaScript进行编程的时候，你很可能需要经常重复写一些工具函数，尤其是处理字符串和对象。
即使ES6已经被标准化了，JavaScript开发者依然无法获得像Objective-C或Ruby那样多的语法糖。
因此，在JavaScript应用中仍然被重复的编写大量的工具函数。而本文将会为你带来的救星就是<a href="https://lodash.com/">Loadsh</a>。</p>

<!--more-->

<p>本文将要介绍的是Loadash中的10个常用的工具函数，当然对于不同的工作，你很可能也会需要其他的工具函数，
本文仅作为一个入门Lodash的引子，完整的函数列表请参考Lodash的<a href="https://lodash.com/docs">API文档</a>。
本文使用的Lodash版本是<code class="highlighter-rouge">3.10.1</code>。</p>

<h2 id="statement">Statement</h2>

<blockquote>
  <p>原文地址： http://colintoh.com/blog/lodash-10-javascript-utility-functions-stop-rewriting</p>
</blockquote>

<h3 id="n">循环N次</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>// 1. Basic for loop.
for(var i = 0; i &lt; 5; i++) {
	// ....
}

// 2. Using Array's join and split methods
Array.apply(null, Array(5)).forEach(function(){
	// ...
});

// Lodash
_.times(5, function(){
	// ...
});
</code></pre>
</div>

<p><code class="highlighter-rouge">for</code>循环是一个常见的使用场景，但是它会引入附加变量污染作用域（scope）。
你可以组合使用数组和<code class="highlighter-rouge">apply</code>方法来避免直接使用for循环，这样也避免了作用域污染的问题。
但是，这种写法不够直观。Lodash总的<code class="highlighter-rouge">_.times</code>方法就非常的直观易用。</p>

<h3 id="section">迭代数组并返回每一项中深度嵌套的属性</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>// Fetch the name of the first pet from each owner
var ownerArr = [{
	"owner": "Colin",
	"pets": [{"name":"dog1"}, {"name": "dog2"}]
}, {
	"owner": "John",
	"pets": [{"name":"dog3"}, {"name": "dog4"}]
}];

// Array's map method.
ownerArr.map(function(owner){
	return owner.pets[0].name;
});

// Lodash
_.map(ownerArr, 'pets[0].name');
</code></pre>
</div>

<p>Lodash中的<code class="highlighter-rouge">map</code>方法和JavaScript中原生的数组方法非常的像，但它还是有非常有用的升级。
你可以通过一个字符串而不是回调函数来导航到深度嵌套的对象属性。</p>

<h3 id="n-1">创建一个大小为N的数组，并且为他们添加相同的前缀</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>// Create an array of length 6 and populate them with unique values. The value must be prefix with "ball_".
// eg. [ball_0, ball_1, ball_2, ball_3, ball_4, ball_5]

// Array's map method.
Array.apply(null, Array(6)).map(function(item, index){
	return "ball_" + index;
});


// Lodash
_.times(6, _.uniqueId.bind(null, 'ball_'));
</code></pre>
</div>

<p>从前面的例子中我们已经知道了<code class="highlighter-rouge">_.times</code>的作用。如果你将它和<code class="highlighter-rouge">_.uniqueId</code>方法组合使用，
我们可以获得一个更简洁的解决方案。如果你不想重复的声明上下文，Lodash也提供了一个可选方案。</p>

<p><strong>避免使用<code class="highlighter-rouge">.bind(null,...)</code></strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>// Lodash
_.times(6, _.partial(_.uniqueId, 'ball_'));
</code></pre>
</div>

<p><code class="highlighter-rouge">_.partial</code>方法完成的工作和原生的<code class="highlighter-rouge">bind()</code>方法很类似，除了它假设当前的上下文为<code class="highlighter-rouge">this</code>。
因此，没必要再额外的指定上下文参数。</p>

<h3 id="javascript">深度克隆JavaScript对象</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>var objA = {
	"name": "colin"
}

// Normal method? Too long. See Stackoverflow for solution: http://stackoverflow.com/questions/4459928/how-to-deep-clone-in-javascript

// Lodash
var objB = _.cloneDeep(objA);
objB === objA // false
</code></pre>
</div>

<p>深度克隆JavaScript对象是困难的，并且也没有什么简单的解决方案。你可以使用原生的解决方案：
<code class="highlighter-rouge">JSON.parse(JSON.stringify(objectToClone))</code>进行深度克隆。但是，这种方案仅在对象内部没有方法的时候才可行。</p>

<p>Lodash提供了<code class="highlighter-rouge">_.cloneDeep</code>方法来帮你简单的完成对象的深度克隆操作。当然，使用<code class="highlighter-rouge">_.clone</code>你还能灵活的指定克隆的深度。</p>

<h3 id="section-1">在指定范围内获取一个随机值</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>// Get a random number between 15 and 20.

// Naive utility method
function getRandomNumber(min, max){
	return Math.floor(Math.random() * (max - min)) + min;
}

getRandomNumber(15, 20);

// Lodash
_.random(15, 20);
</code></pre>
</div>

<p>Lodash中的<code class="highlighter-rouge">random</code>方法要比上面的原生方法更强大与灵活。你可以只传入一个参数作为最大值，
你也可以指定返回的结果为浮点数。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>_.random(20); // Return random number between 0 to 20
_.random(15, 20, true); // Return random floating numbers between 15 and 20
</code></pre>
</div>

<h3 id="section-2">扩展对象</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>// Adding extend function to Object.prototype
Object.prototype.extend = function(obj) {
	for (var i in obj) {
		if (obj.hasOwnProperty(i)) {
			this[i] = obj[i];
		}
	}
};

var objA = {"name": "colin", "car": "suzuki"};
var objB = {"name": "james", "age": 17};

objA.extend(objB);
objA; // {"name": "james", "age": 17, "car": "suzuki"};

// Lodash
_.assign(objA, objB);
</code></pre>
</div>

<p><code class="highlighter-rouge">_.assign</code>方法也可以接收多个参数对象进行扩展。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var objA = {"name": "colin", "car": "suzuki"};
var objB = {"name": "james", "age": 17};
var objC = {"pet": "dog"};

// Lodash
_.assign(objA, objB, objC)
// {"name": "james", "car": "suzuki", "age": 17, "pet": "dog"}
</code></pre>
</div>

<h3 id="section-3">去掉对象的某些属性</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>// Naive method: Remove an array of keys from object
Object.prototype.remove = function(arr) {
	var that = this;
	arr.forEach(function(key){
		delete(that[key]);
	});
};

var objA = {"name": "colin", "car": "suzuki", "age": 17};

objA.remove(['car', 'age']);
objA; // {"name": "colin"}

// Lodash
objA = _.omit(objA, ['car', 'age']); // {"name": "colin"}
</code></pre>
</div>

<p>原生的途径你只能传递数组作为参数。有时我们可能也想对字符串参数进行单个key的删除，甚至是传入一个比较器。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var objA = {"name": "colin", "car": "suzuki", "age": 17};

// Lodash
objA = _.omit(objA, 'car'); // {"name": "colin", "age": 17};
objA = _.omit(objA, _.isNumber); // {"name": "colin"};
</code></pre>
</div>

<p>你需要注意的是，<code class="highlighter-rouge">_.omit</code>方法会返回一个新的对象，而不会修改原来的对象。</p>

<h3 id="section-4">从某个对象中选择部分属性组成新的对象</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>// Naive method: Returning a new object with selected properties 
Object.prototype.pick = function(arr) {
	var _this = this;
	var obj = {};
	arr.forEach(function(key){
		obj[key] = _this[key];
	});

	return obj;
};

var objA = {"name": "colin", "car": "suzuki", "age": 17};

var objB = objA.pick(['car', 'age']);
// {"car": "suzuki", "age": 17}

// Lodash
var objB = _.pick(objA, ['car', 'age']);
// {"car": "suzuki", "age": 17}
</code></pre>
</div>

<p><code class="highlighter-rouge">_.pick</code>方法与<code class="highlighter-rouge">_.omit</code>方法正好相反，它会从对象中选择指定的属性组装成新的对象。
和<code class="highlighter-rouge">_.omit</code>一样，<code class="highlighter-rouge">_.pick</code>也会返回新的对象，并且能够传入字符串、数组、比较器函数。</p>

<h3 id="section-5">从列表中随机的选择列表项</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>var luckyDraw = ["Colin", "John", "James", "Lily", "Mary"];

function pickRandomPerson(luckyDraw){
	var index = Math.floor(Math.random() * (luckyDraw.length -1));
	return luckyDraw[index];
}

pickRandomPerson(luckyDraw); // John

// Lodash
_.sample(luckyDraw); // Colin
</code></pre>
</div>

<p>此外，你也可以指定随机返回元素的个数。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var luckyDraw = ["Colin", "John", "James", "Lily", "Mary"];

// Lodash - Getting 2 random item
_.sample(luckyDraw, 2); // ['John','Lily']
</code></pre>
</div>

<h3 id="jsonparse">JSON.parse的错误处理</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>// Using try-catch to handle the JSON.parse error
function parse(str){
	try {
		return JSON.parse(str);
	}

	catch {
		return false;
	}
}

// With Lodash
function parseLodash(str){
	return _.attempt(JSON.parse.bind(null, str));
}

parse('a'); // false
parseLodash('a'); // Return an error object

parse('{"name": "colin"}'); // Return {"name": "colin"}
parseLodash('{"name": "colin"}'); // Return {"name": "colin"}
</code></pre>
</div>

<p>当你使用<code class="highlighter-rouge">JSON.parse</code>时，请记住一定要进行错误处理。如果没有即使得进行处理，
很可能成为巨大的安全隐患。永远都不要假设你接收到的一定是正确有效的JSON对象。
取代原生的使用<code class="highlighter-rouge">try...catch</code>进行错误处理，你可以使用<code class="highlighter-rouge">_.attempt</code>方法。
如果出错的话，它会返回一个<code class="highlighter-rouge">Error</code>对象。</p>

<h2 id="section-6">小结</h2>

<p>Lodash能够为你解决非常多小的细节问题，推荐你在JavaScript项目中使用它，它能让你的代码看起来更加的精简，
也更加的健壮，帮你避免很多重复的应用逻辑。此外，Lodash也迫使我们以函数式的方式来思考编程。
我们可以将应用切分为若干个小且专注的模块。这种模块化能够提高我们应用程序在测试时的代码覆盖率。</p>
</article>
        </div>
    </div><!--#post-content-->

    <div id="ds-comment" class="container">
        <div class="ds-thread" data-thread-key="/posts/lodash-top-10-functions.html" data-title="Lodash中十个常用的工具函数"></div>
        <script>
            var duoshuoQuery = {short_name:"wwsun"};  
            (function() {  
                var ds = document.createElement('script');  
                ds.type = 'text/javascript';
                ds.async = true;  
                ds.src = 'http://static.duoshuo.com/embed.js';  
                ds.charset = 'UTF-8';  
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);  
            })();
        </script>
    </div><!--#ds-comment-->

    <footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info container">
        <div class="row">
            <nav id="menu-social" class="social-icons">
                <ul id="menu-social-items" class="social-menu">
                    <li><a href="https://github.com/wwsun" title="Github" class="rss" target="_blank"><i class="social_icon fa fa-github"><span>Github</span></i></a></li>
                    <li><a href="http://weibo.com/234170023" title="Weibo" class="youtube" target="_blank"><i class="social_icon fa fa-weibo"><span>Weibo</span></i></a></li>
                    <li><a href="https://twitter.com/wsun38" title="Twitter" class="twitter" target="_blank"><i class="social_icon fa fa-twitter"><span>Twitter</span></i></a></li>
                    <li><a href="https://plus.google.com/u/0/101153267739962807712/posts" title="Google+" class="googleplus" target="_blank"><i class="social_icon fa fa-googleplus"><span>GooglePlus</span></i></a></li>
                    <li><a href="/about.html#wechatQr" title="Wechat" class="facebook" target="_blank"><i class="fa fa-weixin"><span>Wechat</span></i></a></li>
                </ul>
            </nav>
            <nav role="navigation" class="col-md-6">
                <ul id="menu-flat-footer" class="nav footer-nav clearfix">
                    <li><a href="http://weibo.com/swwol">Weibo</a></li>
                    <li><a href="https://github.com/wwsun">Github</a></li>
                    <li><a href="http://www.zhihu.com/people/wwsun">Zhihu</a></li>
                    <li><a href="http://www.youtube.com/user/bootstrapbayofficial">Lofter</a></li>
                    <li><a href="http://wwsun.github.io/">Blog</a></li>
                </ul>
            </nav>
            <div class="copyright col-md-6">
                <a href="http://wwsun.github.io/" title="Sparkling">Weiwei SUN</a> All rights reserved. Theme by 
                <a href="http://colorlib.com/" target="_blank">Colorlib</a> Powered by
                <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
            </div>
        </div>
    </div>
    <!-- .site-info -->
    <div class="scroll-to-top"><i class="fa fa-angle-up"></i></div>
    <!-- .scroll-to-top -->
</footer><!-- #colophon -->

<!-- Google Tag Manager -->
<noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-KJHNXB" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>

<script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KJHNXB');
</script>
<!-- End Google Tag Manager -->

</body>

</html>
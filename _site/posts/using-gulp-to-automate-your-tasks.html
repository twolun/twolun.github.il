<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>使用Gulp.js来自动化你的任务</title>
    <meta name="description" content="">
    <!--<link rel="stylesheet" href="/assets/css/bootstrap.min.css">-->
    <!--<link rel="stylesheet" href="/assets/css/font-awesome.min.css">-->
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://fonts.useso.com/css?family=Roboto">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/syntax-highlight.css">
    
    <link rel="stylesheet" href="/assets/css/proj-layout.css">
    <script src="/assets/js/swiftype.js"></script>
    <!--<script src="/assets/js/jquery.js"></script>-->
    <!--<script src="/assets/js/modernizr.min.js"></script>-->
    <!--<script src="/assets/js/bootstrap.min.js"></script>-->
</head>

<body>
    <header>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <p class="site-name"><a class="navbar-brand" href="/" title="twolun">朱子</a></p>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">首页</a></li>
                    <li><a href="/project.html">项目总结</a></li>
                    <li><a href="/list.html">学习笔记</a></li>
                    <li><a href="/about.html">关于我</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- .site-navigation -->
</header>
    <div id="post-content" class="container">
        <br>
        <div class="well">
            <header class="page-header">
                <h1>使用Gulp.js来自动化你的任务</h1>
                <p class="post-meta">Feb 26, 2016</p>
            </header>
            <article><p>作为开发者而言，我们需要经常确保自己使用了合适的开发工具来提高我们的开发效率。对于JavaScript的项目构建而言，
Chris开发了Grunt，它极大的便利了项目的构建工作。本文将会介绍一个比Grunt更优雅的项目构建工具——Gulp。</p>

<!--more-->

<h2 id="statement">Statement</h2>

<ul>
  <li><strong>作者：</strong> <a href="http://wwsun.github.com">景庄</a>，Web开发者，主要关注JavaScript、Node.js、React、Docker等。</li>
</ul>

<h2 id="gulpjs">Gulp.js</h2>

<p>在几个月前，我<a href="http://wwsun.github.io/posts/grunt-getting-started.html">曾经介绍过Grunt</a>，
今天将要介绍的是一个和Grunt类似的构建工具——Gulp。
Gulp和Grunt都是完全使用JavaScript实现的构建工具，不过，Gulp是一个流式构建系统，
它完全借助了Node的流文件操纵功能，在内存中完成构建工作。整个插件都是通过<code class="highlighter-rouge">pipe()</code>函数来赋予。</p>

<p>Gulp的最大特点在于流的使用，数据流能够同故宫一系列的小函数来传递数据，这些函数会对数据进行修改，
然后把修改后的数据传递给下一个函数。和Linux中的管道概念是一个意思。流可以相互链接。</p>

<p>注意，Gulp管道中的流不是操作Strings和Buffers的常规Node.js流，
而是启用<a href="https://nodejs.org/dist/latest-v4.x/docs/api/stream.html#stream_object_mode">object mode</a>的流。
Gulp中的流发送的是vinyl文件对象。</p>

<p>有关Node中流的介绍，请参考<a href="https://nodejs.org/dist/latest-v4.x/docs/api/stream.html#stream_stream">官方文档</a>。</p>

<h2 id="gulp">安装Gulp</h2>

<p>安装Gulp非常的简单，只要遵循下面三个步骤即可：</p>

<ol>
  <li>全局安装Gulp</li>
  <li>安装Gulp到项目的<code class="highlighter-rouge">devDependencies</code>中</li>
  <li>
    <p>在项目根目录创建<code class="highlighter-rouge">gulpfile.js</code>文件</p>

    <p>$ npm install -g gulp
 $ npm install –save-dev gulp</p>
  </li>
</ol>

<p>我们安装Gulp的工具插件用于可视化任务的执行过程：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install --save-dev gulp-util
</code></pre>
</div>

<p>在项目根目录创建完<code class="highlighter-rouge">gulpfile.js</code>后，我们加入如下基础代码：</p>

<p>```javascript
// grab our gulp packages
var gulp  = require(‘gulp’),
    gutil = require(‘gulp-util’);</p>

<p>// create a default task and just log a message
gulp.task(‘default’, function() {
  return gutil.log(‘Gulp is running!’)
});
```</p>

<p>现在你可以通过<code class="highlighter-rouge">gulp</code>命令来启动Gulp。你可以在项目的<code class="highlighter-rouge">package.json</code>文件中的<code class="highlighter-rouge">scripts</code>属性中加入：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>"gulp": "gulp"
</code></pre>
</div>

<h2 id="gulp-1">Gulp使用手册</h2>

<p>Gulp是一个流式构建系统。它的流式特性意味着开发者</p>

<p>Gulp API主要包括4个顶级函数。如下</p>

<ul>
  <li><code class="highlighter-rouge">gulp.task(name, deps, fn)</code>  定义任务</li>
  <li><code class="highlighter-rouge">gulp.src(globs, [opt])</code>  指向我们想要操作的源文件</li>
  <li><code class="highlighter-rouge">gulp.dest</code>  指向输出文件</li>
  <li><code class="highlighter-rouge">gulp.watch</code>  用于监视文件的变化</li>
</ul>

<p>其中文文档可以参考<a href="https://github.com/lisposter/gulp-docs-zh-cn/blob/master/API.md">该链接</a>。</p>

<h3 id="gulptaskname-deps-fn"><code class="highlighter-rouge">gulp.task(name[, deps], fn)</code></h3>

<p>用于定义Gulp任务。包括三个参数</p>

<ul>
  <li>name: 任务名，字符串</li>
  <li>deps: 一组依赖任务的数组，它是可选的</li>
  <li>fn: 执行任务的函数</li>
</ul>

<p>```javascript
gulp.task(‘mytask’, function() {
  //do stuff
});</p>

<p>gulp.task(‘dependenttask’, [‘mytask’], function() {
  //do stuff after ‘mytask’ is done.
});
```</p>

<p>详细内容请参考<a href="https://github.com/lisposter/gulp-docs-zh-cn/blob/master/API.md#gulptaskname-deps-fn">该链接</a>。</p>

<h3 id="gulpsrcglobs-optionsgulpdestpath-options"><code class="highlighter-rouge">gulp.src(globs[, options])</code>和<code class="highlighter-rouge">gulp.dest(path[, options])</code></h3>

<p><code class="highlighter-rouge">gulp.src</code>指向我们想要使用的文件。它的参数是globs和可选的选项对象。它使用<code class="highlighter-rouge">.pipe()</code>将输出值链接（chaining）到其他插件中。</p>

<p>详细内容请参考<a href="https://github.com/lisposter/gulp-docs-zh-cn/blob/master/API.md#gulpsrcglobs-options">该链接</a></p>

<p><code class="highlighter-rouge">gulp.dest</code>指向我们想要写入结果文件的输出文件夹。</p>

<p>假如我们想要定义一个任务<code class="highlighter-rouge">copHtml</code>将输入文件复制到输出文件夹中，代码如下：</p>

<p><code class="highlighter-rouge">javascript
gulp.task('copyHtml', function() {
  // copy any html files in source/ to public/
  gulp.src('source/*.html').pipe(gulp.dest('public'));
});
</code></p>

<h3 id="gulpwatchglob-opts-tasks"><code class="highlighter-rouge">gulp.watch(glob[, opts], tasks)</code></h3>

<p>和<code class="highlighter-rouge">gulp.task</code>类似，<code class="highlighter-rouge">gulp.watch</code>也有一个可选的中间参数。<code class="highlighter-rouge">gulp.watch</code>返回的是一个发射（emits）<code class="highlighter-rouge">change</code>事件的<code class="highlighter-rouge">EventEmitter</code>。</p>

<p><code class="highlighter-rouge">javascript
gulp.watch('source/javascript/**/*.js', ['jshint']);
</code></p>

<p>匹配的任意文件如果发生了变化，就会自动触发<code class="highlighter-rouge">jshint</code>任务。</p>

<p>详细内容请参考<a href="https://github.com/lisposter/gulp-docs-zh-cn/blob/master/API.md#gulpwatchglob--opts-tasks-或-gulpwatchglob--opts-cb">该链接</a></p>

<h2 id="section">常用任务</h2>

<h3 id="jshint">JShint</h3>

<p>每次我们保存一个JS文件的时候就利用JSHint进行代码检查。我们需要如下插件：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install --save-dev gulp-jshint jshint-stylish
</code></pre>
</div>

<p>任务编写如下：</p>

<p>```javascript
// grab our packages
var gulp   = require(‘gulp’),
    jshint = require(‘gulp-jshint’);</p>

<p>// define the default task and add the watch task to it
gulp.task(‘default’, [‘watch’]);</p>

<p>// configure the jshint task
gulp.task(‘jshint’, function() {
  return gulp.src(‘source/javascript/<em>*/</em>.js’)
    .pipe(jshint())
    .pipe(jshint.reporter(‘jshint-stylish’));
});</p>

<p>// configure which files to watch and what tasks to use on file changes
gulp.task(‘watch’, function() {
  gulp.watch(‘source/javascript/<em>*/</em>.js’, [‘jshint’]);
});
```</p>

<p>如果你要单独的执行<code class="highlighter-rouge">jshint</code>任务，你可以使用如下命令：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ gulp jshint
</code></pre>
</div>

<h3 id="sass">编译Sass文件</h3>

<p><a href="http://sass-lang.com/">Sass</a>是一个常用的CSS预处理语言，它用于增强CSS。我们需要安装<code class="highlighter-rouge">gulp-sass</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install --save-dev gulp-sass
</code></pre>
</div>

<p>任务实现如下：</p>

<p>```javascript
var gulp   = require(‘gulp’),
    jshint = require(‘gulp-jshint’),
    sass   = require(‘gulp-sass’);</p>

<p>/* jshint task would be here */</p>

<p>gulp.task(‘build-css’, function() {
  return gulp.src(‘source/scss/<em>*/</em>.scss’)
    .pipe(sass())
    .pipe(gulp.dest(‘public/assets/stylesheets’));
});</p>

<p>/* updated watch task to include sass */</p>

<p>gulp.task(‘watch’, function() {
  gulp.watch(‘source/javascript/<em>*/</em>.js’, [‘jshint’]);
  gulp.watch(‘source/scss/<em>*/</em>.scss’, [‘build-css’]);
});
```</p>

<p>我们还可以加入<code class="highlighter-rouge">gulp-sourcemaps</code>。Sourcemap是一种用于将处理过的、最小化过的、更改过的文件映射到源文件的强大功能。
支持<code class="highlighter-rouge">gulp-sourcemaps</code>的插件列表可以参考<a href="https://github.com/floridoo/gulp-sourcemaps/wiki/Plugins-with-gulp-sourcemaps-support">该链接</a>。</p>

<p>```javascript
var gulp       = require(‘gulp’),
    jshint     = require(‘gulp-jshint’),
    sass       = require(‘gulp-sass’),
    sourcemaps = require(‘gulp-sourcemaps’);</p>

<p>gulp.task(‘build-css’, function() {
  return gulp.src(‘source/scss/<em>*/</em>.scss’)
    .pipe(sourcemaps.init())  // Process the original sources
      .pipe(sass())
    .pipe(sourcemaps.write()) // Add the map to modified source.
    .pipe(gulp.dest(‘public/assets/stylesheets’));
});
```</p>

<p>如果你使用的是Less，那么可以使用<code class="highlighter-rouge">gulp-less</code>插件，使用起来也非常的简单：</p>

<p>```javascript
var less = require(‘gulp-less’);</p>

<p>gulp.task(‘less’, function() {
    return gulp.src(‘src/less/*.less’)
        .pipe(less())
        .pipe(gulp.dest(‘src/css’));
});
```</p>

<h3 id="javascript">JavaScript拼接和最小化</h3>

<p>我们经常需要将多个文件合并在一起，或者是将一个大文件进行最小化（去除其中的空格等），借助gulp我们能够很容易的做到这些。
需要安装如下依赖：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ npm install --save-dev gulp-concat gulp-uglify
</code></pre>
</div>

<p>任务实现如下:</p>

<p><code class="highlighter-rouge">javascript
gulp.task('build-js', function() {
  return gulp.src('source/javascript/**/*.js')
    .pipe(sourcemaps.init())
      .pipe(concat('bundle.js'))
      //only uglify if gulp is ran with '--type production'
      .pipe(gutil.env.type === 'production' ? uglify() : gutil.noop()) 
    .pipe(sourcemaps.write())
    .pipe(gulp.dest('public/assets/javascript'));
});
</code></p>

<h2 id="section-1">插件</h2>

<p>Gulp的插件列表你可以使用<a href="http://gulpjs.com/">这个工具</a>进行检索。</p>

<h3 id="gulp-load-plugins">gulp-load-plugins</h3>

<p><a href="https://github.com/jackfranklin/gulp-load-plugins">gulp-load-plugins</a>是一个非常有用的插件，
它能够自动的从<code class="highlighter-rouge">package.json</code>中加载所有的Gulp插件，然后将它们附加到一个对象上。它的用法如下：</p>

<p>```javascript
var gulp = require(‘gulp’);
var plugins = require(‘gulp-load-plugins’)();</p>

<p>gulp.task(‘js’, function () {
   return gulp.src(‘js/*.js’)
     .pipe(plugins.jshint())
     .pipe(plugins.jshint.reporter(‘default’))
     .pipe(plugins.uglify())
     .pipe(plugins.concat(‘app.js’))
     .pipe(gulp.dest(‘build’)); 
});
```</p>

<h2 id="section-2">小结</h2>

<p>在本文中我们只浅显的探讨了Gulp的使用。Gulp还能够执行很多复杂的任务，因为Gulp依赖于你编写代码来实现这些任务。
例如，我们可以自动化构建项目源文件，实现文件的检查、拼接、最小化，然后在将构建后的项目自动部署到线上。
通过Gulp你能够快速而简单的完成这些任务。有关Gulp的高级用法，你可以参考<a href="http://csspod.com/advanced-tips-for-using-gulp-js/">这篇博文</a>。</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://github.com/lisposter/gulp-docs-zh-cn/blob/master/API.md">Gulp API Docs</a></li>
  <li><a href="http://gulpjs.com/">Gulp Website</a></li>
  <li><a href="https://scotch.io/tutorials/automate-your-tasks-easily-with-gulp-js">Gulp tutorial</a></li>
  <li><a href="http://zinoui.com/blog/task-automation-with-gulp-js">Another Gulp tutorial</a></li>
  <li><a href="https://nodejs.org/dist/latest-v4.x/docs/api/stream.html#stream_stream">Node.js API: Stream</a></li>
</ul>
</article>
        </div>
    </div><!--#post-content-->

    <div id="ds-comment" class="container">
        <div class="ds-thread" data-thread-key="/posts/using-gulp-to-automate-your-tasks.html" data-title="使用Gulp.js来自动化你的任务"></div>
        <script>
            var duoshuoQuery = {short_name:"wwsun"};  
            (function() {  
                var ds = document.createElement('script');  
                ds.type = 'text/javascript';
                ds.async = true;  
                ds.src = 'http://static.duoshuo.com/embed.js';  
                ds.charset = 'UTF-8';  
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);  
            })();
        </script>
    </div><!--#ds-comment-->

    <footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info container">
        <div class="row">
            <nav id="menu-social" class="social-icons">
                <ul id="menu-social-items" class="social-menu">
                    <li><a href="https://github.com/twolun" title="Github" class="rss" target="_blank"><i class="social_icon fa fa-github"><span>Github</span></i></a></li>
                    <li><a href="/about.html#wechatQr" title="Wechat" class="facebook" target="_blank"><i class="fa fa-weixin"><span>Wechat</span></i></a></li>
                </ul>
            </nav>
            <nav role="navigation" class="col-md-6">
                <ul id="menu-flat-footer" class="nav footer-nav clearfix">
                    <li><a href="https://github.com/twolun">Github</a></li>
                    <li><a href="http://twolun.github.io/">Blog</a></li>
                </ul>
            </nav>
            <div class="copyright col-md-6">
                <a href="http://twolun.github.io/" title="Sparkling">朱了</a> All rights reserved. Theme by 
                <a href="https://pages.github.com/" target="_blank">Github Pages</a> and <a href="https://jekyllrb.com/" target="_blank">Jekyll</a>
            </div>
        </div>
    </div>
    <!-- .site-info -->
    <div class="scroll-to-top"><i class="fa fa-angle-up"></i></div>
    <!-- .scroll-to-top -->
</footer><!-- #colophon -->



</body>

</html>